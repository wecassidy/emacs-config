<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2021-02-11 Thu 00:10 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Doom Emacs Configuration</title>
<meta name="author" content="tecosaur" />
<meta name="generator" content="org mode" />
<meta name="theme-color" content="#77aa99" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Doom Emacs Configuration" />
<meta property="og:description" content="The Methods, Management, and Menagerie of Madness" />
<meta property="og:image" content="https://tecosaur.com/resources/org/nib.png" />
<meta property="og:image:type" content="image/png" />
<meta property="og:image:width" content="200" />
<meta property="og:image:height" content="200" />
<meta property="og:image:alt" content="Green fountain pen nib" />
<meta property="og:article:author:first_name" content="tecosaur" />
<meta property="og:article:published_time" content="2021-02-11T00:10:41+0000" />
<link rel="icon" href="https://tecosaur.com/resources/org/nib.ico" type="image/ico" />

<link rel="preload" as="font" crossorigin="anonymous" type="font/woff2" href="https://tecosaur.com/resources/org/etbookot-roman-webfont.woff2">
<link rel="preload" as="font" crossorigin="anonymous" type="font/woff2" href="https://tecosaur.com/resources/org/etbookot-italic-webfont.woff2">
<link rel="preload" as="font" crossorigin="anonymous" type="font/woff2" href="https://tecosaur.com/resources/org/Merriweather-TextRegular.woff2">
<link rel="preload" as="font" crossorigin="anonymous" type="font/woff2" href="https://tecosaur.com/resources/org/Merriweather-TextItalic.woff2">
<link rel="preload" as="font" crossorigin="anonymous" type="font/woff2" href="https://tecosaur.com/resources/org/Merriweather-TextBold.woff2">
<script>
function copyPreToClipbord(btn) {
    const pre = btn.parentElement.parentElement.getElementsByTagName("PRE")[0];
    const range = document.createRange();
    range.selectNodeContents(pre);
    range.setEnd(pre.childNodes[pre.childNodes.length-1], 0);
    window.getSelection().addRange(range);
    var successful = document.execCommand('copy');
    window.getSelection().removeRange(range);
}
window.addEventListener('DOMContentLoaded', () => {
    const sections = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
    const activate = (entry) => {
        entry.classList.add('active');
        if (["LI", "UL"].includes(entry.parentElement.tagName)) {
            activate(entry.parentElement);
        }
    };
    const activateLast = () => {
        document.querySelectorAll('#text-table-of-contents li.active, #text-table-of-contents ul.active').forEach(a => {
            a.classList.remove('active')
        });
        let mostRecent = { section: sections[0], bottom: -Infinity };
        const windowHeight = window.innerHeight;
        sections.forEach((section) => {
            const bounds = section.getBoundingClientRect()
            if ( bounds.bottom > mostRecent.bottom && bounds.top < windowHeight ) {
                mostRecent = { section, bottom: bounds.bottom };
            }
        })
        activate(document.querySelector(`#text-table-of-contents li a[href="#${mostRecent.section.getAttribute('id')}"]`).parentElement);
    }

    const observer = new IntersectionObserver(entries => {
        activateLast();
    });

    sections.forEach((section) => {
        observer.observe(section);
    });
});
</script>
<style>
@charset "UTF-8";
/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */
html {
  line-height: 1.15;
  -webkit-text-size-adjust: 100%; }

body {
  margin: 0; }

h1 {
  font-size: 2em;
  margin: 0.67em 0; }

hr {
  box-sizing: content-box;
  height: 0; }

pre {
  font-family: monospace, monospace;
  font-size: 1em; }

b {
  font-weight: bolder; }

code,
kbd,
samp {
  font-family: monospace, monospace;
  font-size: 1em; }

small {
  font-size: 80%; }

sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline; }

sub {
  bottom: -0.25em; }

sup {
  top: -0.5em; }

button,
input,
optgroup,
select,
textarea {
  font-family: inherit;
  font-size: 100%;
  line-height: 1.15;
  margin: 0; }

button,
select {
  text-transform: none; }

button {
  -webkit-appearance: button; }

button::-moz-focus-inner {
  border-style: none;
  padding: 0; }

button:-moz-focusring {
  outline: 1px dotted ButtonText; }

details {
  display: block; }

summary {
  display: list-item; }

/*! end normalise.css */
#page {
  --accent: #002642;
  --accent-dark: #00151c;
  --code-foreground: #2c3e50;
  --code-background: #efefef;
  --code-func: #6c3163;
  --code-const: #4e3163;
  --code-regex: #655370;
  --back-white: #fff;
  --back-light: #f0eeed;
  --back-medium: #c8c8c8;
  --text-light: #7b7b7b;
  --text-gray: #444;
  --text-medium: #222;
  --text-dark: #000;
  --switch-icon: "🌚";
  --switch-shadow-color: #373d4e;
  --switch-text: "dark mode?"; }

#theme-switch:checked ~ #page {
  --accent: #002642;
  --accent-dark: #daf1ff;
  --code-foreground: #a1a8ae;
  --code-background: #222;
  --code-func: #bd56ad;
  --code-const: #8755ab;
  --code-regex: #a184b3;
  --back-white: #000;
  --back-light: #181818;
  --back-medium: #444;
  --text-light: #7b7b7b;
  --text-gray: #c8c8c8;
  --text-medium: #ddd;
  --text-dark: #efefef;
  --switch-icon: "🌝";
  --switch-shadow-color: #fce477;
  --switch-text: "light mode?"; }
  #theme-switch:checked ~ #page img.invertible, #theme-switch:checked ~ #page object.invertible[type="image/svg+xml"] {
    filter: invert(90%) hue-rotate(180deg) sepia(1%); }

#theme-switch {
  display: none; }

#switch-label {
  position: fixed;
  bottom: 4rem;
  left: 3rem; }

#switch-label::before {
  content: var(--switch-icon);
  font-size: 20px;
  transition: text-shadow .2s; }

#switch-label::after {
  content: var(--switch-text);
  color: var(--switch-shadow-color);
  font-size: 12px;
  visibility: hidden;
  margin-left: 0.5em;
  z-index: 1;
  position: fixed;
  bottom: calc(4rem - 25px);
  left: calc(3rem - 10px); }

@media (max-width: 1000px) {
  #switch-label {
    left: auto;
    bottom: auto;
    right: 1vw;
    top: 1vh; }
    #switch-label::after {
      position: fixed;
      top: calc(1vh + 3px);
      right: calc(1vw + 30px);
      left: auto;
      bottom: auto; } }

#theme-switch:focus ~ #page #switch-label::before,
#switch-label:hover::before {
  text-shadow: 0 0 15px var(--switch-shadow-color); }

#theme-switch:focus ~ #page #switch-label::after,
#switch-label:hover::after {
  visibility: visible; }

@font-face {
  font-family: "Merriweather";
  src: url("https://tecosaur.com/resources/org/Merriweather-TextRegular.woff2") format("woff2");
  font-weight: normal;
  font-style: normal;
  font-display: fallback; }

@font-face {
  font-family: "Merriweather";
  src: url("https://tecosaur.com/resources/org/Merriweather-TextItalic.woff2") format("woff2");
  font-weight: normal;
  font-style: italic;
  font-display: fallback; }

@font-face {
  font-family: "Merriweather";
  src: url("https://tecosaur.com/resources/org/Merriweather-TextBold.woff2") format("woff2");
  font-weight: bold;
  font-style: normal;
  font-display: fallback; }

@font-face {
  font-family: "et-book";
  src: url("https://tecosaur.com/resources/org/etbookot-roman-webfont.woff2") format("woff2");
  font-weight: normal;
  font-style: normal;
  font-display: fallback; }

@font-face {
  font-family: "et-book";
  src: url("https://tecosaur.com/resources/org/etbookot-italic-webfont.woff2") format("woff2");
  font-weight: normal;
  font-style: italic;
  font-display: fallback; }

*::selection {
  background: var(--back-medium); }

.pace .pace-progress {
  background-color: var(--accent) !important; }

html, body {
  height: 100%; }

body {
  display: flex;
  flex-direction: column;
  font-size: 16px;
  font-family: "Merriweather"; }

#page {
  color: var(--text-dark);
  background-color: var(--back-light);
  transition-property: color, background-color;
  transition-duration: 100ms; }

#content, header, .page-header {
  margin: 32px;
  flex: 1 0 auto; }

#content {
  margin-top: 4rem;
  min-height: calc(100vh - 4rem - 48px); }

.clearfix::after {
  clear: both; }

.clearfix::before, .clearfix::after {
  content: " ";
  display: table; }

.page-header {
  margin-top: 80px;
  margin-left: 0 !important; }
  .page-header h1 {
    font-size: 40px;
    margin-bottom: 10px;
    margin-top: 10px;
    text-transform: none; }
    .page-header h1 .subtitle {
      font-size: 24px;
      color: var(--text-light);
      margin: 0; }

.page-meta {
  font-family: "Open Sans";
  font-weight: normal;
  font-style: normal;
  font-size: 12px;
  line-height: 1.9;
  color: var(--text-light); }

header .site-nav {
  font-family: "Open Sans";
  font-weight: normal;
  font-style: normal;
  font-size: 12px;
  line-height: 1.9;
  color: var(--text-light);
  font-weight: bold;
  line-height: 2.0;
  margin-top: 22px; }
  header .site-nav a {
    color: var(--text-light);
    text-decoration: none;
    margin-left: 10px; }
    header .site-nav a:hover {
      color: var(--text-gray); }
    header .site-nav a.active {
      border-bottom: solid;
      border-bottom-width: 2px; }
  header .site-nav a:first-child {
    margin-left: 0; }

header > div {
  display: inherit; }

.site-title {
  font-size: 16px; }
  .site-title span {
    display: none !important; }
  .site-title ul {
    display: block !important;
    list-style: none;
    padding: 0;
    margin: 0; }
    .site-title ul img {
      border-radius: 2px;
      max-width: 32px; }

.site-header nav a {
  color: var(--text-light);
  font-family: "Open Sans";
  font-size: 12px;
  font-weight: bold;
  text-transform: uppercase; }
  .site-header nav a:hover {
    border: 0;
    color: var(--accent); }

@media (max-width: 1000px) {
  header * {
    display: inline; } }

@media (min-width: 1000px) {
  #content, header, .page-header {
    max-width: 720px;
    margin-left: 164px; }
  header .site-title {
    float: left; }
  header .site-nav {
    float: right;
    margin-top: 0; } }

@media (min-width: 2800px) {
  #content, header, .page-header {
    margin-left: auto;
    margin-right: auto; } }

#content .page-intro {
  font-family: "Open Sans";
  font-weight: normal;
  font-size: 15px;
  line-height: 1.6;
  color: var(--text-gray);
  margin-bottom: 40px; }

#content p, #content li, #content dd {
  line-height: 1.9; }

#footer {
  margin-top: 70px;
  height: 10px;
  background: var(--accent-dark); }

.archive-item {
  margin: 50px 0; }
  .archive-item .archive-title {
    font-size: 25px;
    margin: 5px 0;
    background: none;
    text-shadow: none;
    text-decoration: none; }
    .archive-item .archive-title:hover {
      background: none;
      text-shadow: none;
      text-decoration: none; }

#postamble {
  display: none; }

aside {
  background-color: var(--code-background);
  border-radius: 5px;
  font-family: "Open Sans";
  font-weight: normal;
  font-size: 15px;
  line-height: 1.6;
  color: var(--text-gray);
  margin: 20px 0;
  padding: 20px;
  padding-bottom: 10px;
  line-height: 1.6 !important; }
  aside p {
    font-family: "Open Sans";
    font-weight: normal;
    font-size: 15px;
    line-height: 1.6;
    color: var(--text-gray);
    line-height: 1.6 !important; }
  aside pre {
    font-size: 12px;
    border: none;
    padding-left: 0; }

@media (min-width: 1280px) {
  aside {
    float: right;
    clear: right;
    background-color: var(--back-white);
    max-width: 45% !important;
    margin-right: -52%; }
    aside::before {
      content: ''; } }

blockquote {
  border-width: 0;
  border-left-style: solid;
  border-left-width: 1px;
  border-left-color: var(--back-medium);
  margin: 20px 0;
  padding: 0;
  padding-left: 15px; }
  blockquote p {
    display: inline;
    font-size: 13px; }
  blockquote footer {
    font-family: "Open Sans";
    font-weight: normal;
    font-style: normal;
    font-size: 12px;
    line-height: 1.9;
    color: var(--text-light);
    text-transform: none; }

div.info {
  background: rgba(58, 129, 195, 0.15);
  border-left: 4px solid rgba(58, 129, 195, 0.45);
  margin: 1.8rem 0 1.25rem 15px;
  padding: 0.8em;
  line-height: 1.4;
  text-align: center;
  position: relative;
  clear: both; }
  div.info p {
    margin: 0; }

div.info::before {
  content: "i";
  color: var(--back-white);
  background: rgba(58, 129, 195, 0.8);
  align-items: flex-end;
  top: -1rem;
  font-weight: 700;
  font-size: 1.4rem;
  -webkit-clip-path: circle(50% at 50% 50%);
  clip-path: circle(50% at 50% 50%);
  width: 30px;
  height: 30px;
  display: inline-flex;
  justify-content: center;
  position: absolute;
  left: -1.2rem;
  line-height: 1.3;
  text-align: center; }

div.success {
  background: rgba(45, 149, 116, 0.15);
  border-left: 4px solid rgba(45, 149, 116, 0.45);
  margin: 1.8rem 0 1.25rem 15px;
  padding: 0.8em;
  line-height: 1.4;
  text-align: center;
  position: relative;
  clear: both; }
  div.success p {
    margin: 0; }

div.success::before {
  content: "✔";
  color: var(--back-white);
  background: rgba(45, 149, 116, 0.8);
  align-items: flex-end;
  top: -1rem;
  font-weight: 700;
  font-size: 1.4rem;
  -webkit-clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
  clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
  width: 35px;
  height: 35px;
  display: inline-flex;
  justify-content: center;
  position: absolute;
  left: -1.2rem;
  line-height: 1.5;
  text-align: center; }

div.warning {
  background: rgba(220, 117, 47, 0.15);
  border-left: 4px solid rgba(220, 117, 47, 0.45);
  margin: 1.8rem 0 1.25rem 15px;
  padding: 0.8em;
  line-height: 1.4;
  text-align: center;
  position: relative;
  clear: both; }
  div.warning p {
    margin: 0; }

div.warning::before {
  content: "!";
  color: var(--back-white);
  background: rgba(220, 117, 47, 0.8);
  align-items: flex-end;
  top: -1rem;
  font-weight: 700;
  font-size: 1.4rem;
  -webkit-clip-path: polygon(50% 0, 0 100%, 100% 100%);
  clip-path: polygon(50% 0, 0 100%, 100% 100%);
  width: 35px;
  height: 35px;
  display: inline-flex;
  justify-content: center;
  position: absolute;
  left: -1.2rem;
  line-height: 1.1;
  text-align: center; }

div.error {
  background: rgba(186, 47, 89, 0.15);
  border-left: 4px solid rgba(186, 47, 89, 0.45);
  margin: 1.8rem 0 1.25rem 15px;
  padding: 0.8em;
  line-height: 1.4;
  text-align: center;
  position: relative;
  clear: both; }
  div.error p {
    margin: 0; }

div.error::before {
  content: "!";
  color: var(--back-white);
  background: rgba(186, 47, 89, 0.8);
  align-items: flex-end;
  top: -1rem;
  font-weight: 700;
  font-size: 1.4rem;
  -webkit-clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
  clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
  width: 35px;
  height: 30px;
  display: inline-flex;
  justify-content: center;
  position: absolute;
  left: -1.2rem;
  line-height: 1.1;
  text-align: center; }

.org-ref-bib-h1 {
  margin-top: 70px;
  padding-top: 30px;
  border-width: 0;
  border-top-style: solid;
  border-top-width: 1px;
  border-color: var(--back-light);
  font-family: "Open Sans";
  font-family: "Open Sans";
  font-weight: normal;
  font-size: 20px;
  line-height: 1.6;
  color: var(--text-gray); }

.org-ref-bib {
  font-family: "Open Sans";
  font-weight: normal;
  font-size: 15px;
  line-height: 1.6;
  color: var(--text-gray); }
  .org-ref-bib li > a:nth-child(2) {
    background: none;
    text-shadow: none;
    text-decoration: none; }
    .org-ref-bib li > a:nth-child(2):hover {
      background: none;
      text-shadow: none;
      text-decoration: none; }
  .org-ref-bib .bib-link {
    font-family: "Open Sans";
    font-weight: normal;
    font-style: normal;
    font-size: 12px;
    line-height: 1.9;
    color: var(--text-light);
    background: none;
    text-shadow: none;
    text-decoration: none; }

pre.src, pre.example {
  border-width: 0;
  border-left-style: solid;
  border-left-width: 1px;
  border-left-color: var(--back-medium);
  margin: 20px 0;
  padding: 0;
  padding-left: 15px;
  font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace;
  font-size: 14px;
  line-height: 1.9;
  overflow-x: visible;
  box-shadow: none;
  white-space: pre-wrap;
  position: relative; }

pre.example {
  border-left-style: dotted;
  border-left-width: 2px; }

pre.src::before {
  display: inline-block;
  position: absolute;
  background-color: transparent;
  top: unset;
  bottom: -16px;
  left: 20px;
  padding: 0px;
  border: none;
  font-size: 80%;
  font-style: italic;
  color: var(--text-light); }

pre.src:empty {
  display: none; }

code {
  font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace;
  color: var(--code-foreground);
  font-size: 15px;
  padding: 0 5px; }

kbd {
  display: inline-block;
  padding: 3px 5px;
  font: 80% SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace;
  line-height: normal;
  line-height: 80%;
  color: var(--text-gray);
  vertical-align: middle;
  background-color: var(--back-light);
  border: 1px solid #91959a88;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #91959a88; }

li code {
  font-size: 14px; }

li p code {
  font-size: 15px; }

details.code {
  position: relative; }
  details.code summary {
    position: relative;
    left: -3px;
    padding-left: 10px;
    padding-bottom: 4px;
    margin-left: -10px;
    z-index: 1;
    outline: none;
    font-family: "Open Sans";
    font-weight: normal;
    font-style: normal;
    font-size: 12px;
    line-height: 1.9;
    color: var(--text-light); }
    details.code summary .name {
      font-size: 14px;
      color: var(--text-medium);
      margin-right: 0.7em; }
    details.code summary .lang {
      font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace;
      font-style: italic; }
  details.code summary::marker {
    color: var(--back-medium); }
  details.code[open] summary {
    margin-bottom: -32px; }
    details.code[open] summary .lang {
      display: none; }
  details.code[open] summary.named {
    margin-bottom: -26px; }
  details.code:not([open]) summary {
    margin-bottom: -5px; }

p + details.code {
  margin-top: -20px; }

li p + details.code {
  margin-top: -5px; }

.example,
.src {
  color: var(--code-foreground); }
  .example .org-keyword,
  .src .org-keyword {
    color: #3a81c3; }
  .example .org-variable-name,
  .src .org-variable-name {
    color: #715ab1; }
  .example .org-rainbow-delimiters-depth-1,
  .example .org-rainbow-delimiters-depth-2,
  .example .org-rainbow-delimiters-depth-3,
  .example .org-rainbow-delimiters-depth-4,
  .example .org-rainbow-delimiters-depth-5,
  .example .org-rainbow-delimiters-depth-6,
  .example .org-rainbow-delimiters-depth-7,
  .example .org-rainbow-delimiters-depth-8,
  .example .org-rainbow-delimiters-depth-9,
  .src .org-rainbow-delimiters-depth-1,
  .src .org-rainbow-delimiters-depth-2,
  .src .org-rainbow-delimiters-depth-3,
  .src .org-rainbow-delimiters-depth-4,
  .src .org-rainbow-delimiters-depth-5,
  .src .org-rainbow-delimiters-depth-6,
  .src .org-rainbow-delimiters-depth-7,
  .src .org-rainbow-delimiters-depth-8,
  .src .org-rainbow-delimiters-depth-9 {
    color: #555555; }
  .example .org-string,
  .src .org-string {
    color: #2d9574; }
  .example .org-comment,
  .example .org-comment-delimiter,
  .src .org-comment,
  .src .org-comment-delimiter {
    color: #555555; }
  .example .org-function-name,
  .src .org-function-name {
    color: var(--code-func); }
  .example .org-constant,
  .example .org-highlight-numbers-number,
  .src .org-constant,
  .src .org-highlight-numbers-number {
    color: var(--code-const); }

.gutter {
  position: absolute;
  top: 0;
  left: -2.5rem;
  width: 2rem;
  padding-right: 0.3rem;
  padding-top: 5px;
  height: calc(100% - 10px);
  z-index: 1;
  transition: opacity 200ms;
  opacity: 0;
  font-size: 15px; }
  .gutter:hover {
    opacity: 1; }
  .gutter * {
    display: block;
    width: 100%;
    text-align: right;
    padding: 0;
    margin: 0;
    color: var(--text-light); }
    .gutter *:hover {
      color: var(--text-gray); }
    .gutter *:active {
      font-weight: bold; }
  .gutter a {
    text-decoration: none;
    font-size: 110%; }
  .gutter button {
    background: none;
    border: none; }

/* Languages per Org manual */
pre.src-asymptote::before {
  content: 'Asymptote'; }

pre.src-authinfo::before {
  content: 'Authinfo'; }

pre.src-awk::before {
  content: 'Awk'; }

pre.src-C::before {
  content: 'C'; }

/* pre.src-C++ doesn't work in CSS */
pre.src-clojure::before {
  content: 'Clojure'; }

pre.src-css::before {
  content: 'CSS'; }

pre.src-D::before {
  content: 'D'; }

pre.src-ditaa::before {
  content: 'ditaa'; }

pre.src-dot::before {
  content: 'Graphviz'; }

pre.src-calc::before {
  content: 'Emacs Calc'; }

pre.src-emacs-lisp::before {
  content: 'Emacs Lisp'; }

pre.src-fortran::before {
  content: 'Fortran'; }

pre.src-gnuplot::before {
  content: 'gnuplot'; }

pre.src-haskell::before {
  content: 'Haskell'; }

pre.src-hledger::before {
  content: 'hledger'; }

pre.src-java::before {
  content: 'Java'; }

pre.src-js::before {
  content: 'Javascript'; }

pre.src-latex::before {
  content: 'LaTeX'; }

pre.src-ledger::before {
  content: 'Ledger'; }

pre.src-lisp::before {
  content: 'Lisp'; }

pre.src-lilypond::before {
  content: 'Lilypond'; }

pre.src-lua::before {
  content: 'Lua'; }

pre.src-matlab::before {
  content: 'MATLAB'; }

pre.src-mscgen::before {
  content: 'Mscgen'; }

pre.src-ocaml::before {
  content: 'Objective Caml'; }

pre.src-octave::before {
  content: 'Octave'; }

pre.src-org::before {
  content: 'Org mode'; }

pre.src-oz::before {
  content: 'OZ'; }

pre.src-plantuml::before {
  content: 'Plantuml'; }

pre.src-processing::before {
  content: 'Processing.js'; }

pre.src-python::before {
  content: 'Python'; }

pre.src-R::before {
  content: 'R'; }

pre.src-ruby::before {
  content: 'Ruby'; }

pre.src-sass::before {
  content: 'Sass'; }

pre.src-scheme::before {
  content: 'Scheme'; }

pre.src-screen::before {
  content: 'Gnu Screen'; }

pre.src-sed::before {
  content: 'Sed'; }

pre.src-sh::before {
  content: 'shell'; }

pre.src-sql::before {
  content: 'SQL'; }

pre.src-sqlite::before {
  content: 'SQLite'; }

/* additional languages in org.el's org-babel-load-languages alist */
pre.src-forth::before {
  content: 'Forth'; }

pre.src-io::before {
  content: 'IO'; }

pre.src-J::before {
  content: 'J'; }

pre.src-makefile::before {
  content: 'Makefile'; }

pre.src-maxima::before {
  content: 'Maxima'; }

pre.src-perl::before {
  content: 'Perl'; }

pre.src-picolisp::before {
  content: 'Pico Lisp'; }

pre.src-scala::before {
  content: 'Scala'; }

pre.src-shell::before {
  content: 'Shell Script'; }

pre.src-systemd::before {
  content: 'Systemd'; }

pre.src-ebnf2ps::before {
  content: 'ebfn2ps'; }

/* additional language identifiers per \"defun org-babel-execute\"
      in ob-*.el */
pre.src-cpp::before {
  content: 'C++'; }

pre.src-abc::before {
  content: 'ABC'; }

pre.src-coq::before {
  content: 'Coq'; }

pre.src-groovy::before {
  content: 'Groovy'; }

/* additional language identifiers from org-babel-shell-names in
    ob-shell.el: ob-shell is the only babel language using a lambda to put
    the execution function name together. */
pre.src-bash::before {
  content: 'bash'; }

pre.src-csh::before {
  content: 'csh'; }

pre.src-ash::before {
  content: 'ash'; }

pre.src-dash::before {
  content: 'dash'; }

pre.src-ksh::before {
  content: 'ksh'; }

pre.src-mksh::before {
  content: 'mksh'; }

pre.src-posh::before {
  content: 'posh'; }

/* Additional Emacs modes also supported by the LaTeX listings package */
pre.src-ada::before {
  content: 'Ada'; }

pre.src-asm::before {
  content: 'Assembler'; }

pre.src-caml::before {
  content: 'Caml'; }

pre.src-delphi::before {
  content: 'Delphi'; }

pre.src-html::before {
  content: 'HTML'; }

pre.src-idl::before {
  content: 'IDL'; }

pre.src-mercury::before {
  content: 'Mercury'; }

pre.src-metapost::before {
  content: 'MetaPost'; }

pre.src-modula-2::before {
  content: 'Modula-2'; }

pre.src-pascal::before {
  content: 'Pascal'; }

pre.src-ps::before {
  content: 'PostScript'; }

pre.src-prolog::before {
  content: 'Prolog'; }

pre.src-simula::before {
  content: 'Simula'; }

pre.src-tcl::before {
  content: 'tcl'; }

pre.src-tex::before {
  content: 'LaTeX'; }

pre.src-plain-tex::before {
  content: 'TeX'; }

pre.src-verilog::before {
  content: 'Verilog'; }

pre.src-vhdl::before {
  content: 'VHDL'; }

pre.src-xml::before {
  content: 'XML'; }

pre.src-nxml::before {
  content: 'XML'; }

pre.src-conf::before {
  content: 'Configuration File'; }

.dropcap {
  float: left;
  font-size: 55px;
  font-style: normal;
  line-height: .1;
  margin-right: 0.2em;
  margin-top: 0.5em;
  padding: 0; }

figure {
  text-align: center; }
  figure figcaption {
    margin-top: 10px;
    font-family: "Open Sans";
    font-weight: normal;
    font-size: 15px;
    line-height: 1.6;
    color: var(--text-gray); }
    figure figcaption .figure-number {
      font-family: "Open Sans";
      font-weight: normal;
      font-style: normal;
      font-size: 12px;
      line-height: 1.9;
      color: var(--text-light); }

img.zoomTarget:hover {
  cursor: default !important; }

img, object[type="image/svg+xml"] {
  filter: invert(7%) sepia(4%);
  max-width: 100%; }

.org-svg {
  width: 90%; }

#footnotes {
  margin-top: 70px;
  padding-top: 30px;
  border-width: 0;
  border-top-style: solid;
  border-top-width: 1px;
  border-color: var(--back-light);
  font-family: "Open Sans";
  font-weight: normal;
  font-size: 15px;
  line-height: 1.6;
  color: var(--text-gray); }
  #footnotes p, #footnotes li {
    font-family: "Open Sans";
    font-weight: normal;
    font-size: 15px;
    line-height: 1.6;
    color: var(--text-gray); }
  #footnotes h2.footnotes {
    margin-top: 0;
    margin-bottom: 30px;
    font-family: "Open Sans";
    font-size: 18px;
    letter-spacing: 5px;
    display: none; }
  #footnotes .footnum {
    color: var(--text-dark); }

h1,
h2,
h3,
h4,
h5,
h6 {
  font-family: "et-book";
  font-weight: normal;
  margin-bottom: 0;
  margin-top: 60px; }

h1 > a[aria-hidden='true'],
h2 > a[aria-hidden='true'],
h3 > a[aria-hidden='true'],
h4 > a[aria-hidden='true'],
h5 > a[aria-hidden='true'],
h6 > a[aria-hidden='true'] {
  color: var(--back-medium);
  position: relative;
  top: 0.06em;
  line-height: 1;
  font-size: 110%;
  padding-left: 0.2em;
  text-decoration: none;
  visibility: hidden; }

h1 > a[aria-hidden='true']:hover,
h2 > a[aria-hidden='true']:hover,
h3 > a[aria-hidden='true']:hover,
h4 > a[aria-hidden='true']:hover,
h5 > a[aria-hidden='true']:hover,
h6 > a[aria-hidden='true']:hover {
  color: var(--text-light); }

h1:hover > a[aria-hidden='true'],
h2:hover > a[aria-hidden='true'],
h3:hover > a[aria-hidden='true'],
h4:hover > a[aria-hidden='true'],
h5:hover > a[aria-hidden='true'],
h6:hover > a[aria-hidden='true'] {
  visibility: visible; }

h1, h2, h3, h4, h5, h6 {
  padding-left: 30px;
  margin-left: -30px;
  position: relative; }

h1, .section-number-1 {
  font-size: 40px; }

h2, .section-number-2 {
  font-size: 30px; }

h3, .section-number-3 {
  font-size: 24px; }

h4, .section-number-4 {
  font-size: 20px;
  font-style: italic; }

h5 {
  font-size: 20px;
  font-variant: small-caps; }

.section-number-5 {
  font-size: 20px; }

h6 {
  font-size: 18px;
  font-style: italic; }

.section-number-6 {
  font-size: 18px; }

.section-number-1,
.section-number-2,
.section-number-3,
.section-number-4,
.section-number-5,
.section-number-6 {
  font-family: "Open Sans";
  font-weight: normal;
  font-style: normal;
  font-size: 12px;
  line-height: 1.9;
  color: var(--text-light);
  font-size: inherit;
  color: var(--text-light);
  line-height: 1; }
  @media (min-width: 1000px) {
    .section-number-1,
    .section-number-2,
    .section-number-3,
    .section-number-4,
    .section-number-5,
    .section-number-6 {
      position: absolute;
      transform: translateX(-100%) translateX(-10px); } }
.outline-text-2:empty + .outline-3 > h3, .outline-text-2:-moz-only-whitespace + .outline-3 > h3 {
  margin-top: 20px; }

.outline-text-3:empty + .outline-4 > h4, .outline-text-3:-moz-only-whitespace + .outline-4 > h4 {
  margin-top: 15px; }

.outline-text-4:empty + .outline-5 > h5, .outline-text-4:-moz-only-whitespace + .outline-5 > h5 {
  margin-top: 15px; }

.outline-text-5:empty + .outline-6 > h6, .outline-text-5:-moz-only-whitespace + .outline-6 > h6 {
  margin-top: 10px; }

hr {
  border: none;
  border-top-style: solid;
  border-top-width: 1px;
  color: var(--back-medium);
  margin-bottom: 30px;
  margin-top: 40px; }

figcaption a,
p a,
.page-tags a,
table a,
li a,
dl a {
  background-image: linear-gradient(var(--text-dark), var(--text-dark));
  background-size: 1px 1px;
  background-repeat: repeat-x;
  background-position: 0% 95%;
  border-radius: 1px;
  color: var(--text-dark);
  text-decoration: none; }
  figcaption a::selection,
  p a::selection,
  .page-tags a::selection,
  table a::selection,
  li a::selection,
  dl a::selection {
    background: var(--back-medium); }
  figcaption a *,
  figcaption a *:after, figcaption a:after,
  figcaption a *:before, figcaption a:before,
  p a *,
  p a *:after,
  p a:after,
  p a *:before,
  p a:before,
  .page-tags a *,
  .page-tags a *:after,
  .page-tags a:after,
  .page-tags a *:before,
  .page-tags a:before,
  table a *,
  table a *:after,
  table a:after,
  table a *:before,
  table a:before,
  li a *,
  li a *:after,
  li a:after,
  li a *:before,
  li a:before,
  dl a *,
  dl a *:after,
  dl a:after,
  dl a *:before,
  dl a:before {
    text-shadow: none; }
  figcaption a:visited,
  p a:visited,
  .page-tags a:visited,
  table a:visited,
  li a:visited,
  dl a:visited {
    color: var(--text-dark); }
  figcaption a:hover,
  p a:hover,
  .page-tags a:hover,
  table a:hover,
  li a:hover,
  dl a:hover {
    opacity: 0.9;
    filter: drop-shadow(1px 1px 1px var(--back-white));
    background-image: linear-gradient(var(--text-dark), var(--text-dark));
    background-size: 1px 1px;
    background-repeat: repeat-x;
    background-position: 0% 95%;
    background-image: url("data:image/svg+xml;charset=utf8,%3Csvg id='squiggle-link' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns:ev='http://www.w3.org/2001/xml-events' viewBox='0 0 20 4'%3E%3Cstyle type='text/css'%3E.squiggle{animation:shift .3s linear infinite;}@keyframes shift {from {transform:translateX(0);}to {transform:translateX(-20px);}}%3C/style%3E%3Cpath fill='none' stroke='%23000000' stroke-width='2' class='squiggle' d='M0,3.5 c 5,0,5,-3,10,-3 s 5,3,10,3 c 5,0,5,-3,10,-3 s 5,3,10,3'/%3E%3C/svg%3E");
    background-position: 0% 100%;
    background-size: 0.8em auto;
    text-decoration: none; }
    figcaption a:hover::selection,
    p a:hover::selection,
    .page-tags a:hover::selection,
    table a:hover::selection,
    li a:hover::selection,
    dl a:hover::selection {
      background: var(--back-white); }
  figcaption a[href^="#"],
  p a[href^="#"],
  .page-tags a[href^="#"],
  table a[href^="#"],
  li a[href^="#"],
  dl a[href^="#"] {
    background-image: linear-gradient(var(--text-gray), var(--text-gray));
    background-size: 1px 1px;
    background-repeat: repeat-x;
    background-position: 0% 95%; }
    figcaption a[href^="#"]::selection,
    p a[href^="#"]::selection,
    .page-tags a[href^="#"]::selection,
    table a[href^="#"]::selection,
    li a[href^="#"]::selection,
    dl a[href^="#"]::selection {
      background: var(--back-white); }
    figcaption a[href^="#"]:hover,
    p a[href^="#"]:hover,
    .page-tags a[href^="#"]:hover,
    table a[href^="#"]:hover,
    li a[href^="#"]:hover,
    dl a[href^="#"]:hover {
      opacity: 0.9;
      filter: drop-shadow(1px 1px 1px var(--back-white));
      background-image: linear-gradient(var(--text-medium), var(--text-medium));
      background-size: 1px 1px;
      background-repeat: repeat-x;
      background-position: 0% 95%; }
      figcaption a[href^="#"]:hover::selection,
      p a[href^="#"]:hover::selection,
      .page-tags a[href^="#"]:hover::selection,
      table a[href^="#"]:hover::selection,
      li a[href^="#"]:hover::selection,
      dl a[href^="#"]:hover::selection {
        background: var(--back-white); }

#theme-switch:checked ~ #page #breadcrumbs a:hover,
#theme-switch:checked ~ #page figcaption a:hover,
#theme-switch:checked ~ #page p a:hover,
#theme-switch:checked ~ #page .page-tags a:hover,
#theme-switch:checked ~ #page table a:hover,
#theme-switch:checked ~ #page #crosslinks a:not(.highlight):hover,
#theme-switch:checked ~ #page li a:hover,
#theme-switch:checked ~ #page dl a:hover {
  background-image: url("data:image/svg+xml;charset=utf8,%3Csvg id='squiggle-link' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns:ev='http://www.w3.org/2001/xml-events' viewBox='0 0 20 4'%3E%3Cstyle type='text/css'%3E.squiggle{animation:shift .3s linear infinite;}@keyframes shift {from {transform:translateX(0);}to {transform:translateX(-20px);}}%3C/style%3E%3Cpath fill='none' stroke='%23ffffff' stroke-width='2' class='squiggle' d='M0,3.5 c 5,0,5,-3,10,-3 s 5,3,10,3 c 5,0,5,-3,10,-3 s 5,3,10,3'/%3E%3C/svg%3E"); }

*:target::before {
  content: "🠖";
  position: absolute;
  left: -7rem;
  top: calc(0.5em - 2rem);
  line-height: 1;
  color: #e65353aa;
  font-size: 3rem;
  font-style: normal; }
  @media (max-width: 1000px) {
    *:target::before {
      content: "🠔";
      left: unset;
      right: 0; } }
#content .page-intro p a,
#footnotes a {
  background-image: linear-gradient(var(--text-gray), var(--text-gray));
  background-size: 1px 1px;
  background-repeat: repeat-x;
  background-position: 0% 95%;
  border-radius: 1px;
  color: var(--text-gray);
  text-decoration: none; }
  #content .page-intro p a::selection,
  #footnotes a::selection {
    background: var(--back-medium); }
  #content .page-intro p a *,
  #content .page-intro p a *:after, #content .page-intro p a:after,
  #content .page-intro p a *:before, #content .page-intro p a:before,
  #footnotes a *,
  #footnotes a *:after,
  #footnotes a:after,
  #footnotes a *:before,
  #footnotes a:before {
    text-shadow: none; }
  #content .page-intro p a:visited,
  #footnotes a:visited {
    color: var(--text-gray); }
  #content .page-intro p a:hover,
  #footnotes a:hover {
    background-image: linear-gradient(var(--text-gray), var(--text-gray));
    background-size: 1px 1px;
    background-repeat: repeat-x;
    background-position: 0% 95%;
    border-radius: 1px;
    color: var(--text-gray);
    text-decoration: none; }
    #content .page-intro p a:hover::selection,
    #footnotes a:hover::selection {
      background: var(--back-medium); }
    #content .page-intro p a:hover *,
    #content .page-intro p a:hover *:after, #content .page-intro p a:hover:after,
    #content .page-intro p a:hover *:before, #content .page-intro p a:hover:before,
    #footnotes a:hover *,
    #footnotes a:hover *:after,
    #footnotes a:hover:after,
    #footnotes a:hover *:before,
    #footnotes a:hover:before {
      text-shadow: none; }
    #content .page-intro p a:hover:visited,
    #footnotes a:hover:visited {
      color: var(--text-gray); }

.btn {
  padding: 7px 14px;
  border-style: solid;
  border-width: 1px;
  border-color: var(--back-light);
  border-radius: 1px;
  font-family: "Open Sans";
  font-variant: all-small-caps;
  font-size: 14px;
  font-style: normal;
  letter-spacing: 2px;
  background-image: none;
  cursor: pointer; }
  .btn:hover {
    background-color: var(--back-light);
    background-image: none; }

.btn.disabled {
  color: var(--text-light); }
  .btn.disabled:hover {
    cursor: default; }

.btn.small {
  padding: 3px 6px;
  border-style: solid;
  border-width: 1px;
  border-color: var(--back-light);
  border-radius: 1px;
  font-family: "Open Sans";
  font-variant: all-small-caps;
  font-size: 12px;
  font-style: normal;
  letter-spacing: 2px;
  background-image: none;
  padding-right: 9px;
  padding-left: 9px; }
  .btn.small:hover {
    background-color: var(--back-light);
    background-image: none; }

.btn.highlight {
  text-shadow: none;
  text-decoration: none;
  color: var(--text-dark);
  background-color: yellow; }

.btn.primary {
  text-shadow: none;
  text-decoration: none;
  color: var(--back-white);
  background-color: var(--accent); }
  .btn.primary:hover {
    background-color: var(--back-light);
    background-image: none;
    color: var(--text-dark); }

.image-link, .image-link:hover {
  background: none;
  text-shadow: none;
  text-decoration: none; }

ul, ol, dl {
  list-style: none;
  list-style-position: outside;
  padding: 0; }
  ul li::before, ul dt::before, ol li::before, ol dt::before, dl li::before, dl dt::before {
    display: inline-block;
    width: 1em;
    font-family: "Open Sans";
    font-weight: normal;
    font-size: 15px;
    line-height: 1.6;
    color: var(--text-gray); }
  ul li, ol li, dl li {
    margin: 5px 0;
    font-size: 14px; }
    ul li p, ol li p, dl li p {
      font-size: 15px; }

ul li::before {
  content: "•";
  margin-left: -1em; }

ol {
  counter-reset: li; }
  ol li::before {
    content: counter(li);
    margin-left: -1.5em;
    margin-right: 0.5em;
    text-align: right;
    direction: rtl; }
  ol li {
    counter-increment: li; }

ul ul, ol ol {
  padding-left: 20px; }

ul ul ul, ol ol ol {
  padding-left: 30px; }

li p:first-child {
  display: inline-block;
  margin-bottom: 0; }

dl dt::before {
  content: "•";
  margin-left: -1em; }

dl dt {
  font-weight: normal;
  margin-bottom: 10px; }

dl dd {
  font-style: italic;
  margin-bottom: 20px; }

li .checkbox {
  display: inline-block;
  width: 0.9em;
  height: 0.9em;
  border-radius: 3px;
  margin: 3px;
  top: 4px;
  position: relative; }

li.on > .checkbox {
  background: #2d9574;
  box-shadow: 0 0 2px #2d9574; }

li.trans > .checkbox {
  background: #dc752f;
  box-shadow: 0 0 2px #dc752f; }

li.off > .checkbox {
  background: #ba2f59;
  box-shadow: 0 0 2px #ba2f59;
  top: 6px; }

li.on > .checkbox::after {
  content: '';
  height: 0.45em;
  width: 0.225em;
  -webkit-transform-origin: left top;
  transform-origin: left top;
  transform: scaleX(-1) rotate(135deg);
  border-right: 2.8px solid #fff;
  border-top: 2.8px solid #fff;
  opacity: 0.9;
  left: 0.10em;
  top: 0.45em;
  position: absolute; }

li.trans > .checkbox::after {
  content: '';
  font-weight: bold;
  font-size: 1.6em;
  position: absolute;
  top: 0.2em;
  left: 0.11em;
  width: 0.35em;
  height: 0.12em;
  background: #fff;
  opacity: 0.9;
  border-radius: 0.1em; }

li.off > .checkbox::after {
  content: '✖';
  color: #fff;
  opacity: 0.9;
  position: relative;
  top: -0.50rem;
  left: 0.17em;
  font-size: 0.75em; }

#org-div-home-and-up {
  display: none !important; }

.outline-2 h2 {
  font-size: 30px; }

.outline-3 h3 {
  font-size: 24px;
  font-style: normal; }

.outline-2 .section-number-2 {
  font-size: 30px; }

.outline-3 .section-number-3 {
  font-size: 24px; }

.timestamp, .timestamp-kwd {
  font-family: "Open Sans";
  font-weight: normal;
  font-style: normal;
  font-size: 12px;
  line-height: 1.9;
  color: var(--text-light);
  background-color: var(--back-white);
  border-radius: 1px; }

.todo, .done {
  padding: 0.1em 0.2em;
  border-style: solid;
  border-width: 1px;
  border-color: var(--back-light);
  border-radius: 1px;
  font-family: "Open Sans";
  font-variant: all-small-caps;
  font-size: max(0.4em, 10px);
  font-style: normal;
  letter-spacing: 2px;
  background-image: none;
  line-height: 1;
  white-space: nowrap;
  vertical-align: middle;
  padding: 0.1em 0.5em;
  background-color: var(--back-white);
  background-color: transparent;
  border: none;
  font-weight: bold; }
  .todo:hover, .done:hover {
    background-color: var(--back-light);
    background-image: none; }
  .todo:not(.active), .done:not(.active) {
    border-color: var(--back-white); }
  .todo.active, .done.active {
    text-shadow: none;
    text-decoration: none;
    color: var(--back-white);
    background-color: var(--code-foreground); }
    .todo.active:hover, .done.active:hover {
      background-color: var(--back-light);
      background-image: none;
      color: var(--text-dark); }

.outline-2, .outline-3, .outline-4 {
  contain: layout; }
  .outline-2 .todo, .outline-2 .done, .outline-3 .todo, .outline-3 .done, .outline-4 .todo, .outline-4 .done {
    font-size: 18px; }

.todo {
  color: #ee3333; }

.done {
  color: var(--text-light); }

.tag > span {
  padding: 0.1em 0.2em;
  border-style: solid;
  border-width: 1px;
  border-color: var(--back-light);
  border-radius: 1px;
  font-family: "Open Sans";
  font-variant: all-small-caps;
  font-size: max(0.4em, 10px);
  font-style: normal;
  letter-spacing: 2px;
  background-image: none;
  line-height: 1;
  white-space: nowrap;
  vertical-align: middle;
  padding: 0.1em 0.5em;
  background-color: var(--back-white);
  border-radius: 100px; }
  .tag > span:hover {
    background-color: var(--back-light);
    background-image: none; }
  .tag > span:not(.active) {
    border-color: var(--back-white); }
  .tag > span.active {
    text-shadow: none;
    text-decoration: none;
    color: var(--back-white);
    background-color: var(--code-foreground); }
    .tag > span.active:hover {
      background-color: var(--back-light);
      background-image: none;
      color: var(--text-dark); }

.priority {
  color: var(--text-light);
  font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace; }

.footref {
  text-shadow: none; }

.footpara {
  display: inline; }

.footdef:last-of-type {
  margin-bottom: 1em; }

th.org-right {
  text-align: center; }

th.org-left {
  text-align: center; }

th.org-center {
  text-align: center; }

td.org-right {
  text-align: right; }

td.org-left {
  text-align: left; }

td.org-center {
  text-align: center; }

div.org-center {
  text-align: center; }

span.acr {
  font-variant-caps: all-small-caps;
  letter-spacing: 0.1em; }

.music-track {
  display: flex;
  justify-content: center;
  align-items: center;
  flex-wrap: wrap; }
  .music-track > img {
    height: 6rem; }
  .music-track > span {
    margin-left: 2rem;
    min-width: 30%; }
    .music-track > span > a {
      color: inherit;
      text-decoration: none; }

div.table {
  position: relative; }
  div.table .gutter {
    left: calc(20px - 2.5rem);
    padding-top: 18px; }
  div.table .tabular {
    max-width: 100%;
    overflow-x: auto; }

table {
  border-color: var(--text-light);
  border-left: transparent;
  border-right: transparent;
  border-style: solid;
  border-width: 2px;
  border-collapse: collapse;
  font-size: 15px;
  font-family: "Open Sans";
  margin: 20px;
  padding: 20px; }
  table thead {
    font-family: "Open Sans";
    font-weight: normal;
    font-style: normal;
    font-size: 12px;
    line-height: 1.9;
    color: var(--text-light);
    font-size: 15px; }
    table thead tr th {
      padding: 4px 10px;
      background-color: #9991; }
    table thead tr:last-of-type th {
      border-bottom: solid 1px var(--text-light); }
  table tr, table th, table td {
    border: none; }
  table tbody tr td {
    border-top: 0;
    padding: 0 10px; }
  table tr {
    line-height: 1.9; }
  table caption {
    margin-bottom: 10px;
    font-family: "Open Sans";
    font-weight: normal;
    font-size: 15px;
    line-height: 1.6;
    color: var(--text-gray); }
    table caption .table-number {
      font-family: "Open Sans";
      font-weight: normal;
      font-style: normal;
      font-size: 12px;
      line-height: 1.9;
      color: var(--text-light); }

::-webkit-scrollbar {
  width: 10px;
  height: 8px; }

::-webkit-scrollbar-track {
  background: #9992; }

::-webkit-scrollbar-thumb {
  background: #ccc; }

::-webkit-scrollbar-thumb:hover {
  background: #888; }

@media (min-width: 1280px) {
  #table-of-contents {
    position: fixed;
    width: 18rem;
    right: 1rem;
    top: 0;
    padding: 1em;
    line-height: 1.5;
    margin-top: 4rem; }
    #table-of-contents h2 {
      margin-top: 0; }
    #table-of-contents #text-table-of-contents {
      position: relative; }
      #table-of-contents #text-table-of-contents::before, #table-of-contents #text-table-of-contents::after {
        position: absolute;
        content: '';
        width: calc(100% - 10px);
        height: 0.7rem;
        left: 0;
        z-index: 1; }
      #table-of-contents #text-table-of-contents::before {
        top: 0;
        background: linear-gradient(180deg, var(--back-light) 0%, var(--back-light) 35%, rgba(0, 0, 0, 0) 100%); }
      #table-of-contents #text-table-of-contents::after {
        bottom: 0;
        background: linear-gradient(0deg, var(--back-light) 0%, var(--back-light) 35%, rgba(0, 0, 0, 0) 100%); }
      #table-of-contents #text-table-of-contents > ul {
        list-style: none;
        padding: 0;
        margin: 0;
        max-height: calc(100vh - 5rem - 50px);
        overflow-y: auto;
        overflow-x: hidden;
        scrollbar-width: thin; }
        #table-of-contents #text-table-of-contents > ul ul {
          padding-left: 2em; }
        #table-of-contents #text-table-of-contents > ul ul.active {
          display: inline-block; }
        #table-of-contents #text-table-of-contents > ul li.active > ul {
          display: inline-block; }
        #table-of-contents #text-table-of-contents > ul li.active > label a, #table-of-contents #text-table-of-contents > ul li.active > a {
          color: var(--text-dark); }
        #table-of-contents #text-table-of-contents > ul li.active > input:not(:checked) ~ label::after {
          transform: rotate(90deg);
          top: 5px;
          opacity: 0.35; }
        #table-of-contents #text-table-of-contents > ul > li:last-child {
          margin-bottom: 2rem; } }

@media (min-width: 1440px) {
  #table-of-contents {
    width: 20rem;
    right: 2rem; } }

@media (min-width: 1640px) {
  #table-of-contents {
    right: 5rem; } }

@media (min-width: 2000px) {
  #table-of-contents {
    width: 25rem; } }

#table-of-contents #text-table-of-contents ul {
  width: 100%; }

#table-of-contents #text-table-of-contents > ul ul {
  display: none; }

#table-of-contents #text-table-of-contents li input[type=checkbox] {
  display: none; }

#table-of-contents #text-table-of-contents li label {
  display: inline-block;
  width: 100%;
  position: relative; }

#table-of-contents #text-table-of-contents li a {
  display: inline-block;
  color: var(--text-gray);
  text-decoration: none !important;
  text-shadow: none;
  background: none !important; }

#table-of-contents #text-table-of-contents li label::after {
  content: "\25b6";
  color: var(--text-gray);
  margin-left: 0.5em;
  font-size: 10px;
  display: inline-block;
  position: absolute;
  top: 3.4px;
  left: -20px;
  opacity: 0.8; }

#table-of-contents #text-table-of-contents li input:checked ~ ul {
  display: inline-block !important; }

#table-of-contents #text-table-of-contents li input:checked ~ label a {
  font-weight: bold; }

#table-of-contents #text-table-of-contents li input:checked ~ label::after {
  transform: rotate(90deg);
  top: 5px; }

#table-of-contents #text-table-of-contents li::before {
  content: "" !important; }

.page-tags a {
  padding: 0.1em 0.2em;
  border-style: solid;
  border-width: 1px;
  border-color: var(--back-light);
  border-radius: 1px;
  font-family: "Open Sans";
  font-variant: all-small-caps;
  font-size: max(0.4em, 10px);
  font-style: normal;
  letter-spacing: 2px;
  background-image: none;
  line-height: 1;
  white-space: nowrap;
  vertical-align: middle;
  padding: 0.1em 0.5em;
  background-color: var(--back-white);
  margin-right: 5px;
  line-height: 3em; }
  .page-tags a:hover {
    background-color: var(--back-light);
    background-image: none; }
  .page-tags a:not(.active) {
    border-color: var(--back-white); }
  .page-tags a.active {
    text-shadow: none;
    text-decoration: none;
    color: var(--back-white);
    background-color: var(--code-foreground); }
    .page-tags a.active:hover {
      background-color: var(--back-light);
      background-image: none;
      color: var(--text-dark); }

@media print {
  h2 {
    page-break-before: always; }
  h1, h2, h3, h4, h5 {
    page-break-after: avoid; }
  #switch-label {
    display: none; }
  #content, #page-header {
    margin-top: 0; }
  #table-of-contents #text-table-of-contents > ul ul {
    display: inline-block; }
  #table-of-contents #text-table-of-contents > ul a::after {
    content: leader(".") target-counter(attr(href), page); }
  #table-of-contents #text-table-of-contents li label::after {
    display: none; }
  img {
    filter: none; } }

@page {
  size: auto;
  margin-top: 4mm;
  margin-bottom: 4mm; }
</style>
<link rel='shortcut icon' type='image/png' href='https://www.gnu.org/software/emacs/favicon.png'>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
<script>
    MathJax = {
      chtml: {
        scale: 1
      },
      svg: {
        scale: 1,
        fontCache: "global"
      },
      tex: {
        tags: "ams",
        multlineWidth: "85%",
        tagSide: "right",
        tagIndent: ".8em"
      }
    };
    </script>
    <script id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body>
<input type='checkbox' id='theme-switch'><div id='page'><label id='switch-label' for='theme-switch'></label><div id="content">
<div class='page-header'><div class='page-meta'>2021-02-06 07:56 UTC, <a href="https://github.com/tecosaur/emacs-config/commit/0c50e2a" style="text-decoration: none"><code style="padding: 0; color: var(--text-light); font-size: inherit; opacity: 0.7">0c50e2a</code></a>, tecosaur</div><h1 class="title">Doom Emacs Configuration<p class="subtitle">The Methods, Management, and Menagerie of Madness</p>
</h1></div>
<nav id="table-of-contents">
<h2><a href="#" style="color:inherit; text-decoration: none;">Table of Contents</a></h2>
<div id="text-table-of-contents">
<ul>
<li><input type='checkbox' id='toc--intro'/><label for='toc--intro'><a href="#intro">1. Intro</a></label>
<ul>
<li><input type='checkbox' id='toc--why-emacs'/><label for='toc--why-emacs'><a href="#why-emacs">1.1. Why Emacs?</a></label>
<ul>
<li><a href="#enveloping-editor">1.1.1. The enveloping editor</a></li>
<li><a href="#some-notably-unique">1.1.2. Some notably unique features</a></li>
<li><a href="#issues">1.1.3. Issues</a></li>
<li><a href="#teach-man-fish">1.1.4. Teach a man to fish&#x2026;</a></li>
</ul>
</li>
<li><a href="#editor-comparison">1.2. Editor comparison</a></li>
<li><input type='checkbox' id='toc--notes-unwary-adventurer'/><label for='toc--notes-unwary-adventurer'><a href="#notes-unwary-adventurer">1.3. Notes for the unwary adventurer</a></label>
<ul>
<li><a href="#extra-requirements">1.3.1. Extra Requirements</a></li>
</ul>
</li>
<li><input type='checkbox' id='toc--current-issues'/><label for='toc--current-issues'><a href="#current-issues">1.4. Current Issues</a></label>
<ul>
<li><a href="#magit-push-daemon">1.4.1. Magit push in daemon</a></li>
<li><a href="#calctex-brings-up">1.4.2. CalcTeX brings up compilation buffer</a></li>
<li><a href="#unread-emails-doesnt">1.4.3. Unread emails doesn&rsquo;t work across Emacs instances</a></li>
</ul>
</li>
</ul>
</li>
<li><input type='checkbox' id='toc--rudimentary-configuration'/><label for='toc--rudimentary-configuration'><a href="#rudimentary-configuration">2. Rudimentary configuration</a></label>
<ul>
<li><a href="#personal-information">2.1. Personal Information</a></li>
<li><input type='checkbox' id='toc--better-defaults'/><label for='toc--better-defaults'><a href="#better-defaults">2.2. Better defaults</a></label>
<ul>
<li><a href="#simple-settings">2.2.1. Simple settings</a></li>
<li><a href="#frame-sizing">2.2.2. Frame sizing</a></li>
<li><a href="#auto-customisations">2.2.3. Auto-customisations</a></li>
<li><a href="#windows">2.2.4. Windows</a></li>
<li><a href="#buffer-defaults">2.2.5. Buffer defaults</a></li>
</ul>
</li>
<li><input type='checkbox' id='toc--doom-configuration'/><label for='toc--doom-configuration'><a href="#doom-configuration">2.3. Doom configuration</a></label>
<ul>
<li><input type='checkbox' id='toc--modules'/><label for='toc--modules'><a href="#modules">2.3.1. Modules</a></label>
<ul>
<li><a href="#structure">2.3.1.1. Structure</a></li>
<li><a href="#interface">2.3.1.2. Interface</a></li>
<li><a href="#language-support">2.3.1.3. Language support</a></li>
<li><a href="#everything-emacs">2.3.1.4. Everything in Emacs</a></li>
</ul>
</li>
<li><input type='checkbox' id='toc--visual-settings'/><label for='toc--visual-settings'><a href="#visual-settings">2.3.2. Visual Settings</a></label>
<ul>
<li><a href="#font-face">2.3.2.1. Font Face</a></li>
<li><a href="#theme-modeline">2.3.2.2. Theme and modeline</a></li>
<li><a href="#miscellaneous">2.3.2.3. Miscellaneous</a></li>
</ul>
</li>
<li><a href="#some-helper-macros">2.3.3. Some helper macros</a></li>
</ul>
</li>
<li><input type='checkbox' id='toc--other-things'/><label for='toc--other-things'><a href="#other-things">2.4. Other things</a></label>
<ul>
<li><input type='checkbox' id='toc--editor-interaction'/><label for='toc--editor-interaction'><a href="#editor-interaction">2.4.1. Editor interaction</a></label>
<ul>
<li><a href="#mouse-buttons">2.4.1.1. Mouse buttons</a></li>
</ul>
</li>
<li><a href="#window-title">2.4.2. Window title</a></li>
<li><a href="#splash-screen">2.4.3. Splash screen</a></li>
<li><a href="#systemd-daemon">2.4.4. Systemd daemon</a></li>
<li><a href="#emacs-client-wrapper">2.4.5. Emacs client wrapper</a></li>
</ul>
</li>
</ul>
</li>
<li><input type='checkbox' id='toc--package-loading'/><label for='toc--package-loading'><a href="#package-loading">3. Package loading</a></label>
<ul>
<li><input type='checkbox' id='toc--loading-instructions'/><label for='toc--loading-instructions'><a href="#loading-instructions">3.1. Loading instructions</a></label>
<ul>
<li><a href="#packages-melpa-elpa">3.1.1. Packages in MELPA/ELPA/emacsmirror</a></li>
<li><a href="#packages-from-git">3.1.2. Packages from git repositories</a></li>
<li><a href="#disabling-built-packages">3.1.3. Disabling built-in packages</a></li>
</ul>
</li>
<li><input type='checkbox' id='toc--general-packages'/><label for='toc--general-packages'><a href="#general-packages">3.2. General packages</a></label>
<ul>
<li><a href="#window-management">3.2.1. Window management</a></li>
<li><a href="#fun">3.2.2. Fun</a></li>
<li><input type='checkbox' id='toc--features'/><label for='toc--features'><a href="#features">3.2.3. Features</a></label>
<ul>
<li><a href="#calctex">3.2.3.1. CalcTeX</a></li>
<li><a href="#ess">3.2.3.2. ESS</a></li>
<li><a href="#magit-delta">3.2.3.3. Magit Delta</a></li>
<li><a href="#info-colours">3.2.3.4. Info colours</a></li>
<li><a href="#large-files">3.2.3.5. Large files</a></li>
<li><a href="#definitions">3.2.3.6. Definitions</a></li>
<li><a href="#calibre-ebook-reading">3.2.3.7. Calibre and ebook reading</a></li>
<li><a href="#screenshots">3.2.3.8. Screenshots</a></li>
</ul>
</li>
</ul>
</li>
<li><input type='checkbox' id='toc--language-packages'/><label for='toc--language-packages'><a href="#language-packages">3.3. Language packages</a></label>
<ul>
<li><a href="#latex">3.3.1. LaTeX</a></li>
<li><input type='checkbox' id='toc--org-mode'/><label for='toc--org-mode'><a href="#org-mode">3.3.2. Org Mode</a></label>
<ul>
<li><a href="#improve-agenda-capture">3.3.2.1. Improve agenda/capture</a></li>
<li><a href="#visuals">3.3.2.2. Visuals</a></li>
<li><a href="#extra-functionality">3.3.2.3. Extra functionality</a></li>
</ul>
</li>
<li><a href="#systemd">3.3.3. Systemd</a></li>
<li><a href="#graphviz">3.3.4. Graphviz</a></li>
<li><a href="#authinfo">3.3.5. Authinfo</a></li>
<li><a href="#beancount-accounting">3.3.6. Beancount (accounting)</a></li>
</ul>
</li>
</ul>
</li>
<li><input type='checkbox' id='toc--package-configuration'/><label for='toc--package-configuration'><a href="#package-configuration">4. Package configuration</a></label>
<ul>
<li><a href="#abbrev-mode">4.1. Abbrev mode</a></li>
<li><a href="#calc">4.2. Calc</a></li>
<li><a href="#centaur-tabs">4.3. Centaur Tabs</a></li>
<li><input type='checkbox' id='toc--company'/><label for='toc--company'><a href="#company">4.4. Company</a></label>
<ul>
<li><a href="#plain-text">4.4.1. Plain Text</a></li>
<li><a href="#company-ess">4.4.2. ESS</a></li>
</ul>
</li>
<li><a href="#elcord">4.5. Elcord</a></li>
<li><a href="#emacs-anywhere-configuration">4.6. Emacs Anywhere configuration</a></li>
<li><a href="#eros-eval">4.7. Eros-eval</a></li>
<li><a href="#evil">4.8. EVIL</a></li>
<li><a href="#package-configuration-info">4.9. Info colours</a></li>
<li><input type='checkbox' id='toc--ispell'/><label for='toc--ispell'><a href="#ispell">4.10. Ispell</a></label>
<ul>
<li><input type='checkbox' id='toc--downloading-dictionaries'/><label for='toc--downloading-dictionaries'><a href="#downloading-dictionaries">4.10.1. Downloading dictionaries</a></label>
<ul>
<li><a href="#hunspell">4.10.1.1. Hunspell</a></li>
<li><a href="#aspell">4.10.1.2. Aspell</a></li>
</ul>
</li>
<li><a href="#configuration">4.10.2. Configuration</a></li>
</ul>
</li>
<li><a href="#ivy">4.11. Ivy</a></li>
<li><a href="#magit">4.12. Magit</a></li>
<li><a href="#org-chef">4.13. Org Chef</a></li>
<li><a href="#projectile">4.14. Projectile</a></li>
<li><a href="#smart-parentheses">4.15. Smart Parentheses</a></li>
<li><a href="#spray">4.16. Spray</a></li>
<li><a href="#theme-magic">4.17. Theme magic</a></li>
<li><input type='checkbox' id='toc--tramp'/><label for='toc--tramp'><a href="#tramp">4.18. Tramp</a></label>
<ul>
<li><input type='checkbox' id='toc--troubleshooting'/><label for='toc--troubleshooting'><a href="#troubleshooting">4.18.1. Troubleshooting</a></label>
<ul>
<li><a href="#zsh">4.18.1.1. Zsh</a></li>
</ul>
</li>
<li><a href="#guix">4.18.2. Guix</a></li>
</ul>
</li>
<li><a href="#treemacs">4.19. Treemacs</a></li>
<li><a href="#which-key">4.20. Which-key</a></li>
<li><a href="#writeroom">4.21. Writeroom</a></li>
<li><a href="#xkcd">4.22. xkcd</a></li>
<li><a href="#yasnippet">4.23. YASnippet</a></li>
</ul>
</li>
<li><input type='checkbox' id='toc--applications'/><label for='toc--applications'><a href="#applications">5. Applications</a></label>
<ul>
<li><a href="#ebooks">5.1. Ebooks</a></li>
<li><input type='checkbox' id='toc--irc'/><label for='toc--irc'><a href="#irc">5.2. IRC</a></label>
<ul>
<li><a href="#org-style-emphasis">5.2.1. Org-style emphasis</a></li>
<li><a href="#emojis">5.2.2. Emojis</a></li>
</ul>
</li>
<li><input type='checkbox' id='toc--newsfeed'/><label for='toc--newsfeed'><a href="#newsfeed">5.3. Newsfeed</a></label>
<ul>
<li><a href="#keybindings">5.3.1. Keybindings</a></li>
<li><a href="#usability-enhancements">5.3.2. Usability enhancements</a></li>
<li><a href="#visual-enhancements">5.3.3. Visual enhancements</a></li>
<li><a href="#functionality-enhancements">5.3.4. Functionality enhancements</a></li>
</ul>
</li>
<li><a href="#dictionary">5.4. Dictionary</a></li>
<li><input type='checkbox' id='toc--mail'/><label for='toc--mail'><a href="#mail">5.5. Mail</a></label>
<ul>
<li><input type='checkbox' id='toc--fetching'/><label for='toc--fetching'><a href="#fetching">5.5.1. Fetching</a></label>
<ul>
<li><a href="#rebuild-mail-index">5.5.1.1. Rebuild mail index while using mu4e</a></li>
<li><a href="#config-transcoding-">5.5.1.2. Config transcoding &amp; service management</a></li>
<li><a href="#fetching-systemd">5.5.1.3. Systemd</a></li>
</ul>
</li>
<li><a href="#indexing-searching">5.5.2. Indexing/Searching</a></li>
<li><input type='checkbox' id='toc--sending'/><label for='toc--sending'><a href="#sending">5.5.3. Sending</a></label>
<ul>
<li><a href="#system-hackery">5.5.3.1. System hackery</a></li>
</ul>
</li>
<li><input type='checkbox' id='toc--mu4e'/><label for='toc--mu4e'><a href="#mu4e">5.5.4. Mu4e</a></label>
<ul>
<li><a href="#viewing-mail">5.5.4.1. Viewing Mail</a></li>
<li><a href="#sending-mail">5.5.4.2. Sending Mail</a></li>
</ul>
</li>
<li><a href="#org-msg">5.5.5. Org Msg</a></li>
</ul>
</li>
</ul>
</li>
<li><input type='checkbox' id='toc--language-configuration'/><label for='toc--language-configuration'><a href="#language-configuration">6. Language configuration</a></label>
<ul>
<li><input type='checkbox' id='toc--general'/><label for='toc--general'><a href="#general">6.1. General</a></label>
<ul>
<li><a href="#file-templates">6.1.1. File Templates</a></li>
</ul>
</li>
<li><a href="#plaintext">6.2. Plaintext</a></li>
<li><input type='checkbox' id='toc--org'/><label for='toc--org'><a href="#org">6.3. Org Mode</a></label>
<ul>
<li><input type='checkbox' id='toc--system-config'/><label for='toc--system-config'><a href="#system-config">6.3.1. System config</a></label>
<ul>
<li><a href="#mime-types">6.3.1.1. Mime types</a></li>
<li><a href="#development">6.3.1.2. Development</a></li>
</ul>
</li>
<li><input type='checkbox' id='toc--behaviour'/><label for='toc--behaviour'><a href="#behaviour">6.3.2. Behaviour</a></label>
<ul>
<li><a href="#tweaking-defaults">6.3.2.1. Tweaking defaults</a></li>
<li><input type='checkbox' id='toc--behaviour-extra-functionality'/><label for='toc--behaviour-extra-functionality'><a href="#behaviour-extra-functionality">6.3.2.2. Extra functionality</a></label>
<ul>
<li><a href="#org-buffer-creation">6.3.2.2.1. Org buffer creation</a></li>
<li><a href="#list-bullet-sequence">6.3.2.2.2. List bullet sequence</a></li>
<li><a href="#citation">6.3.2.2.3. Citation</a></li>
<li><a href="#cdlatex">6.3.2.2.4. cdlatex</a></li>
<li><a href="#spellcheck">6.3.2.2.5. Spellcheck</a></li>
<li><a href="#lsp-support-src">6.3.2.2.6. LSP support in <code>src</code> blocks</a></li>
<li><a href="#view-exported-file">6.3.2.2.7. View exported file</a></li>
</ul>
</li>
<li><a href="#super-agenda">6.3.2.3. Super agenda</a></li>
<li><a href="#capture">6.3.2.4. Capture</a></li>
<li><input type='checkbox' id='toc--roam'/><label for='toc--roam'><a href="#roam">6.3.2.5. Roam</a></label>
<ul>
<li><a href="#basic-settings">6.3.2.5.1. Basic settings</a></li>
<li><a href="#registering-roam-protocol">6.3.2.5.2. Registering roam protocol</a></li>
<li><a href="#graph-behaviour">6.3.2.5.3. Graph Behaviour</a></li>
<li><a href="#modeline-file-name">6.3.2.5.4. Modeline file name</a></li>
</ul>
</li>
<li><a href="#nicer-generated-heading">6.3.2.6. Nicer generated heading IDs</a></li>
<li><a href="#nicer-org-return">6.3.2.7. Nicer <code>org-return</code></a></li>
<li><a href="#snippet-helper">6.3.2.8. Snippet Helper</a></li>
<li><a href="#translate-capital-keywords">6.3.2.9. Translate capital keywords (old) to lower case (new)</a></li>
<li><input type='checkbox' id='toc--extra-links'/><label for='toc--extra-links'><a href="#extra-links">6.3.2.10. Extra links</a></label>
<ul>
<li><a href="#extra-links-xkcd">6.3.2.10.1. xkcd</a></li>
<li><a href="#music">6.3.2.10.2. Music</a></li>
<li><a href="#youtube">6.3.2.10.3. YouTube</a></li>
</ul>
</li>
</ul>
</li>
<li><input type='checkbox' id='toc--org-mode-visuals'/><label for='toc--org-mode-visuals'><a href="#org-mode-visuals">6.3.3. Visuals</a></label>
<ul>
<li><input type='checkbox' id='toc--editor'/><label for='toc--editor'><a href="#editor">6.3.3.1. In editor</a></label>
<ul>
<li><a href="#font-display">6.3.3.1.1. Font Display</a></li>
<li><a href="#symbols">6.3.3.1.2. Symbols</a></li>
<li><a href="#latex-fragments">6.3.3.1.3. LaTeX Fragments</a></li>
<li><a href="#stolen-from-scimax">6.3.3.1.4. Stolen from scimax (semi-working right now)</a></li>
</ul>
</li>
<li><a href="#org-plot">6.3.3.2. Org Plot</a></li>
<li><a href="#exporting-general">6.3.3.3. Exporting (general)</a></li>
<li><input type='checkbox' id='toc--exporting-html'/><label for='toc--exporting-html'><a href="#exporting-html">6.3.3.4. Exporting to HTML</a></label>
<ul>
<li><a href="#extra-header-content">6.3.3.4.1. Extra header content</a></li>
<li><a href="#custom-css-js">6.3.3.4.2. Custom CSS/JS</a></li>
<li><a href="#collapsable-src-example">6.3.3.4.3. Collapsable src and example blocks</a></li>
<li><a href="#include-extra-font">6.3.3.4.4. Include extra font-locking in htmlize</a></li>
<li><a href="#handle-table-overflow">6.3.3.4.5. Handle table overflow</a></li>
<li><a href="#toc-as-collapsable">6.3.3.4.6. TOC as a collapsable tree</a></li>
<li><a href="#make-verbatim-different">6.3.3.4.7. Make verbatim different to code</a></li>
<li><a href="#change-checkbox-type">6.3.3.4.8. Change checkbox type</a></li>
<li><a href="#header-anchors">6.3.3.4.9. Header anchors</a></li>
<li><a href="#acronyms">6.3.3.4.10. Acronyms</a></li>
<li><a href="#latex-rendering">6.3.3.4.11. LaTeX Rendering</a></li>
</ul>
</li>
<li><input type='checkbox' id='toc--exporting-latex'/><label for='toc--exporting-latex'><a href="#exporting-latex">6.3.3.5. Exporting to LaTeX</a></label>
<ul>
<li><a href="#compiling">6.3.3.5.1. Compiling</a></li>
<li><a href="#org-latex-acronyms">6.3.3.5.2. Acronyms</a></li>
<li><a href="#nicer-checkboxes">6.3.3.5.3. Nicer checkboxes</a></li>
<li><a href="#class-templates">6.3.3.5.4. Class templates</a></li>
<li><a href="#cleverer-preamble">6.3.3.5.5. A cleverer preamble</a></li>
<li><a href="#pretty-code-blocks">6.3.3.5.6. Pretty code blocks</a></li>
<li><a href="#remove-non-ascii">6.3.3.5.7. Remove non-ascii chars</a></li>
<li><a href="#support-images-from">6.3.3.5.8. Support images from URLs</a></li>
<li><a href="#chameleon-aka-match">6.3.3.5.9. Chameleon &#x2014; aka. match theme</a></li>
<li><a href="#exporting-latex-make">6.3.3.5.10. Make verbatim different to code</a></li>
</ul>
</li>
<li><a href="#exporting-beamer">6.3.3.6. Exporting to Beamer</a></li>
<li><a href="#exporting-markdown">6.3.3.7. Exporting to Markdown</a></li>
</ul>
</li>
<li><a href="#babel">6.3.4. Babel</a></li>
<li><a href="#org-mode-ess">6.3.5. ESS</a></li>
</ul>
</li>
<li><input type='checkbox' id='toc--language-configuration-latex'/><label for='toc--language-configuration-latex'><a href="#language-configuration-latex">6.4. LaTeX</a></label>
<ul>
<li><a href="#be-implemented-ideas">6.4.1. To-be-implemented ideas</a></li>
<li><a href="#compilation">6.4.2. Compilation</a></li>
<li><input type='checkbox' id='toc--snippet-helpers'/><label for='toc--snippet-helpers'><a href="#snippet-helpers">6.4.3. Snippet helpers</a></label>
<ul>
<li><a href="#template">6.4.3.1. Template</a></li>
<li><a href="#deliminators">6.4.3.2. Deliminators</a></li>
</ul>
</li>
<li><a href="#editor-visuals">6.4.4. Editor visuals</a></li>
<li><a href="#latex-cdlatex">6.4.5. CDLaTeX</a></li>
<li><a href="#synctex">6.4.6. SyncTeX</a></li>
<li><a href="#fixes">6.4.7. Fixes</a></li>
</ul>
</li>
<li><a href="#python">6.5. Python</a></li>
<li><input type='checkbox' id='toc--r'/><label for='toc--r'><a href="#r">6.6. R</a></label>
<ul>
<li><a href="#r-editor-visuals">6.6.1. Editor Visuals</a></li>
</ul>
</li>
<li><a href="#language-configuration-graphviz">6.7. Graphviz</a></li>
<li><a href="#markdown">6.8. Markdown</a></li>
<li><a href="#beancount">6.9. Beancount</a></li>
<li><input type='checkbox' id='toc--snippets'/><label for='toc--snippets'><a href="#snippets">6.10. Snippets</a></label>
<ul>
<li><a href="#latex-mode">6.10.1. latex mode</a></li>
<li><a href="#markdown-mode">6.10.2. markdown mode</a></li>
<li><a href="#snippets-org-mode">6.10.3. org mode</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</nav>
<a href="https://github.com/tecosaur/emacs-config/"
   style="font-family: 'Open Sans'; background-image: none; color: inherit;
   text-decoration: none; position: relative; top: clamp(-26px, calc(1280px - 100vw), 0px); opacity: 0.7;">
  <img src="https://upload.wikimedia.org/wikipedia/commons/9/91/Octicons-mark-github.svg"
       class="invertible" alt="GitHub Octicon"
       style="height: 1em; position: relative; top: 0.1em;">
  View on GitHub</a>
<blockquote>
<p>
Let us change our traditional attitude to the construction of programs:
Instead of imagining that our main task is to instruct a computer what to do,
let us concentrate rather on explaining to human beings what we want a
computer to do. &#x2014; Donald Knuth
</p>
</blockquote>

<div id="outline-container-intro" class="outline-2">
<h2 id="intro"><span class="section-number-2">1</span> Intro<a aria-hidden="true" href="#intro">#</a> </h2>
<div class="outline-text-2" id="text-1">
<p>
Customising an editor can be very rewarding &#x2026; until you have to leave it.
For years I have been looking for ways to avoid this pain.
Then I discovered <a href="https://github.com/cknadler/vim-anywhere">vim-anywhere</a>, and found that it had an Emacs companion,
<a href="https://github.com/zachcurry/emacs-anywhere">emacs-anywhere</a>. To me, this looked most attractive.
</p>

<p>
Separately, online I have seen the following statement enough times I think it&rsquo;s a catchphrase
</p>
<blockquote>
<p>
Redditor 1: I just discovered this thing, isn&rsquo;t it cool. <br>
Redditor 2: Oh, there&rsquo;s an Emacs mode for that.
</p>
</blockquote>

<p>
This was enough for me to install Emacs, but I soon learned there are <a href="https://github.com/remacs/remacs#why-emacs">far more
compelling reasons</a> to keep using it.
</p>

<p>
I tried out the <kbd>spacemacs</kbd> distribution a bit, but it wasn&rsquo;t quite to my liking.
Then I heard about <kbd>doom emacs</kbd> and thought I may as well give that a try.
<span class='acr'>TLDR</span>; it&rsquo;s great.
</p>

<p>
Now I&rsquo;ve discovered the wonders of literate programming, and am becoming more
settled by the day. This is both my config, and a cautionary tale (just replace
&ldquo;Linux&rdquo; with &ldquo;Emacs&rdquo; in the comic below).
</p>

<p>
<img class='invertible' src='https://imgs.xkcd.com/comics/cautionary.png' title="This really is a true story, and she doesn't know I put it in my comic because her wifi hasn't worked for weeks." alt='Cautionary'>
</p>
</div>

<div id="outline-container-why-emacs" class="outline-3">
<h3 id="why-emacs"><span class="section-number-3">1.1</span> Why Emacs?<a aria-hidden="true" href="#why-emacs">#</a> </h3>
<div class="outline-text-3" id="text-1-1">
<p>
Emacs is <a href="https://www.eigenbahn.com/2020/01/12/emacs-is-no-editor">not a text editor</a>, this is a common misnomer. It is far more apt to
describe Emacs as <i>a Lisp machine providing a generic user-centric text
manipulation environment</i>. That&rsquo;s quite a mouthful.
In simpler terms one can think of Emacs as a platform for text-related
applications. It&rsquo;s a vague and generic definition because Emacs itself is
generic.
</p>

<p>
Good with text. How far does that go? A lot further than one initially thinks:
</p>
<ul class="org-ul">
<li><a href="https://orgmode.org/">Task planning</a></li>
<li><a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Dired.html">File management</a></li>
<li><a href="https://github.com/akermu/emacs-libvterm">Terminal emulation</a></li>
<li><a href="https://www.djcbsoftware.nl/code/mu/mu4e.html">Email client</a></li>
<li><a href="https://www.gnu.org/software/tramp/">Remote server tool</a></li>
<li><a href="https://magit.vc/">Git frontend</a></li>
<li>Web <a href="https://github.com/pashky/restclient.el">client</a>/<a href="https://github.com/skeeto/emacs-web-server">server</a></li>
<li>and more&#x2026;</li>
</ul>

<p>
Ideally, one may use Emacs as <i>the</i> interface to perform <kbd>input → transform →
output</kbd> cycles, i.e. form a bridge between the human mind and information
manipulation.
</p>
</div>

<div id="outline-container-enveloping-editor" class="outline-4">
<h4 id="enveloping-editor"><span class="section-number-4">1.1.1</span> The enveloping editor<a aria-hidden="true" href="#enveloping-editor">#</a> </h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
Emacs allows one to do more in one place than any other application. Why is this
good?
</p>
<ul class="org-ul">
<li>Enables one to complete tasks with a consistent, standard set of keybindings,
<span class='acr'>GUI</span> and editing methods &#x2014; learn once, use everywhere</li>
<li>Reduced context-switching</li>
<li>Compressing the stages of a project &#x2014; a more centralised workflow can progress
with greater ease</li>
<li>Integration between tasks previously relegated to different applications, but
with a common subject &#x2014; e.g. linking to an email in a to-do list</li>
</ul>

<p>
Emacs can be thought of as a platform within which various elements of your
workflow may settle, with the potential for rich integrations between them &#x2014; a
<i>life</i> <span class='acr'>IDE</span> if you will.
</p>

<p>
Today, many aspects of daily computer usage are split between different
applications which act like islands, but this often doesn&rsquo;t mirror how we
<i>actually use</i> our computers. Emacs, if one goes down the rabbit hole, can give
users the power to bridge this gap.
</p>


<figure id="orgd95c059">
<object type="image/svg+xml" data="misc/emacs-platform.svg" class="invertible" alt="Graph of possible Emacs task integrations" style="max-width:min(24em,100%)">
Sorry, your browser does not support SVG.</object>

<figcaption><span class="figure-number">Figure 1: </span>Some sample workflow integrations that can be used within Emacs</figcaption>
</figure>
</div>
</div>

<div id="outline-container-some-notably-unique" class="outline-4">
<h4 id="some-notably-unique"><span class="section-number-4">1.1.2</span> Some notably unique features<a aria-hidden="true" href="#some-notably-unique">#</a> </h4>
<div class="outline-text-4" id="text-1-1-2">
<ul class="org-ul">
<li>Recursive editing</li>
<li>Completely introspectable, with pervasive docstrings</li>
<li>Mutable environment, which can be incrementally modified</li>
<li>Functionality without applications</li>
<li>Client-server separation allows for a daemon, giving near-instant perceived
startup time.</li>
</ul>
</div>
</div>

<div id="outline-container-issues" class="outline-4">
<h4 id="issues"><span class="section-number-4">1.1.3</span> Issues<a aria-hidden="true" href="#issues">#</a> </h4>
<div class="outline-text-4" id="text-1-1-3">
<ul class="org-ul">
<li>Emacs has irritating quirks</li>
<li>Some aspects are showing their age (naming conventions, <span class='acr'>API</span><small>s</small>)</li>
<li>Emacs is (<a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Threads.html">mostly</a>) single-threaded, meaning that when something holds that
thread up the whole application freezes</li>
<li>A few other nuisances</li>
</ul>
</div>
</div>

<div id="outline-container-teach-man-fish" class="outline-4">
<h4 id="teach-man-fish"><span class="section-number-4">1.1.4</span> Teach a man to fish&#x2026;<a aria-hidden="true" href="#teach-man-fish">#</a> </h4>
<div class="outline-text-4" id="text-1-1-4">
<blockquote>
<p>
Give a man a fish, and you feed him for a day. Teach a man to fish, and you feed
him for a lifetime. &#x2014; Anne Isabella
</p>
</blockquote>

<p>
Most popular editors have a simple and pretty <a href="https://code.visualstudio.com/docs/getstarted/settings">settings interface</a>, filled with
check-boxes, selects, and the occasional text-box. This makes it easy for the
user to pick between common desirable behaviours. To me this is now like <i>giving
a man a fish</i>.
</p>

<p>
What if you want one of those &rsquo;check-box&rsquo; settings to be only on in certain
conditions? Some editors have workspace settings, but that requires you to
manually set the value for <i>every single instance</i>. Urgh, <a href="https://github.com/microsoft/vscode/issues/93153">what</a> <a href="https://github.com/microsoft/vscode/issues/93628">a</a> <a href="https://github.com/microsoft/vscode/issues/5595">pain</a>.
</p>

<p>
What if you could set the value of that &rsquo;check-box&rsquo; setting to be the result of
an arbitrary expression evaluated for each file? This is where an editor like
Emacs comes in.
Configuration for Emacs isn&rsquo;t a list of settings in <span class='acr'>JSON</span> etc. it&rsquo;s <b>an executable
program which modifies the behaviour of the editor to suit your liking</b>.
This is &rsquo;teaching a man to fish&rsquo;.
</p>

<p>
Emacs is built in the same language you configure it in (Emacs <a href="https://en.wikipedia.org/wiki/Lisp_(programming_language)">Lisp</a>, or <a href="https://www.gnu.org/software/emacs/manual/html_node/eintr/">elisp</a>).
It comes with a broad array of useful functions for text-editing, and Doom adds
a few handy little convenience functions.
</p>

<p>
Want to add a keybinding to delete the previous line? It&rsquo;s as easy as
</p>
<details id='keybinding-delete-previous' class='code' open><summary class='named'><span class='name'>Keybinding to delete the previous line</span><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#keybinding-delete-previous'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">map!</span> <span class="org-string">"C-d"</span>
      <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">cmd!</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">previous-line</span><span class="org-rainbow-delimiters-depth-3">)</span>
            <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">kill-line</span><span class="org-rainbow-delimiters-depth-3">)</span>
            <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">forward-line</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
How about another example, say you want to be presented with a list of currently
open <i>buffers</i> (think files, almost) when you split the window. It&rsquo;s as simple as
</p>
<details id='prompt-buffer-after' class='code' open><summary class='named'><span class='name'>Prompt for buffer after split</span><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#prompt-buffer-after'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defadvice!</span> prompt-for-buffer <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">&amp;rest</span> _<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-builtin">:after</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">window-split</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">switch-to-buffer</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Want to test it out? You don&rsquo;t need to save and restart, you can just <i>evaluate
the expression</i> within your current Emacs instance and try it immediately! This
editor is, after all, a Lisp interpreter.
</p>

<p>
Want to tweak the behaviour? Just re-evaluate your new version &#x2014; it&rsquo;s a
super-tight iteration loop.
</p>
</div>
</div>
</div>

<div id="outline-container-editor-comparison" class="outline-3">
<h3 id="editor-comparison"><span class="section-number-3">1.2</span> Editor comparison<a aria-hidden="true" href="#editor-comparison">#</a> </h3>
<div class="outline-text-3" id="text-1-2">
<p>
<img class='invertible' src='https://imgs.xkcd.com/comics/real_programmers.png' title="Real programmers set the universal constants at the start such that the universe evolves to contain the disk with the data they want." alt='Real Programmers'>
</p>

<p>
Over the years I have tried out (spent at least a year using as my primary
editor) the following applications
</p>
<ul class="org-ul">
<li>Python <span class='acr'>IDLE</span></li>
<li>Komodo Edit</li>
<li>Brackets</li>
<li>VSCode</li>
<li>and now, Emacs</li>
</ul>

<p>
I have attempted to quantify aspects of my impressions of them below.
</p>

<div id='editor-comparison,table--1' class='table'>
    <div class='gutter'><a href='#editor-comparison,table--1'>#</a></div>
    <div class='tabular'>
    <table>


<colgroup>
<col  class="org-left">

<col  class="org-right">

<col  class="org-right">

<col  class="org-right">

<col  class="org-right">

<col  class="org-right">

<col  class="org-right">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Editor</th>
<th scope="col" class="org-right">Extensibility</th>
<th scope="col" class="org-right">Ecosystem</th>
<th scope="col" class="org-right">Ease of Use</th>
<th scope="col" class="org-right">Comfort</th>
<th scope="col" class="org-right">Completion</th>
<th scope="col" class="org-right">Performance</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><span class='acr'>IDLE</span></td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">3</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-left">VSCode</td>
<td class="org-right">3</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
<td class="org-right">3.5</td>
<td class="org-right">4</td>
<td class="org-right">3</td>
</tr>

<tr>
<td class="org-left">Brackets</td>
<td class="org-right">2.5</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">3</td>
<td class="org-right">2.5</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-left">Emacs</td>
<td class="org-right">4</td>
<td class="org-right">4</td>
<td class="org-right">2</td>
<td class="org-right">4</td>
<td class="org-right">3.5</td>
<td class="org-right">3</td>
</tr>

<tr>
<td class="org-left">Komodo Edit</td>
<td class="org-right">2</td>
<td class="org-right">1</td>
<td class="org-right">3</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
    </div>    </div>


<figure id="orgf94232b">
<img src="https://tecosaur.com/lfs/emacs-config/editor-comparison.png" alt="Radar chart comparing my thoughts on a few editors." class="invertible">

</figure>
</div>
</div>

<div id="outline-container-notes-unwary-adventurer" class="outline-3">
<h3 id="notes-unwary-adventurer"><span class="section-number-3">1.3</span> Notes for the unwary adventurer<a aria-hidden="true" href="#notes-unwary-adventurer">#</a> </h3>
<div class="outline-text-3" id="text-1-3">
<p>
If you like the look of this, that&rsquo;s marvellous, and I&rsquo;m really happy that I&rsquo;ve
made something which you may find interesting, however:
</p>
<div class="warning" id="org618d031">
<p>
This config is <i>insidious</i>. Copying the whole thing blindly can easily lead to
undesired effects. I recommend copying chunks instead.
</p>

</div>

<p>
If you are so bold as to wish to steal bits of my config (or if I upgrade and
wonder why things aren&rsquo;t working), here&rsquo;s a list of sections which rely on
external setup (i.e. outside of this config).
</p>

<dl class="org-dl">
<dt>dictionary</dt><dd>I&rsquo;ve downloaded a custom <a href="http://app.aspell.com/create"><span class='acr'>SCOWL</span></a> dictionary, which I use in <a href="#ispell">ispell</a>.
If this causes issues, just delete the <code>(setq ispell-dictionary ...)</code> bit.</dd>
<dt>uni-units file</dt><dd>I&rsquo;ve got a file in <kbd>~/.org/.uni-units</kbd> which I use in <code>org-capture</code>
If this causes issues, just remove the reference to that file in <a href="#capture">Capture</a> and
instances of <code>unit-prompt</code> used in  <code>(doct ...)</code></dd>
</dl>

<p>
Oh, did I mention that I started this config when I didn&rsquo;t know any <kbd>elisp</kbd>, and
this whole thing is a hack job? If you can suggest any improvements, please do
so, no matter how much criticism you include I&rsquo;ll appreciate it :)
</p>

<p>
<img class='invertible' src='https://imgs.xkcd.com/comics/code_quality.png' title="I honestly didn't think you could even USE emoji in variable names. Or that there were so many different crying ones." alt='Code Quality'>
</p>
</div>

<div id="outline-container-extra-requirements" class="outline-4">
<h4 id="extra-requirements"><span class="section-number-4">1.3.1</span> Extra Requirements<a aria-hidden="true" href="#extra-requirements">#</a> </h4>
<div class="outline-text-4" id="text-1-3-1">
<p>
The lovely <code>doom doctor</code> is good at diagnosing most missing things, but here are a
few extras.
</p>
<ul class="org-ul">
<li>A <a href="https://www.tug.org/texlive/">LaTeX Compiler</a> is required for the mathematics rendering performed in <a href="#org">Org</a>,
and by <a href="#calctex">CalcTeX</a>.</li>
<li>I use the <a href="https://overpassfont.org/">Overpass</a> font as a go-to sans serif.
It&rsquo;s used as my <code>doom-variable-pitch-font</code> and in the graph generated by <a href="#roam">Roam</a>.
I have chosen it because it possesses a few characteristics I consider
desirable, namely:
<ul class="org-ul">
<li>A clean, and legible style. Highway-style fonts tend to be designed to be
clear at a glance, and work well with a thicker weight, and this is inspired
by <i>Highway Gothic</i>.</li>
<li>It&rsquo;s slightly quirky. Look at the diagonal cut on stems for example.
Helvetica is a masterful design, but I like a bit more pizzazz now and then.</li>
</ul></li>
<li>A few <span class='acr'>LSP</span> servers. Take a look at <a href="init.el">init.el</a> to see which modules have the <code>+lsp</code> flag.</li>
<li><p>
The <a href="https://github.com/dandavison/delta/">Delta</a> binary. It&rsquo;s packaged for some distributions but I installed it with
</p>
<details id=',code--1' class='code' open><summary><span class='lang'>Shell Script</span></summary>
    <div class='gutter'>
    <a href='#,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell">cargo install git-delta
</pre>
</div>
    </details></li>
<li><p>
The <kbd>theme-magic</kbd> package requires the <code>wal</code> (<kbd>pywal</kbd>) executable. If this is
packaged for you, great! If not, it&rsquo;s just a quick <code>pip install</code> away.
</p>
<details id=',code--2' class='code' open><summary><span class='lang'>Shell Script</span></summary>
    <div class='gutter'>
    <a href='#,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell"><span class="org-type">sudo</span> python3 -m pip install pywal
</pre>
</div>
    </details></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-current-issues" class="outline-3">
<h3 id="current-issues"><span class="section-number-3">1.4</span> Current Issues<a aria-hidden="true" href="#current-issues">#</a> </h3>
<div class="outline-text-3" id="text-1-4">
</div>
<div id="outline-container-magit-push-daemon" class="outline-4">
<h4 id="magit-push-daemon"><span class="section-number-4">1.4.1</span> Magit push in daemon<a aria-hidden="true" href="#magit-push-daemon">#</a> </h4>
<div class="outline-text-4" id="text-1-4-1">
<p>
Quite often trying to push to a remote in the Emacs daemon produces as error like this:
</p>
<details id='magit-push-daemon,code--1' class='code' open><summary><span class='lang'>fundamental</span></summary>
    <div class='gutter'>
    <a href='#magit-push-daemon,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-fundamental">128 git &#8230; push -v origin refs/heads/master\:refs/heads/master
Pushing to git@github.com:tecosaur/emacs-config.git

fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-calctex-brings-up" class="outline-4">
<h4 id="calctex-brings-up"><span class="section-number-4">1.4.2</span> CalcTeX brings up compilation buffer<a aria-hidden="true" href="#calctex-brings-up">#</a> </h4>
<div class="outline-text-4" id="text-1-4-2">
<p>
With my <a href="#calc">Calc</a> hook, the first call of <kbd>M-x calc</kbd> brings up a compilation buffer
from CalcTeX. I&rsquo;m guessing this is from the compilation of the preamble / <code>.fmt</code> file.
</p>
</div>
</div>
<div id="outline-container-unread-emails-doesnt" class="outline-4">
<h4 id="unread-emails-doesnt"><span class="section-number-4">1.4.3</span> Unread emails doesn&rsquo;t work across Emacs instances<a aria-hidden="true" href="#unread-emails-doesnt">#</a> </h4>
<div class="outline-text-4" id="text-1-4-3">
<p>
It would be nice if it did, so that I could have the Emacs-daemon hold the
active mu4e session, but still get that information. In this case I&rsquo;d want to
change the action to open the Emacs daemon, but it should be possible.
</p>

<p>
This would probably involve hooking into the daemon&rsquo;s modeline update function
to write to a temporary file, and having a file watcher started in other Emacs
instances, in a similar manner to <a href="#rebuild-mail-index">Rebuild mail index while using mu4e</a>.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-rudimentary-configuration" class="outline-2">
<h2 id="rudimentary-configuration"><span class="section-number-2">2</span> Rudimentary configuration<a aria-hidden="true" href="#rudimentary-configuration">#</a> </h2>
<div class="outline-text-2" id="text-2">
<p>
Make this file run (slightly) faster with lexical binding (see <a href="https://nullprogram.com/blog/2016/12/22/">this blog post</a>
for more info).
</p>
<details id='rudimentary-configuration,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#rudimentary-configuration,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;; </span><span class="org-comment">config.el -*- lexical-binding: t; -*-</span>
</pre>
</div>
    </details>
</div>

<div id="outline-container-personal-information" class="outline-3">
<h3 id="personal-information"><span class="section-number-3">2.1</span> Personal Information<a aria-hidden="true" href="#personal-information">#</a> </h3>
<div class="outline-text-3" id="text-2-1">
<p>
It&rsquo;s useful to have some basic personal information
</p>
<details id='personal-information,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#personal-information,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">user-full-name</span> <span class="org-string">"TEC"</span>
      <span class="org-variable-name">user-mail-address</span> <span class="org-string">"tec@tecosaur.com"</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
Apparently this is used by <code>GPG</code>, and all sorts of other things.
</p>

<p>
Speaking of <code>GPG</code>, I want to use <kbd>~/.authsource.gpg</kbd> instead of the default in
<kbd>~/.emacs.d</kbd>. Why? Because my home directory is already cluttered, so this won&rsquo;t
make a difference, and I don&rsquo;t want to accidentaly purge this file (I have done
<code>rm -rf~/.emac.d</code> before). I also want to cache as much as possible, as my home
machine is pretty safe, and my laptop is shutdown a lot.
</p>
<details id='personal-information,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#personal-information,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">auth-sources</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"~/.authinfo.gpg"</span><span class="org-rainbow-delimiters-depth-2">)</span>
      <span class="org-variable-name">auth-source-cache-expiry</span> nil<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">default is 7200 (2h)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-better-defaults" class="outline-3">
<h3 id="better-defaults"><span class="section-number-3">2.2</span> Better defaults<a aria-hidden="true" href="#better-defaults">#</a> </h3>
<div class="outline-text-3" id="text-2-2">
</div>
<div id="outline-container-simple-settings" class="outline-4">
<h4 id="simple-settings"><span class="section-number-4">2.2.1</span> Simple settings<a aria-hidden="true" href="#simple-settings">#</a> </h4>
<div class="outline-text-4" id="text-2-2-1">
<p>
Browsing the web and seeing <a href="https://github.com/angrybacon/dotemacs/blob/master/dotemacs.org#use-better-defaults">angrybacon/dotemacs</a> and comparing with the values
shown by <kbd>SPC h v</kbd> and selecting what I thought looks good, I&rsquo;ve ended up adding the following:
</p>
<details id='simple-settings,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#simple-settings,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq-default</span>
 <span class="org-variable-name">delete-by-moving-to-trash</span> t                      <span class="org-comment-delimiter">; </span><span class="org-comment">Delete files to trash</span>
 <span class="org-variable-name">window-combination-resize</span> t                      <span class="org-comment-delimiter">; </span><span class="org-comment">take new window space from all other windows (not just current)</span>
 x-stretch-cursor t<span class="org-rainbow-delimiters-depth-1">)</span>                              <span class="org-comment-delimiter">; </span><span class="org-comment">Stretch cursor to the glyph width</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">undo-limit</span> <span class="org-highlight-numbers-number">80000000</span>                         <span class="org-comment-delimiter">; </span><span class="org-comment">Raise undo-limit to 80Mb</span>
      <span class="org-variable-name">evil-want-fine-undo</span> t                       <span class="org-comment-delimiter">; </span><span class="org-comment">By default while in insert all changes are one big blob. Be more granular</span>
      <span class="org-variable-name">auto-save-default</span> t                         <span class="org-comment-delimiter">; </span><span class="org-comment">Nobody likes to loose work, I certainly don't</span>
      truncate-string-ellipsis <span class="org-string">"&#8230;"</span><span class="org-rainbow-delimiters-depth-1">)</span>               <span class="org-comment-delimiter">; </span><span class="org-comment">Unicode ellispis are nicer than "...", and also save /precious/ space</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-variable-name">display-time-mode</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">)</span>                             <span class="org-comment-delimiter">; </span><span class="org-comment">Enable time in the mode-line</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">equal</span> <span class="org-string">"Battery status not available"</span>
           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">battery</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-variable-name">display-battery-mode</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span>                        <span class="org-comment-delimiter">; </span><span class="org-comment">On laptops it's nice to know how much power you have</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">password-cache-expiry</span> nil<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>               <span class="org-comment-delimiter">; </span><span class="org-comment">I can trust my desktops ... can't I? (no battery = desktop)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-variable-name">global-subword-mode</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">)</span>                           <span class="org-comment-delimiter">; </span><span class="org-comment">Iterate through CamelCase words</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-frame-sizing" class="outline-4">
<h4 id="frame-sizing"><span class="section-number-4">2.2.2</span> Frame sizing<a aria-hidden="true" href="#frame-sizing">#</a> </h4>
<div class="outline-text-4" id="text-2-2-2">
<p>
It&rsquo;s nice to control the size of new frames, when launching Emacs that can be
done with <code>emacs -geometry 160x48</code>. After the font size adjustment during
initialisation this works out to be <code>102x31</code>.
</p>

<p>
Thanks to hotkeys, it&rsquo;s easy for me to expand a frame to half/full-screen, so it
makes sense to be conservative with the sizing of new frames.
</p>

<p>
Then, for creating new frames within the same Emacs instance, we&rsquo;ll just set the
default to be something roughly 80% of that size.
</p>

<details id='frame-sizing,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#frame-sizing,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">default-frame-alist</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>height . <span class="org-highlight-numbers-number">24</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">default-frame-alist</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>width . <span class="org-highlight-numbers-number">80</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-auto-customisations" class="outline-4">
<h4 id="auto-customisations"><span class="section-number-4">2.2.3</span> Auto-customisations<a aria-hidden="true" href="#auto-customisations">#</a> </h4>
<div class="outline-text-4" id="text-2-2-3">
<p>
By default changes made via a customisation interface are added to <kbd>init.el</kbd>.
I prefer the idea of using a separate file for this. We just need to change a
setting, and load it if it exists.
</p>
<details id='auto-customisations,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#auto-customisations,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq-default</span> <span class="org-variable-name">custom-file</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">expand-file-name</span> <span class="org-string">".custom.el"</span> <span class="org-variable-name">doom-private-dir</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">file-exists-p</span> <span class="org-variable-name">custom-file</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">load</span> <span class="org-variable-name">custom-file</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-windows" class="outline-4">
<h4 id="windows"><span class="section-number-4">2.2.4</span> Windows<a aria-hidden="true" href="#windows">#</a> </h4>
<div class="outline-text-4" id="text-2-2-4">
<p>
I find it rather handy to be asked which buffer I want to see after splitting
the window. Let&rsquo;s make that happen.
First, we&rsquo;ll enter the new window
</p>
<details id='windows,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#windows,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">evil-vsplit-window-right</span> t
      <span class="org-variable-name">evil-split-window-below</span> t<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
Then, we&rsquo;ll pull up <code>ivy</code>
</p>
<details id='windows,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#windows,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defadvice!</span> prompt-for-buffer <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">&amp;rest</span> _<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-builtin">:after</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>evil-window-split evil-window-vsplit<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">+ivy/switch-buffer</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
Oh, and previews are nice
</p>
<details id='windows,code--3' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#windows,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">+ivy-buffer-preview</span> t<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Window rotation is nice, and can be found under <kbd>SPC w r</kbd> and <kbd>SPC w R</kbd>.
<i>Layout</i> rotation is also nice though. Let&rsquo;s stash this under <kbd>SPC w SPC</kbd>, inspired
by Tmux&rsquo;s use of <kbd>C-b SPC</kbd> to rotate windows.
</p>

<p>
We could also do with adding the missing arrow-key variants of the window
navigation/swapping commands.
</p>
<details id='windows,code--4' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#windows,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">map!</span> <span class="org-builtin">:map</span> <span class="org-variable-name">evil-window-map</span>
      <span class="org-string">"SPC"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">rotate-layout</span>
      <span class="org-comment-delimiter">;; </span><span class="org-comment">Navigation</span>
      <span class="org-string">"&lt;left&gt;"</span>     <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">evil-window-left</span>
      <span class="org-string">"&lt;down&gt;"</span>     <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">evil-window-down</span>
      <span class="org-string">"&lt;up&gt;"</span>       <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">evil-window-up</span>
      <span class="org-string">"&lt;right&gt;"</span>    <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">evil-window-right</span>
      <span class="org-comment-delimiter">;; </span><span class="org-comment">Swapping windows</span>
      <span class="org-string">"C-&lt;left&gt;"</span>       <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">+evil/window-move-left</span>
      <span class="org-string">"C-&lt;down&gt;"</span>       <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">+evil/window-move-down</span>
      <span class="org-string">"C-&lt;up&gt;"</span>         <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">+evil/window-move-up</span>
      <span class="org-string">"C-&lt;right&gt;"</span>      <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">+evil/window-move-right</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-buffer-defaults" class="outline-4">
<h4 id="buffer-defaults"><span class="section-number-4">2.2.5</span> Buffer defaults<a aria-hidden="true" href="#buffer-defaults">#</a> </h4>
<div class="outline-text-4" id="text-2-2-5">
<p>
I&rsquo;d much rather have my new buffers in <code>org-mode</code> than <code>fundamental-mode</code>, hence
</p>
<details id='buffer-defaults,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#buffer-defaults,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">(setq-default major-mode 'org-mode)</span>
</pre>
</div>
    </details>
<p>
For some reason this + the mixed pitch hook causes issues with hydra and so I&rsquo;ll
just need to resort to <kbd>SPC b o</kbd> for now.
</p>
</div>
</div>
</div>
<div id="outline-container-doom-configuration" class="outline-3">
<h3 id="doom-configuration"><span class="section-number-3">2.3</span> Doom configuration<a aria-hidden="true" href="#doom-configuration">#</a> </h3>
<div class="outline-text-3" id="text-2-3">
</div>
<div id="outline-container-modules" class="outline-4">
<h4 id="modules"><span class="section-number-4">2.3.1</span> Modules<a aria-hidden="true" href="#modules">#</a> </h4>
<div class="outline-text-4" id="text-2-3-1">
<p>
Doom has this lovely <i>modular configuration base</i> that takes a lot of work out of
configuring Emacs. Each module (when enabled) can provide a list of packages to
install (on <code>doom sync</code>) and configuration to be applied. The modules can also
have flags applied to tweak their behaviour.
</p>

<details id='initel' class='code'><summary class='named'><span class='name'>init.el</span><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#initel'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;; </span><span class="org-comment">init.el -*- lexical-binding: t; -*-</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">This file controls what Doom modules are enabled and what order they load in.</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">Press 'K' on a module to view its documentation, and 'gd' to browse its directory.</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">doom!</span> <span class="org-builtin">:completion</span>
       &lt;&lt;doom-completion&gt;&gt;

       <span class="org-builtin">:ui</span>
       &lt;&lt;doom-ui&gt;&gt;

       <span class="org-builtin">:editor</span>
       &lt;&lt;doom-editor&gt;&gt;

       <span class="org-builtin">:emacs</span>
       &lt;&lt;doom-emacs&gt;&gt;

       <span class="org-builtin">:term</span>
       &lt;&lt;doom-term&gt;&gt;

       <span class="org-builtin">:checkers</span>
       &lt;&lt;doom-checkers&gt;&gt;

       <span class="org-builtin">:tools</span>
       &lt;&lt;doom-tools&gt;&gt;

       <span class="org-builtin">:os</span>
       &lt;&lt;doom-os&gt;&gt;

       <span class="org-builtin">:lang</span>
       &lt;&lt;doom-lang&gt;&gt;

       <span class="org-builtin">:email</span>
       &lt;&lt;doom-email&gt;&gt;

       <span class="org-builtin">:app</span>
       &lt;&lt;doom-app&gt;&gt;

       <span class="org-builtin">:config</span>
       &lt;&lt;doom-config&gt;&gt;
       <span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>

<div id="outline-container-structure" class="outline-5">
<h5 id="structure"><span class="section-number-5">2.3.1.1</span> Structure<a aria-hidden="true" href="#structure">#</a> </h5>
<div class="outline-text-5" id="text-2-3-1-1">
<p>
As you may have noticed by this point, this is a <a href="https://en.wikipedia.org/wiki/Literate_programming">literate</a> configuration. Doom
has good support for this which we access though the <code>literate</code> module.
</p>

<p>
While we&rsquo;re in the <code>:config</code> section, we&rsquo;ll use Dooms nicer defaults, along with
the bindings and smartparens behaviour (the flags aren&rsquo;t documented, but they exist).
</p>
<details id='doom-config' class='code' open><summary class='named'><span class='name'>doom-config</span><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#doom-config'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">literate
<span class="org-rainbow-delimiters-depth-1">(</span>default +bindings +smartparens<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-interface" class="outline-5">
<h5 id="interface"><span class="section-number-5">2.3.1.2</span> Interface<a aria-hidden="true" href="#interface">#</a> </h5>
<div class="outline-text-5" id="text-2-3-1-2">
<p>
There&rsquo;s a lot that can be done to enhance Emacs&rsquo; capabilities.
I reckon enabling half the modules Doom provides should do it.
</p>

<details id='doom-completion' class='code' open><summary class='named'><span class='name'>doom-completion</span><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#doom-completion'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span>company                     <span class="org-comment-delimiter">; </span><span class="org-comment">the ultimate code completion backend</span>
 +childframe<span class="org-rainbow-delimiters-depth-1">)</span>                <span class="org-comment-delimiter">; </span><span class="org-comment">... when your children are better than you</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">helm                       ; the *other* search engine for love and life</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">ido                        ; the other *other* search engine...</span>
<span class="org-rainbow-delimiters-depth-1">(</span>ivy                         <span class="org-comment-delimiter">; </span><span class="org-comment">a search engine for love and life</span>
 +icons                      <span class="org-comment-delimiter">; </span><span class="org-comment">... icons are nice</span>
 +prescient<span class="org-rainbow-delimiters-depth-1">)</span>                 <span class="org-comment-delimiter">; </span><span class="org-comment">... I know what I want(ed)</span>
</pre>
</div>
    </details>

<details id='doom-ui' class='code' open><summary class='named'><span class='name'>doom-ui</span><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#doom-ui'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;</span><span class="org-comment">deft                       ; notational velocity for Emacs</span>
doom                         <span class="org-comment-delimiter">; </span><span class="org-comment">what makes DOOM look the way it does</span>
doom-dashboard               <span class="org-comment-delimiter">; </span><span class="org-comment">a nifty splash screen for Emacs</span>
doom-quit                    <span class="org-comment-delimiter">; </span><span class="org-comment">DOOM quit-message prompts when you quit Emacs</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">fill-column                ; a `</span><span class="org-comment"><span class="org-constant">fill-column</span></span><span class="org-comment">' indicator</span>
hl-todo                      <span class="org-comment-delimiter">; </span><span class="org-comment">highlight </span><span class="org-bold"><span class="org-warning">TODO</span></span><span class="org-comment">/</span><span class="org-bold"><span class="org-error">FIXME</span></span><span class="org-comment">/</span><span class="org-bold"><span class="org-success">NOTE</span></span><span class="org-comment">/</span><span class="org-bold"><span class="org-doc">DEPRECATED</span></span><span class="org-comment">/</span><span class="org-bold"><span class="org-constant">HACK</span></span><span class="org-comment">/</span><span class="org-bold"><span class="org-keyword">REVIEW</span></span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">hydra                      ; quick documentation for related commands</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">indent-guides              ; highlighted indent columns, notoriously slow</span>
<span class="org-rainbow-delimiters-depth-1">(</span>ligatures +extra<span class="org-rainbow-delimiters-depth-1">)</span>           <span class="org-comment-delimiter">; </span><span class="org-comment">ligatures and symbols to make your code pretty again</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">minimap                    ; show a map of the code on the side</span>
modeline                     <span class="org-comment-delimiter">; </span><span class="org-comment">snazzy, Atom-inspired modeline, plus API</span>
nav-flash                    <span class="org-comment-delimiter">; </span><span class="org-comment">blink the current line after jumping</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">neotree                    ; a project drawer, like NERDTree for vim</span>
ophints                      <span class="org-comment-delimiter">; </span><span class="org-comment">highlight the region an operation acts on</span>
<span class="org-rainbow-delimiters-depth-1">(</span>popup                       <span class="org-comment-delimiter">; </span><span class="org-comment">tame sudden yet inevitable temporary windows</span>
 +all                        <span class="org-comment-delimiter">; </span><span class="org-comment">catch all popups that start with an asterix</span>
 +defaults<span class="org-rainbow-delimiters-depth-1">)</span>                  <span class="org-comment-delimiter">; </span><span class="org-comment">default popup rules</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">(tabs                      ; an tab bar for Emacs</span>
<span class="org-comment-delimiter">;;  </span><span class="org-comment">+centaur-tabs)           ; ... with prettier tabs</span>
treemacs                     <span class="org-comment-delimiter">; </span><span class="org-comment">a project drawer, like neotree but cooler</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">unicode                    ; extended unicode support for various languages</span>
vc-gutter                    <span class="org-comment-delimiter">; </span><span class="org-comment">vcs diff in the fringe</span>
vi-tilde-fringe              <span class="org-comment-delimiter">; </span><span class="org-comment">fringe tildes to mark beyond EOB</span>
<span class="org-rainbow-delimiters-depth-1">(</span>window-select +numbers<span class="org-rainbow-delimiters-depth-1">)</span>     <span class="org-comment-delimiter">; </span><span class="org-comment">visually switch windows</span>
workspaces                   <span class="org-comment-delimiter">; </span><span class="org-comment">tab emulation, persistence &amp; separate workspaces</span>
zen                          <span class="org-comment-delimiter">; </span><span class="org-comment">distraction-free coding or writing</span>
</pre>
</div>
    </details>

<details id='doom-editor' class='code' open><summary class='named'><span class='name'>doom-editor</span><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#doom-editor'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span>evil +everywhere<span class="org-rainbow-delimiters-depth-1">)</span>           <span class="org-comment-delimiter">; </span><span class="org-comment">come to the dark side, we have cookies</span>
file-templates               <span class="org-comment-delimiter">; </span><span class="org-comment">auto-snippets for empty files</span>
fold                         <span class="org-comment-delimiter">; </span><span class="org-comment">(nigh) universal code folding</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> +onsave<span class="org-rainbow-delimiters-depth-1">)</span>             <span class="org-comment-delimiter">; </span><span class="org-comment">automated prettiness</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">god                        ; run Emacs commands without modifier keys</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">lispy                      ; vim for lisp, for people who don't like vim</span>
multiple-cursors             <span class="org-comment-delimiter">; </span><span class="org-comment">editing in many places at once</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">objed                      ; text object editing for the innocent</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">parinfer                   ; turn lisp into python, sort of</span>
rotate-text                  <span class="org-comment-delimiter">; </span><span class="org-comment">cycle region at point between text candidates</span>
snippets                     <span class="org-comment-delimiter">; </span><span class="org-comment">my elves. They type so I don't have to</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">word-wrap                  ; soft wrapping with language-aware indent</span>
</pre>
</div>
    </details>

<details id='doom-emacs' class='code' open><summary class='named'><span class='name'>doom-emacs</span><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#doom-emacs'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">dired</span> +icons<span class="org-rainbow-delimiters-depth-1">)</span>               <span class="org-comment-delimiter">; </span><span class="org-comment">making dired pretty [functional]</span>
electric                     <span class="org-comment-delimiter">; </span><span class="org-comment">smarter, keyword-based electric-indent</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">ibuffer</span> +icons<span class="org-rainbow-delimiters-depth-1">)</span>             <span class="org-comment-delimiter">; </span><span class="org-comment">interactive buffer management</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">undo</span> +tree<span class="org-rainbow-delimiters-depth-1">)</span>                 <span class="org-comment-delimiter">; </span><span class="org-comment">persistent, smarter undo for your inevitable mistakes</span>
vc                           <span class="org-comment-delimiter">; </span><span class="org-comment">version-control and Emacs, sitting in a tree</span>
</pre>
</div>
    </details>

<details id='doom-term' class='code' open><summary class='named'><span class='name'>doom-term</span><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#doom-term'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;</span><span class="org-comment">eshell                     ; the elisp shell that works everywhere</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">shell                      ; simple shell REPL for Emacs</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">term                       ; basic terminal emulator for Emacs</span>
vterm                        <span class="org-comment-delimiter">; </span><span class="org-comment">the best terminal emulation in Emacs</span>
</pre>
</div>
    </details>

<details id='doom-checkers' class='code' open><summary class='named'><span class='name'>doom-checkers</span><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#doom-checkers'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">syntax                       <span class="org-comment-delimiter">; </span><span class="org-comment">tasing you for every semicolon you forget</span>
spell                        <span class="org-comment-delimiter">; </span><span class="org-comment">tasing you for misspelling mispelling</span>
grammar                      <span class="org-comment-delimiter">; </span><span class="org-comment">tasing grammar mistake every you make</span>
</pre>
</div>
    </details>

<details id='doom-tools' class='code' open><summary class='named'><span class='name'>doom-tools</span><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#doom-tools'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">ansible                      <span class="org-comment-delimiter">; </span><span class="org-comment">a crucible for infrastructure as code</span>
<span class="org-variable-name">debugger</span>                     <span class="org-comment-delimiter">; </span><span class="org-bold"><span class="org-error">FIXME</span></span><span class="org-comment"> stepping through code, to help you add bugs</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">direnv                     ; be direct about your environment</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">docker                     ; port everything to containers</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">editorconfig               ; let someone else argue about tabs vs spaces</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">ein                        ; tame Jupyter notebooks with emacs</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">eval</span> +overlay<span class="org-rainbow-delimiters-depth-1">)</span>              <span class="org-comment-delimiter">; </span><span class="org-comment">run code, run (also, repls)</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">gist                       ; interacting with github gists</span>
<span class="org-rainbow-delimiters-depth-1">(</span>lookup                      <span class="org-comment-delimiter">; </span><span class="org-comment">helps you navigate your code and documentation</span>
 +dictionary                 <span class="org-comment-delimiter">; </span><span class="org-comment">dictionary/thesaurus is nice</span>
 +docsets<span class="org-rainbow-delimiters-depth-1">)</span>                   <span class="org-comment-delimiter">; </span><span class="org-comment">...or in Dash docsets locally</span>
lsp                          <span class="org-comment-delimiter">; </span><span class="org-comment">Language Server Protocol</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">macos                      ; MacOS-specific commands</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">magit</span>                       <span class="org-comment-delimiter">; </span><span class="org-comment">a git porcelain for Emacs</span>
 +forge<span class="org-rainbow-delimiters-depth-1">)</span>                     <span class="org-comment-delimiter">; </span><span class="org-comment">interface with git forges</span>
make                         <span class="org-comment-delimiter">; </span><span class="org-comment">run make tasks from Emacs</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">pass                       ; password manager for nerds</span>
pdf                          <span class="org-comment-delimiter">; </span><span class="org-comment">pdf enhancements</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">prodigy                    ; </span><span class="org-bold"><span class="org-error">FIXME</span></span><span class="org-comment"> managing external services &amp; code builders</span>
rgb                          <span class="org-comment-delimiter">; </span><span class="org-comment">creating color strings</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">taskrunner                 ; taskrunner for all your projects</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">terraform                  ; infrastructure as code</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">tmux                       ; an API for interacting with tmux</span>
upload                       <span class="org-comment-delimiter">; </span><span class="org-comment">map local to remote projects via ssh/ftp</span>
</pre>
</div>
    </details>

<details id='doom-os' class='code' open><summary class='named'><span class='name'>doom-os</span><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#doom-os'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">tty                          <span class="org-comment-delimiter">; </span><span class="org-comment">improve the terminal Emacs experience</span>
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-language-support" class="outline-5">
<h5 id="language-support"><span class="section-number-5">2.3.1.3</span> Language support<a aria-hidden="true" href="#language-support">#</a> </h5>
<div class="outline-text-5" id="text-2-3-1-3">
<p>
We can be rather liberal with enabling support for languages as the associated
packages/configuration are (usually) only loaded when first opening an
associated file.
</p>

<details id='doom-lang' class='code' open><summary class='named'><span class='name'>doom-lang</span><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#doom-lang'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;</span><span class="org-comment">agda                       ; types of types of types of types...</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">cc                         ; C/C++/Obj-C madness</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">clojure                    ; java with a lisp</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">common-lisp                ; if you've seen one lisp, you've seen them all</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">coq                        ; proofs-as-programs</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">crystal                    ; ruby at the speed of c</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">csharp                     ; unity, .NET, and mono shenanigans</span>
data                         <span class="org-comment-delimiter">; </span><span class="org-comment">config/data formats</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">(dart +flutter)            ; paint ui and not much else</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">elixir                     ; erlang done right</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">elm                        ; care for a cup of TEA?</span>
emacs-lisp                   <span class="org-comment-delimiter">; </span><span class="org-comment">drown in parentheses</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">erlang                     ; an elegant language for a more civilized age</span>
ess                          <span class="org-comment-delimiter">; </span><span class="org-comment">emacs speaks statistics</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">faust                      ; dsp, but you get to keep your soul</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">fsharp                     ; ML stands for Microsoft's Language</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">fstar                      ; (dependent) types and (monadic) effects and Z3</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">(go +lsp)                  ; the hipster dialect</span>
<span class="org-rainbow-delimiters-depth-1">(</span>haskell +dante<span class="org-rainbow-delimiters-depth-1">)</span>             <span class="org-comment-delimiter">; </span><span class="org-comment">a language that's lazier than I am</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">hy                         ; readability of scheme w/ speed of python</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">idris                      ;</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">json                       ; At least it ain't XML</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">(java +meghanada)          ; the poster child for carpal tunnel syndrome</span>
<span class="org-rainbow-delimiters-depth-1">(</span>javascript +lsp<span class="org-rainbow-delimiters-depth-1">)</span>            <span class="org-comment-delimiter">; </span><span class="org-comment">all(hope(abandon(ye(who(enter(here))))))</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">julia                      ; a better, faster MATLAB</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">kotlin                     ; a better, slicker Java(Script)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>latex                       <span class="org-comment-delimiter">; </span><span class="org-comment">writing papers in Emacs has never been so fun</span>
 +latexmk                    <span class="org-comment-delimiter">; </span><span class="org-comment">what else would you use?</span>
 +cdlatex                    <span class="org-comment-delimiter">; </span><span class="org-comment">quick maths symbols</span>
 +fold<span class="org-rainbow-delimiters-depth-1">)</span>                      <span class="org-comment-delimiter">; </span><span class="org-comment">fold the clutter away nicities</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">lean                       ; proof that mathematicians need help</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">factor                     ; for when scripts are stacked against you</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">ledger                     ; an accounting system in Emacs</span>
lua                          <span class="org-comment-delimiter">; </span><span class="org-comment">one-based indices? one-based indices</span>
markdown                     <span class="org-comment-delimiter">; </span><span class="org-comment">writing docs for people to ignore</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">nim                        ; python + lisp at the speed of c</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">nix                        ; I hereby declare "nix geht mehr!"</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">ocaml                      ; an objective camel</span>
<span class="org-rainbow-delimiters-depth-1">(</span>org                         <span class="org-comment-delimiter">; </span><span class="org-comment">organize your plain life in plain text</span>
 +pretty                     <span class="org-comment-delimiter">; </span><span class="org-comment">yessss my pretties! (nice unicode symbols)</span>
 +dragndrop                  <span class="org-comment-delimiter">; </span><span class="org-comment">drag &amp; drop files/images into org buffers</span>
 <span class="org-comment-delimiter">;;</span><span class="org-comment">+hugo                     ; use Emacs for hugo blogging</span>
 +jupyter                    <span class="org-comment-delimiter">; </span><span class="org-comment">ipython/jupyter support for babel</span>
 +pandoc                     <span class="org-comment-delimiter">; </span><span class="org-comment">export-with-pandoc support</span>
 +gnuplot                    <span class="org-comment-delimiter">; </span><span class="org-comment">who doesn't like pretty pictures</span>
 <span class="org-comment-delimiter">;;</span><span class="org-comment">+pomodoro                 ; be fruitful with the tomato technique</span>
 +present                    <span class="org-comment-delimiter">; </span><span class="org-comment">using org-mode for presentations</span>
 +roam<span class="org-rainbow-delimiters-depth-1">)</span>                      <span class="org-comment-delimiter">; </span><span class="org-comment">wander around notes</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">perl                       ; write code no one else can comprehend</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">php                        ; perl's insecure younger brother</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">plantuml                   ; diagrams for confusing people more</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">purescript                 ; javascript, but functional</span>
<span class="org-rainbow-delimiters-depth-1">(</span>python +lsp +pyright<span class="org-rainbow-delimiters-depth-1">)</span>       <span class="org-comment-delimiter">; </span><span class="org-comment">beautiful is better than ugly</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">qt                         ; the 'cutest' gui framework ever</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">racket                     ; a DSL for DSLs</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">rest                       ; Emacs as a REST client</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">rst                        ; ReST in peace</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">(ruby +rails)              ; 1.step {|i| p "Ruby is #{i.even? ? 'love' : 'life'}"}</span>
<span class="org-rainbow-delimiters-depth-1">(</span>rust +lsp<span class="org-rainbow-delimiters-depth-1">)</span>                  <span class="org-comment-delimiter">; </span><span class="org-comment">Fe2O3.unwrap().unwrap().unwrap().unwrap()</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">scala                      ; java, but good</span>
scheme                       <span class="org-comment-delimiter">; </span><span class="org-comment">a fully conniving family of lisps</span>
sh                           <span class="org-comment-delimiter">; </span><span class="org-comment">she sells {ba,z,fi}sh shells on the C xor</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">sml                        ; no, the /other/ ML</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">solidity                   ; do you need a blockchain? No.</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">swift                      ; who asked for emoji variables?</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">terra                      ; Earth and Moon in alignment for performance.</span>
web                          <span class="org-comment-delimiter">; </span><span class="org-comment">the tubes</span>
yaml                         <span class="org-comment-delimiter">; </span><span class="org-comment">JSON, but readable</span>
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-everything-emacs" class="outline-5">
<h5 id="everything-emacs"><span class="section-number-5">2.3.1.4</span> Everything in Emacs<a aria-hidden="true" href="#everything-emacs">#</a> </h5>
<div class="outline-text-5" id="text-2-3-1-4">
<p>
It&rsquo;s just too convenient being able to have everything in Emacs.
I couldn&rsquo;t resist the Email and Feed modules.
</p>

<details id='doom-email' class='code' open><summary class='named'><span class='name'>doom-email</span><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#doom-email'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">mu4e</span> +org +gmail<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">notmuch</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">(wanderlust +gmail)</span>
</pre>
</div>
    </details>

<details id='doom-app' class='code' open><summary class='named'><span class='name'>doom-app</span><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#doom-app'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;</span><span class="org-comment">calendar</span>
irc                          <span class="org-comment-delimiter">; </span><span class="org-comment">how neckbeards socialize</span>
<span class="org-rainbow-delimiters-depth-1">(</span>rss +org<span class="org-rainbow-delimiters-depth-1">)</span>                   <span class="org-comment-delimiter">; </span><span class="org-comment">emacs as an RSS reader</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">twitter                    ; twitter client https://twitter.com/vnought</span>
</pre>
</div>
    </details>
</div>
</div>
</div>

<div id="outline-container-visual-settings" class="outline-4">
<h4 id="visual-settings"><span class="section-number-4">2.3.2</span> Visual Settings<a aria-hidden="true" href="#visual-settings">#</a> </h4>
<div class="outline-text-4" id="text-2-3-2">
</div>
<div id="outline-container-font-face" class="outline-5">
<h5 id="font-face"><span class="section-number-5">2.3.2.1</span> Font Face<a aria-hidden="true" href="#font-face">#</a> </h5>
<div class="outline-text-5" id="text-2-3-2-1">
<p>
&rsquo;Fira Code&rsquo; is nice, and &rsquo;Overpass&rsquo; makes for a nice sans companion. We just need to
fiddle with the font sizes a tad so that they visually match. Just for fun I&rsquo;m
trying out JetBrains Mono though. So far I have mixed feelings on it, some
aspects are nice, but on others I prefer Fira.
</p>
<details id='font-face,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#font-face,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">doom-font</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">font-spec</span> <span class="org-builtin">:family</span> <span class="org-string">"JetBrains Mono"</span> <span class="org-builtin">:size</span> <span class="org-highlight-numbers-number">24</span><span class="org-rainbow-delimiters-depth-2">)</span>
      <span class="org-variable-name">doom-big-font</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">font-spec</span> <span class="org-builtin">:family</span> <span class="org-string">"JetBrains Mono"</span> <span class="org-builtin">:size</span> <span class="org-highlight-numbers-number">36</span><span class="org-rainbow-delimiters-depth-2">)</span>
      <span class="org-variable-name">doom-variable-pitch-font</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">font-spec</span> <span class="org-builtin">:family</span> <span class="org-string">"Overpass"</span> <span class="org-builtin">:size</span> <span class="org-highlight-numbers-number">24</span><span class="org-rainbow-delimiters-depth-2">)</span>
      <span class="org-variable-name">doom-serif-font</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">font-spec</span> <span class="org-builtin">:family</span> <span class="org-string">"IBM Plex Mono"</span> <span class="org-builtin">:weight</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">light</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>


<figure id="org5aa30af">
<img src="https://tecosaur.com/lfs/emacs-config/screenshots/font-face.png" alt="Screenshot of the fonts within Emacs." class="invertible">

</figure>
</div>
</div>

<div id="outline-container-theme-modeline" class="outline-5">
<h5 id="theme-modeline"><span class="section-number-5">2.3.2.2</span> Theme and modeline<a aria-hidden="true" href="#theme-modeline">#</a> </h5>
<div class="outline-text-5" id="text-2-3-2-2">
<p>
<code>doom-one</code> is nice and all, but I find the <code>vibrant</code> variant nicer. Oh, and with the
nice selection doom provides there&rsquo;s no reason for me to want the defaults.
</p>
<details id='theme-modeline,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#theme-modeline,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">doom-theme</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">doom-vibrant</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">delq!</span> t <span class="org-variable-name">custom-theme-load-path</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
However, by default <code>red</code> text is used in the <code>modeline</code>, so let&rsquo;s make that orange
so I don&rsquo;t feel like something&rsquo;s gone <i>wrong</i> when editing files.
</p>
<details id='theme-modeline,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#theme-modeline,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">custom-set-faces!</span>
  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>doom-modeline-buffer-modified <span class="org-builtin">:foreground</span> <span class="org-string">"orange"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
While we&rsquo;re modifying the modeline, <kbd>LF UTF-8</kbd> is the default file encoding, and
thus not worth noting in the modeline. So, let&rsquo;s conditionally hide it.
</p>
<details id='theme-modeline,code--3' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#theme-modeline,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">doom-modeline-conditional-buffer-encoding</span> <span class="org-rainbow-delimiters-depth-2">()</span>
  <span class="org-doc">"We expect the encoding to be LF UTF-8, so only show the modeline when this is not the case"</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq-local</span> doom-modeline-buffer-encoding
              <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">eq</span> <span class="org-variable-name">buffer-file-coding-system</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">utf-8-unix</span><span class="org-rainbow-delimiters-depth-2">)</span>
                          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">eq</span> <span class="org-variable-name">buffer-file-coding-system</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">utf-8</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">after-change-major-mode-hook</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">doom-modeline-conditional-buffer-encoding</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-miscellaneous" class="outline-5">
<h5 id="miscellaneous"><span class="section-number-5">2.3.2.3</span> Miscellaneous<a aria-hidden="true" href="#miscellaneous">#</a> </h5>
<div class="outline-text-5" id="text-2-3-2-3">
<p>
Relative line numbers are fantastic for knowing how far away line numbers are,
then <kbd>ESC 12 &lt;UP&gt;</kbd> gets you exactly where you think.
</p>
<details id='miscellaneous,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#miscellaneous,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">display-line-numbers-type</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">relative</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
I&rsquo;d like some slightly nicer default buffer names
</p>
<details id='miscellaneous,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#miscellaneous,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">doom-fallback-buffer-name</span> <span class="org-string">"&#9658; Doom"</span>
      <span class="org-variable-name">+doom-dashboard-name</span> <span class="org-string">"&#9658; Doom"</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
There&rsquo;s a bug with the modeline in insert mode for org documents (<a href="https://github.com/seagle0128/doom-modeline/issues/300">issue</a>), so
</p>
<details id='miscellaneous,code--3' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#miscellaneous,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">custom-set-faces!</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>doom-modeline-evil-insert-state <span class="org-builtin">:weight</span> bold <span class="org-builtin">:foreground</span> <span class="org-string">"#339CDB"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-some-helper-macros" class="outline-4">
<h4 id="some-helper-macros"><span class="section-number-4">2.3.3</span> Some helper macros<a aria-hidden="true" href="#some-helper-macros">#</a> </h4>
<div class="outline-text-4" id="text-2-3-3">
<p>
There are a few handy macros added by doom, namely
</p>
<ul class="org-ul">
<li><code>load!</code> for loading external <code>.el</code> files relative to this one</li>
<li><code>use-package!</code> for configuring packages</li>
<li><code>add-load-path!</code> for adding directories to the <code>load-path</code> where <code>Emacs</code> looks when
you load packages with <code>require</code> or <code>use-package</code></li>
<li><code>map!</code> for binding new keys</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-other-things" class="outline-3">
<h3 id="other-things"><span class="section-number-3">2.4</span> Other things<a aria-hidden="true" href="#other-things">#</a> </h3>
<div class="outline-text-3" id="text-2-4">
</div>
<div id="outline-container-editor-interaction" class="outline-4">
<h4 id="editor-interaction"><span class="section-number-4">2.4.1</span> Editor interaction<a aria-hidden="true" href="#editor-interaction">#</a> </h4>
<div class="outline-text-4" id="text-2-4-1">
</div>
<div id="outline-container-mouse-buttons" class="outline-5">
<h5 id="mouse-buttons"><span class="section-number-5">2.4.1.1</span> Mouse buttons<a aria-hidden="true" href="#mouse-buttons">#</a> </h5>
<div class="outline-text-5" id="text-2-4-1-1">
<details id='mouse-buttons,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#mouse-buttons,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">map!</span> <span class="org-builtin">:n</span> <span class="org-rainbow-delimiters-depth-2">[</span>mouse-8<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">better-jumper-jump-backward</span>
      <span class="org-builtin">:n</span> <span class="org-rainbow-delimiters-depth-2">[</span>mouse-9<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">better-jumper-jump-forward</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-window-title" class="outline-4">
<h4 id="window-title"><span class="section-number-4">2.4.2</span> Window title<a aria-hidden="true" href="#window-title">#</a> </h4>
<div class="outline-text-4" id="text-2-4-2">
<p>
I&rsquo;d like to have just the buffer name, then if applicable the project folder
</p>
<details id='window-title,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#window-title,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">frame-title-format</span>
      <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">""</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:eval</span>
         <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">s-contains-p</span> org-roam-directory <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-variable-name">buffer-file-name</span> <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
             <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">replace-regexp-in-string</span>
              <span class="org-string">".*/[0-9]*-?"</span> <span class="org-string">"&#9776; "</span>
              <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">subst-char-in-string</span> ?_ ?  <span class="org-variable-name">buffer-file-name</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-string">"%b"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:eval</span>
         <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>project-name <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">projectile-project-name</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">string=</span> <span class="org-string">"-"</span> project-name<span class="org-rainbow-delimiters-depth-3">)</span>
             <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">buffer-modified-p</span><span class="org-rainbow-delimiters-depth-2">)</span>  <span class="org-string">" &#9673; %s"</span> <span class="org-string">" &#8198;&#9679;&#8198; %s"</span><span class="org-rainbow-delimiters-depth-1">)</span> project-name<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
For example when I open my config file it the window will be titled <kbd>config.org ●
doom</kbd> then as soon as I make a change it will become <kbd>config.org ◉ doom</kbd>.
</p>
</div>
</div>
<div id="outline-container-splash-screen" class="outline-4">
<h4 id="splash-screen"><span class="section-number-4">2.4.3</span> Splash screen<a aria-hidden="true" href="#splash-screen">#</a> </h4>
<div class="outline-text-4" id="text-2-4-3">
<p>
Emacs can render an image as the splash screen, and <a href="https://github.com/MarioRicalde">@MarioRicalde</a> came up with a
cracker! He&rsquo;s also provided me with a nice Emacs-style <i>E</i>, which is good for
smaller windows. <b>@MarioRicalde</b> you have my sincere thanks, you&rsquo;re great!
<object type="image/svg+xml" data="misc/splash-images/blackhole-lines.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>

<p>
By incrementally stripping away the outer layers of the logo one can obtain
quite a nice resizing effect.
</p>
<details id='splash-screen,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#splash-screen,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">fancy-splash-image-template</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">expand-file-name</span> <span class="org-string">"misc/splash-images/blackhole-lines-template.svg"</span> <span class="org-variable-name">doom-private-dir</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Default template svg used for the splash image, with substitutions from "</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">fancy-splash-image-nil</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">expand-file-name</span> <span class="org-string">"misc/splash-images/transparent-pixel.png"</span> <span class="org-variable-name">doom-private-dir</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"An image to use at minimum size, usually a transparent pixel"</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">fancy-splash-sizes</span>
      <span class="org-highlight-quoted-quote">`</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">500</span> <span class="org-builtin">:min-height</span> <span class="org-highlight-numbers-number">50</span> <span class="org-builtin">:padding</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">0</span> . <span class="org-highlight-numbers-number">4</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-builtin">:template</span> ,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">expand-file-name</span> <span class="org-string">"misc/splash-images/blackhole-lines-0.svg"</span> <span class="org-variable-name">doom-private-dir</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">440</span> <span class="org-builtin">:min-height</span> <span class="org-highlight-numbers-number">42</span> <span class="org-builtin">:padding</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">1</span> . <span class="org-highlight-numbers-number">4</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-builtin">:template</span> ,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">expand-file-name</span> <span class="org-string">"misc/splash-images/blackhole-lines-0.svg"</span> <span class="org-variable-name">doom-private-dir</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">400</span> <span class="org-builtin">:min-height</span> <span class="org-highlight-numbers-number">38</span> <span class="org-builtin">:padding</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">1</span> . <span class="org-highlight-numbers-number">4</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-builtin">:template</span> ,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">expand-file-name</span> <span class="org-string">"misc/splash-images/blackhole-lines-1.svg"</span> <span class="org-variable-name">doom-private-dir</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">350</span> <span class="org-builtin">:min-height</span> <span class="org-highlight-numbers-number">36</span> <span class="org-builtin">:padding</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">1</span> . <span class="org-highlight-numbers-number">3</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-builtin">:template</span> ,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">expand-file-name</span> <span class="org-string">"misc/splash-images/blackhole-lines-2.svg"</span> <span class="org-variable-name">doom-private-dir</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">300</span> <span class="org-builtin">:min-height</span> <span class="org-highlight-numbers-number">34</span> <span class="org-builtin">:padding</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">1</span> . <span class="org-highlight-numbers-number">3</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-builtin">:template</span> ,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">expand-file-name</span> <span class="org-string">"misc/splash-images/blackhole-lines-3.svg"</span> <span class="org-variable-name">doom-private-dir</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">250</span> <span class="org-builtin">:min-height</span> <span class="org-highlight-numbers-number">32</span> <span class="org-builtin">:padding</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">1</span> . <span class="org-highlight-numbers-number">2</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-builtin">:template</span> ,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">expand-file-name</span> <span class="org-string">"misc/splash-images/blackhole-lines-4.svg"</span> <span class="org-variable-name">doom-private-dir</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">200</span> <span class="org-builtin">:min-height</span> <span class="org-highlight-numbers-number">30</span> <span class="org-builtin">:padding</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">1</span> . <span class="org-highlight-numbers-number">2</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-builtin">:template</span> ,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">expand-file-name</span> <span class="org-string">"misc/splash-images/blackhole-lines-5.svg"</span> <span class="org-variable-name">doom-private-dir</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">100</span> <span class="org-builtin">:min-height</span> <span class="org-highlight-numbers-number">24</span> <span class="org-builtin">:padding</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">1</span> . <span class="org-highlight-numbers-number">2</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-builtin">:template</span> ,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">expand-file-name</span> <span class="org-string">"misc/splash-images/emacs-e-template.svg"</span> <span class="org-variable-name">doom-private-dir</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">0</span>   <span class="org-builtin">:min-height</span> <span class="org-highlight-numbers-number">0</span>  <span class="org-builtin">:padding</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">0</span> . <span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-builtin">:file</span> ,<span class="org-variable-name">fancy-splash-image-nil</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">fancy-splash-sizes</span>
  <span class="org-highlight-quoted-quote">`</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">500</span> <span class="org-builtin">:min-height</span> <span class="org-highlight-numbers-number">50</span> <span class="org-builtin">:padding</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">0</span> . <span class="org-highlight-numbers-number">2</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">440</span> <span class="org-builtin">:min-height</span> <span class="org-highlight-numbers-number">42</span> <span class="org-builtin">:padding</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">1</span> . <span class="org-highlight-numbers-number">4</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">330</span> <span class="org-builtin">:min-height</span> <span class="org-highlight-numbers-number">35</span> <span class="org-builtin">:padding</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">1</span> . <span class="org-highlight-numbers-number">3</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">200</span> <span class="org-builtin">:min-height</span> <span class="org-highlight-numbers-number">30</span> <span class="org-builtin">:padding</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">1</span> . <span class="org-highlight-numbers-number">2</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">0</span>   <span class="org-builtin">:min-height</span> <span class="org-highlight-numbers-number">0</span>  <span class="org-builtin">:padding</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">0</span> . <span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-builtin">:file</span> ,<span class="org-variable-name">fancy-splash-image-nil</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"list of plists with the following properties</span>
<span class="org-doc">  :height the height of the image</span>
<span class="org-doc">  :min-height minimum `</span><span class="org-doc"><span class="org-constant">frame-height</span></span><span class="org-doc">' for image</span>
<span class="org-doc">  :padding `</span><span class="org-doc"><span class="org-constant">+doom-dashboard-banner-padding</span></span><span class="org-doc">' to apply</span>
<span class="org-doc">  :template non-default template file</span>
<span class="org-doc">  :file file to use instead of template"</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">fancy-splash-template-colours</span>
  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"$colour1"</span> . keywords<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"$colour2"</span> . type<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"$colour3"</span> . base5<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"$colour4"</span> . base8<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"list of colour-replacement alists of the form (\"$placeholder\" . 'theme-colour) which applied the template"</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">file-exists-p</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">expand-file-name</span> <span class="org-string">"theme-splashes"</span> <span class="org-variable-name">doom-cache-dir</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">make-directory</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">expand-file-name</span> <span class="org-string">"theme-splashes"</span> <span class="org-variable-name">doom-cache-dir</span><span class="org-rainbow-delimiters-depth-3">)</span> t<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">fancy-splash-filename</span> <span class="org-rainbow-delimiters-depth-2">(</span>theme-name height<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">expand-file-name</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">concat</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">file-name-as-directory</span> <span class="org-string">"theme-splashes"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                            theme-name
                            <span class="org-string">"-"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">number-to-string</span> height<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-string">".svg"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-variable-name">doom-cache-dir</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">fancy-splash-clear-cache</span> <span class="org-rainbow-delimiters-depth-2">()</span>
  <span class="org-doc">"Delete all cached fancy splash images"</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">interactive</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">delete-directory</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">expand-file-name</span> <span class="org-string">"theme-splashes"</span> <span class="org-variable-name">doom-cache-dir</span><span class="org-rainbow-delimiters-depth-3">)</span> t<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">message</span> <span class="org-string">"Cache cleared!"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">fancy-splash-generate-image</span> <span class="org-rainbow-delimiters-depth-2">(</span>template height<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Read TEMPLATE and create an image if HEIGHT with colour substitutions as</span>
<span class="org-doc">   described by `</span><span class="org-doc"><span class="org-constant">fancy-splash-template-colours</span></span><span class="org-doc">' for the current theme"</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">with-temp-buffer</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">insert-file-contents</span> template<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">re-search-forward</span> <span class="org-string">"$height"</span> nil t<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">replace-match</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">number-to-string</span> height<span class="org-rainbow-delimiters-depth-1">)</span> nil nil<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">dolist</span> <span class="org-rainbow-delimiters-depth-1">(</span>substitution <span class="org-variable-name">fancy-splash-template-colours</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">goto-char</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">point-min</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">while</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">re-search-forward</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">car</span> substitution<span class="org-rainbow-delimiters-depth-3">)</span> nil t<span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">replace-match</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">doom-color</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">cdr</span> substitution<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span> nil nil<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">write-region</span> nil nil
                  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">fancy-splash-filename</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">symbol-name</span> <span class="org-variable-name">doom-theme</span><span class="org-rainbow-delimiters-depth-2">)</span> height<span class="org-rainbow-delimiters-depth-1">)</span> nil nil<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">fancy-splash-generate-images</span> <span class="org-rainbow-delimiters-depth-2">()</span>
  <span class="org-doc">"Perform `</span><span class="org-doc"><span class="org-constant">fancy-splash-generate-image</span></span><span class="org-doc">' in bulk"</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">dolist</span> <span class="org-rainbow-delimiters-depth-3">(</span>size <span class="org-variable-name">fancy-splash-sizes</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> size <span class="org-builtin">:file</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">fancy-splash-generate-image</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> size <span class="org-builtin">:file</span><span class="org-rainbow-delimiters-depth-3">)</span>
                                       <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> size <span class="org-builtin">:template</span><span class="org-rainbow-delimiters-depth-3">)</span>
                                       <span class="org-variable-name">fancy-splash-image-template</span><span class="org-rainbow-delimiters-depth-2">)</span>
                                   <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> size <span class="org-builtin">:height</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">ensure-theme-splash-images-exist</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">&amp;optional</span> height<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">file-exists-p</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">fancy-splash-filename</span>
                          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">symbol-name</span> <span class="org-variable-name">doom-theme</span><span class="org-rainbow-delimiters-depth-2">)</span>
                          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">or</span> height
                              <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">car</span> <span class="org-variable-name">fancy-splash-sizes</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-builtin">:height</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">fancy-splash-generate-images</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">get-appropriate-splash</span> <span class="org-rainbow-delimiters-depth-2">()</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>height <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">frame-height</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">cl-some</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-2">(</span>size<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">&gt;=</span> height <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> size <span class="org-builtin">:min-height</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span> size<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
             <span class="org-variable-name">fancy-splash-sizes</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> fancy-splash-last-size nil<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> fancy-splash-last-theme nil<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">set-appropriate-splash</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">&amp;rest</span> _<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>appropriate-image <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">get-appropriate-splash</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">equal</span> appropriate-image fancy-splash-last-size<span class="org-rainbow-delimiters-depth-2">)</span>
                 <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">equal</span> <span class="org-variable-name">doom-theme</span> fancy-splash-last-theme<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> appropriate-image <span class="org-builtin">:file</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">ensure-theme-splash-images-exist</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> appropriate-image <span class="org-builtin">:height</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">fancy-splash-image</span>
          <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> appropriate-image <span class="org-builtin">:file</span><span class="org-rainbow-delimiters-depth-2">)</span>
              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">fancy-splash-filename</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">symbol-name</span> <span class="org-variable-name">doom-theme</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> appropriate-image <span class="org-builtin">:height</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">+doom-dashboard-banner-padding</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> appropriate-image <span class="org-builtin">:padding</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> fancy-splash-last-size appropriate-image<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> fancy-splash-last-theme <span class="org-variable-name">doom-theme</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">+doom-dashboard-reload</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">window-size-change-functions</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">set-appropriate-splash</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">doom-load-theme-hook</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">set-appropriate-splash</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>


<figure id="org1924ae2">
<img src="https://tecosaur.com/lfs/emacs-config/screenshots/splash-screen.png" alt="The splash screen, just loaded." class="invertible">

</figure>
</div>
</div>

<div id="outline-container-systemd-daemon" class="outline-4">
<h4 id="systemd-daemon"><span class="section-number-4">2.4.4</span> Systemd daemon<a aria-hidden="true" href="#systemd-daemon">#</a> </h4>
<div class="outline-text-4" id="text-2-4-4">
<p>
For running a systemd service for a Emacs server I have the following
</p>
<details id='emacsclient-service' class='code' open><summary class='named'><span class='name'>emacsclient service</span><span class='lang'>systemd</span></summary>
    <div class='gutter'>
    <a href='#emacsclient-service'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-systemd"><span class="org-type">[Unit]</span>
<span class="org-keyword">Description</span>=Emacs server daemon
<span class="org-keyword">Documentation</span>=info:emacs man:emacs(<span class="org-highlight-numbers-number">1</span>) https://gnu.org/software/emacs/

<span class="org-type">[Service]</span>
<span class="org-keyword">Type</span>=<span class="org-builtin">forking</span>
<span class="org-keyword">ExecStart</span>=sh -c <span class="org-string">'emacs --daemon &amp;&amp; emacsclient -c --eval "(delete-frame)"'</span>
<span class="org-keyword">ExecStop</span>=/usr/bin/emacsclient --no-wait --eval <span class="org-string">"(progn (setq kill-emacs-hook nil) (kill emacs))"</span>
<span class="org-keyword">Restart</span>=<span class="org-builtin">on-failure</span>

<span class="org-type">[Install]</span>
<span class="org-keyword">WantedBy</span>=default.target
</pre>
</div>
    </details>

<p>
which is then enabled by
</p>
<details id='systemd-daemon,code--1' class='code' open><summary><span class='lang'>Shell Script</span></summary>
    <div class='gutter'>
    <a href='#systemd-daemon,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell">systemctl --user enable emacs.service
</pre>
</div>
    </details>

<p>
For some reason if a frame isn&rsquo;t opened early in the initialisation process, the
daemon doesn&rsquo;t seem to like opening frames later &#x2014; hence the <code>&amp;&amp; emacsclient</code>
part of the <kbd>ExecStart</kbd> value.
</p>

<p>
It can now be nice to use this as a &rsquo;default app&rsquo; for opening files. If we add
an appropriate desktop entry, and enable it in the desktop environment.
</p>

<details id='systemd-daemon,code--2' class='code' open><summary><span class='lang'>Configuration File</span></summary>
    <div class='gutter'>
    <a href='#systemd-daemon,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-conf">[<span class="org-type">Desktop Entry</span>]
<span class="org-variable-name">Name</span>=Emacs client
<span class="org-variable-name">GenericName</span>=Text Editor
<span class="org-variable-name">Comment</span>=A flexible platform for end-user applications
<span class="org-variable-name">MimeType</span>=text/english;text/plain;text/x-makefile;text/x-c++hdr;text/x-c++src;text/x-chdr;text/x-csrc;text/x-java;text/x-moc;text/x-pascal;text/x-tcl;text/x-tex;application/x-shellscript;text/x-c;text/x-c++;
<span class="org-variable-name">Exec</span>=emacsclient -create-frame --alternate-editor=<span class="org-string">""</span> --no-wait %F
<span class="org-variable-name">Icon</span>=emacs
<span class="org-variable-name">Type</span>=Application
<span class="org-variable-name">Terminal</span>=false
<span class="org-variable-name">Categories</span>=TextEditor;Utility;
<span class="org-variable-name">StartupWMClass</span>=Emacs
<span class="org-variable-name">Keywords</span>=Text;Editor;
<span class="org-variable-name">X-KDE-StartupNotify</span>=false
</pre>
</div>
    </details>

<p>
When the daemon is running, I almost always want to do a few particular things
with it, so I may as well eat the load time at startup. We also want to keep
<kbd>mu4e</kbd> running.
</p>

<p>
It would be good to start the <span class='acr'>IRC</span> client (<kbd>circe</kbd>) too, but that seems to have
issues when started in a non-graphical session.
</p>

<details id='daemon-initialisation' class='code' open><summary class='named'><span class='name'>daemon initialisation</span><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#daemon-initialisation'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">greedily-do-daemon-setup</span> <span class="org-rainbow-delimiters-depth-2">()</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">require</span> <span class="org-highlight-quoted-quote">'</span><span class="org-constant">org</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">require</span> <span class="org-highlight-quoted-quote">'</span><span class="org-constant">mu4e</span> nil t<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> mu4e-confirm-quit t<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> +mu4e-lock-greedy t<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> +mu4e-lock-relaxed t<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>+mu4e-lock-add-watcher<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-1">(</span>+mu4e-lock-available t<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span>mu4e~start<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">require</span> <span class="org-highlight-quoted-quote">'</span><span class="org-constant">elfeed</span> nil t<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">run-at-time</span> nil <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">*</span> <span class="org-highlight-numbers-number">8</span> <span class="org-highlight-numbers-number">60</span> <span class="org-highlight-numbers-number">60</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">elfeed-update</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">daemonp</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">emacs-startup-hook</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">greedily-do-daemon-setup</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-emacs-client-wrapper" class="outline-4">
<h4 id="emacs-client-wrapper"><span class="section-number-4">2.4.5</span> Emacs client wrapper<a aria-hidden="true" href="#emacs-client-wrapper">#</a> </h4>
<div class="outline-text-4" id="text-2-4-5">
<p>
I frequently want to make use of Emacs while in a terminal emulator. To make
this easier, I can construct a few handy aliases.
</p>

<p>
However, a little convenience script in <kbd>~/.local/bin</kbd> can have the same effect,
be available beyond the specific shell I plop the alias in, then also allow me
to add a few bells and whistles &#x2014; namely:
</p>
<ul class="org-ul">
<li>Accepting stdin by putting it in a temporary file and immediately opening it.</li>
<li>Guessing that the <kbd>tty</kbd> is a good idea when <code>$DISPLAY</code> is unset (relevant with <span class='acr'>SSH</span>
sessions, among other things).</li>
<li>With a whiff of 24-bit color support, sets <code>TERM</code> variable to a <kbd>terminfo</kbd> that
(probably) announces 24-bit color support.</li>
<li>Changes <span class='acr'>GUI</span> <kbd>emacsclient</kbd> instances to be non-blocking by default (<code>--no-wait</code>),
and instead take a flag to suppress this behaviour (<code>-w</code>).</li>
</ul>

<p>
I would use <kbd>sh</kbd>, but using arrays for argument manipulation is just too
convenient, so I&rsquo;ll raise the requirement to <kbd>bash</kbd>. Since arrays are the only
&rsquo;extra&rsquo; compared to <kbd>sh</kbd>, other shells like <kbd>csh</kbd> etc. should work too.
</p>

<details id='e' class='code' open><summary class='named'><span class='name'>e</span><span class='lang'>Shell Script</span></summary>
    <div class='gutter'>
    <a href='#e'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell"><span class="org-comment-delimiter">#</span><span class="org-comment">!/usr/bin/</span><span class="org-keyword">env</span><span class="org-comment"> bash</span>
<span class="org-variable-name">force_tty</span>=false
<span class="org-variable-name">force_wait</span>=false
<span class="org-variable-name">stdin_mode</span>=<span class="org-string">""</span>

<span class="org-variable-name">args</span>=<span class="org-rainbow-delimiters-depth-1">()</span>

<span class="org-keyword">while</span> :; <span class="org-keyword">do</span>
    <span class="org-keyword">case</span> <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">1</span></span><span class="org-string">"</span><span class="org-keyword"> in</span>
        -t | -nw | --tty)
            <span class="org-variable-name">force_tty</span>=true
            <span class="org-builtin">shift</span> ;;
        -w | --wait)
            <span class="org-variable-name">force_wait</span>=true
            <span class="org-builtin">shift</span> ;;
        -m | --mode)
            <span class="org-variable-name">stdin_mode</span>=<span class="org-string">" (</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">2</span></span><span class="org-string">-mode)"</span>
            <span class="org-builtin">shift</span> <span class="org-highlight-numbers-number">2</span> ;;
        -h | --help)
            <span class="org-type">echo</span> -e <span class="org-string">"\033[1mUsage: e [-t] [-m MODE] [OPTIONS] FILE [-]\033[0m</span>

<span class="org-string">Emacs client convenience wrapper.</span>

<span class="org-string">\033[1mOptions:\033[0m</span>
<span class="org-string">\033[0;34m-h, --help\033[0m            Show this message</span>
<span class="org-string">\033[0;34m-t, -nw, --tty\033[0m        Force terminal mode</span>
<span class="org-string">\033[0;34m-w, --wait\033[0m            Don't supply \033[0;34m--no-wait\033[0m to graphical emacsclient</span>
<span class="org-string">\033[0;34m-\033[0m                     Take \033[0;33mstdin\033[0m (when last argument)</span>
<span class="org-string">\033[0;34m-m MODE, --mode MODE\033[0m  Mode to open \033[0;33mstdin\033[0m with</span>

<span class="org-string">Run \033[0;32memacsclient --help\033[0m to see help for the emacsclient."</span>
            <span class="org-keyword">exit</span> <span class="org-highlight-numbers-number">0</span> ;;
        --*=*)
            <span class="org-builtin">set</span> -- <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">@</span></span><span class="org-string">"</span> <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">{1%%=*}</span></span><span class="org-string">"</span> <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">{1#*=}</span></span><span class="org-string">"</span>
            <span class="org-builtin">shift</span> ;;
        *)
            <span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">[</span> <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">#</span></span><span class="org-string">"</span> = <span class="org-highlight-numbers-number">0</span> <span class="org-rainbow-delimiters-depth-1">]</span>; <span class="org-keyword">then</span>
                <span class="org-keyword">break</span>; <span class="org-keyword">fi</span>
            <span class="org-variable-name">args</span>+=<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">1</span></span><span class="org-string">"</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-builtin">shift</span> ;;
    <span class="org-keyword">esac</span>
<span class="org-keyword">done</span>

<span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">[</span> <span class="org-negation-char">!</span> <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">{#args[*]}</span></span><span class="org-string">"</span> = <span class="org-highlight-numbers-number">0</span> <span class="org-rainbow-delimiters-depth-1">]</span> &amp;&amp; <span class="org-rainbow-delimiters-depth-1">[</span> <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">{args[-1]}</span></span><span class="org-string">"</span> = <span class="org-string">"-"</span> <span class="org-rainbow-delimiters-depth-1">]</span>; <span class="org-keyword">then</span>
    <span class="org-builtin">unset</span> <span class="org-string">'args[-1]'</span>
    <span class="org-variable-name">TMP</span>=<span class="org-string">"</span><span class="org-string"><span class="org-sh-quoted-exec">$(</span></span><span class="org-sh-quoted-exec">mktemp</span><span class="org-string"><span class="org-sh-quoted-exec"> /tmp/emacsstdin-</span></span><span class="org-bold"><span class="org-constant">XXX</span></span><span class="org-string"><span class="org-sh-quoted-exec">)</span></span><span class="org-string">"</span>
    <span class="org-type">cat</span> &gt; <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">TMP</span></span><span class="org-string">"</span>
    <span class="org-variable-name">args</span>+=<span class="org-rainbow-delimiters-depth-1">(</span>--eval <span class="org-string">"(let ((b (generate-new-buffer \"*stdin*\"))) (switch-to-buffer b) (insert-file-contents \"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">TMP</span></span><span class="org-string">\") (delete-file \"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">TMP</span></span><span class="org-string">\")</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">{stdin_mode}</span></span><span class="org-string">)"</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-keyword">fi</span>

<span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">[</span> -z <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">DISPLAY</span></span><span class="org-string">"</span> <span class="org-rainbow-delimiters-depth-1">]</span> || $<span class="org-variable-name">force_tty</span>; <span class="org-keyword">then</span>
    <span class="org-comment-delimiter"># </span><span class="org-comment">detect terminals with sneaky 24-bit support</span>
    <span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">{</span> <span class="org-rainbow-delimiters-depth-2">[</span> <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">COLORTERM</span></span><span class="org-string">"</span> = truecolor <span class="org-rainbow-delimiters-depth-2">]</span> || <span class="org-rainbow-delimiters-depth-2">[</span> <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">COLORTERM</span></span><span class="org-string">"</span> = 24bit <span class="org-rainbow-delimiters-depth-2">]</span>; <span class="org-rainbow-delimiters-depth-1">}</span> <span class="org-sh-escaped-newline">\</span>
        &amp;&amp; <span class="org-rainbow-delimiters-depth-1">[</span> <span class="org-string">"</span><span class="org-string"><span class="org-sh-quoted-exec">$(</span></span><span class="org-sh-quoted-exec">tput</span><span class="org-string"><span class="org-sh-quoted-exec"> colors 2&gt;/dev/null)</span></span><span class="org-string">"</span> -lt <span class="org-highlight-numbers-number">257</span> <span class="org-rainbow-delimiters-depth-1">]</span>; <span class="org-keyword">then</span>
        <span class="org-keyword">if </span><span class="org-type">echo</span> <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">TERM</span></span><span class="org-string">"</span> | <span class="org-type">grep</span> -q <span class="org-string">"^\w\+-[0-9]"</span>; <span class="org-keyword">then</span>
            <span class="org-variable-name">termstub</span>=<span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">{TERM%%-*}</span></span><span class="org-string">"</span>; <span class="org-keyword">else</span>
            <span class="org-variable-name">termstub</span>=<span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">{TERM#*-}</span></span><span class="org-string">"</span>; <span class="org-keyword">fi</span>
        <span class="org-keyword">if</span> infocmp <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">termstub</span></span><span class="org-string">-direct"</span> &gt;/dev/null <span class="org-highlight-numbers-number">2</span>&gt;&amp;<span class="org-highlight-numbers-number">1</span>; <span class="org-keyword">then</span>
            <span class="org-variable-name">TERM</span>=<span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">termstub</span></span><span class="org-string">-direct"</span>; <span class="org-keyword">else</span>
            <span class="org-variable-name">TERM</span>=<span class="org-string">"xterm-direct"</span>; <span class="org-keyword">fi</span> <span class="org-comment-delimiter"># </span><span class="org-comment">should be fairly safe</span>
    <span class="org-keyword">fi</span>
    emacsclient --tty -create-frame --alternate-editor=<span class="org-string">""</span> <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">{args[@]}</span></span><span class="org-string">"</span>
<span class="org-keyword">else</span>
    <span class="org-keyword">if</span> <span class="org-negation-char">!</span> $<span class="org-variable-name">force_wait</span>; <span class="org-keyword">then</span>
        <span class="org-variable-name">args</span>+=<span class="org-rainbow-delimiters-depth-1">(</span>--no-wait<span class="org-rainbow-delimiters-depth-1">)</span>; <span class="org-keyword">fi</span>
    emacsclient -create-frame --alternate-editor=<span class="org-string">""</span> <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">{args[@]}</span></span><span class="org-string">"</span>
<span class="org-keyword">fi</span>
</pre>
</div>
    </details>

<p>
Now, to set an alias to use <kbd>e</kbd> with magit, and then for maximum laziness we can
set aliases for the terminal-forced variants.
</p>
<details id='emacs-client-wrapper,code--1' class='code' open><summary><span class='lang'>Shell Script</span></summary>
    <div class='gutter'>
    <a href='#emacs-client-wrapper,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell"><span class="org-builtin">alias</span> <span class="org-variable-name">m</span>=<span class="org-string">'e --eval "(progn (magit-status) (delete-other-windows))"'</span>
<span class="org-builtin">alias</span> <span class="org-variable-name">mt</span>=<span class="org-string">"m -t"</span>
<span class="org-builtin">alias</span> <span class="org-variable-name">et</span>=<span class="org-string">"e -t"</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
</div>

<div id="outline-container-package-loading" class="outline-2">
<h2 id="package-loading"><span class="section-number-2">3</span> Package loading<a aria-hidden="true" href="#package-loading">#</a> </h2>
<div class="outline-text-2" id="text-3">
<p>
This file shouldn&rsquo;t be byte compiled.
</p>
<details id='package-loading,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#package-loading,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">-*- no-byte-compile: t; -*-</span>
</pre>
</div>
    </details>
</div>
<div id="outline-container-loading-instructions" class="outline-3">
<h3 id="loading-instructions"><span class="section-number-3">3.1</span> Loading instructions<a aria-hidden="true" href="#loading-instructions">#</a> </h3>
<div class="outline-text-3" id="text-3-1">
<p>
This is where you install packages, by declaring them with the <code>package!</code>
macro, then running <code>doom refresh</code> on the command line. You&rsquo;ll need to
restart Emacs for your changes to take effect! Or at least, run <kbd>M-x doom/reload</kbd>.
</p>

<p>
<span class='acr'>WARNING</span>: Don&rsquo;t disable core packages listed in <code>~/.emacs.d/core/packages.el</code>.
Doom requires these, and disabling them may have terrible side effects.
</p>
</div>

<div id="outline-container-packages-melpa-elpa" class="outline-4">
<h4 id="packages-melpa-elpa"><span class="section-number-4">3.1.1</span> Packages in <span class='acr'>MELPA</span>/<span class='acr'>ELPA</span>/emacsmirror<a aria-hidden="true" href="#packages-melpa-elpa">#</a> </h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
To install <code>some-package</code> from <span class='acr'>MELPA</span>, <span class='acr'>ELPA</span> or emacsmirror:
</p>
<details id='packages-melpa-elpa,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#packages-melpa-elpa,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> some-package<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-packages-from-git" class="outline-4">
<h4 id="packages-from-git"><span class="section-number-4">3.1.2</span> Packages from git repositories<a aria-hidden="true" href="#packages-from-git">#</a> </h4>
<div class="outline-text-4" id="text-3-1-2">
<p>
To install a package directly from a particular repo, you&rsquo;ll need to specify
a <code>:recipe</code>. You&rsquo;ll find documentation on what <code>:recipe</code> accepts <a href="https://github.com/raxod502/straight.el#the-recipe-format">here</a>:
</p>
<details id='packages-from-git,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#packages-from-git,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> another-package
  <span class="org-builtin">:recipe</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:host</span> github <span class="org-builtin">:repo</span> <span class="org-string">"username/repo"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
If the package you are trying to install does not contain a <code>PACKAGENAME.el</code>
file, or is located in a subdirectory of the repo, you&rsquo;ll need to specify
<code>:files</code> in the <code>:recipe</code>:
</p>
<details id='packages-from-git,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#packages-from-git,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> this-package
  <span class="org-builtin">:recipe</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:host</span> github <span class="org-builtin">:repo</span> <span class="org-string">"username/repo"</span>
           <span class="org-builtin">:files</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"some-file.el"</span> <span class="org-string">"src/lisp/*.el"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-disabling-built-packages" class="outline-4">
<h4 id="disabling-built-packages"><span class="section-number-4">3.1.3</span> Disabling built-in packages<a aria-hidden="true" href="#disabling-built-packages">#</a> </h4>
<div class="outline-text-4" id="text-3-1-3">
<p>
If you&rsquo;d like to disable a package included with Doom, for whatever reason,
you can do so here with the <code>:disable</code> property:
</p>
<details id='disabling-built-packages,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#disabling-built-packages,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> builtin-package <span class="org-builtin">:disable</span> t<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
You can override the recipe of a built in package without having to specify
all the properties for <code>:recipe</code>. These will inherit the rest of its recipe
from Doom or <span class='acr'>MELPA</span>/<span class='acr'>ELPA</span>/Emacsmirror:
</p>
<details id='disabling-built-packages,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#disabling-built-packages,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> builtin-package <span class="org-builtin">:recipe</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:nonrecursive</span> t<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> builtin-package-2 <span class="org-builtin">:recipe</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:repo</span> <span class="org-string">"myfork/package"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Specify a <code>:branch</code> to install a package from a particular branch or tag.
This is required for some packages whose default branch isn&rsquo;t &rsquo;master&rsquo; (which
our package manager can&rsquo;t deal with; see <a href="https://github.com/raxod502/straight.el/issues/279">raxod502/straight.el#279</a>)
</p>
<details id='disabling-built-packages,code--3' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#disabling-built-packages,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> builtin-package <span class="org-builtin">:recipe</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:branch</span> <span class="org-string">"develop"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-general-packages" class="outline-3">
<h3 id="general-packages"><span class="section-number-3">3.2</span> General packages<a aria-hidden="true" href="#general-packages">#</a> </h3>
<div class="outline-text-3" id="text-3-2">
</div>
<div id="outline-container-window-management" class="outline-4">
<h4 id="window-management"><span class="section-number-4">3.2.1</span> Window management<a aria-hidden="true" href="#window-management">#</a> </h4>
<div class="outline-text-4" id="text-3-2-1">
<details id='window-management,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#window-management,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> rotate <span class="org-builtin">:pin</span> <span class="org-string">"4e9ac3ff80..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-fun" class="outline-4">
<h4 id="fun"><span class="section-number-4">3.2.2</span> Fun<a aria-hidden="true" href="#fun">#</a> </h4>
<div class="outline-text-4" id="text-3-2-2">
<p>
Sometimes one just wants a little fun.
<span class='acr'>XKCD</span> comics are fun.
</p>
<details id='fun,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#fun,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> xkcd <span class="org-builtin">:pin</span> <span class="org-string">"66e928706f..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Every so often, you want everyone else to <i>know</i> that you&rsquo;re typing, or just to
amuse oneself. Introducing: typewriter sounds!
</p>
<details id='fun,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#fun,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> <span class="org-variable-name">selectric-mode</span> <span class="org-builtin">:pin</span> <span class="org-string">"1840de71f7..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Hey, let&rsquo;s get the weather in here while we&rsquo;re at it.
Unfortunately this seems slightly unmaintained (<a href="https://github.com/bcbcarl/emacs-wttrin/pulls">few open bugfix <span class='acr'>PR</span><small>s</small></a>) so let&rsquo;s
roll our <a href="lisp/wttrin.el">own version</a>.
</p>
<details id='fun,code--3' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#fun,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> wttrin <span class="org-builtin">:recipe</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:local-repo</span> <span class="org-string">"lisp"</span> <span class="org-builtin">:build</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:not</span> compile<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Why not flash words on the screen. Why not &#x2014; hey, it could be fun.
</p>
<details id='fun,code--4' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#fun,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> spray <span class="org-builtin">:pin</span> <span class="org-string">"74d9dcfa2e..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
With all our fancy Emacs themes, my terminal is missing out!
</p>
<details id='fun,code--5' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#fun,code--5'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> theme-magic <span class="org-builtin">:pin</span> <span class="org-string">"844c4311bd..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
What&rsquo;s even the point of using Emacs unless you&rsquo;re constantly telling everyone
about it?
</p>
<details id='fun,code--6' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#fun,code--6'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> elcord <span class="org-builtin">:pin</span> <span class="org-string">"01b26d1af2..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
For some reason, I find myself demoing Emacs every now and then. Showing what
keyboard stuff I&rsquo;m doing on-screen seems helpful. While <a href="https://gitlab.com/screenkey/screenkey">screenkey</a> does exist,
having something that doesn&rsquo;t cover up screen content is nice.
</p>


<figure id="org3d2323f">
<img src="https://tecosaur.com/lfs/emacs-config/screenshots/keycast.png" alt="Screenshot of Keycast-mode in action" class="invertible">

</figure>

<details id='fun,code--7' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#fun,code--7'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> keycast <span class="org-builtin">:pin</span> <span class="org-string">"a3a0798349..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
let&rsquo;s just make sure this is lazy-loaded appropriately.
</p>
<details id='fun,code--8' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#fun,code--8'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">use-package!</span> keycast
  <span class="org-builtin">:commands</span> <span class="org-variable-name">keycast-mode</span>
  <span class="org-builtin">:config</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">define-minor-mode</span> <span class="org-variable-name">keycast-mode</span>
    <span class="org-doc">"Show current command and its key binding in the mode line."</span>
    <span class="org-builtin">:global</span> t
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-variable-name">keycast-mode</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">progn</span>
          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">pre-command-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">keycast--update</span> t<span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">global-mode-string</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">""</span> mode-line-keycast <span class="org-string">" "</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">remove-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">pre-command-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">keycast--update</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">global-mode-string</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">remove</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">""</span> mode-line-keycast <span class="org-string">" "</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-variable-name">global-mode-string</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">custom-set-faces!</span>
    <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span>keycast-command <span class="org-builtin">:inherit</span> doom-modeline-debug
                      <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">0.9</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span>keycast-key <span class="org-builtin">:inherit</span> custom-modified
                  <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.1</span>
                  <span class="org-builtin">:weight</span> bold<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
In a similar manner, <a href="https://gitlab.com/ambrevar/emacs-gif-screencast">gif-screencast</a> may come in handy.
</p>
<details id='fun,code--9' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#fun,code--9'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> gif-screencast <span class="org-builtin">:pin</span> <span class="org-string">"1145e676b1..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
We can lazy load this using the start/stop commands.
</p>

<p>
I initially installed <code>scrot</code> for this, since it was the default capture program.
However it raised <code>glib error: Saving to file ... failed</code> each time it was run.
Google didn&rsquo;t reveal any easy fixed, so I switched to <a href="https://github.com/naelstrof/maim">maim</a>. We now need to pass
it the window <span class='acr'>ID</span>. This doesn&rsquo;t change throughout the lifetime of an emacs
instance, so as long as a single window is used <code>xdotool getactivewindow</code> will
give a satisfactory result.
</p>

<p>
It seems that when new colours appear, that tends to make <code>gifsicle</code> introduce
artefacts. To avoid this we pre-populate the colour map using the current doom
theme.
</p>
<details id='fun,code--10' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#fun,code--10'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">use-package!</span> gif-screencast
  <span class="org-builtin">:commands</span> gif-screencast-mode
  <span class="org-builtin">:config</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">map!</span> <span class="org-builtin">:map</span> gif-screencast-mode-map
        <span class="org-builtin">:g</span> <span class="org-string">"&lt;f8&gt;"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">gif-screencast-toggle-pause</span>
        <span class="org-builtin">:g</span> <span class="org-string">"&lt;f9&gt;"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">gif-screencast-stop</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> gif-screencast-program <span class="org-string">"maim"</span>
        gif-screencast-args <span class="org-highlight-quoted-quote">`</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"--quality"</span> <span class="org-string">"3"</span> <span class="org-string">"-i"</span> ,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">string-trim-right</span>
                                                     <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">shell-command-to-string</span>
                                                      <span class="org-string">"xdotool getactivewindow"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        gif-screencast-optimize-args <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"--batch"</span> <span class="org-string">"--optimize=3"</span> <span class="org-string">"--usecolormap=/tmp/doom-color-theme"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">gif-screencast-write-colormap</span> <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">f-write-text</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">replace-regexp-in-string</span>
      <span class="org-string">"\n+"</span> <span class="org-string">"\n"</span>
      <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">mapconcat</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-1">(</span>c<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">listp</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">cdr</span> c<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                                 <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">cadr</span> c<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span> doom-themes--colors <span class="org-string">"\n"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">utf-8</span>
     <span class="org-string">"/tmp/doom-color-theme"</span> <span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>gif-screencast-write-colormap<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">doom-load-theme-hook</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">gif-screencast-write-colormap</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-features" class="outline-4">
<h4 id="features"><span class="section-number-4">3.2.3</span> Features<a aria-hidden="true" href="#features">#</a> </h4>
<div class="outline-text-4" id="text-3-2-3">
</div>
<div id="outline-container-calctex" class="outline-5">
<h5 id="calctex"><span class="section-number-5">3.2.3.1</span> CalcTeX<a aria-hidden="true" href="#calctex">#</a> </h5>
<div class="outline-text-5" id="text-3-2-3-1">
<p>
This is a nice extension to <code>calc</code>
</p>

<details id='calctex,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#calctex,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> calctex <span class="org-builtin">:recipe</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:host</span> github <span class="org-builtin">:repo</span> <span class="org-string">"johnbcoughlin/calctex"</span>
                           <span class="org-builtin">:files</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"*.el"</span> <span class="org-string">"calctex/*.el"</span> <span class="org-string">"calctex-contrib/*.el"</span> <span class="org-string">"org-calctex/*.el"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-builtin">:pin</span> <span class="org-string">"7fa2673c64..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-ess" class="outline-5">
<h5 id="ess"><span class="section-number-5">3.2.3.2</span> <span class='acr'>ESS</span><a aria-hidden="true" href="#ess">#</a> </h5>
<div class="outline-text-5" id="text-3-2-3-2">
<p>
View data frames better with
</p>
<details id='ess,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#ess,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> ess-view <span class="org-builtin">:pin</span> <span class="org-string">"d4e5a340b7..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-magit-delta" class="outline-5">
<h5 id="magit-delta"><span class="section-number-5">3.2.3.3</span> Magit Delta<a aria-hidden="true" href="#magit-delta">#</a> </h5>
<div class="outline-text-5" id="text-3-2-3-3">
<p>
<a href="https://github.com/dandavison/delta/">Delta</a> is a git diff syntax highlighter written in rust. The author also wrote a
package to hook this into the magit diff view. This requires the <code>delta</code> binary.
</p>
<details id='magit-delta,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#magit-delta,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">(package! magit-delta :recipe (:host github :repo "dandavison/magit-delta") :pin "fc4de96e3f...")</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-info-colours" class="outline-5">
<h5 id="info-colours"><span class="section-number-5">3.2.3.4</span> Info colours<a aria-hidden="true" href="#info-colours">#</a> </h5>
<div class="outline-text-5" id="text-3-2-3-4">
<p>
This makes manual pages nicer to look at :)
Variable pitch fontification + colouring
</p>


<figure id="org27449c8">
<img src="https://tecosaur.com/lfs/emacs-config/screenshots/info-colours.png" alt="Example info-colours page." class="invertible" style="width:80%">

</figure>

<details id='info-colours,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#info-colours,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> info-colors <span class="org-builtin">:pin</span> <span class="org-string">"47ee73cc19..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-large-files" class="outline-5">
<h5 id="large-files"><span class="section-number-5">3.2.3.5</span> Large files<a aria-hidden="true" href="#large-files">#</a> </h5>
<div class="outline-text-5" id="text-3-2-3-5">
<p>
The <i>very large files</i> mode loads large files in chunks, allowing one to open
ridiculously large files.
</p>
<details id='large-files,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#large-files,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> vlf <span class="org-builtin">:recipe</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:host</span> github <span class="org-builtin">:repo</span> <span class="org-string">"m00natic/vlfi"</span> <span class="org-builtin">:files</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"*.el"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-builtin">:pin</span> <span class="org-string">"cc02f25337..."</span> <span class="org-builtin">:disable</span> t<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
To make <span class='acr'>VLF</span> available without delaying startup, we&rsquo;ll just load it in quiet moments.
</p>
<details id='large-files,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#large-files,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">use-package!</span> vlf-setup
  <span class="org-builtin">:defer-incrementally</span> vlf-tune vlf-base vlf-write vlf-search vlf-occur vlf-follow vlf-ediff vlf<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-definitions" class="outline-5">
<h5 id="definitions"><span class="section-number-5">3.2.3.6</span> Definitions<a aria-hidden="true" href="#definitions">#</a> </h5>
<div class="outline-text-5" id="text-3-2-3-6">
<p>
Doom already loads <kbd>define-word</kbd>, and provides it&rsquo;s own definition service using
<a href="https://github.com/gromnitsky/wordnut">wordnut</a>. However, using an offline dictionary possess a few compelling
advantages, namely:
</p>
<ul class="org-ul">
<li>speed</li>
<li>integration of multiple dictionaries</li>
</ul>
<p>
<a href="http://goldendict.org/">GoldenDict</a> seems like the best option currently avalible, but lacks a <span class='acr'>CLI</span>.
Hence, we&rsquo;ll fall back to <a href="https://dushistov.github.io/sdcv/">sdcv</a> (a <span class='acr'>CLI</span> version of StarDict) for now.
To interface with this, we&rsquo;ll use a my <kbd>lexic</kbd> package.
</p>


<figure id="orgc0b8099">
<img src="https://tecosaur.com/lfs/emacs-config/screenshots/lexic.png" alt="Screenshot of the lexic-mode view of &quot;literate&quot;" class="invertible">

</figure>

<details id='definitions,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#definitions,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> lexic <span class="org-builtin">:recipe</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:local-repo</span> <span class="org-string">"lisp/lexic"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Given that a request for a <span class='acr'>CLI</span> is the most upvoted issue on GitHub for
GoldenDict, it&rsquo;s likely we&rsquo;ll be able to switch from <code>sdcv</code> to that in the future.
</p>

<p>
Since GoldenDict supports StarDict files, I expect this will be a relatively
painless switch.
</p>
</div>
</div>
<div id="outline-container-calibre-ebook-reading" class="outline-5">
<h5 id="calibre-ebook-reading"><span class="section-number-5">3.2.3.7</span> Calibre and ebook reading<a aria-hidden="true" href="#calibre-ebook-reading">#</a> </h5>
<div class="outline-text-5" id="text-3-2-3-7">
<p>
For managing my ebooks, I&rsquo;ll hook into the well-established ebook library
manager <a href="https://calibre-ebook.com/">calibre</a>. A number of Emacs clients for this exist, but this seems like a
good option.
</p>
<details id='calibre-ebook-reading,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#calibre-ebook-reading,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> calibredb <span class="org-builtin">:pin</span> <span class="org-string">"1f38fc34a8..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Then for reading them, the only currently viable options seems to be <a href="https://depp.brause.cc/nov.el/">nov.el</a>.
</p>
<details id='calibre-ebook-reading,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#calibre-ebook-reading,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> nov <span class="org-builtin">:pin</span> <span class="org-string">"0ece7ccbf7..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Together these should give me a rather good experience reading ebooks.
</p>
</div>
</div>
<div id="outline-container-screenshots" class="outline-5">
<h5 id="screenshots"><span class="section-number-5">3.2.3.8</span> Screenshots<a aria-hidden="true" href="#screenshots">#</a> </h5>
<div class="outline-text-5" id="text-3-2-3-8">
<p>
This makes it a breeze to take lovely screenshots.
</p>
<details id='screenshots,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#screenshots,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> screenshot <span class="org-builtin">:recipe</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:local-repo</span> <span class="org-string">"lisp/screenshot"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>


<figure id="orgeaab760">
<img src="https://tecosaur.com/lfs/emacs-config/screenshots/screenshot.png" alt="Example screenshot.el screenshot" class="invertible">

</figure>

<p>
Some light configuring is all we need, so we can make use of the <a href="https://github.com/Calinou/0x0">0x0</a> wrapper
file uploading script (which I&rsquo;ve renamed to <code>upload</code>).
</p>
<details id='screenshots,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#screenshots,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">use-package!</span> screenshot
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:config</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> screenshot-upload-fn <span class="org-string">"upload %s 2&gt;/dev/null"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
</div>
<div id="outline-container-language-packages" class="outline-3">
<h3 id="language-packages"><span class="section-number-3">3.3</span> Language packages<a aria-hidden="true" href="#language-packages">#</a> </h3>
<div class="outline-text-3" id="text-3-3">
</div>
<div id="outline-container-latex" class="outline-4">
<h4 id="latex"><span class="section-number-4">3.3.1</span> LaTeX<a aria-hidden="true" href="#latex">#</a> </h4>
<div class="outline-text-4" id="text-3-3-1">
<p>
For mathematical convenience, <span class='acr'>WIP</span>
</p>
<details id='latex,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#latex,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> auto-activating-snippets <span class="org-builtin">:recipe</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:host</span> github <span class="org-builtin">:repo</span> <span class="org-string">"ymarco/auto-activating-snippets"</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-builtin">:pin</span> <span class="org-string">"85cd255347..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> latex-auto-activating-snippets
  <span class="org-builtin">:recipe</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:local-repo</span> <span class="org-string">"lisp/LaTeX-auto-activating-snippets"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
And some basic config
</p>
<details id='latex,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#latex,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">use-package!</span> auto-activating-snippets
  <span class="org-builtin">:hook</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">LaTeX-mode</span> . <span class="org-variable-name">auto-activating-snippets-mode</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-builtin">:config</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">require</span> <span class="org-highlight-quoted-quote">'</span><span class="org-constant">latex-auto-activating-snippets</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">use-package!</span> latex-auto-activating-snippets
  <span class="org-builtin">:config</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">als-tex-fold-maybe</span> <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">equal</span> <span class="org-string">"/"</span> als-transient-snippet-key<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">+latex-fold-last-macro-a</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">aas-post-snippet-expand-hook</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">als-tex-fold-maybe</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-org-mode" class="outline-4">
<h4 id="org-mode"><span class="section-number-4">3.3.2</span> Org Mode<a aria-hidden="true" href="#org-mode">#</a> </h4>
<div class="outline-text-4" id="text-3-3-2">
<p>
Use <span class='acr'>HEAD</span> for development.
</p>
<details id='org-mode,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">unpin!</span> org-mode<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>

<div id="outline-container-improve-agenda-capture" class="outline-5">
<h5 id="improve-agenda-capture"><span class="section-number-5">3.3.2.1</span> Improve agenda/capture<a aria-hidden="true" href="#improve-agenda-capture">#</a> </h5>
<div class="outline-text-5" id="text-3-3-2-1">
<p>
The agenda is nice, but a souped up version is nicer.
</p>
<details id='improve-agenda-capture,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#improve-agenda-capture,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> org-super-agenda <span class="org-builtin">:pin</span> <span class="org-string">"f5e80e4d0d..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Similarly <code>doct</code> (Declarative Org Capture Templates) seems to be a nicer way to
set up org-capture.
</p>
<details id='improve-agenda-capture,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#improve-agenda-capture,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> doct
  <span class="org-builtin">:recipe</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:host</span> github <span class="org-builtin">:repo</span> <span class="org-string">"progfolio/doct"</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-builtin">:pin</span> <span class="org-string">"8ac08633ae..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-visuals" class="outline-5">
<h5 id="visuals"><span class="section-number-5">3.3.2.2</span> Visuals<a aria-hidden="true" href="#visuals">#</a> </h5>
<div class="outline-text-5" id="text-3-3-2-2">
<p>
Org tables aren&rsquo;t the prettiest thing to look at. This package is supposed to
redraw them in the buffer with box-drawing characters. Sounds like an
improvement to me! Just need to get it working&#x2026;
</p>
<details id='visuals,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#visuals,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> org-pretty-table-mode
  <span class="org-builtin">:recipe</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:host</span> github <span class="org-builtin">:repo</span> <span class="org-string">"Fuco1/org-pretty-table"</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-builtin">:pin</span> <span class="org-string">"474ad84a8f..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
For automatically toggling LaTeX fragment previews there&rsquo;s this nice package
</p>
<details id='visuals,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#visuals,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> org-fragtog <span class="org-builtin">:pin</span> <span class="org-string">"0151cabc7a..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Then for pretty markers
</p>
<details id='visuals,code--3' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#visuals,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> org-appear <span class="org-builtin">:recipe</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:host</span> github <span class="org-builtin">:repo</span> <span class="org-string">"awth13/org-appear"</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-builtin">:pin</span> <span class="org-string">"19ea96e6e2..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
<code>org-superstar-mode</code> is great. While we&rsquo;re at it we may as well make tags prettier as well :)
</p>
<details id='visuals,code--4' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#visuals,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> org-pretty-tags <span class="org-builtin">:pin</span> <span class="org-string">"5c7521651b..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
There&rsquo;s this nice package that can provide nice syntax highlighting with LaTeX
exports.
</p>
<details id='visuals,code--5' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#visuals,code--5'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> engrave-faces <span class="org-builtin">:recipe</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:local-repo</span> <span class="org-string">"lisp/engrave-faces"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<details id='visuals,code--6' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#visuals,code--6'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">use-package!</span> engrave-faces-latex
  <span class="org-builtin">:after</span> ox-latex<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-extra-functionality" class="outline-5">
<h5 id="extra-functionality"><span class="section-number-5">3.3.2.3</span> Extra functionality<a aria-hidden="true" href="#extra-functionality">#</a> </h5>
<div class="outline-text-5" id="text-3-3-2-3">
<p>
Because of the <i><a href="https://github.com/commonmark/commonmark-spec/wiki/markdown-flavors">lovely variety in markdown implementations</a></i> there isn&rsquo;t actually
such a thing a standard table spec &#x2026; or standard anything really. Because
<code>org-md</code> is a goody-two-shoes, it just uses <span class='acr'>HTML</span> for all these non-standardised
elements (a lot of them). So <code>ox-gfm</code> is handy for exporting markdown with all the
features that GitHub has.
</p>
<details id='extra-functionality,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-functionality,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> ox-gfm <span class="org-builtin">:pin</span> <span class="org-string">"99f93011b0..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<details id='extra-functionality,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-functionality,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">use-package!</span> ox-gfm
  <span class="org-builtin">:after</span> org<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Now and then citations need to happen
</p>
<details id='extra-functionality,code--3' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-functionality,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> org-ref <span class="org-builtin">:pin</span> <span class="org-string">"052a176b4c..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Came across this and &#x2026; it&rsquo;s cool
</p>
<details id='extra-functionality,code--4' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-functionality,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> org-graph-view <span class="org-builtin">:recipe</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:host</span> github <span class="org-builtin">:repo</span> <span class="org-string">"alphapapa/org-graph-view"</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-builtin">:pin</span> <span class="org-string">"13314338d7..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
I <b>need</b> this in my life. It take a <span class='acr'>URL</span> to a recipe from a common site, and
inserts an org-ified version at point. Isn&rsquo;t that just great.
</p>
<details id='extra-functionality,code--5' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-functionality,code--5'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> org-chef <span class="org-builtin">:pin</span> <span class="org-string">"5b461ed7d4..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Sometimes I&rsquo;m given non-org files, that&rsquo;s very sad. Luckily Pandoc offers a way
to make that right again, and this package makes that even easier to do.
</p>
<details id='extra-functionality,code--6' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-functionality,code--6'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> org-pandoc-import <span class="org-builtin">:recipe</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:local-repo</span> <span class="org-string">"lisp/org-pandoc-import"</span> <span class="org-builtin">:files</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"*.el"</span> <span class="org-string">"filters"</span> <span class="org-string">"preprocessors"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<details id='extra-functionality,code--7' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-functionality,code--7'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">use-package!</span> org-pandoc-import
  <span class="org-builtin">:after</span> org<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Org-roam is nice by itself, but there are so <i>extra</i> nice packages which integrate
with it.
</p>
<details id='extra-functionality,code--8' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-functionality,code--8'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> org-roam-server <span class="org-builtin">:pin</span> <span class="org-string">"c7793202e9..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<details id='extra-functionality,code--9' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-functionality,code--9'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">use-package</span> org-roam-server
  <span class="org-builtin">:after</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-roam</span> server<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-builtin">:config</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> org-roam-server-host <span class="org-string">"127.0.0.1"</span>
        org-roam-server-port <span class="org-highlight-numbers-number">8078</span>
        org-roam-server-export-inline-images t
        org-roam-server-authenticate nil
        org-roam-server-network-label-truncate t
        org-roam-server-network-label-truncate-length <span class="org-highlight-numbers-number">60</span>
        org-roam-server-network-label-wrap-length <span class="org-highlight-numbers-number">20</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-roam-server-open</span> <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-doc">"Ensure the server is active, then open the roam graph."</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">interactive</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-variable-name">org-roam-server-mode</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">browse-url-xdg-open</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"http://localhost:%d"</span> org-roam-server-port<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-systemd" class="outline-4">
<h4 id="systemd"><span class="section-number-4">3.3.3</span> Systemd<a aria-hidden="true" href="#systemd">#</a> </h4>
<div class="outline-text-4" id="text-3-3-3">
<p>
For editing systemd unit files
</p>
<details id='systemd,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#systemd,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> systemd <span class="org-builtin">:pin</span> <span class="org-string">"51c148e09a..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-graphviz" class="outline-4">
<h4 id="graphviz"><span class="section-number-4">3.3.4</span> Graphviz<a aria-hidden="true" href="#graphviz">#</a> </h4>
<div class="outline-text-4" id="text-3-3-4">
<p>
Graphviz is a nice method of visualising simple graphs, based on plaintext
<kbd>.dot</kbd> / <kbd>.gv</kbd> files.
</p>
<details id='graphviz,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#graphviz,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> graphviz-dot-mode <span class="org-builtin">:pin</span> <span class="org-string">"3642a0a5f4..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-authinfo" class="outline-4">
<h4 id="authinfo"><span class="section-number-4">3.3.5</span> Authinfo<a aria-hidden="true" href="#authinfo">#</a> </h4>
<div class="outline-text-4" id="text-3-3-5">
<details id='authinfo,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#authinfo,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> authinfo-color-mode
  <span class="org-builtin">:recipe</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:local-repo</span> <span class="org-string">"lisp/authinfo-color-mode"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
Now we just need to load it appropriately.
</p>
<details id='authinfo,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#authinfo,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">use-package!</span> authinfo-color-mode
  <span class="org-builtin">:mode</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"authinfo.gpg\\'"</span> . authinfo-color-mode<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-builtin">:init</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">advice-add</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">authinfo-mode</span> <span class="org-builtin">:override</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">authinfo-color-mode</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-beancount-accounting" class="outline-4">
<h4 id="beancount-accounting"><span class="section-number-4">3.3.6</span> Beancount (accounting)<a aria-hidden="true" href="#beancount-accounting">#</a> </h4>
<div class="outline-text-4" id="text-3-3-6">
<details id='beancount-accounting,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#beancount-accounting,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> beancount <span class="org-builtin">:recipe</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:host</span> github <span class="org-builtin">:repo</span> <span class="org-string">"beancount/beancount-mode"</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-builtin">:pin</span> <span class="org-string">"7a0ef01d1f..."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
</div>
<div id="outline-container-package-configuration" class="outline-2">
<h2 id="package-configuration"><span class="section-number-2">4</span> Package configuration<a aria-hidden="true" href="#package-configuration">#</a> </h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-abbrev-mode" class="outline-3">
<h3 id="abbrev-mode"><span class="section-number-3">4.1</span> Abbrev mode<a aria-hidden="true" href="#abbrev-mode">#</a> </h3>
<div class="outline-text-3" id="text-4-1">
<p>
Thanks to <a href="https://emacs.stackexchange.com/questions/45462/use-a-single-abbrev-table-for-multiple-modes/45476#45476">use a single abbrev-table for multiple modes? - Emacs Stack Exchange</a> I
have the following.
</p>
<details id='abbrev-mode,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#abbrev-mode,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">use-package</span> abbrev
  <span class="org-builtin">:init</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq-default</span> <span class="org-variable-name">abbrev-mode</span> t<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">a hook funtion that sets the abbrev-table to org-mode-abbrev-table</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">whenever the major mode is a text mode</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">tec/set-text-mode-abbrev-table</span> <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">derived-mode-p</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">text-mode</span><span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">local-abbrev-table</span> <span class="org-variable-name">org-mode-abbrev-table</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-builtin">:commands</span> <span class="org-variable-name">abbrev-mode</span>
  <span class="org-builtin">:hook</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-variable-name">abbrev-mode</span> . tec/set-text-mode-abbrev-table<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-builtin">:config</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">abbrev-file-name</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">expand-file-name</span> <span class="org-string">"abbrev.el"</span> <span class="org-variable-name">doom-private-dir</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">save-abbrevs</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">silently</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-calc" class="outline-3">
<h3 id="calc"><span class="section-number-3">4.2</span> Calc<a aria-hidden="true" href="#calc">#</a> </h3>
<div class="outline-text-3" id="text-4-2">
<p>
Radians are just better
(setq calc-angle-mode &rsquo;rad  ;; radians are rad
      calc-algebraic-mode t ;; allows &rsquo;2*x instead of &rsquo;x&ltRET&gt;2*
      calc-symbolic-mode t) ;; keeps stuff like √2 irrational for as long as possible
(after! calctex
  (setq calctex-format-latex-header (concat calctex-format-latex-header
                                            &ldquo;\n\\usepackage{arevmath}&rdquo;)))
</p>
<details id='calc,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#calc,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">calc-mode-hook</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calctex-mode</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-centaur-tabs" class="outline-3">
<h3 id="centaur-tabs"><span class="section-number-3">4.3</span> Centaur Tabs<a aria-hidden="true" href="#centaur-tabs">#</a> </h3>
<div class="outline-text-3" id="text-4-3">
<p>
We want to make the tabs a nice, comfy size (<code>36</code>), with icons. The modifier
marker is nice, but the particular default Unicode one causes a lag spike, so
let&rsquo;s just switch to an <code>o</code>, which still looks decent but doesn&rsquo;t cause any
issues.
A &rsquo;active-bar&rsquo; is nice, so let&rsquo;s have one of those. If we have it <code>under</code> needs us to
turn on <code>x-underline-at-decent</code> though. For some reason this didn&rsquo;t seem to work
inside the <code>(after! ... )</code> block ¯\<sub>(ツ)</sub>_/¯.
Then let&rsquo;s change the font to a sans serif, but the default one doesn&rsquo;t fit too
well somehow, so let&rsquo;s switch to &rsquo;P22 Underground Book&rsquo;; it looks much nicer.
</p>
<details id='centaur-tabs,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#centaur-tabs,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> centaur-tabs
  <span class="org-rainbow-delimiters-depth-2">(</span>centaur-tabs-mode <span class="org-highlight-numbers-number">-1</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> centaur-tabs-height <span class="org-highlight-numbers-number">36</span>
        centaur-tabs-set-icons t
        centaur-tabs-modified-marker <span class="org-string">"o"</span>
        centaur-tabs-close-button <span class="org-string">"&#215;"</span>
        centaur-tabs-set-bar <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">above</span>
        centaur-tabs-gray-out-icons <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">buffer</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>centaur-tabs-change-fonts <span class="org-string">"P22 Underground Book"</span> <span class="org-highlight-numbers-number">160</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(setq x-underline-at-descent-line t)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-company" class="outline-3">
<h3 id="company"><span class="section-number-3">4.4</span> Company<a aria-hidden="true" href="#company">#</a> </h3>
<div class="outline-text-3" id="text-4-4">
<p>
It&rsquo;s nice to have completions almost all the time, in my opinion. Key strokes
are just waiting to be saved!
</p>
<details id='company,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#company,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> company
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">company-idle-delay</span> <span class="org-highlight-numbers-number">0.5</span>
        <span class="org-variable-name">company-minimum-prefix-length</span> <span class="org-highlight-numbers-number">2</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">company-show-numbers</span> t<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">evil-normal-state-entry-hook</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">company-abort</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">make aborting less annoying.</span>
</pre>
</div>
    </details>
<p>
Now, the improvements from <code>precedent</code> are mostly from remembering history, so
let&rsquo;s improve that memory.
</p>
<details id='company,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#company,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq-default</span> <span class="org-variable-name">history-length</span> <span class="org-highlight-numbers-number">1000</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq-default</span> prescient-history-length <span class="org-highlight-numbers-number">1000</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
<div id="outline-container-plain-text" class="outline-4">
<h4 id="plain-text"><span class="section-number-4">4.4.1</span> Plain Text<a aria-hidden="true" href="#plain-text">#</a> </h4>
<div class="outline-text-4" id="text-4-4-1">
<p>
<code>Ispell</code> is nice, let&rsquo;s have it in <code>text</code>, <code>markdown</code>, and <code>GFM</code>.
</p>
<details id='plain-text,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#plain-text,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">set-company-backend!</span>
  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>text-mode
    markdown-mode
    gfm-mode<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:seperate</span>
    company-ispell
    company-files
    company-yasnippet<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
We then configure the dictionary we&rsquo;re using in <a href="#ispell">Ispell</a>.
</p>
</div>
</div>
<div id="outline-container-company-ess" class="outline-4">
<h4 id="company-ess"><span class="section-number-4">4.4.2</span> <span class='acr'>ESS</span><a aria-hidden="true" href="#company-ess">#</a> </h4>
<div class="outline-text-4" id="text-4-4-2">
<p>
<code>company-dabbrev-code</code> is nice. Let&rsquo;s have it.
</p>
<details id='ess,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#ess,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">set-company-backend!</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">ess-r-mode</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>company-R-args company-R-objects company-dabbrev-code <span class="org-builtin">:separate</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-elcord" class="outline-3">
<h3 id="elcord"><span class="section-number-3">4.5</span> Elcord<a aria-hidden="true" href="#elcord">#</a> </h3>
<div class="outline-text-3" id="text-4-5">
<details id='elcord,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#elcord,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> elcord-use-major-mode-as-main-icon t<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-emacs-anywhere-configuration" class="outline-3">
<h3 id="emacs-anywhere-configuration"><span class="section-number-3">4.6</span> <a href="https://github.com/zachcurry/emacs-anywhere">Emacs Anywhere</a> configuration<a aria-hidden="true" href="#emacs-anywhere-configuration">#</a> </h3>
<div class="outline-text-3" id="text-4-6">
<p>
To start with, let&rsquo;s install this.
</p>
<details id='emacs-anywhere-configuration,code--1' class='code' open><summary><span class='lang'>Shell Script</span></summary>
    <div class='gutter'>
    <a href='#emacs-anywhere-configuration,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell"><span class="org-type">cd</span> /tmp
<span class="org-type">curl</span> -fsSL https://raw.github.com/zachcurry/emacs-anywhere/master/install -o ea-install.sh
sed -i <span class="org-string">'s/EA_PATH=$HOME\/.emacs_anywhere/EA_PATH=$HOME\/.local\/share\/emacs_anywhere/'</span> ea-install.sh
bash ea-install.sh || <span class="org-keyword">exit</span>
<span class="org-type">cd</span> ~/.local/share/emacs_anywhere
<span class="org-comment-delimiter"># </span><span class="org-comment">Install in ~/.local not ~/.emacs_anywhere</span>
sed -i <span class="org-string">'s/$HOME\/.emacs_anywhere/$HOME\/.local\/share\/emacs_anywhere/'</span> ./bin/linux ./bin/emacstask
<span class="org-type">ln</span> -s ~/.local/share/emacs_anywhere/bin/linux ~/.local/bin/emacs_anywhere
</pre>
</div>
    </details>

<p>
It&rsquo;s nice to recognise GitHub (so we can use <code>GFM</code>), and other apps which we know
take markdown
</p>
<details id='emacs-anywhere-configuration,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#emacs-anywhere-configuration,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">markdown-window-p</span> <span class="org-rainbow-delimiters-depth-2">(</span>window-title<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Judges from WINDOW-TITLE whether the current window likes markdown"</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">string-match-p</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">rx</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">or</span> <span class="org-string">"Stack Exchange"</span> <span class="org-string">"Stack Overflow"</span>
                              <span class="org-string">"Pull Request"</span> <span class="org-string">"Issue"</span> <span class="org-string">"Discord"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                      window-title<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-warning">t nil</span><span class="org-warning"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-warning"><span class="org-rainbow-delimiters-depth-1">)</span></span>
</pre>
</div>
    </details>
<p>
When the window opens, we generally want text so let&rsquo;s use a nice sans serif font,
a position the window below and to the left. Oh, and don&rsquo;t forget about checking
for <code>GFM</code>, otherwise let&rsquo;s just use <code>markdown</code>.
</p>
<details id='emacs-anywhere-configuration,code--3' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#emacs-anywhere-configuration,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">emacs-anywhere--active-markdown</span> nil
  <span class="org-doc">"Whether the buffer started off as markdown.</span>
<span class="org-doc">Affects behaviour of `</span><span class="org-doc"><span class="org-constant">emacs-anywhere--finalise-content</span></span><span class="org-doc">'"</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">emacs-anywhere--finalise-content</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">&amp;optional</span> _frame<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-variable-name">emacs-anywhere--active-markdown</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">fundamental-mode</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">goto-char</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">point-min</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">insert</span> <span class="org-string">"#+property: header-args :exports both\n#+options: toc:nil\n"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">rename-buffer</span> <span class="org-string">"*EA Pre Export*"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-export-to-buffer</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">gfm</span> ea--buffer-name<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">kill-buffer</span> <span class="org-string">"*EA Pre Export*"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">gui-select-text</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">buffer-string</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define-minor-mode</span> <span class="org-variable-name">emacs-anywhere-mode</span>
  <span class="org-doc">"To tweak the current buffer for some emacs-anywhere considerations"</span>
  <span class="org-builtin">:init-value</span> nil
  <span class="org-builtin">:keymap</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">list</span>
           <span class="org-comment-delimiter">;; </span><span class="org-comment">Finish edit, but be smart in org mode</span>
           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">cons</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">kbd</span> <span class="org-string">"C-c C-c"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">cmd!</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">eq</span> <span class="org-variable-name">major-mode</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">org-mode</span><span class="org-rainbow-delimiters-depth-1">)</span>
                                <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-in-src-block-p</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-ctrl-c-ctrl-c</span><span class="org-rainbow-delimiters-depth-3">)</span>
                         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">delete-frame</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
           <span class="org-comment-delimiter">;; </span><span class="org-comment">Abort edit. emacs-anywhere saves the current edit for next time.</span>
           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">cons</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">kbd</span> <span class="org-string">"C-c C-k"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">cmd!</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> ea-on nil<span class="org-rainbow-delimiters-depth-2">)</span>
                       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">delete-frame</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-variable-name">emacs-anywhere-mode</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">line breaking</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">turn-off-auto-fill</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-variable-name">visual-line-mode</span> t<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">DEL/C-SPC to clear (first keystroke only)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">set-transient-map</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>keymap <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">make-sparse-keymap</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                         <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">define-key</span> keymap <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">kbd</span> <span class="org-string">"DEL"</span><span class="org-rainbow-delimiters-depth-3">)</span>   <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">cmd!</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">delete-region</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">point-min</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">point-max</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                         <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">define-key</span> keymap <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">kbd</span> <span class="org-string">"C-SPC"</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">cmd!</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">delete-region</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">point-min</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">point-max</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                         keymap<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">disable tabs</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">bound-and-true-p</span> centaur-tabs-mode<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span>centaur-tabs-local-mode t<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">ea-popup-handler</span> <span class="org-rainbow-delimiters-depth-2">(</span>app-name window-title x y w h<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">interactive</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">set-frame-size</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">selected-frame</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-highlight-numbers-number">80</span> <span class="org-highlight-numbers-number">12</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">position the frame near the mouse</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>mousepos <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">split-string</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">shell-command-to-string</span> <span class="org-string">"xdotool getmouselocation | sed -E \"s/ screen:0 window:[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string"> ]*|x:|y://g\""</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>mouse-x <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">-</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">string-to-number</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">0</span> mousepos<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-highlight-numbers-number">100</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>mouse-y <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">-</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">string-to-number</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">1</span> mousepos<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-highlight-numbers-number">50</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">set-frame-position</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">selected-frame</span><span class="org-rainbow-delimiters-depth-1">)</span> mouse-x mouse-y<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">set-frame-name</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">concat</span> <span class="org-string">"Quick Edit &#8759; "</span> ea-app-name <span class="org-string">" &#8212; "</span>
                          <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">truncate-string-to-width</span>
                           <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">string-trim</span>
                            <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">string-trim-right</span> window-title
                                               <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"-[A-Za-z0-9 ]*%s"</span> ea-app-name<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                            <span class="org-string">"[\s-]+"</span> <span class="org-string">"[\s-]+"</span><span class="org-rainbow-delimiters-depth-2">)</span>
                           <span class="org-highlight-numbers-number">45</span> nil nil <span class="org-string">"&#8230;"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when-let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>selection <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">gui-get-selection</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">PRIMARY</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">insert</span> selection<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-comment-delimiter">;; </span><span class="org-comment">convert buffer to org mode if markdown</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">markdown-window-p</span> window-title<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">shell-command-on-region</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">point-min</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">point-max</span><span class="org-rainbow-delimiters-depth-1">)</span>
                             <span class="org-string">"pandoc -f markdown -t org"</span> nil t<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-variable-name">deactivate-mark</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">goto-char</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">point-max</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-comment-delimiter">;; </span><span class="org-comment">remove any blank newline at end</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">delete-trailing-whitespace</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">delete-char</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">-</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">skip-chars-backward</span> <span class="org-string">"\n"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-comment-delimiter">;; </span><span class="org-comment">set major mode</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-mode</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-comment-delimiter">;; </span><span class="org-comment">set markdown status</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq-local</span> <span class="org-variable-name">emacs-anywhere--active-markdown</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">markdown-window-p</span> window-title<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">advice-add</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">ea--delete-frame-handler</span> <span class="org-builtin">:before</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">emacs-anywhere--finalise-content</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-comment-delimiter">;; </span><span class="org-comment">I'll be honest with myself, I /need/ spellcheck</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>spell-fu-buffer<span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">evil-insert-state</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">start in insert</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-variable-name">emacs-anywhere-mode</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">ea-popup-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">ea-popup-handler</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
#+end<sub>src</sub>
</p>

<p>
This new minor mode of ours will be nice for messages, so let&rsquo;s hook it in for
Email and <span class='acr'>IRC</span>.
</p>
<details id='emacs-anywhere-configuration,code--4' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#emacs-anywhere-configuration,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">add-hook!</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>mu4e-compose-mode org-msg-edit-mode circe-channel-mode<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>emoticon-to-emoji <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-eros-eval" class="outline-3">
<h3 id="eros-eval"><span class="section-number-3">4.7</span> Eros-eval<a aria-hidden="true" href="#eros-eval">#</a> </h3>
<div class="outline-text-3" id="text-4-7">
<p>
This makes the result of evals with <kbd>gr</kbd> and <kbd>gR</kbd> just slightly prettier. Every bit
counts right?
</p>
<details id='eros-eval,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#eros-eval,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">eros-eval-result-prefix</span> <span class="org-string">"&#10233; "</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-evil" class="outline-3">
<h3 id="evil"><span class="section-number-3">4.8</span> <span class='acr'>EVIL</span><a aria-hidden="true" href="#evil">#</a> </h3>
<div class="outline-text-3" id="text-4-8">
<p>
I don&rsquo;t use <code>evil-escape-mode</code>, so I may as well turn it off, I&rsquo;ve heard it
contributes a typing delay. I&rsquo;m not sure it&rsquo;s much, but it is an extra
<code>pre-command-hook</code> that I don&rsquo;t benefit from, so&#x2026;
</p>
<details id='evil,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#evil,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> evil-escape <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-variable-name">evil-escape-mode</span> <span class="org-highlight-numbers-number">-1</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
When I want to make a substitution, I want it to be global more often than not
&#x2014; so let&rsquo;s make that the default.
</p>
<details id='evil,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#evil,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> evil <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">evil-ex-substitute-global</span> t<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">I like my s/../.. to by global by default</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-package-configuration-info" class="outline-3">
<h3 id="package-configuration-info"><span class="section-number-3">4.9</span> Info colours<a aria-hidden="true" href="#package-configuration-info">#</a> </h3>
<div class="outline-text-3" id="text-4-9">
<details id='info-colours,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#info-colours,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">use-package!</span> info-colors
  <span class="org-builtin">:commands</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">info-colors-fontify-node</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">Info-selection-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">info-colors-fontify-node</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">Info-mode-hook</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">mixed-pitch-mode</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>


<figure id="org620eaa8">
<img src="https://tecosaur.com/lfs/emacs-config/screenshots/info-coloured.png" alt="Example colourised info page" class="invertible">

</figure>
</div>
</div>
<div id="outline-container-ispell" class="outline-3">
<h3 id="ispell"><span class="section-number-3">4.10</span> Ispell<a aria-hidden="true" href="#ispell">#</a> </h3>
<div class="outline-text-3" id="text-4-10">
</div>
<div id="outline-container-downloading-dictionaries" class="outline-4">
<h4 id="downloading-dictionaries"><span class="section-number-4">4.10.1</span> Downloading dictionaries<a aria-hidden="true" href="#downloading-dictionaries">#</a> </h4>
<div class="outline-text-4" id="text-4-10-1">
<p>
Let&rsquo;s get a nice big dictionary from <a href="http://app.aspell.net/create"><span class='acr'>SCOWL</span> Custom List/Dictionary Creator</a> with
the following configuration
</p>
<dl class="org-dl">
<dt>size</dt><dd>80 (huge)</dd>
<dt>spellings</dt><dd>British(-ise) and Australian</dd>
<dt>spelling variants level</dt><dd>0</dd>
<dt>diacritics</dt><dd>keep</dd>
<dt>extra lists</dt><dd>hacker, roman numerals</dd>
</dl>
</div>

<div id="outline-container-hunspell" class="outline-5">
<h5 id="hunspell"><span class="section-number-5">4.10.1.1</span> Hunspell<a aria-hidden="true" href="#hunspell">#</a> </h5>
<div class="outline-text-5" id="text-4-10-1-1">
<details id='hunspell,code--1' class='code' open><summary><span class='lang'>Shell Script</span></summary>
    <div class='gutter'>
    <a href='#hunspell,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell"><span class="org-type">cd</span> /tmp
<span class="org-type">curl</span> -o <span class="org-string">"hunspell-en-custom.zip"</span> <span class="org-string">'http://app.aspell.net/create?max_size=80&amp;spelling=GBs&amp;spelling=AU&amp;max_variant=0&amp;diacritic=keep&amp;special=hacker&amp;special=roman-numerals&amp;encoding=utf-8&amp;format=inline&amp;download=hunspell'</span>
unzip <span class="org-string">"hunspell-en-custom.zip"</span>

<span class="org-type">sudo</span> <span class="org-type">chown</span> root:root en-custom.*
<span class="org-type">sudo</span> <span class="org-type">mv</span> en-custom.<span class="org-rainbow-delimiters-depth-1">{</span>aff,dic<span class="org-rainbow-delimiters-depth-1">}</span> /usr/share/myspell/
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-aspell" class="outline-5">
<h5 id="aspell"><span class="section-number-5">4.10.1.2</span> Aspell<a aria-hidden="true" href="#aspell">#</a> </h5>
<div class="outline-text-5" id="text-4-10-1-2">
<details id='aspell,code--1' class='code' open><summary><span class='lang'>Shell Script</span></summary>
    <div class='gutter'>
    <a href='#aspell,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell"><span class="org-type">cd</span> /tmp
<span class="org-type">curl</span> -o <span class="org-string">"aspell6-en-custom.tar.bz2"</span> <span class="org-string">'http://app.aspell.net/create?max_size=80&amp;spelling=GBs&amp;spelling=AU&amp;max_variant=0&amp;diacritic=keep&amp;special=hacker&amp;special=roman-numerals&amp;encoding=utf-8&amp;format=inline&amp;download=aspell'</span>
tar -xjf <span class="org-string">"aspell6-en-custom.tar.bz2"</span>

<span class="org-type">cd</span> aspell6-en-custom
./configure &amp;&amp; <span class="org-type">make</span> &amp;&amp; <span class="org-type">sudo</span> <span class="org-type">make</span> install
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-configuration" class="outline-4">
<h4 id="configuration"><span class="section-number-4">4.10.2</span> Configuration<a aria-hidden="true" href="#configuration">#</a> </h4>
<div class="outline-text-4" id="text-4-10-2">
<details id='configuration,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#configuration,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">ispell-dictionary</span> <span class="org-string">"en-custom"</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
Oh, and by the way, if <code>company-ispell-dictionary</code> is <code>nil</code>, then
<code>ispell-complete-word-dict</code> is used instead, which once again when <code>nil</code> is
<code>ispell-alternate-dictionary</code>, which at the moment maps to a plaintext version of
the above.
</p>

<p>
It seems reasonable to want to keep an eye on my personal dict, let&rsquo;s have it
nearby (also means that if I change the &rsquo;main&rsquo; dictionary I keep my addition).
</p>
<details id='configuration,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#configuration,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">ispell-personal-dictionary</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">expand-file-name</span> <span class="org-string">".ispell_personal"</span> <span class="org-variable-name">doom-private-dir</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-ivy" class="outline-3">
<h3 id="ivy"><span class="section-number-3">4.11</span> Ivy<a aria-hidden="true" href="#ivy">#</a> </h3>
<div class="outline-text-3" id="text-4-11">
<p>
While in an ivy mini-buffer <kbd>C-o</kbd> shows a list of all possible actions one may take.
By default this is <code>#'ivy-read-action-by-key</code> however a better interface to this
is using Hydra.
</p>
<details id='ivy,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#ivy,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> ivy-read-action-function <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">ivy-hydra-read-action</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
I currently have ~40k functions. This seems like sufficient motivation to
increase the maximum number of items ivy will sort to 40k + a bit, this way
<kbd>SPC h f</kbd> et al. will continue to function as expected.
</p>
<details id='ivy,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#ivy,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> ivy-sort-max-size <span class="org-highlight-numbers-number">50000</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-magit" class="outline-3">
<h3 id="magit"><span class="section-number-3">4.12</span> Magit<a aria-hidden="true" href="#magit">#</a> </h3>
<div class="outline-text-3" id="text-4-12">
<p>
Magit is pretty nice by default. The diffs don&rsquo;t get any
syntax-highlighting-love though which is a bit sad. Thankfully
<a href="https://github.com/dandavison/magit-delta">dandavison/magit-delta</a> exists, which we can put to use.
</p>
<details id='magit,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#magit,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">(after! magit</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">(magit-delta-mode +1))</span>
</pre>
</div>
    </details>
<p>
Unfortunately this seems to mess things up, which is something I&rsquo;ll want to look
into later.
</p>
</div>
</div>
<div id="outline-container-org-chef" class="outline-3">
<h3 id="org-chef"><span class="section-number-3">4.13</span> Org Chef<a aria-hidden="true" href="#org-chef">#</a> </h3>
<div class="outline-text-3" id="text-4-13">
<p>
Loading after org seems a bit premature. Let&rsquo;s just load it when we try to use
it, either by command or in a capture template.
</p>
<details id='org-chef,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#org-chef,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">use-package!</span> org-chef
  <span class="org-builtin">:commands</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-chef-insert-recipe</span> org-chef-get-recipe-from-url<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-projectile" class="outline-3">
<h3 id="projectile"><span class="section-number-3">4.14</span> Projectile<a aria-hidden="true" href="#projectile">#</a> </h3>
<div class="outline-text-3" id="text-4-14">
<p>
Looking at documentation via <kbd>SPC h f</kbd> and <kbd>SPC h v</kbd> and looking at the source can
add package src directories to projectile. This isn&rsquo;t desirable in my opinion.
</p>
<details id='projectile,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#projectile,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> projectile-ignored-projects <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"~/"</span> <span class="org-string">"/tmp"</span> <span class="org-string">"~/.emacs.d/.local/straight/repos/"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">projectile-ignored-project-function</span> <span class="org-rainbow-delimiters-depth-2">(</span>filepath<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Return t if FILEPATH is within any of `</span><span class="org-doc"><span class="org-constant">projectile-ignored-projects</span></span><span class="org-doc">'"</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">mapcar</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-2">(</span>p<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">s-starts-with-p</span> p filepath<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span> projectile-ignored-projects<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-smart-parentheses" class="outline-3">
<h3 id="smart-parentheses"><span class="section-number-3">4.15</span> Smart Parentheses<a aria-hidden="true" href="#smart-parentheses">#</a> </h3>
<div class="outline-text-3" id="text-4-15">
<details id='smart-parentheses,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#smart-parentheses,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">sp-local-pair</span>
 <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>org-mode<span class="org-rainbow-delimiters-depth-2">)</span>
 <span class="org-string">"&lt;&lt;"</span> <span class="org-string">"&gt;&gt;"</span>
 <span class="org-builtin">:actions</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>insert<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-spray" class="outline-3">
<h3 id="spray"><span class="section-number-3">4.16</span> Spray<a aria-hidden="true" href="#spray">#</a> </h3>
<div class="outline-text-3" id="text-4-16">
<p>
Let&rsquo;s make this suit me slightly better.
</p>
<details id='spray,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#spray,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> spray-wpm <span class="org-highlight-numbers-number">500</span>
      spray-height <span class="org-highlight-numbers-number">700</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-theme-magic" class="outline-3">
<h3 id="theme-magic"><span class="section-number-3">4.17</span> Theme magic<a aria-hidden="true" href="#theme-magic">#</a> </h3>
<div class="outline-text-3" id="text-4-17">
<p>
Let&rsquo;s automatically update terminals on theme change (as long as <code>pywal</code> is available).
</p>

<p>
Unfortunately, as the theme is set on startup this causes the hook to be run
immediately. It would be nicer to <i>not</i> have this add to our precious startup
time (around 0.4s last time I checked).
We can achieve this by deferring it with a short idle timer that should add the
hook <i>just after</i> initialisation.
</p>

<details id='theme-magic,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#theme-magic,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">run-with-idle-timer</span> <span class="org-highlight-numbers-number">0.1</span> nil <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-3">()</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">doom-load-theme-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">theme-magic-from-emacs</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-tramp" class="outline-3">
<h3 id="tramp"><span class="section-number-3">4.18</span> Tramp<a aria-hidden="true" href="#tramp">#</a> </h3>
<div class="outline-text-3" id="text-4-18">
<p>
Let&rsquo;s try to make tramp handle prompts better
</p>
<details id='tramp,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#tramp,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> tramp
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">setenv</span> <span class="org-string">"SHELL"</span> <span class="org-string">"/bin/bash"</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">tramp-shell-prompt-pattern</span> <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">^</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string"></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">]#$%&gt;\n]*#?[]#$%&gt;&#57520;] *</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">&#27;\\[[0-9;]*[a-zA-Z] *</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">*"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">default + &#57520;</span>
</pre>
</div>
    </details>
</div>
<div id="outline-container-troubleshooting" class="outline-4">
<h4 id="troubleshooting"><span class="section-number-4">4.18.1</span> Troubleshooting<a aria-hidden="true" href="#troubleshooting">#</a> </h4>
<div class="outline-text-4" id="text-4-18-1">
<p>
In case the remote shell is misbehaving, here are some things to try
</p>
</div>
<div id="outline-container-zsh" class="outline-5">
<h5 id="zsh"><span class="section-number-5">4.18.1.1</span> Zsh<a aria-hidden="true" href="#zsh">#</a> </h5>
<div class="outline-text-5" id="text-4-18-1-1">
<p>
There are some escape code you don&rsquo;t want, let&rsquo;s make it behave more considerately.
</p>
<details id='zsh,code--1' class='code' open><summary><span class='lang'>Shell Script</span></summary>
    <div class='gutter'>
    <a href='#zsh,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell"><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">[</span><span class="org-rainbow-delimiters-depth-2">[</span> <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">TERM</span></span><span class="org-string">"</span> == <span class="org-string">"dumb"</span> <span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">]</span>; <span class="org-keyword">then</span>
    <span class="org-builtin">unset</span> zle_bracketed_paste
    <span class="org-builtin">unset</span> zle
    <span class="org-variable-name">PS1</span>=<span class="org-string">'$ '</span>
    <span class="org-keyword">return</span>
<span class="org-keyword">fi</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-guix" class="outline-4">
<h4 id="guix"><span class="section-number-4">4.18.2</span> Guix<a aria-hidden="true" href="#guix">#</a> </h4>
<div class="outline-text-4" id="text-4-18-2">
<p>
<a href="https://guix.gnu.org/">Guix</a> puts some binaries that <span class='acr'>TRAMP</span> looks for in unexpected locations.
That&rsquo;s no problem though, we just need to help <span class='acr'>TRAMP</span> find them.
</p>
<details id='guix,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#guix,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> tramp
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">appendq!</span> <span class="org-variable-name">tramp-remote-path</span>
            <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"~/.guix-profile/bin"</span> <span class="org-string">"~/.guix-profile/sbin"</span>
              <span class="org-string">"/run/current-system/profile/bin"</span>
              <span class="org-string">"/run/current-system/profile/sbin"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-treemacs" class="outline-3">
<h3 id="treemacs"><span class="section-number-3">4.19</span> Treemacs<a aria-hidden="true" href="#treemacs">#</a> </h3>
<div class="outline-text-3" id="text-4-19">
<p>
Quite often there are superfluous files I&rsquo;m not that interested in. There&rsquo;s no
good reason for them to take up space. Let&rsquo;s add a mechanism to ignore them.
</p>
<details id='treemacs,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#treemacs,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> treemacs
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">treemacs-file-ignore-extensions</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-doc">"File extension which `</span><span class="org-doc"><span class="org-constant">treemacs-ignore-filter</span></span><span class="org-doc">' will ensure are ignored"</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">treemacs-file-ignore-globs</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-doc">"Globs which will are transformed to `</span><span class="org-doc"><span class="org-constant">treemacs-file-ignore-regexps</span></span><span class="org-doc">' which `</span><span class="org-doc"><span class="org-constant">treemacs-ignore-filter</span></span><span class="org-doc">' will ensure are ignored"</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">treemacs-file-ignore-regexps</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-doc">"RegExps to be tested to ignore files, generated from `</span><span class="org-doc"><span class="org-constant">treeemacs-file-ignore-globs</span></span><span class="org-doc">'"</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">treemacs-file-ignore-generate-regexps</span> <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-doc">"Generate `</span><span class="org-doc"><span class="org-constant">treemacs-file-ignore-regexps</span></span><span class="org-doc">' from `</span><span class="org-doc"><span class="org-constant">treemacs-file-ignore-globs</span></span><span class="org-doc">'"</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> treemacs-file-ignore-regexps <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">mapcar</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">dired-glob-regexp</span> treemacs-file-ignore-globs<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">equal</span> treemacs-file-ignore-globs <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-1">()</span><span class="org-rainbow-delimiters-depth-3">)</span> nil <span class="org-rainbow-delimiters-depth-3">(</span>treemacs-file-ignore-generate-regexps<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">treemacs-ignore-filter</span> <span class="org-rainbow-delimiters-depth-3">(</span>file full-path<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Ignore files specified by `</span><span class="org-doc"><span class="org-constant">treemacs-file-ignore-extensions</span></span><span class="org-doc">', and `</span><span class="org-doc"><span class="org-constant">treemacs-file-ignore-regexps</span></span><span class="org-doc">'"</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">member</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">file-name-extension</span> file<span class="org-rainbow-delimiters-depth-2">)</span> treemacs-file-ignore-extensions<span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>ignore-file nil<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">dolist</span> <span class="org-rainbow-delimiters-depth-3">(</span>regexp treemacs-file-ignore-regexps ignore-file<span class="org-rainbow-delimiters-depth-3">)</span>
            <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> ignore-file <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> ignore-file <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">string-match-p</span> regexp full-path<span class="org-rainbow-delimiters-depth-3">)</span> t nil<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">treemacs-ignored-file-predicates</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">treemacs-ignore-filter</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Now, we just identify the files in question.
</p>
<details id='treemacs,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#treemacs,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> treemacs-file-ignore-extensions
      <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-comment-delimiter">;; </span><span class="org-comment">LaTeX</span>
        <span class="org-string">"aux"</span>
        <span class="org-string">"ptc"</span>
        <span class="org-string">"fdb_latexmk"</span>
        <span class="org-string">"fls"</span>
        <span class="org-string">"synctex.gz"</span>
        <span class="org-string">"toc"</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">LaTeX - glossary</span>
        <span class="org-string">"glg"</span>
        <span class="org-string">"glo"</span>
        <span class="org-string">"gls"</span>
        <span class="org-string">"glsdefs"</span>
        <span class="org-string">"ist"</span>
        <span class="org-string">"acn"</span>
        <span class="org-string">"acr"</span>
        <span class="org-string">"alg"</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">LaTeX - pgfplots</span>
        <span class="org-string">"mw"</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">LaTeX - pdfx</span>
        <span class="org-string">"pdfa.xmpi"</span>
        <span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> treemacs-file-ignore-globs
      <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-comment-delimiter">;; </span><span class="org-comment">LaTeX</span>
        <span class="org-string">"*/_minted-*"</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">AucTeX</span>
        <span class="org-string">"*/.auctex-auto"</span>
        <span class="org-string">"*/_region_.log"</span>
        <span class="org-string">"*/_region_.tex"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-which-key" class="outline-3">
<h3 id="which-key"><span class="section-number-3">4.20</span> Which-key<a aria-hidden="true" href="#which-key">#</a> </h3>
<div class="outline-text-3" id="text-4-20">
<p>
Let&rsquo;s make this popup a bit faster
</p>
<details id='which-key,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#which-key,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> which-key-idle-delay <span class="org-highlight-numbers-number">0.5</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">I need the help, I really do</span>
</pre>
</div>
    </details>
<p>
I also think that having <kbd>evil-</kbd> appear in so many popups is a bit too verbose, let&rsquo;s change that, and do a few other similar tweaks while we&rsquo;re at it.
</p>
<details id='which-key,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#which-key,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> which-key-allow-multiple-replacements t<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> which-key
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">pushnew!</span>
   which-key-replacement-alist
   <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">""</span> . <span class="org-string">"\\`+?evil[-:]?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">a-</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span><span class="org-rainbow-delimiters-depth-1">)</span> . <span class="org-rainbow-delimiters-depth-1">(</span>nil . <span class="org-string">"&#9666;\\1"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
   <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"\\`g s"</span> . <span class="org-string">"\\`evilem--?motion-</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span><span class="org-rainbow-delimiters-depth-1">)</span> . <span class="org-rainbow-delimiters-depth-1">(</span>nil . <span class="org-string">"&#9667;\\1"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
   <span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>


<figure id="org955114c">
<img src="https://tecosaur.com/lfs/emacs-config/screenshots/whichkey-evil.png" alt="Whichkey triggered on an evil motion" class="invertible">

</figure>
</div>
</div>
<div id="outline-container-writeroom" class="outline-3">
<h3 id="writeroom"><span class="section-number-3">4.21</span> Writeroom<a aria-hidden="true" href="#writeroom">#</a> </h3>
<div class="outline-text-3" id="text-4-21">
<p>
For starters, I think Doom is a bit over-zealous when zooming in
</p>
<details id='writeroom,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#writeroom,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">+zen-text-scale</span> <span class="org-highlight-numbers-number">0.6</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Now, I think it would also be nice to remove line numbers and org stars in
writeroom.
</p>
<details id='writeroom,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#writeroom,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> writeroom-mode
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">writeroom-mode-hook</span>
            <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+zen-cleaner-org</span> <span class="org-rainbow-delimiters-depth-1">()</span>
              <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">eq</span> <span class="org-variable-name">major-mode</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">org-mode</span><span class="org-rainbow-delimiters-depth-3">)</span> writeroom-mode<span class="org-rainbow-delimiters-depth-2">)</span>
                <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq-local</span> -display-line-numbers <span class="org-variable-name">display-line-numbers</span>
                            <span class="org-variable-name">display-line-numbers</span> nil<span class="org-rainbow-delimiters-depth-2">)</span>
                <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq-local</span> -org-indent-mode org-indent-mode<span class="org-rainbow-delimiters-depth-2">)</span>
                <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-indent-mode</span> <span class="org-highlight-numbers-number">-1</span><span class="org-rainbow-delimiters-depth-2">)</span>
                <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">featurep</span> <span class="org-highlight-quoted-quote">'</span><span class="org-constant">org-superstar</span><span class="org-rainbow-delimiters-depth-3">)</span>
                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq-local</span> -org-superstar-headline-bullets-list org-superstar-headline-bullets-list
                              <span class="org-comment-delimiter">;; </span><span class="org-comment">org-superstar-headline-bullets-list '("&#128592;" "&#128593;" "&#128594;" "&#128595;" "&#128596;" "&#128597;" "&#128598;" "&#128599;")</span>
                              org-superstar-headline-bullets-list <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"&#128600;"</span> <span class="org-string">"&#128601;"</span> <span class="org-string">"&#128602;"</span> <span class="org-string">"&#128603;"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                              -org-superstar-remove-leading-stars org-superstar-remove-leading-stars
                              org-superstar-remove-leading-stars t<span class="org-rainbow-delimiters-depth-3">)</span>
                  <span class="org-rainbow-delimiters-depth-3">(</span>org-superstar-restart<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">writeroom-mode-disable-hook</span>
            <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+zen-dirty-org</span> <span class="org-rainbow-delimiters-depth-1">()</span>
              <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">eq</span> <span class="org-variable-name">major-mode</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">org-mode</span><span class="org-rainbow-delimiters-depth-2">)</span>
                <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq-local</span> <span class="org-variable-name">display-line-numbers</span> -display-line-numbers<span class="org-rainbow-delimiters-depth-2">)</span>
                <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> -org-indent-mode
                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-indent-mode</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">featurep</span> <span class="org-highlight-quoted-quote">'</span><span class="org-constant">org-superstar</span><span class="org-rainbow-delimiters-depth-3">)</span>
                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq-local</span> org-superstar-headline-bullets-list -org-superstar-headline-bullets-list
                              org-superstar-remove-leading-stars -org-superstar-remove-leading-stars<span class="org-rainbow-delimiters-depth-3">)</span>
                  <span class="org-rainbow-delimiters-depth-3">(</span>org-superstar-restart<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>


<figure id="orgbc5a394">
<img src="https://tecosaur.com/lfs/emacs-config/screenshots/writeroom-and-org.png" alt="Writeroom applied to an Org file" class="invertible">

</figure>
</div>
</div>
<div id="outline-container-xkcd" class="outline-3">
<h3 id="xkcd"><span class="section-number-3">4.22</span> xkcd<a aria-hidden="true" href="#xkcd">#</a> </h3>
<div class="outline-text-3" id="text-4-22">
<p>
We want to set this up so it loads nicely in <a href="#extra-links">Extra links</a>.
</p>
<details id='xkcd,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#xkcd,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">use-package!</span> xkcd
  <span class="org-builtin">:commands</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">xkcd-get-json</span>
             xkcd-download xkcd-get
             <span class="org-comment-delimiter">;; </span><span class="org-comment">now for funcs from my extension of this pkg</span>
             +xkcd-find-and-copy +xkcd-find-and-view
             +xkcd-fetch-info +xkcd-select<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-builtin">:config</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">xkcd-cache-dir</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">expand-file-name</span> <span class="org-string">"xkcd/"</span> <span class="org-variable-name">doom-cache-dir</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-variable-name">xkcd-cache-latest</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">concat</span> <span class="org-variable-name">xkcd-cache-dir</span> <span class="org-string">"latest"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">file-exists-p</span> <span class="org-variable-name">xkcd-cache-dir</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">make-directory</span> <span class="org-variable-name">xkcd-cache-dir</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">after!</span> evil-snipe
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">evil-snipe-disabled-modes</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">xkcd-mode</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-builtin">:general</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:states</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">normal</span>
            <span class="org-builtin">:keymaps</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">xkcd-mode-map</span>
            <span class="org-string">"&lt;right&gt;"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">xkcd-next</span>
            <span class="org-string">"n"</span>       <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">xkcd-next</span> <span class="org-comment-delimiter">; </span><span class="org-comment">evil-ish</span>
            <span class="org-string">"&lt;left&gt;"</span>  <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">xkcd-prev</span>
            <span class="org-string">"N"</span>       <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">xkcd-prev</span> <span class="org-comment-delimiter">; </span><span class="org-comment">evil-ish</span>
            <span class="org-string">"r"</span>       <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">xkcd-rand</span>
            <span class="org-string">"a"</span>       <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">xkcd-rand</span> <span class="org-comment-delimiter">; </span><span class="org-comment">because image-rotate can interfere</span>
            <span class="org-string">"t"</span>       <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">xkcd-alt-text</span>
            <span class="org-string">"q"</span>       <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">xkcd-kill-buffer</span>
            <span class="org-string">"o"</span>       <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">xkcd-open-browser</span>
            <span class="org-string">"e"</span>       <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">xkcd-open-explanation-browser</span>
            <span class="org-comment-delimiter">;; </span><span class="org-comment">extras</span>
            <span class="org-string">"s"</span>       <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">+xkcd-find-and-view</span>
            <span class="org-string">"/"</span>       <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">+xkcd-find-and-view</span>
            <span class="org-string">"y"</span>       <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">+xkcd-copy</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Let&rsquo;s also extend the functionality a whole bunch.
</p>
<details id='xkcd,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#xkcd,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> xkcd
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">require</span> <span class="org-highlight-quoted-quote">'</span><span class="org-constant">emacsql-sqlite</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-select</span> <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-doc">"Prompt the user for an xkcd using `</span><span class="org-doc"><span class="org-constant">ivy-read</span></span><span class="org-doc">' and `</span><span class="org-doc"><span class="org-constant">+xkcd-select-format</span></span><span class="org-doc">'. Return the xkcd number or nil"</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-1">(</span>prompt-lines
           <span class="org-rainbow-delimiters-depth-2">(</span>-dummy <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">maphash</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-2">(</span>key xkcd-info<span class="org-rainbow-delimiters-depth-2">)</span>
                              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">push</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">+xkcd-select-format</span> xkcd-info<span class="org-rainbow-delimiters-depth-3">)</span> prompt-lines<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                            <span class="org-variable-name">+xkcd-stored-info</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>num <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">ivy-read</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"xkcd (%s): "</span> <span class="org-variable-name">xkcd-latest</span><span class="org-rainbow-delimiters-depth-1">)</span> prompt-lines<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">equal</span> <span class="org-string">""</span> num<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-variable-name">xkcd-latest</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">string-to-number</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">replace-regexp-in-string</span> <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[0-9]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">.*"</span> <span class="org-string">"\\1"</span> num<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-select-format</span> <span class="org-rainbow-delimiters-depth-3">(</span>xkcd-info<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Creates each ivy-read line from an xkcd info plist. Must start with the xkcd number"</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-string">"%-4s  %-30s %s"</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">propertize</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">number-to-string</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> xkcd-info <span class="org-builtin">:num</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                        <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">counsel-key-binding</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> xkcd-info <span class="org-builtin">:title</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">propertize</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> xkcd-info <span class="org-builtin">:alt</span><span class="org-rainbow-delimiters-depth-2">)</span>
                        <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>variable-pitch <span class="org-variable-name">font-lock-comment-face</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-fetch-info</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">&amp;optional</span> num<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Fetch the parsed json info for comic NUM. Fetches latest when omitted or 0"</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">require</span> <span class="org-highlight-quoted-quote">'</span><span class="org-constant">xkcd</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">not</span> num<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">=</span> num <span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">+xkcd-check-latest</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> num <span class="org-variable-name">xkcd-latest</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>res <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">gethash</span> num <span class="org-variable-name">+xkcd-stored-info</span><span class="org-rainbow-delimiters-depth-1">)</span>
                   <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">puthash</span> num <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">+xkcd-db-read</span> num<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-variable-name">+xkcd-stored-info</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">unless</span> res
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">+xkcd-db-write</span>
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>url <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-string">"https://xkcd.com/%d/info.0.json"</span> num<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                <span class="org-rainbow-delimiters-depth-2">(</span>json-assoc
                 <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">gethash</span> num <span class="org-variable-name">+xkcd-stored-info</span><span class="org-rainbow-delimiters-depth-1">)</span>
                     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">gethash</span> num <span class="org-variable-name">+xkcd-stored-info</span><span class="org-rainbow-delimiters-depth-1">)</span>
                   <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">json-read-from-string</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">xkcd-get-json</span> url num<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
           json-assoc<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> res <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">+xkcd-db-read</span> num<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      res<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-comment-delimiter">;; </span><span class="org-comment">since we've done this, we may as well go one little step further</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-find-and-copy</span> <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-doc">"Prompt for an xkcd using `</span><span class="org-doc"><span class="org-constant">+xkcd-select</span></span><span class="org-doc">' and copy url to clipboard"</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">interactive</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">+xkcd-copy</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">+xkcd-select</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-copy</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">&amp;optional</span> num<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Copy a url to xkcd NUM to the clipboard"</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">interactive</span> <span class="org-string">"i"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>num <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> num <span class="org-variable-name">xkcd-cur</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">gui-select-text</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"https://xkcd.com/%d"</span> num<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">message</span> <span class="org-string">"xkcd.com/%d copied to clipboard"</span> num<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-find-and-view</span> <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-doc">"Prompt for an xkcd using `</span><span class="org-doc"><span class="org-constant">+xkcd-select</span></span><span class="org-doc">' and view it"</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">interactive</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">xkcd-get</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">+xkcd-select</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">switch-to-buffer</span> <span class="org-string">"*xkcd*"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">+xkcd-latest-max-age</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">*</span> <span class="org-highlight-numbers-number">60</span> <span class="org-highlight-numbers-number">60</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">1 hour</span>
    <span class="org-doc">"Time after which xkcd-latest should be refreshed, in seconds"</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-comment-delimiter">;; </span><span class="org-comment">initialise `</span><span class="org-comment"><span class="org-constant">xkcd-latest</span></span><span class="org-comment">' and `</span><span class="org-comment"><span class="org-constant">+xkcd-stored-info</span></span><span class="org-comment">' with latest xkcd</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">add-transient-hook!</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">+xkcd-select</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">require</span> <span class="org-highlight-quoted-quote">'</span><span class="org-constant">xkcd</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">+xkcd-fetch-info</span> <span class="org-variable-name">xkcd-latest</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">+xkcd-stored-info</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">+xkcd-db-read-all</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">add-transient-hook!</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">+xkcd-fetch-info</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">xkcd-update-latest</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-check-latest</span> <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-doc">"Use value in `</span><span class="org-doc"><span class="org-constant">xkcd-cache-latest</span></span><span class="org-doc">' as long as it isn't older thabn `</span><span class="org-doc"><span class="org-constant">+xkcd-latest-max-age</span></span><span class="org-doc">'"</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">file-exists-p</span> <span class="org-variable-name">xkcd-cache-latest</span><span class="org-rainbow-delimiters-depth-2">)</span>
                 <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">&lt;</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">-</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">time-to-seconds</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">current-time</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">time-to-seconds</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">file-attribute-modification-time</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">file-attributes</span> <span class="org-variable-name">xkcd-cache-latest</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-variable-name">+xkcd-latest-max-age</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>out <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">xkcd-get-json</span> <span class="org-string">"http://xkcd.com/info.0.json"</span> <span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
             <span class="org-rainbow-delimiters-depth-3">(</span>json-assoc <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">json-read-from-string</span> out<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
             <span class="org-rainbow-delimiters-depth-3">(</span>latest <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">cdr</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">assoc</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">num</span> json-assoc<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">/=</span> <span class="org-variable-name">xkcd-latest</span> latest<span class="org-rainbow-delimiters-depth-3">)</span>
          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">+xkcd-db-write</span> json-assoc<span class="org-rainbow-delimiters-depth-3">)</span>
          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">with-current-buffer</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">find-file</span> <span class="org-variable-name">xkcd-cache-latest</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">xkcd-latest</span> latest<span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">erase-buffer</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">insert</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">number-to-string</span> latest<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">save-buffer</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">kill-buffer</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">current-buffer</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">shell-command</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"touch %s"</span> <span class="org-variable-name">xkcd-cache-latest</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">+xkcd-stored-info</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">make-hash-table</span> <span class="org-builtin">:test</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">eql</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Basic info on downloaded xkcds, in the form of a hashtable"</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defadvice!</span> xkcd-get-json--and-cache <span class="org-rainbow-delimiters-depth-3">(</span>url <span class="org-type">&amp;optional</span> num<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Fetch the Json coming from URL.</span>
<span class="org-doc">If the file NUM.json exists, use it instead.</span>
<span class="org-doc">If NUM is 0, always download from URL.</span>
<span class="org-doc">The return value is a string."</span>
    <span class="org-builtin">:override</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">xkcd-get-json</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>file <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-string">"%s%d.json"</span> <span class="org-variable-name">xkcd-cache-dir</span> num<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>cached <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">file-exists-p</span> file<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">not</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">eq</span> num <span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>out <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">with-current-buffer</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">if</span> cached
                                         <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">find-file</span> file<span class="org-rainbow-delimiters-depth-2">)</span>
                                       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">url-retrieve-synchronously</span> url<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">goto-char</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">point-min</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">unless</span> cached <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">re-search-forward</span> <span class="org-string">"^$"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">prog1</span>
                      <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">buffer-substring-no-properties</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">point</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">point-max</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">kill-buffer</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">current-buffer</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">or</span> cached <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">eq</span> num <span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">xkcd-cache-json</span> num out<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      out<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defadvice!</span> +xkcd-get <span class="org-rainbow-delimiters-depth-3">(</span>num<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Get the xkcd number NUM."</span>
    <span class="org-builtin">:override</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">xkcd-get</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">interactive</span> <span class="org-string">"nEnter comic number: "</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">xkcd-update-latest</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">get-buffer-create</span> <span class="org-string">"*xkcd*"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">switch-to-buffer</span> <span class="org-string">"*xkcd*"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">xkcd-mode</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-variable-name">buffer-read-only</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">erase-buffer</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">xkcd-cur</span> num<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>xkcd-data <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">+xkcd-fetch-info</span> num<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
             <span class="org-rainbow-delimiters-depth-3">(</span>num <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> xkcd-data <span class="org-builtin">:num</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
             <span class="org-rainbow-delimiters-depth-3">(</span>img <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> xkcd-data <span class="org-builtin">:img</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
             <span class="org-rainbow-delimiters-depth-3">(</span>safe-title <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> xkcd-data <span class="org-builtin">:safe-title</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
             <span class="org-rainbow-delimiters-depth-3">(</span>alt <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> xkcd-data <span class="org-builtin">:alt</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
             title file<span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">message</span> <span class="org-string">"Getting comic..."</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> file <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">xkcd-download</span> img num<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> title <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-string">"%d: %s"</span> num safe-title<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">insert</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">propertize</span> title
                            <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">outline-1</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">center-line</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">insert</span> <span class="org-string">"\n"</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">xkcd-insert-image</span> file num<span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">eq</span> <span class="org-variable-name">xkcd-cur</span> <span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-3">)</span>
            <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">xkcd-cur</span> num<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">xkcd-alt</span> alt<span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">message</span> <span class="org-string">"%s"</span> title<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defconst</span> <span class="org-variable-name">+xkcd-db--sqlite-available-p</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">with-demoted-errors</span> <span class="org-string">"+org-xkcd initialization: %S"</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">emacsql-sqlite-ensure-binary</span><span class="org-rainbow-delimiters-depth-1">)</span>
      t<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">+xkcd-db--connection</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">make-hash-table</span> <span class="org-builtin">:test</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">equal</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Database connection to +org-xkcd database."</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-db--get</span> <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-doc">"Return the sqlite db file."</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">expand-file-name</span> <span class="org-string">"xkcd.db"</span> <span class="org-variable-name">xkcd-cache-dir</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-db--get-connection</span> <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-doc">"Return the database connection, if any."</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">gethash</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">file-truename</span> <span class="org-variable-name">xkcd-cache-dir</span><span class="org-rainbow-delimiters-depth-1">)</span>
             <span class="org-variable-name">+xkcd-db--connection</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defconst</span> <span class="org-variable-name">+xkcd-db--table-schema</span>
    <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>xkcds
       <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-rainbow-delimiters-depth-3">(</span>num integer <span class="org-builtin">:unique</span> <span class="org-builtin">:primary-key</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>year        <span class="org-builtin">:not-null</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>month       <span class="org-builtin">:not-null</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>link        <span class="org-builtin">:not-null</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>news        <span class="org-builtin">:not-null</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>safe_title  <span class="org-builtin">:not-null</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>title       <span class="org-builtin">:not-null</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>transcript  <span class="org-builtin">:not-null</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>alt         <span class="org-builtin">:not-null</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>img         <span class="org-builtin">:not-null</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-db--init</span> <span class="org-rainbow-delimiters-depth-3">(</span>db<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Initialize database DB with the correct schema and user version."</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">emacsql-with-transaction</span> db
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">pcase-dolist</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-highlight-quoted-quote">`</span><span class="org-rainbow-delimiters-depth-3">(</span>,table . ,schema<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-variable-name">+xkcd-db--table-schema</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">emacsql</span> db <span class="org-rainbow-delimiters-depth-3">[</span><span class="org-builtin">:create-table</span> $i1 $S2<span class="org-rainbow-delimiters-depth-3">]</span> table schema<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-db</span> <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-doc">"Entrypoint to the +org-xkcd sqlite database.</span>
<span class="org-doc">Initializes and stores the database, and the database connection.</span>
<span class="org-doc">Performs a database upgrade when required."</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">+xkcd-db--get-connection</span><span class="org-rainbow-delimiters-depth-2">)</span>
                 <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">emacsql-live-p</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">+xkcd-db--get-connection</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>db-file <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">+xkcd-db--get</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
             <span class="org-rainbow-delimiters-depth-3">(</span>init-db <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">not</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">file-exists-p</span> db-file<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">make-directory</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">file-name-directory</span> db-file<span class="org-rainbow-delimiters-depth-3">)</span> t<span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>conn <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">emacsql-sqlite</span> db-file<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">set-process-query-on-exit-flag</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">emacsql-process</span> conn<span class="org-rainbow-delimiters-depth-1">)</span> nil<span class="org-rainbow-delimiters-depth-3">)</span>
          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">puthash</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">file-truename</span> <span class="org-variable-name">xkcd-cache-dir</span><span class="org-rainbow-delimiters-depth-1">)</span>
                   conn
                   <span class="org-variable-name">+xkcd-db--connection</span><span class="org-rainbow-delimiters-depth-3">)</span>
          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> init-db
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">+xkcd-db--init</span> conn<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">+xkcd-db--get-connection</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-db-query</span> <span class="org-rainbow-delimiters-depth-3">(</span>sql <span class="org-type">&amp;rest</span> args<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Run SQL query on +org-xkcd database with ARGS.</span>
<span class="org-doc">SQL can be either the emacsql vector representation, or a string."</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span>  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">stringp</span> sql<span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">emacsql</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">+xkcd-db</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">apply</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">format</span> sql args<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">apply</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">emacsql</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">+xkcd-db</span><span class="org-rainbow-delimiters-depth-2">)</span> sql args<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-db-read</span> <span class="org-rainbow-delimiters-depth-3">(</span>num<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when-let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>res
                <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">car</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">+xkcd-db-query</span> <span class="org-rainbow-delimiters-depth-2">[</span><span class="org-builtin">:select</span> * <span class="org-builtin">:from</span> xkcds
                                      <span class="org-builtin">:where</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">=</span> num $s1<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">]</span>
                                     num
                                     <span class="org-builtin">:limit</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">+xkcd-db-list-to-plist</span> res<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-db-read-all</span> <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>xkcd-table <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">make-hash-table</span> <span class="org-builtin">:test</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">eql</span> <span class="org-builtin">:size</span> <span class="org-highlight-numbers-number">4000</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">mapcar</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-3">(</span>xkcd-info-list<span class="org-rainbow-delimiters-depth-3">)</span>
                <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">puthash</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">car</span> xkcd-info-list<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">+xkcd-db-list-to-plist</span> xkcd-info-list<span class="org-rainbow-delimiters-depth-1">)</span> xkcd-table<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">+xkcd-db-query</span> <span class="org-rainbow-delimiters-depth-3">[</span><span class="org-builtin">:select</span> * <span class="org-builtin">:from</span> xkcds<span class="org-rainbow-delimiters-depth-3">]</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      xkcd-table<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-db-list-to-plist</span> <span class="org-rainbow-delimiters-depth-3">(</span>xkcd-datalist<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-highlight-quoted-quote">`</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:num</span> ,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">0</span> xkcd-datalist<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-builtin">:year</span> ,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">1</span> xkcd-datalist<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-builtin">:month</span> ,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">2</span> xkcd-datalist<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-builtin">:link</span> ,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">3</span> xkcd-datalist<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-builtin">:news</span> ,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">4</span> xkcd-datalist<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-builtin">:safe-title</span> ,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">5</span> xkcd-datalist<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-builtin">:title</span> ,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">6</span> xkcd-datalist<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-builtin">:transcript</span> ,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">7</span> xkcd-datalist<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-builtin">:alt</span> ,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">8</span> xkcd-datalist<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-builtin">:img</span> ,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">9</span> xkcd-datalist<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+xkcd-db-write</span> <span class="org-rainbow-delimiters-depth-3">(</span>data<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">+xkcd-db-query</span> <span class="org-rainbow-delimiters-depth-1">[</span><span class="org-builtin">:insert-into</span> xkcds
                     <span class="org-builtin">:values</span> $v1<span class="org-rainbow-delimiters-depth-1">]</span>
                    <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">list</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">vector</span>
                           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">cdr</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">assoc</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">num</span>        data<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">cdr</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">assoc</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">year</span>       data<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">cdr</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">assoc</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">month</span>      data<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">cdr</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">assoc</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">link</span>       data<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">cdr</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">assoc</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">news</span>       data<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">cdr</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">assoc</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">safe_title</span> data<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">cdr</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">assoc</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">title</span>      data<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">cdr</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">assoc</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">transcript</span> data<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">cdr</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">assoc</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">alt</span>        data<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">cdr</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">assoc</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">img</span>        data<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                           <span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-yasnippet" class="outline-3">
<h3 id="yasnippet"><span class="section-number-3">4.23</span> <span class='acr'>YAS</span>nippet<a aria-hidden="true" href="#yasnippet">#</a> </h3>
<div class="outline-text-3" id="text-4-23">
<p>
Nested snippets are good, enable that.
</p>
<details id='yasnippet,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#yasnippet,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">yas-triggers-in-field</span> t<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-applications" class="outline-2">
<h2 id="applications"><span class="section-number-2">5</span> Applications<a aria-hidden="true" href="#applications">#</a> </h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-ebooks" class="outline-3">
<h3 id="ebooks"><span class="section-number-3">5.1</span> Ebooks<a aria-hidden="true" href="#ebooks">#</a> </h3>
<div class="outline-text-3" id="text-5-1">
<p>
<img class='invertible' src='https://imgs.xkcd.com/comics/kindle.png' title="I'm happy with my Kindle 2 so far, but if they cut off the free Wikipedia browsing, I plan to show up drunk on Jeff Bezos's lawn and refuse to leave." alt='Kindle'>
<kbd>calibredb</kbd> lets us use calibre through Emacs, because who wouldn&rsquo;t want to use
something through Emacs?
</p>
<details id='ebooks,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#ebooks,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">use-package!</span> calibredb
  <span class="org-builtin">:commands</span> calibredb
  <span class="org-builtin">:config</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> calibredb-root-dir <span class="org-string">"~/Desktop/TEC/Other/Ebooks"</span>
        calibredb-db-dir <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">expand-file-name</span> <span class="org-string">"metadata.db"</span> calibredb-root-dir<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">map!</span> <span class="org-builtin">:map</span> calibredb-show-mode-map
        <span class="org-builtin">:ne</span> <span class="org-string">"?"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-entry-dispatch</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"o"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-find-file</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"O"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-find-file-other-frame</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"V"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-open-file-with-default-tool</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"s"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-set-metadata-dispatch</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"e"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-export-dispatch</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"q"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-entry-quit</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"."</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-open-dired</span>
        <span class="org-builtin">:ne</span> <span class="org-rainbow-delimiters-depth-3">[</span>tab<span class="org-rainbow-delimiters-depth-3">]</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-toggle-view-at-point</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"M-t"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-set-metadata--tags</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"M-a"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-set-metadata--author_sort</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"M-A"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-set-metadata--authors</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"M-T"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-set-metadata--title</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"M-c"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-set-metadata--comments</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">map!</span> <span class="org-builtin">:map</span> calibredb-search-mode-map
        <span class="org-builtin">:ne</span> <span class="org-rainbow-delimiters-depth-3">[</span>mouse-3<span class="org-rainbow-delimiters-depth-3">]</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-search-mouse</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"RET"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-find-file</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"?"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-dispatch</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"a"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-add</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"A"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-add-dir</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"c"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-clone</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"d"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-remove</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"D"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-remove-marked-items</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"j"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-next-entry</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"k"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-previous-entry</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"l"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-virtual-library-list</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"L"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-library-list</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"n"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-virtual-library-next</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"N"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-library-next</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"p"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-virtual-library-previous</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"P"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-library-previous</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"s"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-set-metadata-dispatch</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"S"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-switch-library</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"o"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-find-file</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"O"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-find-file-other-frame</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"v"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-view</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"V"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-open-file-with-default-tool</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"."</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-open-dired</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"b"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-catalog-bib-dispatch</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"e"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-export-dispatch</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"r"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-search-refresh-and-clear-filter</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"R"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-search-clear-filter</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"q"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-search-quit</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"m"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-mark-and-forward</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"f"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-toggle-favorite-at-point</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"x"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-toggle-archive-at-point</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"h"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-toggle-highlight-at-point</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"u"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-unmark-and-forward</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"i"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-edit-annotation</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"DEL"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-unmark-and-backward</span>
        <span class="org-builtin">:ne</span> <span class="org-rainbow-delimiters-depth-3">[</span>backtab<span class="org-rainbow-delimiters-depth-3">]</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-toggle-view</span>
        <span class="org-builtin">:ne</span> <span class="org-rainbow-delimiters-depth-3">[</span>tab<span class="org-rainbow-delimiters-depth-3">]</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-toggle-view-at-point</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"M-n"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-show-next-entry</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"M-p"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-show-previous-entry</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"/"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-search-live-filter</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"M-t"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-set-metadata--tags</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"M-a"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-set-metadata--author_sort</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"M-A"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-set-metadata--authors</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"M-T"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-set-metadata--title</span>
        <span class="org-builtin">:ne</span> <span class="org-string">"M-c"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">calibredb-set-metadata--comments</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Then, to actually read the ebooks we use <kbd>nov</kbd>.
</p>


<figure id="orgafccb1c">
<img src="https://tecosaur.com/lfs/emacs-config/screenshots/nov.png" alt="Excerpt of the GNU Emacs manual viewed through nov.el" class="invertible">

</figure>

<details id='ebooks,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#ebooks,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">use-package!</span> nov
  <span class="org-builtin">:mode</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"\\.epub\\'"</span> . nov-mode<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-builtin">:config</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">map!</span> <span class="org-builtin">:map</span> nov-mode-map
        <span class="org-builtin">:n</span> <span class="org-string">"RET"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">nov-scroll-up</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">doom-modeline-segment--nov-info</span> <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">concat</span>
     <span class="org-string">" "</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">propertize</span>
      <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">cdr</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">assoc</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">creator</span> nov-metadata<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
      <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">doom-modeline-project-parent-dir</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-string">" "</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">cdr</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">assoc</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">title</span> nov-metadata<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-string">" "</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">propertize</span>
      <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"%d/%d"</span>
              <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">1+</span> nov-documents-index<span class="org-rainbow-delimiters-depth-3">)</span>
              <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">length</span> nov-documents<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
      <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">doom-modeline-info</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">advice-add</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">nov-render-title</span> <span class="org-builtin">:override</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">ignore</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+nov-mode-setup</span> <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">face-remap-add-relative</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">variable-pitch</span>
                             <span class="org-builtin">:family</span> <span class="org-string">"Merriweather"</span>
                             <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.4</span>
                             <span class="org-builtin">:width</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">semi-expanded</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">face-remap-add-relative</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">default</span> <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.3</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq-local</span> <span class="org-variable-name">line-spacing</span> <span class="org-highlight-numbers-number">0.2</span>
                <span class="org-variable-name">next-screen-context-lines</span> <span class="org-highlight-numbers-number">4</span>
                shr-use-colors nil<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">require</span> <span class="org-highlight-quoted-quote">'</span><span class="org-constant">visual-fill-column</span> nil t<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq-local</span> visual-fill-column-center-text t
                visual-fill-column-width <span class="org-highlight-numbers-number">80</span>
                nov-text-width <span class="org-highlight-numbers-number">80</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">visual-fill-column-mode</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-variable-name">hl-line-mode</span> <span class="org-highlight-numbers-number">-1</span><span class="org-rainbow-delimiters-depth-3">)</span>

    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">+lookup-definition-functions</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">+lookup/dictionary-definition</span><span class="org-rainbow-delimiters-depth-3">)</span>

    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq-local</span> <span class="org-variable-name">mode-line-format</span>
                <span class="org-highlight-quoted-quote">`</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:eval</span>
                   <span class="org-rainbow-delimiters-depth-3">(</span>doom-modeline-segment--workspace-name<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:eval</span>
                   <span class="org-rainbow-delimiters-depth-3">(</span>doom-modeline-segment--window-number<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:eval</span>
                   <span class="org-rainbow-delimiters-depth-3">(</span>doom-modeline-segment--nov-info<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                  ,<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">propertize</span>
                    <span class="org-string">" %P "</span>
                    <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">doom-modeline-buffer-minor-mode</span><span class="org-rainbow-delimiters-depth-2">)</span>
                  ,<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">propertize</span>
                    <span class="org-string">" "</span>
                    <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">(</span>doom-modeline--active<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">mode-line</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">mode-line-inactive</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">display</span> <span class="org-highlight-quoted-quote">`</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>space
                                <span class="org-builtin">:align-to</span>
                                <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">-</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">+</span> right right-fringe right-margin<span class="org-rainbow-delimiters-depth-3">)</span>
                                   ,<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">*</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>width <span class="org-rainbow-delimiters-depth-1">(</span>doom-modeline--font-width<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                                         <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">=</span> width <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-3">)</span>
                                             <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">/</span> width <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">frame-char-width</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-highlight-numbers-number">1.0</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">string-width</span>
                                        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format-mode-line</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">cons</span> <span class="org-string">""</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-builtin">:eval</span> <span class="org-rainbow-delimiters-depth-2">(</span>doom-modeline-segment--major-mode<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:eval</span> <span class="org-rainbow-delimiters-depth-3">(</span>doom-modeline-segment--major-mode<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">nov-mode-hook</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">+nov-mode-setup</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-irc" class="outline-3">
<h3 id="irc"><span class="section-number-3">5.2</span> <span class='acr'>IRC</span><a aria-hidden="true" href="#irc">#</a> </h3>
<div class="outline-text-3" id="text-5-2">
<p>
<kbd>circe</kbd> is a client for <span class='acr'>IRC</span> in Emacs (hey, isn&rsquo;t that a nice project
name+acronym), and a greek enchantress who turned humans into animals.
</p>

<p>
Let&rsquo;s use the former to chat to <del>recluses</del> discerning individuals online.
</p>

<p>
<img class='invertible' src='https://imgs.xkcd.com/comics/team_chat.png' title="2078: He announces that he's finally making the jump from screen+irssi to tmux+weechat." alt='Team Chat'>
</p>

<p>
Before we start seeing and sending messages, we need to authenticate with our
<span class='acr'>IRC</span> servers. The circe manual provided a snippet for putting some of the auth
details in <kbd>.authinfo.gpg</kbd> &#x2014; but I think we should go further than that: have
the entire server info in our authinfo.
</p>

<p>
First, a reasonable format by which we can specify:
</p>
<ul class="org-ul">
<li>server</li>
<li>port</li>
<li><span class='acr'>SASL</span> username</li>
<li><span class='acr'>SASL</span> password</li>
<li>channels to join</li>
</ul>

<p>
We can have these stored like so
</p>
<details id='irc,code--1' class='code' open><summary><span class='lang'>authinfo</span></summary>
    <div class='gutter'>
    <a href='#irc,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-authinfo"><span class="org-variable-name">machine</span> <span class="org-builtin">chat.freenode.net</span> <span class="org-comment-delimiter">login</span> <span class="org-keyword">USERNAME</span> <span class="org-comment-delimiter">password</span> <span class="org-doc">PASSWORD</span> <span class="org-comment-delimiter">port</span> <span class="org-type">PORT</span> <span class="org-constant">for</span> irc <span class="org-constant">channels</span> emacs,org-mode
</pre>
</div>
    </details>

<p>
The <code>for irc</code> bit is used so we can uniquely identify all <span class='acr'>IRC</span> auth info. By
omitting the <kbd>#</kbd> in channel names we can have a list of channels comma-separated
(no space!) which the secrets <span class='acr'>API</span> will return as a single string.
</p>

<details id='irc-authinfo-reader' class='code' open><summary class='named'><span class='name'>irc-authinfo-reader</span><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#irc-authinfo-reader'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">auth-server-pass</span> <span class="org-rainbow-delimiters-depth-2">(</span>server<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if-let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>secret <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">car</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">auth-source-search</span> <span class="org-builtin">:host</span> server<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-builtin">:secret</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">functionp</span> secret<span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">funcall</span> secret<span class="org-rainbow-delimiters-depth-1">)</span> secret<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">error</span> <span class="org-string">"Could not fetch password for host %s"</span> server<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">register-irc-auths</span> <span class="org-rainbow-delimiters-depth-2">()</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">require</span> <span class="org-highlight-quoted-quote">'</span><span class="org-constant">circe</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">require</span> <span class="org-highlight-quoted-quote">'</span><span class="org-constant">dash</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>accounts <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">-filter</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-1">(</span>a<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">string=</span> <span class="org-string">"irc"</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> a <span class="org-builtin">:for</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">auth-source-search</span> <span class="org-builtin">:require</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-builtin">:for</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-builtin">:max</span> <span class="org-highlight-numbers-number">10</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">appendq!</span> circe-network-options
              <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">mapcar</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-3">(</span>entry<span class="org-rainbow-delimiters-depth-3">)</span>
                        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>host <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> entry <span class="org-builtin">:host</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                               <span class="org-rainbow-delimiters-depth-2">(</span>label <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> entry <span class="org-builtin">:label</span><span class="org-rainbow-delimiters-depth-1">)</span> host<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                               <span class="org-rainbow-delimiters-depth-2">(</span>_ports <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">mapcar</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">string-to-number</span>
                                               <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">s-split</span> <span class="org-string">","</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> entry <span class="org-builtin">:port</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                               <span class="org-rainbow-delimiters-depth-2">(</span>port <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">=</span> <span class="org-highlight-numbers-number">1</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">length</span> _ports<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">car</span> _ports<span class="org-rainbow-delimiters-depth-1">)</span> _ports<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                               <span class="org-rainbow-delimiters-depth-2">(</span>user <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> entry <span class="org-builtin">:user</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                               <span class="org-rainbow-delimiters-depth-2">(</span>nick <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> entry <span class="org-builtin">:nick</span><span class="org-rainbow-delimiters-depth-1">)</span> user<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                               <span class="org-rainbow-delimiters-depth-2">(</span>channels <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">mapcar</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-2">(</span>c<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">concat</span> <span class="org-string">"#"</span> c<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                                                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">s-split</span> <span class="org-string">","</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> entry <span class="org-builtin">:channels</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                          <span class="org-highlight-quoted-quote">`</span><span class="org-rainbow-delimiters-depth-1">(</span>,label
                            <span class="org-builtin">:host</span> ,host <span class="org-builtin">:port</span> ,port <span class="org-builtin">:nick</span> ,nick
                            <span class="org-builtin">:sasl-username</span> ,user <span class="org-builtin">:sasl-password</span> auth-server-pass
                            <span class="org-builtin">:channels</span> ,channels<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                      accounts<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
We&rsquo;ll just call <code>(register-irc-auths)</code> on a hook when we start Circe up.
</p>

<p>
Now we&rsquo;re ready to go, let&rsquo;s actually wire-up Circe, with one or two
configuration tweaks.
</p>
<details id='irc,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#irc,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> circe
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq-default</span> circe-use-tls t<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> circe-notifications-alert-icon <span class="org-string">"/usr/share/icons/breeze/actions/24/network-connect.svg"</span>
        lui-logging-directory <span class="org-string">"~/.emacs.d/.local/etc/irc"</span>
        lui-logging-file-format <span class="org-string">"{buffer}/%Y/%m-%d.txt"</span>
        circe-format-self-say <span class="org-string">"{nick:+13s} &#9475; {body}"</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">custom-set-faces!</span>
    <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span>circe-my-message-face <span class="org-builtin">:weight</span> unspecified<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span>enable-lui-logging-globally<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">enable-circe-display-images</span><span class="org-rainbow-delimiters-depth-2">)</span>

  &lt;&lt;org-emph-to-irc&gt;&gt;

  &lt;&lt;circe-emojis&gt;&gt;
  &lt;&lt;circe-emoji-alists&gt;&gt;

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">named-circe-prompt</span> <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>lui-set-prompt
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">propertize</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-string">"%13s &gt; "</span> <span class="org-rainbow-delimiters-depth-1">(</span>circe-nick<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                         <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">circe-prompt-face</span><span class="org-rainbow-delimiters-depth-2">)</span>
             <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">circe-chat-mode-hook</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">named-circe-prompt</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">appendq!</span> <span class="org-variable-name">all-the-icons-mode-icon-alist</span>
            <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>circe-channel-mode all-the-icons-material <span class="org-string">"message"</span> <span class="org-builtin">:face</span> all-the-icons-lblue<span class="org-rainbow-delimiters-depth-1">)</span>
              <span class="org-rainbow-delimiters-depth-1">(</span>circe-server-mode all-the-icons-material <span class="org-string">"chat_bubble_outline"</span> <span class="org-builtin">:face</span> all-the-icons-purple<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

&lt;&lt;irc-authinfo-reader&gt;&gt;

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">add-transient-hook!</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">=irc</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">register-irc-auths</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>

<div id="outline-container-org-style-emphasis" class="outline-4">
<h4 id="org-style-emphasis"><span class="section-number-4">5.2.1</span> Org-style emphasis<a aria-hidden="true" href="#org-style-emphasis">#</a> </h4>
<div class="outline-text-4" id="text-5-2-1">
<p>
Let&rsquo;s do our <b>bold</b>, <i>italic</i>, and <span class="underline">underline</span> in org-syntax, using <span class='acr'>IRC</span> control charachters
</p>
<details id='org-emph-irc' class='code' open><summary class='named'><span class='name'>org-emph-to-irc</span><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#org-emph-irc'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">lui-org-to-irc</span> <span class="org-rainbow-delimiters-depth-2">()</span>
  <span class="org-doc">"Examine a buffer with simple org-mode formatting, and converts the empasis:</span>
<span class="org-doc">*bold*, /italic/, and _underline_ to IRC semi-standard escape codes.</span>
<span class="org-doc">=code= is converted to inverse (highlighted) text."</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">goto-char</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">point-min</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">while</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">re-search-forward</span> <span class="org-string">"\\_&lt;</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?1:</span></span><span class="org-string">[*/_=]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?2:</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">[:space:]]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">.*?[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">[:space:]]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\1\\_&gt;"</span> nil t<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">replace-match</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">pcase</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">match-string</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-3">)</span>
               <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"*"</span> <span class="org-string">"&#2;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
               <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"/"</span> <span class="org-string">"&#29;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
               <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"_"</span> <span class="org-string">"&#31;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
               <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"="</span> <span class="org-string">"&#22;"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
             <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">match-string</span> <span class="org-highlight-numbers-number">2</span><span class="org-rainbow-delimiters-depth-2">)</span>
             <span class="org-string">"&#15;"</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-warning">nil nil</span><span class="org-warning"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-warning"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-warning"><span class="org-rainbow-delimiters-depth-1">)</span></span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">lui-pre-input-hook</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">lui-org-to-irc</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-emojis" class="outline-4">
<h4 id="emojis"><span class="section-number-4">5.2.2</span> Emojis<a aria-hidden="true" href="#emojis">#</a> </h4>
<div class="outline-text-4" id="text-5-2-2">
<p>
Let&rsquo;s setup Circe to use some emojis
</p>
<details id='circe-emojis' class='code' open><summary class='named'><span class='name'>circe-emojis</span><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#circe-emojis'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">lui-ascii-to-emoji</span> <span class="org-rainbow-delimiters-depth-2">()</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">goto-char</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">point-min</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">while</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">re-search-forward</span> <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string"> </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?::?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">[:space:]:]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">:</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string"> </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?"</span> nil t<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">replace-match</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span>
      <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">match-string</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span>
      <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">cdr</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">assoc</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">match-string</span> <span class="org-highlight-numbers-number">2</span><span class="org-rainbow-delimiters-depth-2">)</span> lui-emojis-alist<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">concat</span> <span class="org-string">":"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">match-string</span> <span class="org-highlight-numbers-number">2</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-string">":"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
      <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">match-string</span> <span class="org-highlight-numbers-number">3</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     nil nil<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">lui-emoticon-to-emoji</span> <span class="org-rainbow-delimiters-depth-2">()</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">dolist</span> <span class="org-rainbow-delimiters-depth-3">(</span>emoticon lui-emoticons-alist<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">goto-char</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">point-min</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">while</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">re-search-forward</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">concat</span> <span class="org-string">" "</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">car</span> emoticon<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string"> </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?"</span><span class="org-rainbow-delimiters-depth-2">)</span> nil t<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">replace-match</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">concat</span> <span class="org-string">" "</span>
                             <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">cdr</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">assoc</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">cdr</span> emoticon<span class="org-rainbow-delimiters-depth-2">)</span> lui-emojis-alist<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                             <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">match-string</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define-minor-mode</span> <span class="org-function-name">lui-emojify</span>
  <span class="org-doc">"Replace :emojis: and ;) emoticons with unicode emoji chars."</span>
  <span class="org-builtin">:global</span> t
  <span class="org-builtin">:init-value</span> t
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> lui-emojify
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">add-hook!</span> lui-pre-input <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">lui-ascii-to-emoji</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">lui-emoticon-to-emoji</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">remove-hook!</span> lui-pre-input <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">lui-ascii-to-emoji</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">lui-emoticon-to-emoji</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Now, some actual emojis to use.
</p>
<details id='circe-emoji-alists' class='code' open><summary class='named'><span class='name'>circe-emoji-alists</span><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#circe-emoji-alists'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">lui-emojis-alist</span>
  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"grinning"</span>                      . <span class="org-string">"&#128512;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"smiley"</span>                        . <span class="org-string">"&#128515;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"smile"</span>                         . <span class="org-string">"&#128516;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"grin"</span>                          . <span class="org-string">"&#128513;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"laughing"</span>                      . <span class="org-string">"&#128518;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"sweat_smile"</span>                   . <span class="org-string">"&#128517;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"joy"</span>                           . <span class="org-string">"&#128514;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"rofl"</span>                          . <span class="org-string">"&#129315;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"relaxed"</span>                       . <span class="org-string">"&#9786;&#65039;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"blush"</span>                         . <span class="org-string">"&#128522;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"innocent"</span>                      . <span class="org-string">"&#128519;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"slight_smile"</span>                  . <span class="org-string">"&#128578;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"upside_down"</span>                   . <span class="org-string">"&#128579;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"wink"</span>                          . <span class="org-string">"&#128521;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"relieved"</span>                      . <span class="org-string">"&#128524;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"heart_eyes"</span>                    . <span class="org-string">"&#128525;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"yum"</span>                           . <span class="org-string">"&#128523;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"stuck_out_tongue"</span>              . <span class="org-string">"&#128539;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"stuck_out_tongue_closed_eyes"</span>  . <span class="org-string">"&#128541;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"stuck_out_tongue_wink"</span>         . <span class="org-string">"&#128540;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"zanzy"</span>                         . <span class="org-string">"&#129322;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"raised_eyebrow"</span>                . <span class="org-string">"&#129320;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"monocle"</span>                       . <span class="org-string">"&#129488;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"nerd"</span>                          . <span class="org-string">"&#129299;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"cool"</span>                          . <span class="org-string">"&#128526;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"star_struck"</span>                   . <span class="org-string">"&#129321;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"party"</span>                         . <span class="org-string">"&#129395;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"smirk"</span>                         . <span class="org-string">"&#128527;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"unamused"</span>                      . <span class="org-string">"&#128530;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"disapointed"</span>                   . <span class="org-string">"&#128542;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"pensive"</span>                       . <span class="org-string">"&#128532;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"worried"</span>                       . <span class="org-string">"&#128543;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"confused"</span>                      . <span class="org-string">"&#128533;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"slight_frown"</span>                  . <span class="org-string">"&#128577;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"frown"</span>                         . <span class="org-string">"&#9785;&#65039;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"persevere"</span>                     . <span class="org-string">"&#128547;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"confounded"</span>                    . <span class="org-string">"&#128534;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"tired"</span>                         . <span class="org-string">"&#128555;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"weary"</span>                         . <span class="org-string">"&#128553;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"pleading"</span>                      . <span class="org-string">"&#129402;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"tear"</span>                          . <span class="org-string">"&#128546;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"cry"</span>                           . <span class="org-string">"&#128546;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"sob"</span>                           . <span class="org-string">"&#128557;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"triumph"</span>                       . <span class="org-string">"&#128548;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"angry"</span>                         . <span class="org-string">"&#128544;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"rage"</span>                          . <span class="org-string">"&#128545;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"exploding_head"</span>                . <span class="org-string">"&#129327;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"flushed"</span>                       . <span class="org-string">"&#128563;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"hot"</span>                           . <span class="org-string">"&#129397;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"cold"</span>                          . <span class="org-string">"&#129398;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"scream"</span>                        . <span class="org-string">"&#128561;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"fearful"</span>                       . <span class="org-string">"&#128552;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"disapointed"</span>                   . <span class="org-string">"&#128560;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"relieved"</span>                      . <span class="org-string">"&#128549;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"sweat"</span>                         . <span class="org-string">"&#128531;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"thinking"</span>                      . <span class="org-string">"&#129300;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"shush"</span>                         . <span class="org-string">"&#129323;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"liar"</span>                          . <span class="org-string">"&#129317;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"blank_face"</span>                    . <span class="org-string">"&#128566;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"neutral"</span>                       . <span class="org-string">"&#128528;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"expressionless"</span>                . <span class="org-string">"&#128529;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"grimace"</span>                       . <span class="org-string">"&#128556;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"rolling_eyes"</span>                  . <span class="org-string">"&#128580;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"hushed"</span>                        . <span class="org-string">"&#128559;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"frowning"</span>                      . <span class="org-string">"&#128550;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"anguished"</span>                     . <span class="org-string">"&#128551;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"wow"</span>                           . <span class="org-string">"&#128558;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"astonished"</span>                    . <span class="org-string">"&#128562;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"sleeping"</span>                      . <span class="org-string">"&#128564;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"drooling"</span>                      . <span class="org-string">"&#129316;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"sleepy"</span>                        . <span class="org-string">"&#128554;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"dizzy"</span>                         . <span class="org-string">"&#128565;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"zipper_mouth"</span>                  . <span class="org-string">"&#129296;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"woozy"</span>                         . <span class="org-string">"&#129396;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"sick"</span>                          . <span class="org-string">"&#129314;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"vomiting"</span>                      . <span class="org-string">"&#129326;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"sneeze"</span>                        . <span class="org-string">"&#129319;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"mask"</span>                          . <span class="org-string">"&#128567;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"bandaged_head"</span>                 . <span class="org-string">"&#129301;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"money_face"</span>                    . <span class="org-string">"&#129297;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"cowboy"</span>                        . <span class="org-string">"&#129312;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"imp"</span>                           . <span class="org-string">"&#128520;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"ghost"</span>                         . <span class="org-string">"&#128123;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"alien"</span>                         . <span class="org-string">"&#128125;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"robot"</span>                         . <span class="org-string">"&#129302;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"clap"</span>                          . <span class="org-string">"&#128079;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"thumpup"</span>                       . <span class="org-string">"&#128077;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"+1"</span>                            . <span class="org-string">"&#128077;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"thumbdown"</span>                     . <span class="org-string">"&#128078;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"-1"</span>                            . <span class="org-string">"&#128078;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"ok"</span>                            . <span class="org-string">"&#128076;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"pinch"</span>                         . <span class="org-string">"&#129295;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"left"</span>                          . <span class="org-string">"&#128072;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"right"</span>                         . <span class="org-string">"&#128073;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"down"</span>                          . <span class="org-string">"&#128071;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"wave"</span>                          . <span class="org-string">"&#128075;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"pray"</span>                          . <span class="org-string">"&#128591;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"eyes"</span>                          . <span class="org-string">"&#128064;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"brain"</span>                         . <span class="org-string">"&#129504;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"facepalm"</span>                      . <span class="org-string">"&#129318;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"tada"</span>                          . <span class="org-string">"&#127881;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"fire"</span>                          . <span class="org-string">"&#128293;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"flying_money"</span>                  . <span class="org-string">"&#128184;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"lighbulb"</span>                      . <span class="org-string">"&#128161;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"heart"</span>                         . <span class="org-string">"&#10084;&#65039;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"sparkling_heart"</span>               . <span class="org-string">"&#128150;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"heartbreak"</span>                    . <span class="org-string">"&#128148;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"100"</span>                           . <span class="org-string">"&#128175;"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">lui-emoticons-alist</span>
  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">":)"</span>   . <span class="org-string">"slight_smile"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">";)"</span>   . <span class="org-string">"wink"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">":D"</span>   . <span class="org-string">"smile"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"=D"</span>   . <span class="org-string">"grin"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"xD"</span>   . <span class="org-string">"laughing"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">";("</span>   . <span class="org-string">"joy"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">":P"</span>   . <span class="org-string">"stuck_out_tongue"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">";D"</span>   . <span class="org-string">"stuck_out_tongue_wink"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"xP"</span>   . <span class="org-string">"stuck_out_tongue_closed_eyes"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">":("</span>   . <span class="org-string">"slight_frown"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">";("</span>   . <span class="org-string">"cry"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">";'("</span>  . <span class="org-string">"sob"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&gt;:("</span>  . <span class="org-string">"angry"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&gt;&gt;:("</span> . <span class="org-string">"rage"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">":o"</span>   . <span class="org-string">"wow"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">":O"</span>   . <span class="org-string">"astonished"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">":/"</span>   . <span class="org-string">"confused"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">":-/"</span>  . <span class="org-string">"thinking"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">":|"</span>   . <span class="org-string">"neutral"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">":-|"</span>  . <span class="org-string">"expressionless"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-newsfeed" class="outline-3">
<h3 id="newsfeed"><span class="section-number-3">5.3</span> Newsfeed<a aria-hidden="true" href="#newsfeed">#</a> </h3>
<div class="outline-text-3" id="text-5-3">
<p>
<span class='acr'>RSS</span> feeds are still a thing. Why not make use of them with <kbd>elfeed</kbd>.
I really like what <a href="https://github.com/fuxialexander/doom-emacs-private-xfu/tree/master/modules/app/rss">fuxialexander</a> has going on, but I don&rsquo;t think I need a custom
module. Let&rsquo;s just try to patch on the main things I like the look of.
</p>


<figure id="orgadceff2">
<img src="https://tecosaur.com/lfs/emacs-config/screenshots/elfeed.png" alt="Example elfeed entry" class="invertible">

</figure>
</div>

<div id="outline-container-keybindings" class="outline-4">
<h4 id="keybindings"><span class="section-number-4">5.3.1</span> Keybindings<a aria-hidden="true" href="#keybindings">#</a> </h4>
<div class="outline-text-4" id="text-5-3-1">
<details id='keybindings,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#keybindings,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">map!</span> <span class="org-builtin">:map</span> elfeed-search-mode-map
      <span class="org-builtin">:after</span> elfeed-search
      <span class="org-rainbow-delimiters-depth-2">[</span>remap kill-this-buffer<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-string">"q"</span>
      <span class="org-rainbow-delimiters-depth-2">[</span>remap kill-buffer<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-string">"q"</span>
      <span class="org-builtin">:n</span> <span class="org-variable-name">doom-leader-key</span> nil
      <span class="org-builtin">:n</span> <span class="org-string">"q"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">+rss/quit</span>
      <span class="org-builtin">:n</span> <span class="org-string">"e"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">elfeed-update</span>
      <span class="org-builtin">:n</span> <span class="org-string">"r"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">elfeed-search-untag-all-unread</span>
      <span class="org-builtin">:n</span> <span class="org-string">"u"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">elfeed-search-tag-all-unread</span>
      <span class="org-builtin">:n</span> <span class="org-string">"s"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">elfeed-search-live-filter</span>
      <span class="org-builtin">:n</span> <span class="org-string">"RET"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">elfeed-search-show-entry</span>
      <span class="org-builtin">:n</span> <span class="org-string">"p"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">elfeed-show-pdf</span>
      <span class="org-builtin">:n</span> <span class="org-string">"+"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">elfeed-search-tag-all</span>
      <span class="org-builtin">:n</span> <span class="org-string">"-"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">elfeed-search-untag-all</span>
      <span class="org-builtin">:n</span> <span class="org-string">"S"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">elfeed-search-set-filter</span>
      <span class="org-builtin">:n</span> <span class="org-string">"b"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">elfeed-search-browse-url</span>
      <span class="org-builtin">:n</span> <span class="org-string">"y"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">elfeed-search-yank</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">map!</span> <span class="org-builtin">:map</span> elfeed-show-mode-map
      <span class="org-builtin">:after</span> elfeed-show
      <span class="org-rainbow-delimiters-depth-2">[</span>remap kill-this-buffer<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-string">"q"</span>
      <span class="org-rainbow-delimiters-depth-2">[</span>remap kill-buffer<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-string">"q"</span>
      <span class="org-builtin">:n</span> <span class="org-variable-name">doom-leader-key</span> nil
      <span class="org-builtin">:nm</span> <span class="org-string">"q"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">+rss/delete-pane</span>
      <span class="org-builtin">:nm</span> <span class="org-string">"o"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">ace-link-elfeed</span>
      <span class="org-builtin">:nm</span> <span class="org-string">"RET"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-ref-elfeed-add</span>
      <span class="org-builtin">:nm</span> <span class="org-string">"n"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">elfeed-show-next</span>
      <span class="org-builtin">:nm</span> <span class="org-string">"N"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">elfeed-show-prev</span>
      <span class="org-builtin">:nm</span> <span class="org-string">"p"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">elfeed-show-pdf</span>
      <span class="org-builtin">:nm</span> <span class="org-string">"+"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">elfeed-show-tag</span>
      <span class="org-builtin">:nm</span> <span class="org-string">"-"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">elfeed-show-untag</span>
      <span class="org-builtin">:nm</span> <span class="org-string">"s"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">elfeed-show-new-live-search</span>
      <span class="org-builtin">:nm</span> <span class="org-string">"y"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">elfeed-show-yank</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-usability-enhancements" class="outline-4">
<h4 id="usability-enhancements"><span class="section-number-4">5.3.2</span> Usability enhancements<a aria-hidden="true" href="#usability-enhancements">#</a> </h4>
<div class="outline-text-4" id="text-5-3-2">
<details id='usability-enhancements,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#usability-enhancements,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> elfeed-search
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">set-evil-initial-state!</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">elfeed-search-mode</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">normal</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> elfeed-show-mode
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">set-evil-initial-state!</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">elfeed-show-mode</span>   <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">normal</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> evil-snipe
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">push</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">elfeed-show-mode</span>   evil-snipe-disabled-modes<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">push</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">elfeed-search-mode</span> evil-snipe-disabled-modes<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-visual-enhancements" class="outline-4">
<h4 id="visual-enhancements"><span class="section-number-4">5.3.3</span> Visual enhancements<a aria-hidden="true" href="#visual-enhancements">#</a> </h4>
<div class="outline-text-4" id="text-5-3-3">
<details id='visual-enhancements,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#visual-enhancements,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> elfeed

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">elfeed-org</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">use-package!</span> elfeed-link<span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> elfeed-search-filter <span class="org-string">"@1-week-ago +unread"</span>
        elfeed-search-print-entry-function <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">+rss/elfeed-search-print-entry</span>
        elfeed-search-title-min-width <span class="org-highlight-numbers-number">80</span>
        elfeed-show-entry-switch <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">pop-to-buffer</span>
        elfeed-show-entry-delete <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">+rss/delete-pane</span>
        elfeed-show-refresh-function <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">+rss/elfeed-show-refresh--better-style</span>
        shr-max-image-proportion <span class="org-highlight-numbers-number">0.6</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">add-hook!</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">elfeed-show-mode-hook</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">hide-mode-line-mode</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">add-hook!</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">elfeed-search-update-hook</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">hide-mode-line-mode</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defface</span> <span class="org-variable-name">elfeed-show-title-face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>t <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:weight</span> ultrabold <span class="org-builtin">:slant</span> italic <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.5</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"title face in elfeed show buffer"</span>
    <span class="org-builtin">:group</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">elfeed</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defface</span> <span class="org-variable-name">elfeed-show-author-face</span> <span class="org-highlight-quoted-quote">`</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>t <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:weight</span> light<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"title face in elfeed show buffer"</span>
    <span class="org-builtin">:group</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">elfeed</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">set-face-attribute</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">elfeed-search-title-face</span> nil
                      <span class="org-builtin">:foreground</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">nil</span>
                      <span class="org-builtin">:weight</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">light</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defadvice!</span> +rss-elfeed-wrap-h-nicer <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-doc">"Enhances an elfeed entry's readability by wrapping it to a width of</span>
<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">fill-column</span></span><span class="org-doc">' and centering it with `</span><span class="org-doc"><span class="org-constant">visual-fill-column-mode</span></span><span class="org-doc">'."</span>
    <span class="org-builtin">:override</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">+rss-elfeed-wrap-h</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-variable-name">inhibit-read-only</span> t<span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-variable-name">inhibit-modification-hooks</span> t<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq-local</span> <span class="org-variable-name">truncate-lines</span> nil<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq-local</span> shr-width <span class="org-highlight-numbers-number">120</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq-local</span> <span class="org-variable-name">line-spacing</span> <span class="org-highlight-numbers-number">0.2</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq-local</span> visual-fill-column-center-text t<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">visual-fill-column-mode</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-comment-delimiter">;; </span><span class="org-comment">(setq-local shr-current-font '(:family "Merriweather" :height 1.2))</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">set-buffer-modified-p</span> nil<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+rss/elfeed-search-print-entry</span> <span class="org-rainbow-delimiters-depth-3">(</span>entry<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Print ENTRY to the buffer."</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>elfeed-goodies/tag-column-width <span class="org-highlight-numbers-number">40</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>elfeed-goodies/feed-source-column-width <span class="org-highlight-numbers-number">30</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>title <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span>elfeed-meta entry <span class="org-builtin">:title</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span>elfeed-entry-title entry<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>title-faces <span class="org-rainbow-delimiters-depth-3">(</span>elfeed-search--faces <span class="org-rainbow-delimiters-depth-1">(</span>elfeed-entry-tags entry<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>feed <span class="org-rainbow-delimiters-depth-3">(</span>elfeed-entry-feed entry<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>feed-title
            <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> feed
              <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-2">(</span>elfeed-meta feed <span class="org-builtin">:title</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>elfeed-feed-title feed<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>tags <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">mapcar</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">symbol-name</span> <span class="org-rainbow-delimiters-depth-1">(</span>elfeed-entry-tags entry<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>tags-str <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">concat</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">mapconcat</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">identity</span> tags <span class="org-string">","</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>title-width <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">-</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">window-width</span><span class="org-rainbow-delimiters-depth-1">)</span> elfeed-goodies/feed-source-column-width
                           elfeed-goodies/tag-column-width <span class="org-highlight-numbers-number">4</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

           <span class="org-rainbow-delimiters-depth-2">(</span>tag-column <span class="org-rainbow-delimiters-depth-3">(</span>elfeed-format-column
                        tags-str <span class="org-rainbow-delimiters-depth-1">(</span>elfeed-clamp <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">length</span> tags-str<span class="org-rainbow-delimiters-depth-2">)</span>
                                               elfeed-goodies/tag-column-width
                                               elfeed-goodies/tag-column-width<span class="org-rainbow-delimiters-depth-1">)</span>
                        <span class="org-builtin">:left</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>feed-column <span class="org-rainbow-delimiters-depth-3">(</span>elfeed-format-column
                         feed-title <span class="org-rainbow-delimiters-depth-1">(</span>elfeed-clamp elfeed-goodies/feed-source-column-width
                                                  elfeed-goodies/feed-source-column-width
                                                  elfeed-goodies/feed-source-column-width<span class="org-rainbow-delimiters-depth-1">)</span>
                         <span class="org-builtin">:left</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">insert</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">propertize</span> feed-column <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">elfeed-search-feed-face</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-string">" "</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">insert</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">propertize</span> tag-column <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">elfeed-search-tag-face</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-string">" "</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">insert</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">propertize</span> title <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> title-faces <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">kbd-help</span> title<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq-local</span> <span class="org-variable-name">line-spacing</span> <span class="org-highlight-numbers-number">0.2</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+rss/elfeed-show-refresh--better-style</span> <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-doc">"Update the buffer to match the selected entry, using a mail-style."</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">interactive</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-variable-name">inhibit-read-only</span> t<span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>title <span class="org-rainbow-delimiters-depth-3">(</span>elfeed-entry-title elfeed-show-entry<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>date <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">seconds-to-time</span> <span class="org-rainbow-delimiters-depth-1">(</span>elfeed-entry-date elfeed-show-entry<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>author <span class="org-rainbow-delimiters-depth-3">(</span>elfeed-meta elfeed-show-entry <span class="org-builtin">:author</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>link <span class="org-rainbow-delimiters-depth-3">(</span>elfeed-entry-link elfeed-show-entry<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>tags <span class="org-rainbow-delimiters-depth-3">(</span>elfeed-entry-tags elfeed-show-entry<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>tagsstr <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">mapconcat</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">symbol-name</span> tags <span class="org-string">", "</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>nicedate <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format-time-string</span> <span class="org-string">"%a, %e %b %Y %T %Z"</span> date<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>content <span class="org-rainbow-delimiters-depth-3">(</span>elfeed-deref <span class="org-rainbow-delimiters-depth-1">(</span>elfeed-entry-content elfeed-show-entry<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>type <span class="org-rainbow-delimiters-depth-3">(</span>elfeed-entry-content-type elfeed-show-entry<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>feed <span class="org-rainbow-delimiters-depth-3">(</span>elfeed-entry-feed elfeed-show-entry<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>feed-title <span class="org-rainbow-delimiters-depth-3">(</span>elfeed-feed-title feed<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>base <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">and</span> feed <span class="org-rainbow-delimiters-depth-1">(</span>elfeed-compute-base <span class="org-rainbow-delimiters-depth-2">(</span>elfeed-feed-url feed<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">erase-buffer</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">insert</span> <span class="org-string">"\n"</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">insert</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"%s\n\n"</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">propertize</span> title <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">elfeed-show-title-face</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">insert</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"%s\t"</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">propertize</span> feed-title <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">elfeed-search-feed-face</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">and</span> author elfeed-show-entry-author<span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">insert</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-string">"%s\n"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">propertize</span> author <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">elfeed-show-author-face</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">insert</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"%s\n\n"</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">propertize</span> nicedate <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">elfeed-log-date-face</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> tags
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">insert</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-string">"%s\n"</span>
                        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">propertize</span> tagsstr <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">elfeed-search-tag-face</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-comment-delimiter">;; </span><span class="org-comment">(insert (propertize "Link: " 'face 'message-header-name))</span>
      <span class="org-comment-delimiter">;; </span><span class="org-comment">(elfeed-insert-link link link)</span>
      <span class="org-comment-delimiter">;; </span><span class="org-comment">(insert "\n")</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">cl-loop</span> for enclosure in <span class="org-rainbow-delimiters-depth-2">(</span>elfeed-entry-enclosures elfeed-show-entry<span class="org-rainbow-delimiters-depth-2">)</span>
               do <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">insert</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">propertize</span> <span class="org-string">"Enclosure: "</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">message-header-name</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
               do <span class="org-rainbow-delimiters-depth-2">(</span>elfeed-insert-link <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">car</span> enclosure<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
               do <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">insert</span> <span class="org-string">"\n"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">insert</span> <span class="org-string">"\n"</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">if</span> content
          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">eq</span> type <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">html</span><span class="org-rainbow-delimiters-depth-3">)</span>
              <span class="org-rainbow-delimiters-depth-3">(</span>elfeed-insert-html content base<span class="org-rainbow-delimiters-depth-3">)</span>
            <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">insert</span> content<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">insert</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">propertize</span> <span class="org-string">"(empty)\n"</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">italic</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">goto-char</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">point-min</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-functionality-enhancements" class="outline-4">
<h4 id="functionality-enhancements"><span class="section-number-4">5.3.4</span> Functionality enhancements<a aria-hidden="true" href="#functionality-enhancements">#</a> </h4>
<div class="outline-text-4" id="text-5-3-4">
<details id='functionality-enhancements,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#functionality-enhancements,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> elfeed-show
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">require</span> <span class="org-highlight-quoted-quote">'</span><span class="org-constant">url</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">elfeed-pdf-dir</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">expand-file-name</span> <span class="org-string">"pdfs/"</span>
                      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">file-name-directory</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">directory-file-name</span> elfeed-enclosure-default-dir<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">elfeed-link-pdfs</span>
    <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"https://www.jstatsoft.org/index.php/jss/article/view/v0</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">/]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span> . <span class="org-string">"https://www.jstatsoft.org/index.php/jss/article/view/v0\\1/v\\1.pdf"</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"http://arxiv.org/abs/</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">/]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span> . <span class="org-string">"https://arxiv.org/pdf/\\1.pdf"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"List of alists of the form (REGEX-FOR-LINK . FORM-FOR-PDF)"</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">elfeed-show-pdf</span> <span class="org-rainbow-delimiters-depth-3">(</span>entry<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">interactive</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">list</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">or</span> elfeed-show-entry <span class="org-rainbow-delimiters-depth-3">(</span>elfeed-search-selected <span class="org-builtin">:ignore-region</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>link <span class="org-rainbow-delimiters-depth-3">(</span>elfeed-entry-link entry<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span>feed-name <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> <span class="org-rainbow-delimiters-depth-1">(</span>elfeed-feed-meta <span class="org-rainbow-delimiters-depth-2">(</span>elfeed-entry-feed entry<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-builtin">:title</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span>title <span class="org-rainbow-delimiters-depth-3">(</span>elfeed-entry-title entry<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span>file-view-function
           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-1">(</span>f<span class="org-rainbow-delimiters-depth-1">)</span>
             <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> elfeed-show-entry
               <span class="org-rainbow-delimiters-depth-2">(</span>elfeed-kill-buffer<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
             <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">pop-to-buffer</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">find-file-noselect</span> f<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
          pdf<span class="org-rainbow-delimiters-depth-1">)</span>

      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>file <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">expand-file-name</span>
                   <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">concat</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">subst-char-in-string</span> ?/ ?, title<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-string">".pdf"</span><span class="org-rainbow-delimiters-depth-2">)</span>
                   <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">expand-file-name</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">subst-char-in-string</span> ?/ ?, feed-name<span class="org-rainbow-delimiters-depth-3">)</span>
                                     elfeed-pdf-dir<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">file-exists-p</span> file<span class="org-rainbow-delimiters-depth-3">)</span>
            <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">funcall</span> file-view-function file<span class="org-rainbow-delimiters-depth-3">)</span>
          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">dolist</span> <span class="org-rainbow-delimiters-depth-1">(</span>link-pdf elfeed-link-pdfs<span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">string-match-p</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">car</span> link-pdf<span class="org-rainbow-delimiters-depth-1">)</span> link<span class="org-rainbow-delimiters-depth-3">)</span>
                       <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">not</span> pdf<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> pdf <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">replace-regexp-in-string</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">car</span> link-pdf<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">cdr</span> link-pdf<span class="org-rainbow-delimiters-depth-1">)</span> link<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">not</span> pdf<span class="org-rainbow-delimiters-depth-1">)</span>
              <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">message</span> <span class="org-string">"No associated PDF for entry"</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">message</span> <span class="org-string">"Fetching %s"</span> pdf<span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">file-exists-p</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">file-name-directory</span> file<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">make-directory</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">file-name-directory</span> file<span class="org-rainbow-delimiters-depth-3">)</span> t<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">url-copy-file</span> pdf file<span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">funcall</span> file-view-function file<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-dictionary" class="outline-3">
<h3 id="dictionary"><span class="section-number-3">5.4</span> Dictionary<a aria-hidden="true" href="#dictionary">#</a> </h3>
<div class="outline-text-3" id="text-5-4">
<p>
We start off by loading <kbd>lexic</kbd>, then we&rsquo;ll integrate it into pre-existing
definition functionality (like <code>+lookup/dictionary-definition</code>).
</p>
<details id='dictionary,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#dictionary,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">use-package!</span> lexic
  <span class="org-builtin">:commands</span> lexic-search lexic-list-dictionary
  <span class="org-builtin">:config</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">map!</span> <span class="org-builtin">:map</span> lexic-mode-map
        <span class="org-builtin">:n</span> <span class="org-string">"q"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">lexic-return-from-lexic</span>
        <span class="org-builtin">:nv</span> <span class="org-string">"RET"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">lexic-search-word-at-point</span>
        <span class="org-builtin">:n</span> <span class="org-string">"a"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">outline-show-all</span>
        <span class="org-builtin">:n</span> <span class="org-string">"h"</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">cmd!</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">outline-hide-sublevels</span> <span class="org-highlight-numbers-number">3</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-builtin">:n</span> <span class="org-string">"o"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">lexic-toggle-entry</span>
        <span class="org-builtin">:n</span> <span class="org-string">"n"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">lexic-next-entry</span>
        <span class="org-builtin">:n</span> <span class="org-string">"N"</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">cmd!</span> <span class="org-rainbow-delimiters-depth-1">(</span>lexic-next-entry t<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-builtin">:n</span> <span class="org-string">"p"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">lexic-previous-entry</span>
        <span class="org-builtin">:n</span> <span class="org-string">"P"</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">cmd!</span> <span class="org-rainbow-delimiters-depth-1">(</span>lexic-previous-entry t<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-builtin">:n</span> <span class="org-string">"E"</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">cmd!</span> <span class="org-rainbow-delimiters-depth-1">(</span>lexic-return-from-lexic<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">expand</span>
                     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">switch-to-buffer</span> <span class="org-rainbow-delimiters-depth-2">(</span>lexic-get-buffer<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-builtin">:n</span> <span class="org-string">"M"</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">cmd!</span> <span class="org-rainbow-delimiters-depth-1">(</span>lexic-return-from-lexic<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">minimise</span>
                     <span class="org-rainbow-delimiters-depth-1">(</span>lexic-goto-lexic<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-builtin">:n</span> <span class="org-string">"C-p"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">lexic-search-history-backwards</span>
        <span class="org-builtin">:n</span> <span class="org-string">"C-n"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">lexic-search-history-forwards</span>
        <span class="org-builtin">:n</span> <span class="org-string">"/"</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">cmd!</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">call-interactively</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">lexic-search</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Now let&rsquo;s use this instead of wordnet.
</p>
<details id='dictionary,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#dictionary,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defadvice!</span> +lookup/dictionary-definition-lexic <span class="org-rainbow-delimiters-depth-2">(</span>identifier <span class="org-type">&amp;optional</span> arg<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Look up the definition of the word at point (or selection) using `</span><span class="org-doc"><span class="org-constant">lexic-search</span></span><span class="org-doc">'."</span>
  <span class="org-builtin">:override</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">+lookup/dictionary-definition</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">interactive</span>
   <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">list</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">doom-thing-at-point-or-region</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">word</span><span class="org-rainbow-delimiters-depth-2">)</span>
             <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">read-string</span> <span class="org-string">"Look up in dictionary: "</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-variable-name">current-prefix-arg</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">lexic-search</span> identifier nil nil t<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-mail" class="outline-3">
<h3 id="mail"><span class="section-number-3">5.5</span> Mail<a aria-hidden="true" href="#mail">#</a> </h3>
<div class="outline-text-3" id="text-5-5">
<p>
<img class='invertible' src='https://imgs.xkcd.com/comics/email.png' title="My New Year's resolution for 2014-54-12/30/14 Dec:12:1420001642 is to learn these stupid time formatting strings." alt='Email'>
</p>
</div>

<div id="outline-container-fetching" class="outline-4">
<h4 id="fetching"><span class="section-number-4">5.5.1</span> Fetching<a aria-hidden="true" href="#fetching">#</a> </h4>
<div class="outline-text-4" id="text-5-5-1">
<p>
The contenders for this seem to be:
</p>
<ul class="org-ul">
<li><a href="https://www.offlineimap.org/">OfflineIMAP</a> (<a href="https://wiki.archlinux.org/index.php/OfflineIMAP">ArchWiki page</a>)</li>
<li><a href="http://isync.sourceforge.net/mbsync.html">isync/mbsync</a> (<a href="https://wiki.archlinux.org/index.php/isync">ArchWiki page</a>)</li>
</ul>

<p>
From perusing r/emacs the prevailing opinion seems to be that
</p>
<ul class="org-ul">
<li>isync is faster</li>
<li>isync works more reliably</li>
</ul>
<p>
So let&rsquo;s use that.
</p>

<p>
The config was straightforward, and is located at <a href="file:///home/runner/.mbsyncrc">~/.mbsyncrc</a>.
I&rsquo;m currently successfully connecting to: Gmail, office365mail, and dovecot.
I&rsquo;m also shoving passwords in my <a href="file:///home/runner/.authinfo.gpg">authinfo.gpg</a> and fetching them using <code>PassCmd</code>:
</p>
<details id='fetching,code--1' class='code' open><summary><span class='lang'>Shell Script</span></summary>
    <div class='gutter'>
    <a href='#fetching,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell">gpg2 -q --for-your-eyes-only --no-tty -d ~/.authinfo.gpg | awk <span class="org-string">'/machine IMAP_SERCER login EMAIL_ADDR/ {print $NF}'</span>
</pre>
</div>
    </details>

<p>
We can run <code>mbsync -a</code> in a systemd service file or something, but we can do
better than that. <a href="https://github.com/vsemyonoff/easymail#usage">vsemyonoff/easymail</a> seems like the sort of thing we want, but
is written for <kbd>notmuch</kbd> unfortunately. We can still use it for inspiration though.
Using <a href="https://gitlab.com/shackra/goimapnotify">goimapnotify</a> we should be able to sync just after new
mail. Unfortunately this means <i>yet another</i> config file :(
</p>

<p>
We install with
</p>
<details id='fetching,code--2' class='code' open><summary><span class='lang'>Shell Script</span></summary>
    <div class='gutter'>
    <a href='#fetching,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell">go get -u gitlab.com/shackra/goimapnotify
<span class="org-type">ln</span> -s ~/.local/share/go/bin/goimapnotify ~/.local/bin/
</pre>
</div>
    </details>

<p>
Here&rsquo;s the general plan:
</p>
<ol class="org-ol">
<li>Use <code>goimapnotify</code> to monitor mailboxes
This needs it&rsquo;s own set of configs, and <kbd>systemd</kbd> services, which is a pain. We
remove this pain by writing a python script (found below) to setup these
config files, and systemd services by parsing the  <a href="file:///home/runner/.mbsyncrc">~/.mbsyncrc</a> file.</li>
<li>On new mail, call <code>mbsync --pull --new ACCOUNT:BOX</code>
We try to be as specific as possible, so <code>mbsync</code> returns as soon as possible,
and we can <i>get those emails as soon as possible</i>.</li>
<li>Try to call <code>mu index --lazy-fetch</code>.
This fails if mu4e is already open (due to a write lock on the database), so
in that case we just <code>touch</code> a tmp file (<kbd>/tmp/mu_reindex_now</kbd>).</li>
<li>Separately, we set up Emacs to check for the existance of
<kbd>/tmp/mu_reindex_now</kbd> once a second while mu4e is
running, and (after deleting the file) call <code>mu4e-update-index</code>.</li>
</ol>

<p>
Let&rsquo;s start off by handling the elisp side of things
</p>
</div>

<div id="outline-container-rebuild-mail-index" class="outline-5">
<h5 id="rebuild-mail-index"><span class="section-number-5">5.5.1.1</span> Rebuild mail index while using mu4e<a aria-hidden="true" href="#rebuild-mail-index">#</a> </h5>
<div class="outline-text-5" id="text-5-5-1-1">
<details id='rebuild-mail-index,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#rebuild-mail-index,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> mu4e
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">mu4e-reindex-request-file</span> <span class="org-string">"/tmp/mu_reindex_now"</span>
    <span class="org-doc">"Location of the reindex request, signaled by existance"</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">mu4e-reindex-request-min-seperation</span> <span class="org-highlight-numbers-number">5.0</span>
    <span class="org-doc">"Don't refresh again until this many second have elapsed.</span>
<span class="org-doc">Prevents a series of redisplays from being called (when set to an appropriate value)"</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">mu4e-reindex-request--file-watcher</span> nil<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">mu4e-reindex-request--file-just-deleted</span> nil<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">mu4e-reindex-request--last-time</span> <span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">mu4e-reindex-request--add-watcher</span> <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> mu4e-reindex-request--file-just-deleted nil<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> mu4e-reindex-request--file-watcher
          <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">file-notify-add-watch</span> mu4e-reindex-request-file
                                 <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>change<span class="org-rainbow-delimiters-depth-2">)</span>
                                 <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">mu4e-file-reindex-request</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defadvice!</span> mu4e-stop-watching-for-reindex-request <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-builtin">:after</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">mu4e~proc-kill</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> mu4e-reindex-request--file-watcher
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">file-notify-rm-watch</span> mu4e-reindex-request--file-watcher<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defadvice!</span> mu4e-watch-for-reindex-request <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-builtin">:after</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">mu4e~proc-start</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>mu4e-stop-watching-for-reindex-request<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">file-exists-p</span> mu4e-reindex-request-file<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">delete-file</span> mu4e-reindex-request-file<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>mu4e-reindex-request--add-watcher<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">mu4e-file-reindex-request</span> <span class="org-rainbow-delimiters-depth-3">(</span>event<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Act based on the existance of `</span><span class="org-doc"><span class="org-constant">mu4e-reindex-request-file</span></span><span class="org-doc">'"</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> mu4e-reindex-request--file-just-deleted
        <span class="org-rainbow-delimiters-depth-1">(</span>mu4e-reindex-request--add-watcher<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">equal</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">1</span> event<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">created</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">delete-file</span> mu4e-reindex-request-file<span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> mu4e-reindex-request--file-just-deleted t<span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span>mu4e-reindex-maybe t<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">mu4e-reindex-maybe</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">&amp;optional</span> new-request<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Run `</span><span class="org-doc"><span class="org-constant">mu4e~proc-index</span></span><span class="org-doc">' if it's been more than</span>
<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">mu4e-reindex-request-min-seperation</span></span><span class="org-doc">'seconds since the last request,"</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>time-since-last-request <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">-</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">float-time</span><span class="org-rainbow-delimiters-depth-1">)</span>
                                      mu4e-reindex-request--last-time<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> new-request
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> mu4e-reindex-request--last-time <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">float-time</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">&gt;</span> time-since-last-request mu4e-reindex-request-min-seperation<span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span>mu4e~proc-index nil t<span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> new-request
          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">run-at-time</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">*</span> <span class="org-highlight-numbers-number">1.1</span> mu4e-reindex-request-min-seperation<span class="org-rainbow-delimiters-depth-1">)</span> nil
                       <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">mu4e-reindex-maybe</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-config-transcoding-" class="outline-5">
<h5 id="config-transcoding-"><span class="section-number-5">5.5.1.2</span> Config transcoding &amp; service management<a aria-hidden="true" href="#config-transcoding-">#</a> </h5>
<div class="outline-text-5" id="text-5-5-1-2">
<p>
As long as the <kbd>mbsyncrc</kbd> file exists, this is as easy as running
</p>
<details id='config-transcoding-,code--1' class='code' open><summary><span class='lang'>Shell Script</span></summary>
    <div class='gutter'>
    <a href='#config-transcoding-,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell">~/.config/doom/misc/mbsync-imapnotify.py
</pre>
</div>
    </details>

<p>
When run without flags this will perform the following actions
</p>
<ul class="org-ul">
<li>Read, and parse <a href="file:///home/runner/.mbsyncrc">~/.mbsyncrc</a>, specifically recognising the following properties
<ul class="org-ul">
<li><code>IMAPAccount</code></li>
<li><code>Host</code></li>
<li><code>Port</code></li>
<li><code>User</code></li>
<li><code>Password</code></li>
<li><code>PassCmd</code></li>
<li><code>Patterns</code></li>
</ul></li>
<li>Call <code>mbsync --list ACCOUNT</code>, and filter results according to <code>Patterns</code></li>
<li>Construct a imapnotify config for each account, with the following hooks
<dl class="org-dl">
<dt>onNewMail</dt><dd><code>mbsync --pull ACCOUNT:MAILBOX</code></dd>
<dt>onNewMailPost</dt><dd><code>if mu index --lazy-check; then test -f /tmp/mu_reindex_now &amp;&amp; rm /tmp/mu_reindex_now; else touch /tmp/mu_reindex_now; fi</code></dd>
</dl></li>
<li>Compare accounts list to previous accounts, enable/disable the relevant
systemd services, called with the <code>--now</code> flag (start/stop services as well)</li>
</ul>

<p>
This script also supports the following flags
</p>
<ul class="org-ul">
<li><code>--status</code> to get the status of the relevant systemd services supports <kbd>active</kbd>,
<kbd>failing</kbd>, and <kbd>disabled</kbd></li>
<li><code>--enable</code> to enable all relevant systemd services</li>
<li><code>--disable</code> to disable all relevant systemd services</li>
</ul>
<details id='config-transcoding-,code--2' class='code' open><summary><span class='lang'>Python</span></summary>
    <div class='gutter'>
    <a href='#config-transcoding-,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">from</span> pathlib <span class="org-keyword">import</span> Path
<span class="org-keyword">import</span> json
<span class="org-keyword">import</span> re
<span class="org-keyword">import</span> shutil
<span class="org-keyword">import</span> subprocess
<span class="org-keyword">import</span> sys
<span class="org-keyword">import</span> fnmatch

<span class="org-variable-name">mbsyncFile</span> = Path(<span class="org-string">"~/.mbsyncrc"</span>).expanduser()

<span class="org-variable-name">imapnotifyConfigFolder</span> = Path(<span class="org-string">"~/.config/imapnotify/"</span>).expanduser()
imapnotifyConfigFolder.mkdir(exist_ok=<span class="org-constant">True</span>)
<span class="org-variable-name">imapnotifyConfigFilename</span> = <span class="org-string">"notify.conf"</span>

<span class="org-variable-name">imapnotifyDefault</span> = {
    <span class="org-string">"host"</span>: <span class="org-string">""</span>,
    <span class="org-string">"port"</span>: <span class="org-highlight-numbers-number">993</span>,
    <span class="org-string">"tls"</span>: <span class="org-constant">True</span>,
    <span class="org-string">"tlsOptions"</span>: {<span class="org-string">"rejectUnauthorized"</span>: <span class="org-constant">True</span>},
    <span class="org-string">"onNewMail"</span>: <span class="org-string">""</span>,
    <span class="org-string">"onNewMailPost"</span>: <span class="org-string">"if mu index --lazy-check; then test -f /tmp/mu_reindex_now &amp;&amp; rm /tmp/mu_reindex_now; else touch /tmp/mu_reindex_now; fi"</span>,
}


<span class="org-keyword">def</span> <span class="org-function-name">stripQuotes</span>(string):
    <span class="org-keyword">if</span> string[<span class="org-highlight-numbers-number">0</span>] == <span class="org-string">'"'</span> <span class="org-keyword">and</span> string[-<span class="org-highlight-numbers-number">1</span>] == <span class="org-string">'"'</span>:
        <span class="org-keyword">return</span> string[<span class="org-highlight-numbers-number">1</span>:-<span class="org-highlight-numbers-number">1</span>].replace(<span class="org-string">'\\"'</span>, <span class="org-string">'"'</span>)


<span class="org-variable-name">mbsyncInotifyMapping</span> = {
    <span class="org-string">"Host"</span>: (<span class="org-builtin">str</span>, <span class="org-string">"host"</span>),
    <span class="org-string">"Port"</span>: (<span class="org-builtin">int</span>, <span class="org-string">"port"</span>),
    <span class="org-string">"User"</span>: (<span class="org-builtin">str</span>, <span class="org-string">"username"</span>),
    <span class="org-string">"Password"</span>: (<span class="org-builtin">str</span>, <span class="org-string">"password"</span>),
    <span class="org-string">"PassCmd"</span>: (stripQuotes, <span class="org-string">"passwordCmd"</span>),
    <span class="org-string">"Patterns"</span>: (<span class="org-builtin">str</span>, <span class="org-string">"_patterns"</span>),
}

<span class="org-variable-name">oldAccounts</span> = [d.name <span class="org-keyword">for</span> d <span class="org-keyword">in</span> imapnotifyConfigFolder.iterdir() <span class="org-keyword">if</span> d.is_dir()]

<span class="org-variable-name">currentAccount</span> = <span class="org-string">""</span>
<span class="org-variable-name">currentAccountData</span> = {}

<span class="org-variable-name">successfulAdditions</span> = []


<span class="org-keyword">def</span> <span class="org-function-name">processLine</span>(line):
    <span class="org-variable-name">newAcc</span> = re.match(r<span class="org-string">"^IMAPAccount ([^#]+)"</span>, line)

    <span class="org-variable-name">linecontent</span> = re.sub(r<span class="org-string">"(^|[^\\])#.*"</span>, <span class="org-string">""</span>, line).split(<span class="org-string">" "</span>, <span class="org-highlight-numbers-number">1</span>)
    <span class="org-keyword">if</span> <span class="org-builtin">len</span>(linecontent) != <span class="org-highlight-numbers-number">2</span>:
        <span class="org-keyword">return</span>

    <span class="org-variable-name">parameter</span>, <span class="org-variable-name">value</span> = linecontent

    <span class="org-keyword">if</span> parameter == <span class="org-string">"IMAPAccount"</span>:
        <span class="org-keyword">if</span> currentAccountNumber &gt; <span class="org-highlight-numbers-number">0</span>:
            finaliseAccount()
        newAccount(value)
    <span class="org-keyword">elif</span> parameter <span class="org-keyword">in</span> mbsyncInotifyMapping.keys():
        <span class="org-variable-name">parser</span>, <span class="org-variable-name">key</span> = mbsyncInotifyMapping[parameter]
        <span class="org-variable-name">currentAccountData</span>[key] = parser(value)
    <span class="org-keyword">elif</span> parameter == <span class="org-string">"Channel"</span>:
        <span class="org-variable-name">currentAccountData</span>[<span class="org-string">"onNewMail"</span>] = f<span class="org-string">"mbsync --pull --new {value}:'%s'"</span>


<span class="org-keyword">def</span> <span class="org-function-name">newAccount</span>(name):
    <span class="org-keyword">global</span> currentAccountNumber
    <span class="org-keyword">global</span> currentAccount
    <span class="org-keyword">global</span> currentAccountData
    <span class="org-variable-name">currentAccountNumber</span> += <span class="org-highlight-numbers-number">1</span>
    <span class="org-variable-name">currentAccount</span> = name
    <span class="org-variable-name">currentAccountData</span> = {}
    <span class="org-keyword">print</span>(f<span class="org-string">"\n\033[1;32m{currentAccountNumber}\033[0;32m - {name}\033[0;37m"</span>)


<span class="org-keyword">def</span> <span class="org-function-name">accountToFoldername</span>(name):
    <span class="org-keyword">return</span> re.sub(r<span class="org-string">"[^A-Za-z0-9]"</span>, <span class="org-string">""</span>, name)


<span class="org-keyword">def</span> <span class="org-function-name">finaliseAccount</span>():
    <span class="org-keyword">if</span> currentAccountNumber == <span class="org-highlight-numbers-number">0</span>:
        <span class="org-keyword">return</span>

    <span class="org-keyword">global</span> currentAccountData
    <span class="org-keyword">try</span>:
        <span class="org-variable-name">currentAccountData</span>[<span class="org-string">"boxes"</span>] = getMailBoxes(currentAccount)
    <span class="org-keyword">except</span> subprocess.CalledProcessError <span class="org-keyword">as</span> e:
        <span class="org-keyword">print</span>(
            f<span class="org-string">"\033[1;31mError:\033[0;31m failed to fetch mailboxes (skipping): "</span>
            + f<span class="org-string">"`{' '.join(e.cmd)}' returned code {e.returncode}\033[0;37m"</span>
        )
        <span class="org-keyword">return</span>
    <span class="org-keyword">except</span> subprocess.TimeoutExpired <span class="org-keyword">as</span> e:
        <span class="org-keyword">print</span>(
            f<span class="org-string">"\033[1;31mError:\033[0;31m failed to fetch mailboxes (skipping): "</span>
            + f<span class="org-string">"`{' '.join(e.cmd)}' timed out after {e.timeout:.2f} seconds\033[0;37m"</span>
        )
        <span class="org-keyword">return</span>

    <span class="org-keyword">if</span> <span class="org-string">"_patterns"</span> <span class="org-keyword">in</span> currentAccountData:
        currentAccountData[<span class="org-string">"boxes"</span>] = applyPatternFilter(
            currentAccountData[<span class="org-string">"_patterns"</span>], currentAccountData[<span class="org-string">"boxes"</span>]
        )

    <span class="org-comment-delimiter"># </span><span class="org-comment">strip not-to-be-exported data</span>
    <span class="org-variable-name">currentAccountData</span> = {
        k: currentAccountData[k] <span class="org-keyword">for</span> k <span class="org-keyword">in</span> currentAccountData <span class="org-keyword">if</span> k[<span class="org-highlight-numbers-number">0</span>] != <span class="org-string">"_"</span>
    }

    <span class="org-variable-name">parametersSet</span> = currentAccountData.keys()
    <span class="org-variable-name">currentAccountData</span> = {**imapnotifyDefault, **currentAccountData}
    <span class="org-keyword">for</span> key, val <span class="org-keyword">in</span> currentAccountData.items():
        <span class="org-variable-name">valColor</span> = <span class="org-string">"\033[0;33m"</span> <span class="org-keyword">if</span> key <span class="org-keyword">in</span> parametersSet <span class="org-keyword">else</span> <span class="org-string">"\033[0;37m"</span>
        <span class="org-keyword">print</span>(f<span class="org-string">"  \033[1;37m{key:&lt;13} {valColor}{val}\033[0;37m"</span>)

    <span class="org-keyword">if</span> (
            <span class="org-builtin">len</span>(currentAccountData[<span class="org-string">"boxes"</span>]) &gt; <span class="org-highlight-numbers-number">15</span>
            <span class="org-keyword">and</span> <span class="org-string">"@gmail.com"</span> <span class="org-keyword">in</span> currentAccountData[<span class="org-string">"username"</span>]
    ):
        <span class="org-keyword">print</span>(
            <span class="org-string">"  \033[1;31mWarning:\033[0;31m Gmail raises an error when more than"</span>
            + <span class="org-string">"\033[1;31m15\033[0;31m simultanious connections are attempted."</span>
            + <span class="org-string">"\n           You are attempting to monitor "</span>
            + f<span class="org-string">"\033[1;31m{len(currentAccountData['boxes'])}\033[0;31m mailboxes.\033[0;37m"</span>
        )

    <span class="org-variable-name">configFile</span> = (
        imapnotifyConfigFolder
        / accountToFoldername(currentAccount)
        / imapnotifyConfigFilename
    )
    configFile.parent.mkdir(exist_ok=<span class="org-constant">True</span>)

    json.dump(currentAccountData, <span class="org-builtin">open</span>(configFile, <span class="org-string">"w"</span>), indent=<span class="org-highlight-numbers-number">2</span>)
    <span class="org-keyword">print</span>(f<span class="org-string">" \033[0;35mConfig generated and saved to {configFile}\033[0;37m"</span>)

    <span class="org-keyword">global</span> successfulAdditions
    successfulAdditions.append(accountToFoldername(currentAccount))


<span class="org-keyword">def</span> <span class="org-function-name">getMailBoxes</span>(account):
    <span class="org-variable-name">boxes</span> = subprocess.run(
        [<span class="org-string">"mbsync"</span>, <span class="org-string">"--list"</span>, account], check=<span class="org-constant">True</span>, stdout=subprocess.PIPE, timeout=<span class="org-highlight-numbers-number">10.0</span>
    )
    <span class="org-keyword">return</span> boxes.stdout.decode(<span class="org-string">"utf-8"</span>).strip().split(<span class="org-string">"\n"</span>)


<span class="org-keyword">def</span> <span class="org-function-name">applyPatternFilter</span>(pattern, mailboxes):
    <span class="org-variable-name">patternRegexs</span> = getPatternRegexes(pattern)
    <span class="org-keyword">return</span> [m <span class="org-keyword">for</span> m <span class="org-keyword">in</span> mailboxes <span class="org-keyword">if</span> testPatternRegexs(patternRegexs, m)]


<span class="org-keyword">def</span> <span class="org-function-name">getPatternRegexes</span>(pattern):
    <span class="org-keyword">def</span> <span class="org-function-name">addGlob</span>(b):
        blobs.append(b.replace(<span class="org-string">'\\"'</span>, <span class="org-string">'"'</span>))
        <span class="org-keyword">return</span> <span class="org-string">""</span>

    <span class="org-variable-name">blobs</span> = []
    <span class="org-variable-name">pattern</span> = re.sub(r<span class="org-string">' ?"([^"]+)"'</span>, <span class="org-keyword">lambda</span> m: addGlob(m.groups()[<span class="org-highlight-numbers-number">0</span>]), pattern)
    blobs.extend(pattern.split(<span class="org-string">" "</span>))
    <span class="org-variable-name">blobs</span> = [
        (-<span class="org-highlight-numbers-number">1</span>, fnmatch.translate(b[<span class="org-highlight-numbers-number">1</span>::])) <span class="org-keyword">if</span> b[<span class="org-highlight-numbers-number">0</span>] == <span class="org-string">"!"</span> <span class="org-keyword">else</span> (<span class="org-highlight-numbers-number">1</span>, fnmatch.translate(b))
        <span class="org-keyword">for</span> b <span class="org-keyword">in</span> blobs
    ]
    <span class="org-keyword">return</span> blobs


<span class="org-keyword">def</span> <span class="org-function-name">testPatternRegexs</span>(regexCond, case):
    <span class="org-keyword">for</span> factor, regex <span class="org-keyword">in</span> regexCond:
        <span class="org-keyword">if</span> factor * <span class="org-builtin">bool</span>(re.match(regex, case)) &lt; <span class="org-highlight-numbers-number">0</span>:
            <span class="org-keyword">return</span> <span class="org-constant">False</span>
    <span class="org-keyword">return</span> <span class="org-constant">True</span>


<span class="org-keyword">def</span> <span class="org-function-name">processSystemdServices</span>():
    <span class="org-variable-name">keptAccounts</span> = [acc <span class="org-keyword">for</span> acc <span class="org-keyword">in</span> successfulAdditions <span class="org-keyword">if</span> acc <span class="org-keyword">in</span> oldAccounts]
    <span class="org-variable-name">freshAccounts</span> = [acc <span class="org-keyword">for</span> acc <span class="org-keyword">in</span> successfulAdditions <span class="org-keyword">if</span> acc <span class="org-keyword">not</span> <span class="org-keyword">in</span> oldAccounts]
    <span class="org-variable-name">staleAccounts</span> = [acc <span class="org-keyword">for</span> acc <span class="org-keyword">in</span> oldAccounts <span class="org-keyword">if</span> acc <span class="org-keyword">not</span> <span class="org-keyword">in</span> successfulAdditions]

    <span class="org-keyword">if</span> keptAccounts:
        <span class="org-keyword">print</span>(f<span class="org-string">"\033[1;34m{len(keptAccounts)}\033[0;34m kept accounts:\033[0;37m"</span>)
        restartAccountSystemdServices(keptAccounts)

    <span class="org-keyword">if</span> freshAccounts:
        <span class="org-keyword">print</span>(f<span class="org-string">"\033[1;32m{len(freshAccounts)}\033[0;32m new accounts:\033[0;37m"</span>)
        enableAccountSystemdServices(freshAccounts)
    <span class="org-keyword">else</span>:
        <span class="org-keyword">print</span>(f<span class="org-string">"\033[0;32mNo new accounts.\033[0;37m"</span>)

    <span class="org-variable-name">notActuallyEnabledAccounts</span> = [
        acc <span class="org-keyword">for</span> acc <span class="org-keyword">in</span> successfulAdditions <span class="org-keyword">if</span> <span class="org-keyword">not</span> getAccountServiceState(acc)[<span class="org-string">"enabled"</span>]
    ]
    <span class="org-keyword">if</span> notActuallyEnabledAccounts:
        <span class="org-keyword">print</span>(
            f<span class="org-string">"\033[1;32m{len(notActuallyEnabledAccounts)}\033[0;32m accounts need re-enabling:\033[0;37m"</span>
        )
        enableAccountSystemdServices(notActuallyEnabledAccounts)

    <span class="org-keyword">if</span> staleAccounts:
        <span class="org-keyword">print</span>(f<span class="org-string">"\033[1;33m{len(staleAccounts)}\033[0;33m removed accounts:\033[0;37m"</span>)
        disableAccountSystemdServices(staleAccounts)
    <span class="org-keyword">else</span>:
        <span class="org-keyword">print</span>(f<span class="org-string">"\033[0;33mNo removed accounts.\033[0;37m"</span>)


<span class="org-keyword">def</span> <span class="org-function-name">enableAccountSystemdServices</span>(accounts):
    <span class="org-keyword">for</span> account <span class="org-keyword">in</span> accounts:
        <span class="org-keyword">print</span>(f<span class="org-string">" \033[0;32m - \033[1;37m{account:&lt;18}"</span>, end=<span class="org-string">"\033[0;37m"</span>, flush=<span class="org-constant">True</span>)
        <span class="org-keyword">if</span> setSystemdServiceState(
                <span class="org-string">"enable"</span>, f<span class="org-string">"goimapnotify@{accountToFoldername(account)}.service"</span>
        ):
            <span class="org-keyword">print</span>(<span class="org-string">"\033[1;32m enabled"</span>)


<span class="org-keyword">def</span> <span class="org-function-name">disableAccountSystemdServices</span>(accounts):
    <span class="org-keyword">for</span> account <span class="org-keyword">in</span> accounts:
        <span class="org-keyword">print</span>(f<span class="org-string">" \033[0;33m - \033[1;37m{account:&lt;18}"</span>, end=<span class="org-string">"\033[0;37m"</span>, flush=<span class="org-constant">True</span>)
        <span class="org-keyword">if</span> setSystemdServiceState(
                <span class="org-string">"disable"</span>, f<span class="org-string">"goimapnotify@{accountToFoldername(account)}.service"</span>
        ):
            <span class="org-keyword">print</span>(<span class="org-string">"\033[1;33m disabled"</span>)


<span class="org-keyword">def</span> <span class="org-function-name">restartAccountSystemdServices</span>(accounts):
    <span class="org-keyword">for</span> account <span class="org-keyword">in</span> accounts:
        <span class="org-keyword">print</span>(f<span class="org-string">" \033[0;34m - \033[1;37m{account:&lt;18}"</span>, end=<span class="org-string">"\033[0;37m"</span>, flush=<span class="org-constant">True</span>)
        <span class="org-keyword">if</span> setSystemdServiceState(
                <span class="org-string">"restart"</span>, f<span class="org-string">"goimapnotify@{accountToFoldername(account)}.service"</span>
        ):
            <span class="org-keyword">print</span>(<span class="org-string">"\033[1;34m restarted"</span>)


<span class="org-keyword">def</span> <span class="org-function-name">setSystemdServiceState</span>(state, service):
    <span class="org-keyword">try</span>:
        <span class="org-variable-name">enabler</span> = subprocess.run(
            [<span class="org-string">"systemctl"</span>, <span class="org-string">"--user"</span>, state, service, <span class="org-string">"--now"</span>],
            check=<span class="org-constant">True</span>,
            stderr=subprocess.DEVNULL,
            timeout=<span class="org-highlight-numbers-number">5.0</span>,
        )
        <span class="org-keyword">return</span> <span class="org-constant">True</span>
    <span class="org-keyword">except</span> subprocess.CalledProcessError <span class="org-keyword">as</span> e:
        <span class="org-keyword">print</span>(
            f<span class="org-string">" \033[1;31mfailed\033[0;31m to {state}, `{' '.join(e.cmd)}'"</span>
            + f<span class="org-string">"returned code {e.returncode}\033[0;37m"</span>
        )
    <span class="org-keyword">except</span> subprocess.TimeoutExpired <span class="org-keyword">as</span> e:
        <span class="org-keyword">print</span>(f<span class="org-string">" \033[1;31mtimed out after {e.timeout:.2f} seconds\033[0;37m"</span>)
        <span class="org-keyword">return</span> <span class="org-constant">False</span>


<span class="org-keyword">def</span> <span class="org-function-name">getAccountServiceState</span>(account):
    <span class="org-keyword">return</span> {
        state: <span class="org-builtin">bool</span>(
            <span class="org-highlight-numbers-number">1</span>
            - subprocess.run(
                [
                    <span class="org-string">"systemctl"</span>,
                    <span class="org-string">"--user"</span>,
                    f<span class="org-string">"is-{state}"</span>,
                    <span class="org-string">"--quiet"</span>,
                    f<span class="org-string">"goimapnotify@{accountToFoldername(account)}.service"</span>,
                ],
                stderr=subprocess.DEVNULL,
            ).returncode
        )
        <span class="org-keyword">for</span> state <span class="org-keyword">in</span> (<span class="org-string">"enabled"</span>, <span class="org-string">"active"</span>, <span class="org-string">"failing"</span>)
    }


<span class="org-keyword">def</span> <span class="org-function-name">getAccountServiceStates</span>(accounts):
    <span class="org-keyword">for</span> account <span class="org-keyword">in</span> accounts:
        <span class="org-variable-name">enabled</span>, <span class="org-variable-name">active</span>, <span class="org-variable-name">failing</span> = getAccountServiceState(account).values()
        <span class="org-keyword">print</span>(f<span class="org-string">"  - \033[1;37m{account:&lt;18}\033[0;37m "</span>, end=<span class="org-string">""</span>, flush=<span class="org-constant">True</span>)
        <span class="org-keyword">if</span> <span class="org-keyword">not</span> enabled:
            <span class="org-keyword">print</span>(<span class="org-string">"\033[1;33mdisabled\033[0;37m"</span>)
        <span class="org-keyword">elif</span> active:
            <span class="org-keyword">print</span>(<span class="org-string">"\033[1;32mactive\033[0;37m"</span>)
        <span class="org-keyword">elif</span> failing:
            <span class="org-keyword">print</span>(<span class="org-string">"\033[1;31mfailing\033[0;37m"</span>)
        <span class="org-keyword">else</span>:
            <span class="org-keyword">print</span>(<span class="org-string">"\033[1;35min an unrecognised state\033[0;37m"</span>)


<span class="org-keyword">if</span> <span class="org-builtin">len</span>(sys.argv) &gt; <span class="org-highlight-numbers-number">1</span>:
    <span class="org-keyword">if</span> sys.argv[<span class="org-highlight-numbers-number">1</span>]   <span class="org-keyword">in</span> [<span class="org-string">"-e"</span>, <span class="org-string">"--enable"</span>]:
        enableAccountSystemdServices(oldAccounts)
        <span class="org-constant">exit</span>()
    <span class="org-keyword">elif</span> sys.argv[<span class="org-highlight-numbers-number">1</span>] <span class="org-keyword">in</span> [<span class="org-string">"-d"</span>, <span class="org-string">"--disable"</span>]:
        disableAccountSystemdServices(oldAccounts)
        <span class="org-constant">exit</span>()
    <span class="org-keyword">elif</span> sys.argv[<span class="org-highlight-numbers-number">1</span>] <span class="org-keyword">in</span> [<span class="org-string">"-r"</span>, <span class="org-string">"--restart"</span>]:
        restartAccountSystemdServices(oldAccounts)
        <span class="org-constant">exit</span>()
    <span class="org-keyword">elif</span> sys.argv[<span class="org-highlight-numbers-number">1</span>] <span class="org-keyword">in</span> [<span class="org-string">"-s"</span>, <span class="org-string">"--status"</span>]:
        getAccountServiceStates(oldAccounts)
        <span class="org-constant">exit</span>()
    <span class="org-keyword">elif</span> sys.argv[<span class="org-highlight-numbers-number">1</span>] <span class="org-keyword">in</span> [<span class="org-string">"-h"</span>, <span class="org-string">"--help"</span>]:
        <span class="org-keyword">print</span>(<span class="org-string">"""\033[1;37mMbsync to IMAP Notify config generator.\033[0;37m</span>

<span class="org-string">Usage: mbsync-imapnotify [options]</span>

<span class="org-string">Options:</span>
<span class="org-string">    -e, --enable       enable all services</span>
<span class="org-string">    -d, --disable      disable all services</span>
<span class="org-string">    -r, --restart      restart all services</span>
<span class="org-string">    -s, --status       fetch the status for all services</span>
<span class="org-string">    -h, --help         show this help</span>
<span class="org-string">"""</span>, end=<span class="org-string">''</span>)
        <span class="org-constant">exit</span>()
    <span class="org-keyword">else</span>:
        <span class="org-keyword">print</span>(f<span class="org-string">"\033[0;31mFlag {sys.argv[1]} not recognised, try --help\033[0;37m"</span>)
        <span class="org-constant">exit</span>()


<span class="org-variable-name">mbsyncData</span> = <span class="org-builtin">open</span>(mbsyncFile, <span class="org-string">"r"</span>).read()

<span class="org-variable-name">currentAccountNumber</span> = <span class="org-highlight-numbers-number">0</span>

<span class="org-variable-name">totalAccounts</span> = <span class="org-builtin">len</span>(re.findall(r<span class="org-string">"^IMAPAccount"</span>, mbsyncData, re.M))


<span class="org-keyword">def</span> <span class="org-function-name">main</span>():
    <span class="org-keyword">print</span>(<span class="org-string">"\033[1;34m:: MbSync to Go IMAP notify config file creator ::\033[0;37m"</span>)

    shutil.rmtree(imapnotifyConfigFolder)
    imapnotifyConfigFolder.mkdir(exist_ok=<span class="org-constant">False</span>)
    <span class="org-keyword">print</span>(<span class="org-string">"\033[1;30mImap Notify config dir purged\033[0;37m"</span>)

    <span class="org-keyword">print</span>(f<span class="org-string">"Identified \033[1;32m{totalAccounts}\033[0;32m accounts.\033[0;37m"</span>)

    <span class="org-keyword">for</span> line <span class="org-keyword">in</span> mbsyncData.split(<span class="org-string">"\n"</span>):
        processLine(line)

    finaliseAccount()

    <span class="org-keyword">print</span>(
        f<span class="org-string">"\nConfig files generated for \033[1;36m{len(successfulAdditions)}\033[0;36m"</span>
        + f<span class="org-string">" out of \033[1;36m{totalAccounts}\033[0;37m accounts.\n"</span>
    )

    processSystemdServices()


<span class="org-keyword">if</span> <span class="org-builtin">__name__</span> == <span class="org-string">"__main__"</span>:
    main()
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-fetching-systemd" class="outline-5">
<h5 id="fetching-systemd"><span class="section-number-5">5.5.1.3</span> Systemd<a aria-hidden="true" href="#fetching-systemd">#</a> </h5>
<div class="outline-text-5" id="text-5-5-1-3">
<p>
We then have a service file to run <code>goimapnotify</code> on all of these generated config files.
We&rsquo;ll use a template service file so we can enable a unit per-account.
</p>
<details id='systemd,code--2' class='code' open><summary><span class='lang'>systemd</span></summary>
    <div class='gutter'>
    <a href='#systemd,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-systemd"><span class="org-type">[Unit]</span>
<span class="org-keyword">Description</span>=IMAP notifier using IDLE, golang version.
<span class="org-keyword">ConditionPathExists</span>=<span class="org-constant">%h</span>/.config/imapnotify/<span class="org-constant">%I</span>/notify.conf
<span class="org-keyword">After</span>=network.target

<span class="org-type">[Service]</span>
<span class="org-keyword">ExecStart</span>=<span class="org-constant">%h</span>/.local/bin/goimapnotify -conf <span class="org-constant">%h</span>/.config/imapnotify/<span class="org-constant">%I</span>/notify.conf
<span class="org-keyword">Restart</span>=<span class="org-builtin">always</span>
<span class="org-keyword">RestartSec</span>=<span class="org-highlight-numbers-number">30</span>

<span class="org-type">[Install]</span>
<span class="org-keyword">WantedBy</span>=default.target
</pre>
</div>
    </details>

<p>
Enabling the service is actually taken care of by that python script.
</p>

<p>
From one or two small tests, this can bring the delay down to as low as five
seconds, which I&rsquo;m quite happy with.
</p>

<p>
This works well for fetching new mail, but we also want to propagate other
changes (e.g. marking mail as read), and make sure we&rsquo;re up to date at the
start, so for that I&rsquo;ll do the &rsquo;normal&rsquo; thing and run <code>mbsync -all</code> every so often
&#x2014; let&rsquo;s say five minutes.
</p>

<p>
We can accomplish this via a systemd timer, and service file.
</p>
<details id='systemd,code--3' class='code' open><summary><span class='lang'>systemd</span></summary>
    <div class='gutter'>
    <a href='#systemd,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-systemd"><span class="org-type">[Unit]</span>
<span class="org-keyword">Description</span>=call mbsync on all accounts every <span class="org-highlight-numbers-number">5</span> minutes
<span class="org-keyword">ConditionPathExists</span>=<span class="org-constant">%h</span>/.mbsyncrc

<span class="org-type">[Timer]</span>
<span class="org-keyword">OnBootSec</span>=5m
<span class="org-keyword">OnUnitInactiveSec</span>=5m

<span class="org-type">[Install]</span>
<span class="org-keyword">WantedBy</span>=default.target
</pre>
</div>
    </details>

<details id='systemd,code--4' class='code' open><summary><span class='lang'>systemd</span></summary>
    <div class='gutter'>
    <a href='#systemd,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-systemd"><span class="org-type">[Unit]</span>
<span class="org-keyword">Description</span>=mbsync service, sync all mail
<span class="org-keyword">Documentation</span>=man:mbsync(<span class="org-highlight-numbers-number">1</span>)
<span class="org-keyword">ConditionPathExists</span>=<span class="org-constant">%h</span>/.mbsyncrc

<span class="org-type">[Service]</span>
<span class="org-keyword">Type</span>=<span class="org-builtin">oneshot</span>
<span class="org-keyword">ExecStart</span>=/usr/bin/mbsync -c <span class="org-constant">%h</span>/.mbsyncrc --all

<span class="org-type">[Install]</span>
<span class="org-keyword">WantedBy</span>=mail.target
</pre>
</div>
    </details>

<p>
Enabling (and starting) this is as simple as
</p>
<details id='systemd,code--5' class='code' open><summary><span class='lang'>Shell Script</span></summary>
    <div class='gutter'>
    <a href='#systemd,code--5'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell">systemctl --user enable mbsync.timer --now
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-indexing-searching" class="outline-4">
<h4 id="indexing-searching"><span class="section-number-4">5.5.2</span> Indexing/Searching<a aria-hidden="true" href="#indexing-searching">#</a> </h4>
<div class="outline-text-4" id="text-5-5-2">
<p>
This is performed by <a href="https://www.djcbsoftware.nl/code/mu/">Mu</a>. This is a tool for finding emails stored in the <a href="http://en.wikipedia.org/wiki/Maildir">Maildir</a> format.
According to the homepage, it&rsquo;s main features are
</p>
<ul class="org-ul">
<li>Fast indexing</li>
<li>Good searching</li>
<li>Support for encrypted and signed messages</li>
<li>Rich <span class='acr'>CLI</span> tooling</li>
<li>accent/case normalisation</li>
<li>strong integration with email clients</li>
</ul>

<p>
Unfortunately <code>mu</code> is not currently packaged from me. Oh well, I guess I&rsquo;m
building it from source then. I needed to install these packages
</p>
<ul class="org-ul">
<li><kbd>gmime-devel</kbd></li>
<li><kbd>xapian-core-devel</kbd></li>
</ul>

<details id='install-mu-from' class='code' open><summary class='named'><span class='name'>Install mu from source</span><span class='lang'>Shell Script</span></summary>
    <div class='gutter'>
    <a href='#install-mu-from'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell"><span class="org-type">cd</span> ~/.local/lib/
<span class="org-type">git</span> clone https://github.com/djcb/mu.git
<span class="org-type">cd</span> ./mu
./autogen.sh
<span class="org-type">make</span>
<span class="org-type">sudo</span> <span class="org-type">make</span> install
</pre>
</div>
    </details>

<p>
To check how my version compares to the latest published:
</p>

<details id='indexing-searching,code--1' class='code' open><summary><span class='lang'>Shell Script</span></summary>
    <div class='gutter'>
    <a href='#indexing-searching,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell"><span class="org-type">curl</span> --silent <span class="org-string">"https://api.github.com/repos/djcb/mu/releases/latest"</span> | <span class="org-type">grep</span> <span class="org-string">'"tag_name":'</span> | sed -E <span class="org-string">'s/.*"([^"]+)".*/\1/'</span>
mu --version | head -n <span class="org-highlight-numbers-number">1</span> | sed <span class="org-string">'s/.* version //'</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-sending" class="outline-4">
<h4 id="sending"><span class="section-number-4">5.5.3</span> Sending<a aria-hidden="true" href="#sending">#</a> </h4>
<div class="outline-text-4" id="text-5-5-3">
<p>
<a href="https://www.nongnu.org/smtpmail/">SmtpMail</a> seems to be the &rsquo;default&rsquo; starting point, but that&rsquo;s not packaged for
me. <a href="https://marlam.de/msmtp/">msmtp</a> is however, so I&rsquo;ll give that a shot. Reading around a bit (googling
&ldquo;msmtp vs sendmail&rdquo; for example) almost every comparison mentioned seems to
suggest msmtp to be a better choice. I have seen the following points raised
</p>
<ul class="org-ul">
<li><code>sendmail</code> has several vulnerabilities</li>
<li><code>sendmail</code> is tedious to configure</li>
<li><code>ssmtp</code> is no longer maintained</li>
<li><code>msmtp</code> is a maintained alternative to <code>ssmtp</code></li>
<li><code>msmtp</code> is easier to configure</li>
</ul>

<p>
The config file is <a href="file:///home/runner/.msmtprc">~/.msmtprc</a>
</p>
</div>

<div id="outline-container-system-hackery" class="outline-5">
<h5 id="system-hackery"><span class="section-number-5">5.5.3.1</span> System hackery<a aria-hidden="true" href="#system-hackery">#</a> </h5>
<div class="outline-text-5" id="text-5-5-3-1">
<p>
Unfortunately, I seem to have run into a <a href="https://bugs.archlinux.org/task/44994">bug</a> present in my packaged version, so
we&rsquo;ll just install the latest from source.
</p>

<p>
For full use of the <code>auth</code> options, I need <kbd>GNU SASL</kbd>, which isn&rsquo;t packaged for me.
I don&rsquo;t think I want it, but in case I do, I&rsquo;ll need to do this.
</p>
<details id='install-gsasl-from' class='code' open><summary class='named'><span class='name'>Install gsasl from source</span><span class='lang'>Shell Script</span></summary>
    <div class='gutter'>
    <a href='#install-gsasl-from'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell"><span class="org-builtin">export</span> <span class="org-variable-name">GSASL_VERSION</span>=1.8.1
<span class="org-type">cd</span> ~/.local/lib/
<span class="org-type">curl</span> <span class="org-string">"ftp://ftp.gnu.org/gnu/gsasl/libgsasl-</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">GSASL_VERSION</span></span><span class="org-string">.tar.gz"</span> | tar xz
<span class="org-type">curl</span> <span class="org-string">"ftp://ftp.gnu.org/gnu/gsasl/gsasl-</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">GSASL_VERSION</span></span><span class="org-string">.tar.gz"</span> | tar xz
<span class="org-type">cd</span> <span class="org-string">"./libgsasl-</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">GSASL_VERSION</span></span><span class="org-string">"</span>
./configure
<span class="org-type">make</span>
<span class="org-type">sudo</span> <span class="org-type">make</span> install
<span class="org-type">cd</span> ..
<span class="org-type">cd</span> <span class="org-string">"./gsasl-</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">VERSION</span></span><span class="org-string">"</span>
./configure
<span class="org-type">make</span>
<span class="org-type">sudo</span> <span class="org-type">make</span> install
<span class="org-type">cd</span> ..
</pre>
</div>
    </details>

<p>
Now actually compile <code>msmtp</code>.
</p>
<details id='install-msmtp-from' class='code' open><summary class='named'><span class='name'>Install msmtp from source</span><span class='lang'>Shell Script</span></summary>
    <div class='gutter'>
    <a href='#install-msmtp-from'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell"><span class="org-type">cd</span> ~/.local/lib/
<span class="org-type">git</span> clone https://github.com/marlam/msmtp-mirror.git ./msmtp
<span class="org-type">cd</span> ./msmtp
libtoolize --force
aclocal
autoheader
automake --force-missing --add-missing
autoconf
<span class="org-comment-delimiter"># </span><span class="org-comment">if using GSASL</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">PKG_CONFIG_PATH=/usr/local/lib/pkgconfig ./configure --with-libgsasl</span>
./configure
<span class="org-type">make</span>
<span class="org-type">sudo</span> <span class="org-type">make</span> install
</pre>
</div>
    </details>

<p>
If using <kbd>GSASL</kbd> (from earlier) we need to make ensure that the dynamic library in
in the library path. We can do by adding an executable with the same name
earlier on in my <code>$PATH</code>.
</p>
<details id='system-hackery,code--1' class='code' open><summary><span class='lang'>shell</span></summary>
    <div class='gutter'>
    <a href='#system-hackery,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-sh"><span class="org-variable-name">LD_LIBRARY_PATH</span>=/usr/local/lib exec /usr/local/bin/msmtp <span class="org-string">"</span><span class="org-string"><span class="org-constant">$</span></span><span class="org-string"><span class="org-variable-name">@</span></span><span class="org-string">"</span>
</pre>
</div>
    </details>
</div>
</div>
</div>

<div id="outline-container-mu4e" class="outline-4">
<h4 id="mu4e"><span class="section-number-4">5.5.4</span> Mu4e<a aria-hidden="true" href="#mu4e">#</a> </h4>
<div class="outline-text-4" id="text-5-5-4">
<p>
Webmail clients are nice and all, but I still don&rsquo;t believe that <span class='acr'>SPA</span><small>s</small> in my
browser can replaced desktop apps &#x2026; sorry Gmail. I&rsquo;m also liking google less
and less.
</p>

<p>
Mailspring is a decent desktop client, quite lightweight for electron
(apparently the backend is in <kbd>C</kbd>, which probably helps), however I miss Emacs
stuff.
</p>

<p>
While <kbd>Notmuch</kbd> seems very promising, and I&rsquo;ve heard good things about it, it
doesn&rsquo;t seem to make any changes to the emails themselves. All data is stored in
Notmuch&rsquo;s database. While this is a very interesting model, occasionally I need
to pull up an email on say my phone, and so not I want the tagging/folders etc.
to be applied to the mail itself &#x2014; not stored in a database.
</p>

<p>
On the other hand <kbd>Mu4e</kbd> is also talked about a lot in positive terms, and seems
to possess a similarly strong feature set &#x2014; and modifies the mail itself (I.e.
information is accessible without the database). <kbd>Mu4e</kbd> also seems to have a large
user base, which tends to correlate with better support and attention.
</p>

<p>
As I installed mu4e from source, I need to add the <kbd>/usr/local/</kbd> loadpath so Mu4e has a chance of loading
</p>
<details id='mu4e,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#mu4e,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">load-path</span> <span class="org-string">"/usr/local/share/emacs/site-lisp/mu4e"</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>

<div id="outline-container-viewing-mail" class="outline-5">
<h5 id="viewing-mail"><span class="section-number-5">5.5.4.1</span> Viewing Mail<a aria-hidden="true" href="#viewing-mail">#</a> </h5>
<div class="outline-text-5" id="text-5-5-4-1">
<p>
There seem to be some advantages with using Gnus&rsquo; article view (such as inline
images), and judging from <a href="https://github.com/djcb/mu/pull/1442#issuecomment-591695814">djcb/mu!1442 (comment)</a> this seems to be the &rsquo;way of
the future&rsquo; for mu4e.
</p>

<p>
There are some all-the-icons font related issues, so we need to redefine the
fancy chars, and make sure they get the correct width.
</p>

<p>
To account for the increase width of each flag character, and make perform a
few more visual tweaks, we&rsquo;ll tweak the headers a bit
</p>
<details id='viewing-mail,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#viewing-mail,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> mu4e
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> mu4e-headers-fields
        <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-builtin">:flags</span> . <span class="org-highlight-numbers-number">6</span><span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-builtin">:account-stripe</span> . <span class="org-highlight-numbers-number">2</span><span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-builtin">:from-or-to</span> . <span class="org-highlight-numbers-number">25</span><span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-builtin">:folder</span> . <span class="org-highlight-numbers-number">10</span><span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-builtin">:recipnum</span> . <span class="org-highlight-numbers-number">2</span><span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-builtin">:subject</span> . <span class="org-highlight-numbers-number">80</span><span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-builtin">:human-date</span> . <span class="org-highlight-numbers-number">8</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        +mu4e-min-header-frame-width <span class="org-highlight-numbers-number">142</span>
        mu4e-headers-date-format <span class="org-string">"%d/%m/%y"</span>
        mu4e-headers-time-format <span class="org-string">"&#10710; %H:%M"</span>
        mu4e-headers-results-limit <span class="org-highlight-numbers-number">1000</span>
        mu4e-index-cleanup t<span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">mu4e-bookmarks</span>
               <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:name</span> <span class="org-string">"Yesterday's messages"</span> <span class="org-builtin">:query</span> <span class="org-string">"date:2d..1d"</span> <span class="org-builtin">:key</span> ?y<span class="org-rainbow-delimiters-depth-3">)</span> t<span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">+mu4e-header--folder-colors</span> nil<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">appendq!</span> mu4e-header-info-custom
            <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-builtin">:folder</span> .
               <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:name</span> <span class="org-string">"Folder"</span> <span class="org-builtin">:shortname</span> <span class="org-string">"Folder"</span> <span class="org-builtin">:help</span> <span class="org-string">"Lowest level folder"</span> <span class="org-builtin">:function</span>
                <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-1">(</span>msg<span class="org-rainbow-delimiters-depth-1">)</span>
                  <span class="org-rainbow-delimiters-depth-1">(</span>+mu4e-colorize-str
                   <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">replace-regexp-in-string</span> <span class="org-string">"\\`.*/"</span> <span class="org-string">""</span> <span class="org-rainbow-delimiters-depth-3">(</span>mu4e-message-field msg <span class="org-builtin">:maildir</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                   <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">+mu4e-header--folder-colors</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
We&rsquo;ll also use a nicer alert icon
</p>
<details id='viewing-mail,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#viewing-mail,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> mu4e-alert-icon <span class="org-string">"/usr/share/icons/Papirus/64x64/apps/evolution.svg"</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-sending-mail" class="outline-5">
<h5 id="sending-mail"><span class="section-number-5">5.5.4.2</span> Sending Mail<a aria-hidden="true" href="#sending-mail">#</a> </h5>
<div class="outline-text-5" id="text-5-5-4-2">
<p>
Let&rsquo;s send emails too.
</p>
<details id='sending-mail,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#sending-mail,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> mu4e
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> sendmail-program <span class="org-string">"/usr/bin/msmtp"</span>
        <span class="org-variable-name">send-mail-function</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">smtpmail-send-it</span>
        <span class="org-variable-name">message-sendmail-f-is-evil</span> t
        <span class="org-variable-name">message-sendmail-extra-arguments</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"--read-envelope-from"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-comment-delimiter">; </span><span class="org-comment">, "--read-recipients")</span>
        <span class="org-variable-name">message-send-mail-function</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">message-send-mail-with-sendmail</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
It&rsquo;s also nice to avoid accidentally sending emails with the wrong account.
If we can send from the address in the <code>To</code> field, let&rsquo;s do that. Opening an <code>ivy</code>
prompt otherwise also seems sensible.
</p>

<p>
We can register Emacs as a potential email client with the following desktop
file, thanks to Etienne Deparis&rsquo;s <a href="https://etienne.depar.is/emacs.d/mu4e.html">Mu4e customization</a>.
</p>
<details id='sending-mail,code--2' class='code' open><summary><span class='lang'>Configuration File</span></summary>
    <div class='gutter'>
    <a href='#sending-mail,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-conf">[<span class="org-type">Desktop Entry</span>]
<span class="org-variable-name">Name</span>=Compose message in Emacs
<span class="org-variable-name">GenericName</span>=Compose a new message with Mu4e in Emacs
<span class="org-variable-name">Comment</span>=Open mu4e compose window
<span class="org-variable-name">MimeType</span>=x-scheme-handler/mailto;
<span class="org-variable-name">Exec</span>=emacsclient -create-frame --alternate-editor=<span class="org-string">""</span> --no-wait --eval <span class="org-string">'(progn (x-focus-frame nil) (mu4e-compose-from-mailto "%u"))'</span>
<span class="org-variable-name">Icon</span>=emacs
<span class="org-variable-name">Type</span>=Application
<span class="org-variable-name">Terminal</span>=false
<span class="org-variable-name">Categories</span>=Network;Email;
<span class="org-variable-name">StartupWMClass</span>=Emacs
</pre>
</div>
    </details>

<p>
To register this, just call
</p>
<details id='sending-mail,code--3' class='code' open><summary><span class='lang'>Shell Script</span></summary>
    <div class='gutter'>
    <a href='#sending-mail,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell">update-desktop-database ~/.local/share/applications
</pre>
</div>
    </details>

<p>
We also want to define <code>mu4e-compose-from-mailto</code>.
</p>
<details id='sending-mail,code--4' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#sending-mail,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">mu4e-compose-from-mailto</span> <span class="org-rainbow-delimiters-depth-2">(</span>mailto-string<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">require</span> <span class="org-highlight-quoted-quote">'</span><span class="org-constant">mu4e</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">unless</span> mu4e~server-props <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">mu4e</span> t<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">sleep-for</span> <span class="org-highlight-numbers-number">0.1</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>mailto <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">rfc2368-parse-mailto-url</span> mailto-string<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>to <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">cdr</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">assoc</span> <span class="org-string">"To"</span> mailto<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>subject <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">cdr</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">assoc</span> <span class="org-string">"Subject"</span> mailto<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>body <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">cdr</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">assoc</span> <span class="org-string">"Body"</span> mailto<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>org-msg-greeting-fmt <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">assoc</span> <span class="org-string">"Body"</span> mailto<span class="org-rainbow-delimiters-depth-3">)</span>
                                   <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">replace-regexp-in-string</span> <span class="org-string">"%"</span> <span class="org-string">"%%"</span>
                                                             <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">cdr</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">assoc</span> <span class="org-string">"Body"</span> mailto<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                                 org-msg-greeting-fmt<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>headers <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">-filter</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-1">(</span>spec<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">not</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">-contains-p</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"To"</span> <span class="org-string">"Subject"</span> <span class="org-string">"Body"</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">car</span> spec<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span> mailto<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>mu4e~compose-mail to subject headers<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
This may not quite function as intended for now due to <a href="https://github.com/jeremy-compostella/org-msg/issues/52">jeremy-compostella/org-msg#52</a>.
</p>
</div>
</div>
</div>
<div id="outline-container-org-msg" class="outline-4">
<h4 id="org-msg"><span class="section-number-4">5.5.5</span> Org Msg<a aria-hidden="true" href="#org-msg">#</a> </h4>
<div class="outline-text-4" id="text-5-5-5">
<p>
Doom does a fantastic stuff with the defaults with this, so we only make a few
minor tweaks.
</p>
<details id='org-msg,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#org-msg,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> +org-msg-accent-color <span class="org-string">"#1a5fb4"</span>
      org-msg-greeting-fmt <span class="org-string">"\nHi %s,\n\n"</span>
      org-msg-signature <span class="org-string">"\n\n#+begin_signature\nAll the best,\\\\\n*Timothy*\n#+end_signature"</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">map!</span> <span class="org-builtin">:map</span> org-msg-edit-mode-map
      <span class="org-builtin">:after</span> org-msg
      <span class="org-builtin">:n</span> <span class="org-string">"G"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-msg-goto-body</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
</div>
<div id="outline-container-language-configuration" class="outline-2">
<h2 id="language-configuration"><span class="section-number-2">6</span> Language configuration<a aria-hidden="true" href="#language-configuration">#</a> </h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-general" class="outline-3">
<h3 id="general"><span class="section-number-3">6.1</span> General<a aria-hidden="true" href="#general">#</a> </h3>
<div class="outline-text-3" id="text-6-1">
</div>
<div id="outline-container-file-templates" class="outline-4">
<h4 id="file-templates"><span class="section-number-4">6.1.1</span> File Templates<a aria-hidden="true" href="#file-templates">#</a> </h4>
<div class="outline-text-4" id="text-6-1-1">
<p>
For some file types, we overwrite defaults in the <a href="./snippets">snippets</a> directory, others
need to have a template assigned.
</p>
<details id='file-templates,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#file-templates,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">set-file-template!</span> <span class="org-string">"\\.tex$"</span> <span class="org-builtin">:trigger</span> <span class="org-string">"__"</span> <span class="org-builtin">:mode</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">latex-mode</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">set-file-template!</span> <span class="org-string">"\\.org$"</span> <span class="org-builtin">:trigger</span> <span class="org-string">"__"</span> <span class="org-builtin">:mode</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">org-mode</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">set-file-template!</span> <span class="org-string">"/LICEN[CS]E$"</span> <span class="org-builtin">:trigger</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">+file-templates/insert-license</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-plaintext" class="outline-3">
<h3 id="plaintext"><span class="section-number-3">6.2</span> Plaintext<a aria-hidden="true" href="#plaintext">#</a> </h3>
<div class="outline-text-3" id="text-6-2">
<p>
It&rsquo;s nice to see <span class='acr'>ANSI</span> colour codes displayed
</p>
<details id='plaintext,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#plaintext,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> text-mode
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">add-hook!</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">text-mode-hook</span>
             <span class="org-comment-delimiter">;; </span><span class="org-comment">Apply ANSI color codes</span>
             <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">with-silent-modifications</span>
               <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">ansi-color-apply-on-region</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">point-min</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">point-max</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-org" class="outline-3">
<h3 id="org"><span class="section-number-3">6.3</span> Org Mode<a aria-hidden="true" href="#org">#</a> </h3>
<div class="outline-text-3" id="text-org">
<p>
I really like org mode, I&rsquo;ve given some thought to why, and below is the result.
</p>

<div id=',table--1' class='table'>
    <div class='gutter'><a href='#,table--1'>#</a></div>
    <div class='tabular'>
    <table>


<colgroup>
<col  class="org-left">

<col  class="org-right">

<col  class="org-right">

<col  class="org-right">

<col  class="org-right">

<col  class="org-right">

<col  class="org-right">

<col  class="org-right">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Format</th>
<th scope="col" class="org-right">Fine-grained-control</th>
<th scope="col" class="org-right">Initial Effort</th>
<th scope="col" class="org-right">Syntax simplicity</th>
<th scope="col" class="org-right">Editor Support</th>
<th scope="col" class="org-right">Integrations</th>
<th scope="col" class="org-right">Ease-of-referencing</th>
<th scope="col" class="org-right">Versatility</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Word</td>
<td class="org-right">2</td>
<td class="org-right">4</td>
<td class="org-right">4</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-left">LaTeX</td>
<td class="org-right">4</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">3</td>
<td class="org-right">2</td>
<td class="org-right">4</td>
<td class="org-right">3</td>
</tr>

<tr>
<td class="org-left">Org Mode</td>
<td class="org-right">4</td>
<td class="org-right">2</td>
<td class="org-right">3.5</td>
<td class="org-right">1</td>
<td class="org-right">4</td>
<td class="org-right">4</td>
<td class="org-right">4</td>
</tr>

<tr>
<td class="org-left">Markdown</td>
<td class="org-right">1</td>
<td class="org-right">3</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
<td class="org-right">3</td>
<td class="org-right">3</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-left">Markdown + Pandoc</td>
<td class="org-right">2.5</td>
<td class="org-right">2.5</td>
<td class="org-right">2.5</td>
<td class="org-right">3</td>
<td class="org-right">3</td>
<td class="org-right">3</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
    </div>    </div>


<figure id="orgd13ecce">
<img src="https://tecosaur.com/lfs/emacs-config/document-format-comparison.png" alt="Radar chart comparing my opinions of document formats." class="invertible">

</figure>

<p>
Beyond the elegance in the markup language, tremendously rich integrations with
Emacs allow for some fantastic <a href="https://orgmode.org/features.html">features</a>, such as what seems to be the best
support for <a href="https://en.wikipedia.org/wiki/Literate_programming">literate programming</a> of any currently available technology.
</p>

<details id='orgd0e9feb' class='code' open>
    <summary></summary>
    <div class='gutter'>    <a href='#orgd0e9feb'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <pre class="example" style="line-height:1.13;" id="orgd0e9feb">
      ╭─╴Code╶─╮            ╭─╴Raw Code╶─▶ Computer
Ideas╺┥        ┝━▶ Org Mode╺┥
      ╰─╴Text╶─╯            ╰─╴Document╶─▶ People
</pre>

    </details>

<p>
An <kbd>.org</kbd> file can contain blocks of code (with <a href="https://en.wikipedia.org/wiki/Noweb">noweb</a> templating support), which
can be <a href="https://orgmode.org/manual/Extracting-Source-Code.html">tangled</a> to dedicated source code files, and <a href="https://orgmode.org/manual/Extracting-Source-Code.html">woven</a> into a document
(report, documentation, presentation, etc.) through various (<i>extensible</i>) methods.
These source blocks may even create images or other content to be included in
the document, or generate source code.
</p>

<details id='org71cebb0' class='code' open>
    <summary></summary>
    <div class='gutter'>    <a href='#org71cebb0'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <pre class="example" style="line-height:1.13;" id="org71cebb0">
                   ╭───────────────────────────────────▶ .pdf ⎫
                  pdfLaTeX ▶╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╮                 ⎪
                   ╿     ╿                  ┊                 ⎪
                   │     ┊                  ┊                 ⎪
                 .tex    ┊                  ┊                 ⎪
                   ╿     ┊                  ┊                 ⎪
                ╭──┴╌╌╮  ┊                  ┊ style.scss      ⎬ Weaving
graphc.png ─╮   │  embedded TeX             ┊      ╽          ⎪ (Documents)
image.jpeg ─┤ filters   ╿                   ┊    .css         ⎪
            ╎     ╿     ┊                   ┊     ▾╎          ⎪
figure.png╶─╧─▶ PROJECT.ORG ▶───╴filters╶───╧──────╪──▶ .html ⎪
     ╿           ╿┊ ║ │ ╰╌╌╌▷╌╌ embedded html ▶╌╌╌╌╯          ⎪
     ├╌╌╌╌╌╌╌▷╌╌╌╯┊ ║ │                                       ⎪
    result╶╌╌╌╌╌╮ ┊ ║ ├──────╴filters╶────────────────▶ .txt  ⎪
     ┊▴         ┊ ┊ ║ │                                       ⎪
    execution   ┊ ┊ ║ ╰──────╴filters╶────────────────▶ .md   ⎭
     ┊▴         ┊ ┊ ║
    code blocks◀╯ ┊ ╟─────────────────────────────────▶ .c    ⎫
     ╰╌╌╌╌◁╌╌╌╌╌╌╌╯ ╟─────────────────────────────────▶ .sh   ⎬ Tangling
                    ╟─────────────────────────────────▶ .hs   ⎪ (Code)
                    ╙─────────────────────────────────▶ .el   ⎭
</pre>

    </details>

<p>
Finally, because this section is fairly expensive to initialise, we&rsquo;ll wrap it
in an <code>(after! ...)</code> block.
</p>
<details id='org-mode,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> org
  &lt;&lt;org-conf&gt;&gt;
<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
<div id="outline-container-system-config" class="outline-4">
<h4 id="system-config"><span class="section-number-4">6.3.1</span> System config<a aria-hidden="true" href="#system-config">#</a> </h4>
<div class="outline-text-4" id="text-6-3-1">
</div>
<div id="outline-container-mime-types" class="outline-5">
<h5 id="mime-types"><span class="section-number-5">6.3.1.1</span> Mime types<a aria-hidden="true" href="#mime-types">#</a> </h5>
<div class="outline-text-5" id="text-6-3-1-1">
<p>
Org mode isn&rsquo;t recognised as it&rsquo;s own mime type by default, but that can easily
be changed with the following file. For system-wide changes try
<code>/usr/share/mime/packages/org.xml</code>.
</p>
<details id='mime-types,code--1' class='code' open><summary><span class='lang'>XML</span></summary>
    <div class='gutter'>
    <a href='#mime-types,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-xml"><span class="org-nxml-processing-instruction-delimiter">&lt;?</span><span class="org-nxml-processing-instruction-target">xml</span> <span class="org-nxml-processing-instruction-content">version="1.0" encoding="utf-8"</span><span class="org-nxml-processing-instruction-delimiter">?&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">mime-info</span> <span class="org-nxml-namespace-attribute-xmlns">xmlns</span>=<span class="org-string">'http://www.freedesktop.org/standards/shared-mime-info'</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">mime-type</span> <span class="org-nxml-attribute-local-name">type</span>=<span class="org-string">"text/org"</span><span class="org-nxml-tag-delimiter">&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">comment</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">Emacs Org-mode File</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">comment</span><span class="org-nxml-tag-delimiter">&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">glob</span> <span class="org-nxml-attribute-local-name">pattern</span>=<span class="org-string">"*.org"</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-tag-delimiter">&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">alias</span> <span class="org-nxml-attribute-local-name">type</span>=<span class="org-string">"text/org"</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">mime-type</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">mime-info</span><span class="org-nxml-tag-delimiter">&gt;</span>
</pre>
</div>
    </details>
<p>
What&rsquo;s nice is that Papirus <a href="https://github.com/PapirusDevelopmentTeam/papirus-icon-theme/commit/a10fb7f2423d5e30b9c4477416ccdc93c4f3849d">now</a> has an icon for <kbd>text/org</kbd>.
One simply needs to refresh their mime database
</p>
<details id='mime-types,code--2' class='code' open><summary><span class='lang'>Shell Script</span></summary>
    <div class='gutter'>
    <a href='#mime-types,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell">update-mime-database ~/.local/share/mime
</pre>
</div>
    </details>
<p>
Then set Emacs as the default editor
</p>
<details id='mime-types,code--3' class='code' open><summary><span class='lang'>Shell Script</span></summary>
    <div class='gutter'>
    <a href='#mime-types,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell">xdg-mime default emacs.desktop text/org
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-development" class="outline-5">
<h5 id="development"><span class="section-number-5">6.3.1.2</span> Development<a aria-hidden="true" href="#development">#</a> </h5>
<div class="outline-text-5" id="text-6-3-1-2">
<p>
Testing patches from the <span class='acr'>ML</span> is currently more hassle than it needs to be. Let&rsquo;s
change that.
</p>
<details id='development,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#development,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">org-ml-target-dir</span> <span class="org-string">"~/.emacs.d/.local/straight/repos/org-mode/"</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">org-ml-max-age</span> <span class="org-highlight-numbers-number">600</span>
  <span class="org-doc">"Maximum permissible age in seconds."</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">org-ml--cache-timestamp</span> <span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">org-ml--cache</span> nil<span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-ml-current-patches</span> <span class="org-rainbow-delimiters-depth-2">()</span>
  <span class="org-doc">"Get the currently open patches, as a list of alists.</span>
<span class="org-doc">Entries of the form (subject . id)."</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">delq</span> nil
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">mapcar</span>
         <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-2">(</span>entry<span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> entry <span class="org-builtin">:fixed</span><span class="org-rainbow-delimiters-depth-3">)</span>
             <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">cons</span>
              <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"%-8s  %s"</span>
                      <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">propertize</span>
                       <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">replace-regexp-in-string</span> <span class="org-string">"T.*"</span> <span class="org-string">""</span>
                                                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> entry <span class="org-builtin">:date</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                       <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">font-lock-doc-face</span><span class="org-rainbow-delimiters-depth-2">)</span>
                      <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">propertize</span>
                       <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">replace-regexp-in-string</span> <span class="org-string">"\\[</span><span class="org-string"><span class="org-constant">PATCH\\</span></span><span class="org-string">] ?"</span> <span class="org-string">""</span>
                                                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> entry <span class="org-builtin">:summary</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                       <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">font-lock-keyword-face</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
              <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> entry <span class="org-builtin">:id</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">with-current-buffer</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">url-retrieve-synchronously</span> <span class="org-string">"https://updates.orgmode.org/data/patches"</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">json-parse-buffer</span> <span class="org-builtin">:object-type</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">plist</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-ml-select-patch-thread</span> <span class="org-rainbow-delimiters-depth-2">()</span>
  <span class="org-doc">"Find and apply a proposed Org patch."</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">interactive</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>current-workspace <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">+workspace-current</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-rainbow-delimiters-depth-1">(</span>patches <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">progn</span>
                   <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">not</span> <span class="org-variable-name">org-ml--cache</span><span class="org-rainbow-delimiters-depth-2">)</span>
                             <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">&gt;</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">-</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">float-time</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-variable-name">org-ml--cache-timestamp</span><span class="org-rainbow-delimiters-depth-3">)</span>
                                <span class="org-variable-name">org-ml-max-age</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-ml--cache</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-ml-current-patches</span><span class="org-rainbow-delimiters-depth-2">)</span>
                           <span class="org-variable-name">org-ml--cache-timestamp</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">float-time</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                   <span class="org-variable-name">org-ml--cache</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
        msg-id<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">ivy-read</span> <span class="org-string">"Thread: "</span>
              patches
              <span class="org-builtin">:action</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-2">(</span>m<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> msg-id <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">cdr</span> m<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">+workspace-switch</span> +mu4e-workspace-name<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>mu4e-view-message-with-message-id msg-id<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">mu4e-view-actions</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">cons</span> <span class="org-string">"apply patch to org"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-ml-transient-mu4e-action</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-ml-transient-mu4e-action</span> <span class="org-rainbow-delimiters-depth-2">(</span>msg<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> mu4e-view-actions
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">delete</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">cons</span> <span class="org-string">"apply patch to org"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-ml-transient-mu4e-action</span><span class="org-rainbow-delimiters-depth-1">)</span>
                mu4e-view-actions<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">+workspace/other</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">magit-status</span> <span class="org-variable-name">org-ml-target-dir</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">with-current-buffer</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">get-buffer-create</span> <span class="org-string">"*Shell: Org apply patches*"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">erase-buffer</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-variable-name">default-directory</span> <span class="org-variable-name">org-ml-target-dir</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">shell-command</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"git am %s"</span>
               <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">shell-quote-argument</span> <span class="org-rainbow-delimiters-depth-1">(</span>mu4e-message-field msg <span class="org-builtin">:path</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">current-buffer</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">magit-refresh</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">string-match-p</span> <span class="org-string">"Error</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">failed"</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">buffer-string</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">+popup/buffer</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-behaviour" class="outline-4">
<h4 id="behaviour"><span class="section-number-4">6.3.2</span> Behaviour<a aria-hidden="true" href="#behaviour">#</a> </h4>
<div class="outline-text-4" id="text-6-3-2">
<p>
<img class='invertible' src='https://imgs.xkcd.com/comics/automation.png' title="'Automating' comes from the roots 'auto-' meaning 'self-', and 'mating', meaning 'screwing'." alt='Automation'>
</p>
</div>
<div id="outline-container-tweaking-defaults" class="outline-5">
<h5 id="tweaking-defaults"><span class="section-number-5">6.3.2.1</span> Tweaking defaults<a aria-hidden="true" href="#tweaking-defaults">#</a> </h5>
<div class="outline-text-5" id="text-6-3-2-1">
<details id='tweaking-defaults,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#tweaking-defaults,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-directory</span> <span class="org-string">"~/.org"</span>                      <span class="org-comment-delimiter">; </span><span class="org-comment">let's put files here</span>
      <span class="org-variable-name">org-use-property-inheritance</span> t              <span class="org-comment-delimiter">; </span><span class="org-comment">it's convenient to have properties inherited</span>
      <span class="org-variable-name">org-log-done</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">time</span>                          <span class="org-comment-delimiter">; </span><span class="org-comment">having the time a item is done sounds convininet</span>
      <span class="org-variable-name">org-list-allow-alphabetical</span> t               <span class="org-comment-delimiter">; </span><span class="org-comment">have a. A. a) A) list bullets</span>
      <span class="org-variable-name">org-export-in-background</span> t                  <span class="org-comment-delimiter">; </span><span class="org-comment">run export processes in external emacs process</span>
      <span class="org-variable-name">org-catch-invisible-edits</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">smart</span>            <span class="org-comment-delimiter">; </span><span class="org-comment">try not to accidently do weird stuff in invisible regions</span>
      <span class="org-variable-name">org-re-reveal-root</span> <span class="org-string">"https://cdn.jsdelivr.net/npm/reveal.js"</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
I also like the <code>:comments</code> header-argument, so let&rsquo;s make that a default.
</p>
<details id='tweaking-defaults,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#tweaking-defaults,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-babel-default-header-args</span>
      <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:session</span> . <span class="org-string">"none"</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:results</span> . <span class="org-string">"replace"</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:exports</span> . <span class="org-string">"code"</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:cache</span> . <span class="org-string">"no"</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:noweb</span> . <span class="org-string">"no"</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:hlines</span> . <span class="org-string">"no"</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:tangle</span> . <span class="org-string">"no"</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:comments</span> . <span class="org-string">"link"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
By default, <code>visual-line-mode</code> is turned <kbd>on</kbd>, and <code>auto-fill-mode</code> <kbd>off</kbd> by a hook.
However this messes with tables in Org-mode, and other plaintext files (e.g.
markdown, \LaTeX) so I&rsquo;ll turn it off for this, and manually enable it for more
specific modes as desired.
</p>
<details id='tweaking-defaults,code--3' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#tweaking-defaults,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">remove-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">text-mode-hook</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-variable-name">visual-line-mode</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">text-mode-hook</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">auto-fill-mode</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
There also seem to be a few keybindings which use <kbd>hjkl</kbd>, but miss arrow key equivalents.
</p>
<details id='tweaking-defaults,code--4' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#tweaking-defaults,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">map!</span> <span class="org-builtin">:map</span> evil-org-mode-map
      <span class="org-builtin">:after</span> evil-org
      <span class="org-builtin">:n</span> <span class="org-string">"g &lt;up&gt;"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-backward-heading-same-level</span>
      <span class="org-builtin">:n</span> <span class="org-string">"g &lt;down&gt;"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-forward-heading-same-level</span>
      <span class="org-builtin">:n</span> <span class="org-string">"g &lt;left&gt;"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-up-element</span>
      <span class="org-builtin">:n</span> <span class="org-string">"g &lt;right&gt;"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-down-element</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-behaviour-extra-functionality" class="outline-5">
<h5 id="behaviour-extra-functionality"><span class="section-number-5">6.3.2.2</span> Extra functionality<a aria-hidden="true" href="#behaviour-extra-functionality">#</a> </h5>
<div class="outline-text-5" id="text-6-3-2-2">
</div>
<div id="outline-container-org-buffer-creation" class="outline-6">
<h6 id="org-buffer-creation"><span class="section-number-6">6.3.2.2.1</span> Org buffer creation<a aria-hidden="true" href="#org-buffer-creation">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-2-1">
<p>
Let&rsquo;s also make creating an org buffer just that little bit easier.
</p>
<details id='org-buffer-creation,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#org-buffer-creation,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">evil-define-command</span> <span class="org-function-name">evil-buffer-org-new</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">count</span> file<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Creates a new ORG buffer replacing the current window, optionally</span>
<span class="org-doc">   editing a certain FILE"</span>
  <span class="org-builtin">:repeat</span> nil
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">interactive</span> <span class="org-string">"P&lt;f&gt;"</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> file
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">evil-edit</span> file<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>buffer <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">generate-new-buffer</span> <span class="org-string">"*new org*"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">set-window-buffer</span> nil buffer<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">with-current-buffer</span> buffer
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-mode</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">map!</span> <span class="org-builtin">:leader</span>
      <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:prefix</span> <span class="org-string">"b"</span>
       <span class="org-builtin">:desc</span> <span class="org-string">"New empty ORG buffer"</span> <span class="org-string">"o"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">evil-buffer-org-new</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-list-bullet-sequence" class="outline-6">
<h6 id="list-bullet-sequence"><span class="section-number-6">6.3.2.2.2</span> List bullet sequence<a aria-hidden="true" href="#list-bullet-sequence">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-2-2">
<p>
I think it makes sense to have list bullets change with depth
</p>
<details id='list-bullet-sequence,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#list-bullet-sequence,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-list-demote-modify-bullet</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"+"</span> . <span class="org-string">"-"</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"-"</span> . <span class="org-string">"+"</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"*"</span> . <span class="org-string">"+"</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"1."</span> . <span class="org-string">"a."</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-citation" class="outline-6">
<h6 id="citation"><span class="section-number-6">6.3.2.2.3</span> Citation<a aria-hidden="true" href="#citation">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-2-3">
<p>
Occasionally I want to cite something.
</p>
<details id='citation,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#citation,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">use-package!</span> org-ref
  <span class="org-builtin">:after</span> org
  <span class="org-builtin">:config</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-ref-completion-library</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">org-ref-ivy-cite</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-cdlatex" class="outline-6">
<h6 id="cdlatex"><span class="section-number-6">6.3.2.2.4</span> cdlatex<a aria-hidden="true" href="#cdlatex">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-2-4">
<p>
It&rsquo;s also nice to be able to use <code>cdlatex</code>.
</p>
<details id='cdlatex,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#cdlatex,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">org-mode-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">turn-on-org-cdlatex</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
It&rsquo;s handy to be able to quickly insert environments with <kbd>C-c }</kbd>. I almost always
want to edit them afterwards though, so let&rsquo;s make that happen by default.
</p>
<details id='cdlatex,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#cdlatex,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defadvice!</span> org-edit-latex-emv-after-insert <span class="org-rainbow-delimiters-depth-2">()</span>
  <span class="org-builtin">:after</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-cdlatex-environment-indent</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-edit-latex-environment</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
At some point in the future it could be good to investigate <a href="https://scripter.co/splitting-an-org-block-into-two/">splitting org blocks</a>.
Likewise <a href="https://archive.casouri.cat/note/2020/insert-math-symbol-in-emacs/">this</a> looks good for symbols.
</p>
</div>
</div>
<div id="outline-container-spellcheck" class="outline-6">
<h6 id="spellcheck"><span class="section-number-6">6.3.2.2.5</span> Spellcheck<a aria-hidden="true" href="#spellcheck">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-2-5">
<p>
My spelling is atrocious, so let&rsquo;s get flycheck going.
</p>
<details id='spellcheck,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#spellcheck,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">org-mode-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">turn-on-flyspell</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-lsp-support-src" class="outline-6">
<h6 id="lsp-support-src"><span class="section-number-6">6.3.2.2.6</span> <span class='acr'>LSP</span> support in <code>src</code> blocks<a aria-hidden="true" href="#lsp-support-src">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-2-6">
<p>
Now, by default, <span class='acr'>LSP</span><small>s</small> don&rsquo;t really function at all in <code>src</code> blocks.
</p>
<details id='lsp-support-src,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#lsp-support-src,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">cl-defmacro</span> <span class="org-function-name">lsp-org-babel-enable</span> <span class="org-rainbow-delimiters-depth-2">(</span>lang<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Support LANG in org source code block."</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> centaur-lsp <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">lsp-mode</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-warning">cl-check-type</span> lang stringp<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>edit-pre <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">intern</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-string">"org-babel-edit-prep:%s"</span> lang<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>intern-pre <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">intern</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-string">"lsp--%s"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">symbol-name</span> edit-pre<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-highlight-quoted-quote">`</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">progn</span>
       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> ,intern-pre <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">info</span><span class="org-rainbow-delimiters-depth-2">)</span>
         <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>file-name <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">-&gt;&gt;</span> info caddr <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">alist-get</span> <span class="org-builtin">:file</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">unless</span> file-name
             <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> file-name <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">make-temp-file</span> <span class="org-string">"babel-lsp-"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">buffer-file-name</span> file-name<span class="org-rainbow-delimiters-depth-3">)</span>
           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">lsp-deferred</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">put</span> <span class="org-highlight-quoted-quote">'</span>,intern-pre <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">function-documentation</span>
            <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"Enable lsp-mode in the buffer of org source block (%s)."</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">upcase</span> ,lang<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">fboundp</span> <span class="org-highlight-quoted-quote">'</span>,edit-pre<span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">advice-add</span> <span class="org-highlight-quoted-quote">'</span>,edit-pre <span class="org-builtin">:after</span> <span class="org-highlight-quoted-quote">'</span>,intern-pre<span class="org-rainbow-delimiters-depth-2">)</span>
         <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">progn</span>
           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">defun</span> ,edit-pre <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">info</span><span class="org-rainbow-delimiters-depth-1">)</span>
             <span class="org-rainbow-delimiters-depth-1">(</span>,intern-pre info<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">put</span> <span class="org-highlight-quoted-quote">'</span>,edit-pre <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">function-documentation</span>
                <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"Prepare local buffer environment for org source block (%s)."</span>
                        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">upcase</span> ,lang<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">org-babel-lang-list</span>
  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"go"</span> <span class="org-string">"python"</span> <span class="org-string">"ipython"</span> <span class="org-string">"bash"</span> <span class="org-string">"sh"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">dolist</span> <span class="org-rainbow-delimiters-depth-2">(</span>lang <span class="org-variable-name">org-babel-lang-list</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">eval</span> <span class="org-highlight-quoted-quote">`</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">lsp-org-babel-enable</span> ,lang<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-view-exported-file" class="outline-6">
<h6 id="view-exported-file"><span class="section-number-6">6.3.2.2.7</span> View exported file<a aria-hidden="true" href="#view-exported-file">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-2-7">
<p>
<kbd>'localeader v</kbd> has no pre-existing binding, so I may as well use it with the same
functionality as in LaTeX. Let&rsquo;s try viewing possible output files with this.
</p>
<details id='view-exported-file,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#view-exported-file,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">map!</span> <span class="org-builtin">:map</span> <span class="org-variable-name">org-mode-map</span>
      <span class="org-builtin">:localleader</span>
      <span class="org-builtin">:desc</span> <span class="org-string">"View exported file"</span> <span class="org-string">"v"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-view-output-file</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-view-output-file</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">&amp;optional</span> org-file-path<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Visit buffer open on the first output file (if any) found, using `</span><span class="org-doc"><span class="org-constant">org-view-output-file-extensions</span></span><span class="org-doc">'"</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">interactive</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>org-file-path <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">or</span> org-file-path <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-variable-name">buffer-file-name</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>dir <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">file-name-directory</span> org-file-path<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>basename <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">file-name-base</span> org-file-path<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>output-file nil<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">dolist</span> <span class="org-rainbow-delimiters-depth-1">(</span>ext <span class="org-variable-name">org-view-output-file-extensions</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">unless</span> output-file
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">file-exists-p</span>
               <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span> dir basename <span class="org-string">"."</span> ext<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> output-file <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span> dir basename <span class="org-string">"."</span> ext<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> output-file
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">member</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">file-name-extension</span> output-file<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-variable-name">org-view-external-file-extensions</span><span class="org-rainbow-delimiters-depth-2">)</span>
            <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">browse-url-xdg-open</span> output-file<span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">pop-to-buffer</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">find-buffer-visiting</span> output-file<span class="org-rainbow-delimiters-depth-1">)</span>
                             <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">find-file-noselect</span> output-file<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">message</span> <span class="org-string">"No exported file found"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">org-view-output-file-extensions</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"pdf"</span> <span class="org-string">"md"</span> <span class="org-string">"rst"</span> <span class="org-string">"txt"</span> <span class="org-string">"tex"</span> <span class="org-string">"html"</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Search for output files with these extensions, in order, viewing the first that matches"</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">org-view-external-file-extensions</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"html"</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"File formats that should be opened externally."</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-super-agenda" class="outline-5">
<h5 id="super-agenda"><span class="section-number-5">6.3.2.3</span> Super agenda<a aria-hidden="true" href="#super-agenda">#</a> </h5>
<div class="outline-text-5" id="text-6-3-2-3">
<details id='super-agenda,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#super-agenda,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">use-package!</span> org-super-agenda
  <span class="org-builtin">:commands</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-variable-name">org-super-agenda-mode</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> org-agenda
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-variable-name">org-super-agenda-mode</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> org-agenda-skip-scheduled-if-done t
      org-agenda-skip-deadline-if-done t
      org-agenda-include-deadlines t
      org-agenda-block-separator nil
      org-agenda-tags-column <span class="org-highlight-numbers-number">100</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">from testing this seems to be a good value</span>
      org-agenda-compact-blocks t<span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> org-agenda-custom-commands
      <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"o"</span> <span class="org-string">"Overview"</span>
         <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>agenda <span class="org-string">""</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>org-agenda-span <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">day</span><span class="org-rainbow-delimiters-depth-1">)</span>
                      <span class="org-rainbow-delimiters-depth-1">(</span>org-super-agenda-groups
                       <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:name</span> <span class="org-string">"Today"</span>
                          <span class="org-builtin">:time-grid</span> t
                          <span class="org-builtin">:date</span> today
                          <span class="org-builtin">:todo</span> <span class="org-string">"TODAY"</span>
                          <span class="org-builtin">:scheduled</span> today
                          <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span>alltodo <span class="org-string">""</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>org-agenda-overriding-header <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span>org-super-agenda-groups
                        <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:name</span> <span class="org-string">"Next to do"</span>
                           <span class="org-builtin">:todo</span> <span class="org-string">"NEXT"</span>
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-3">)</span>
                          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:name</span> <span class="org-string">"Important"</span>
                           <span class="org-builtin">:tag</span> <span class="org-string">"Important"</span>
                           <span class="org-builtin">:priority</span> <span class="org-string">"A"</span>
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">6</span><span class="org-rainbow-delimiters-depth-3">)</span>
                          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:name</span> <span class="org-string">"Due Today"</span>
                           <span class="org-builtin">:deadline</span> today
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">2</span><span class="org-rainbow-delimiters-depth-3">)</span>
                          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:name</span> <span class="org-string">"Due Soon"</span>
                           <span class="org-builtin">:deadline</span> future
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">8</span><span class="org-rainbow-delimiters-depth-3">)</span>
                          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:name</span> <span class="org-string">"Overdue"</span>
                           <span class="org-builtin">:deadline</span> past
                           <span class="org-builtin">:face</span> error
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">7</span><span class="org-rainbow-delimiters-depth-3">)</span>
                          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:name</span> <span class="org-string">"Assignments"</span>
                           <span class="org-builtin">:tag</span> <span class="org-string">"Assignment"</span>
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">10</span><span class="org-rainbow-delimiters-depth-3">)</span>
                          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:name</span> <span class="org-string">"Issues"</span>
                           <span class="org-builtin">:tag</span> <span class="org-string">"Issue"</span>
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">12</span><span class="org-rainbow-delimiters-depth-3">)</span>
                          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:name</span> <span class="org-string">"Emacs"</span>
                           <span class="org-builtin">:tag</span> <span class="org-string">"Emacs"</span>
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">13</span><span class="org-rainbow-delimiters-depth-3">)</span>
                          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:name</span> <span class="org-string">"Projects"</span>
                           <span class="org-builtin">:tag</span> <span class="org-string">"Project"</span>
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">14</span><span class="org-rainbow-delimiters-depth-3">)</span>
                          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:name</span> <span class="org-string">"Research"</span>
                           <span class="org-builtin">:tag</span> <span class="org-string">"Research"</span>
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">15</span><span class="org-rainbow-delimiters-depth-3">)</span>
                          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:name</span> <span class="org-string">"To read"</span>
                           <span class="org-builtin">:tag</span> <span class="org-string">"Read"</span>
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">30</span><span class="org-rainbow-delimiters-depth-3">)</span>
                          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:name</span> <span class="org-string">"Waiting"</span>
                           <span class="org-builtin">:todo</span> <span class="org-string">"WAITING"</span>
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">20</span><span class="org-rainbow-delimiters-depth-3">)</span>
                          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:name</span> <span class="org-string">"University"</span>
                           <span class="org-builtin">:tag</span> <span class="org-string">"uni"</span>
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">32</span><span class="org-rainbow-delimiters-depth-3">)</span>
                          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:name</span> <span class="org-string">"Trivial"</span>
                           <span class="org-builtin">:priority&lt;=</span> <span class="org-string">"E"</span>
                           <span class="org-builtin">:tag</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Trivial"</span> <span class="org-string">"Unimportant"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                           <span class="org-builtin">:todo</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"SOMEDAY"</span> <span class="org-rainbow-delimiters-depth-1">)</span>
                           <span class="org-builtin">:order</span> <span class="org-highlight-numbers-number">90</span><span class="org-rainbow-delimiters-depth-3">)</span>
                          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:discard</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-builtin">:tag</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Chore"</span> <span class="org-string">"Routine"</span> <span class="org-string">"Daily"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-capture" class="outline-5">
<h5 id="capture"><span class="section-number-5">6.3.2.4</span> Capture<a aria-hidden="true" href="#capture">#</a> </h5>
<div class="outline-text-5" id="text-6-3-2-4">
<p>
Let&rsquo;s setup some org-capture templates, and make them visually nice to access.
</p>


<figure id="orgf9d2564">
<img src="https://tecosaur.com/lfs/emacs-config/screenshots/org-capture.png" alt="My org-capture dialouge." class="invertible">

</figure>

<details id='capture,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#capture,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">use-package!</span> doct
  <span class="org-builtin">:commands</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">doct</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> org-capture
  &lt;&lt;prettify-capture&gt;&gt;
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> +org-capture-uni-units <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">condition-case</span> nil
                                   <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">split-string</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">f-read-text</span> <span class="org-string">"~/.org/.uni-units"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">error</span> nil<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        +org-capture-recipies  <span class="org-string">"~/Desktop/TEC/Organisation/recipies.org"</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+doct-icon-declaration-to-icon</span> <span class="org-rainbow-delimiters-depth-3">(</span>declaration<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Convert :icon declaration to icon"</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>name <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">pop</span> declaration<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">set</span>  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">intern</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span> <span class="org-string">"all-the-icons-"</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> declaration <span class="org-builtin">:set</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span>face <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">intern</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span> <span class="org-string">"all-the-icons-"</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> declaration <span class="org-builtin">:color</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span>v-adjust <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> declaration <span class="org-builtin">:v-adjust</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-highlight-numbers-number">0.01</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">apply</span> set <span class="org-highlight-quoted-quote">`</span><span class="org-rainbow-delimiters-depth-2">(</span>,name <span class="org-builtin">:face</span> ,face <span class="org-builtin">:v-adjust</span> ,v-adjust<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+doct-iconify-capture-templates</span> <span class="org-rainbow-delimiters-depth-3">(</span>groups<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Add declaration's :icon to each template group in GROUPS."</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>templates <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">doct-flatten-lists-in</span> groups<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">doct-templates</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">mapcar</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-1">(</span>template<span class="org-rainbow-delimiters-depth-1">)</span>
                                     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when-let*</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>props <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">nthcdr</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">=</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">length</span> template<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-highlight-numbers-number">4</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-highlight-numbers-number">2</span> <span class="org-highlight-numbers-number">5</span><span class="org-rainbow-delimiters-depth-2">)</span> template<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                                                 <span class="org-rainbow-delimiters-depth-3">(</span>spec <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> props <span class="org-builtin">:doct</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-builtin">:icon</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                                       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setf</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">1</span> template<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">concat</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">+doct-icon-declaration-to-icon</span> spec<span class="org-rainbow-delimiters-depth-1">)</span>
                                                                      <span class="org-string">"\t"</span>
                                                                      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">1</span> template<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                                     template<span class="org-rainbow-delimiters-depth-3">)</span>
                                   templates<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">doct-after-conversion-functions</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span>+doct-iconify-capture-templates<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">set-org-capture-templates</span> <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-capture-templates</span>
          <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">doct</span> <span class="org-highlight-quoted-quote">`</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"Personal todo"</span> <span class="org-builtin">:keys</span> <span class="org-string">"t"</span>
                   <span class="org-builtin">:icon</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"checklist"</span> <span class="org-builtin">:set</span> <span class="org-string">"octicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"green"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                   <span class="org-builtin">:file</span> <span class="org-variable-name">+org-capture-todo-file</span>
                   <span class="org-builtin">:prepend</span> t
                   <span class="org-builtin">:headline</span> <span class="org-string">"Inbox"</span>
                   <span class="org-builtin">:type</span> entry
                   <span class="org-builtin">:template</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"* </span><span class="org-bold"><span class="org-warning">TODO</span></span><span class="org-string"> %?"</span>
                              <span class="org-string">"%i %a"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                   <span class="org-rainbow-delimiters-depth-3">)</span>
                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"Personal note"</span> <span class="org-builtin">:keys</span> <span class="org-string">"n"</span>
                   <span class="org-builtin">:icon</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"sticky-note-o"</span> <span class="org-builtin">:set</span> <span class="org-string">"faicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"green"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                   <span class="org-builtin">:file</span> <span class="org-variable-name">+org-capture-todo-file</span>
                   <span class="org-builtin">:prepend</span> t
                   <span class="org-builtin">:headline</span> <span class="org-string">"Inbox"</span>
                   <span class="org-builtin">:type</span> entry
                   <span class="org-builtin">:template</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"* %?"</span>
                              <span class="org-string">"%i %a"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                   <span class="org-rainbow-delimiters-depth-3">)</span>
                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"University"</span> <span class="org-builtin">:keys</span> <span class="org-string">"u"</span>
                   <span class="org-builtin">:icon</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"graduation-cap"</span> <span class="org-builtin">:set</span> <span class="org-string">"faicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"purple"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                   <span class="org-builtin">:file</span> <span class="org-variable-name">+org-capture-todo-file</span>
                   <span class="org-builtin">:headline</span> <span class="org-string">"University"</span>
                   <span class="org-builtin">:unit-prompt</span> ,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"%%^{Unit|%s}"</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">string-join</span> +org-capture-uni-units <span class="org-string">"|"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                   <span class="org-builtin">:prepend</span> t
                   <span class="org-builtin">:type</span> entry
                   <span class="org-builtin">:children</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Test"</span> <span class="org-builtin">:keys</span> <span class="org-string">"t"</span>
                               <span class="org-builtin">:icon</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"timer"</span> <span class="org-builtin">:set</span> <span class="org-string">"material"</span> <span class="org-builtin">:color</span> <span class="org-string">"red"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                               <span class="org-builtin">:template</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"* </span><span class="org-bold"><span class="org-warning">TODO</span></span><span class="org-string"> [#C] %{unit-prompt} %? :uni:tests:"</span>
                                          <span class="org-string">"SCHEDULED: %^{Test date:}T"</span>
                                          <span class="org-string">"%i %a"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Assignment"</span> <span class="org-builtin">:keys</span> <span class="org-string">"a"</span>
                               <span class="org-builtin">:icon</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"library_books"</span> <span class="org-builtin">:set</span> <span class="org-string">"material"</span> <span class="org-builtin">:color</span> <span class="org-string">"orange"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                               <span class="org-builtin">:template</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"* </span><span class="org-bold"><span class="org-warning">TODO</span></span><span class="org-string"> [#B] %{unit-prompt} %? :uni:assignments:"</span>
                                          <span class="org-string">"DEADLINE: %^{Due date:}T"</span>
                                          <span class="org-string">"%i %a"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Lecture"</span> <span class="org-builtin">:keys</span> <span class="org-string">"l"</span>
                               <span class="org-builtin">:icon</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"keynote"</span> <span class="org-builtin">:set</span> <span class="org-string">"fileicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"orange"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                               <span class="org-builtin">:template</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"* </span><span class="org-bold"><span class="org-warning">TODO</span></span><span class="org-string"> [#C] %{unit-prompt} %? :uni:lecture:"</span>
                                          <span class="org-string">"%i %a"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Miscellaneous task"</span> <span class="org-builtin">:keys</span> <span class="org-string">"u"</span>
                               <span class="org-builtin">:icon</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"list"</span> <span class="org-builtin">:set</span> <span class="org-string">"faicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"yellow"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                               <span class="org-builtin">:template</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"* </span><span class="org-bold"><span class="org-warning">TODO</span></span><span class="org-string"> [#D] %{unit-prompt} %? :uni:"</span>
                                          <span class="org-string">"%i %a"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"Email"</span> <span class="org-builtin">:keys</span> <span class="org-string">"e"</span>
                   <span class="org-builtin">:icon</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"envelope"</span> <span class="org-builtin">:set</span> <span class="org-string">"faicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"blue"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                   <span class="org-builtin">:file</span> <span class="org-variable-name">+org-capture-todo-file</span>
                   <span class="org-builtin">:prepend</span> t
                   <span class="org-builtin">:headline</span> <span class="org-string">"Inbox"</span>
                   <span class="org-builtin">:type</span> entry
                   <span class="org-builtin">:template</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"* </span><span class="org-bold"><span class="org-warning">TODO</span></span><span class="org-string"> %^{type|reply to|contact} %\\3 %? :email:"</span>
                              <span class="org-string">"Send an email %^{urgancy|soon|ASAP|anon|at some point|eventually} to %^{recipiant}"</span>
                              <span class="org-string">"about %^{topic}"</span>
                              <span class="org-string">"%U %i %a"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"Interesting"</span> <span class="org-builtin">:keys</span> <span class="org-string">"i"</span>
                   <span class="org-builtin">:icon</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"eye"</span> <span class="org-builtin">:set</span> <span class="org-string">"faicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"lcyan"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                   <span class="org-builtin">:file</span> <span class="org-variable-name">+org-capture-todo-file</span>
                   <span class="org-builtin">:prepend</span> t
                   <span class="org-builtin">:headline</span> <span class="org-string">"Interesting"</span>
                   <span class="org-builtin">:type</span> entry
                   <span class="org-builtin">:template</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"* [ ] %{desc}%? :%{i-type}:"</span>
                              <span class="org-string">"%i %a"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                   <span class="org-builtin">:children</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Webpage"</span> <span class="org-builtin">:keys</span> <span class="org-string">"w"</span>
                               <span class="org-builtin">:icon</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"globe"</span> <span class="org-builtin">:set</span> <span class="org-string">"faicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"green"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                               <span class="org-builtin">:desc</span> <span class="org-string">"%(org-cliplink-capture) "</span>
                               <span class="org-builtin">:i-type</span> <span class="org-string">"read:web"</span>
                               <span class="org-rainbow-delimiters-depth-2">)</span>
                              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Article"</span> <span class="org-builtin">:keys</span> <span class="org-string">"a"</span>
                               <span class="org-builtin">:icon</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"file-text"</span> <span class="org-builtin">:set</span> <span class="org-string">"octicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"yellow"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                               <span class="org-builtin">:desc</span> <span class="org-string">""</span>
                               <span class="org-builtin">:i-type</span> <span class="org-string">"read:reaserch"</span>
                               <span class="org-rainbow-delimiters-depth-2">)</span>
                              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"\tRecipie"</span> <span class="org-builtin">:keys</span> <span class="org-string">"r"</span>
                               <span class="org-builtin">:icon</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"spoon"</span> <span class="org-builtin">:set</span> <span class="org-string">"faicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"dorange"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                               <span class="org-builtin">:file</span> +org-capture-recipies
                               <span class="org-builtin">:headline</span> <span class="org-string">"Unsorted"</span>
                               <span class="org-builtin">:template</span> <span class="org-string">"%(org-chef-get-recipe-from-url)"</span>
                               <span class="org-rainbow-delimiters-depth-2">)</span>
                              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Information"</span> <span class="org-builtin">:keys</span> <span class="org-string">"i"</span>
                               <span class="org-builtin">:icon</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"info-circle"</span> <span class="org-builtin">:set</span> <span class="org-string">"faicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"blue"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                               <span class="org-builtin">:desc</span> <span class="org-string">""</span>
                               <span class="org-builtin">:i-type</span> <span class="org-string">"read:info"</span>
                               <span class="org-rainbow-delimiters-depth-2">)</span>
                              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Idea"</span> <span class="org-builtin">:keys</span> <span class="org-string">"I"</span>
                               <span class="org-builtin">:icon</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"bubble_chart"</span> <span class="org-builtin">:set</span> <span class="org-string">"material"</span> <span class="org-builtin">:color</span> <span class="org-string">"silver"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                               <span class="org-builtin">:desc</span> <span class="org-string">""</span>
                               <span class="org-builtin">:i-type</span> <span class="org-string">"idea"</span>
                               <span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"Tasks"</span> <span class="org-builtin">:keys</span> <span class="org-string">"k"</span>
                   <span class="org-builtin">:icon</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"inbox"</span> <span class="org-builtin">:set</span> <span class="org-string">"octicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"yellow"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                   <span class="org-builtin">:file</span> <span class="org-variable-name">+org-capture-todo-file</span>
                   <span class="org-builtin">:prepend</span> t
                   <span class="org-builtin">:headline</span> <span class="org-string">"Tasks"</span>
                   <span class="org-builtin">:type</span> entry
                   <span class="org-builtin">:template</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"* </span><span class="org-bold"><span class="org-warning">TODO</span></span><span class="org-string"> %? %^G%{extra}"</span>
                              <span class="org-string">"%i %a"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                   <span class="org-builtin">:children</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"General Task"</span> <span class="org-builtin">:keys</span> <span class="org-string">"k"</span>
                               <span class="org-builtin">:icon</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"inbox"</span> <span class="org-builtin">:set</span> <span class="org-string">"octicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"yellow"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                               <span class="org-builtin">:extra</span> <span class="org-string">""</span>
                               <span class="org-rainbow-delimiters-depth-2">)</span>
                              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Task with deadline"</span> <span class="org-builtin">:keys</span> <span class="org-string">"d"</span>
                               <span class="org-builtin">:icon</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"timer"</span> <span class="org-builtin">:set</span> <span class="org-string">"material"</span> <span class="org-builtin">:color</span> <span class="org-string">"orange"</span> <span class="org-builtin">:v-adjust</span> <span class="org-highlight-numbers-number">-0.1</span><span class="org-rainbow-delimiters-depth-3">)</span>
                               <span class="org-builtin">:extra</span> <span class="org-string">"\nDEADLINE: %^{Deadline:}t"</span>
                               <span class="org-rainbow-delimiters-depth-2">)</span>
                              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Scheduled Task"</span> <span class="org-builtin">:keys</span> <span class="org-string">"s"</span>
                               <span class="org-builtin">:icon</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"calendar"</span> <span class="org-builtin">:set</span> <span class="org-string">"octicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"orange"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                               <span class="org-builtin">:extra</span> <span class="org-string">"\nSCHEDULED: %^{Start time:}t"</span>
                               <span class="org-rainbow-delimiters-depth-2">)</span>
                              <span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"Project"</span> <span class="org-builtin">:keys</span> <span class="org-string">"p"</span>
                   <span class="org-builtin">:icon</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"repo"</span> <span class="org-builtin">:set</span> <span class="org-string">"octicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"silver"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                   <span class="org-builtin">:prepend</span> t
                   <span class="org-builtin">:type</span> entry
                   <span class="org-builtin">:headline</span> <span class="org-string">"Inbox"</span>
                   <span class="org-builtin">:template</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"* %{time-or-todo} %?"</span>
                              <span class="org-string">"%i"</span>
                              <span class="org-string">"%a"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                   <span class="org-builtin">:file</span> <span class="org-string">""</span>
                   <span class="org-builtin">:custom</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-builtin">:time-or-todo</span> <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-1">)</span>
                   <span class="org-builtin">:children</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Project-local todo"</span> <span class="org-builtin">:keys</span> <span class="org-string">"t"</span>
                               <span class="org-builtin">:icon</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"checklist"</span> <span class="org-builtin">:set</span> <span class="org-string">"octicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"green"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                               <span class="org-builtin">:time-or-todo</span> <span class="org-string">"</span><span class="org-bold"><span class="org-warning">TODO</span></span><span class="org-string">"</span>
                               <span class="org-builtin">:file</span> +org-capture-project-todo-file<span class="org-rainbow-delimiters-depth-2">)</span>
                              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Project-local note"</span> <span class="org-builtin">:keys</span> <span class="org-string">"n"</span>
                               <span class="org-builtin">:icon</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"sticky-note"</span> <span class="org-builtin">:set</span> <span class="org-string">"faicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"yellow"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                               <span class="org-builtin">:time-or-todo</span> <span class="org-string">"%U"</span>
                               <span class="org-builtin">:file</span> +org-capture-project-notes-file<span class="org-rainbow-delimiters-depth-2">)</span>
                              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Project-local changelog"</span> <span class="org-builtin">:keys</span> <span class="org-string">"c"</span>
                               <span class="org-builtin">:icon</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"list"</span> <span class="org-builtin">:set</span> <span class="org-string">"faicon"</span> <span class="org-builtin">:color</span> <span class="org-string">"blue"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                               <span class="org-builtin">:time-or-todo</span> <span class="org-string">"%U"</span>
                               <span class="org-builtin">:heading</span> <span class="org-string">"Unreleased"</span>
                               <span class="org-builtin">:file</span> +org-capture-project-changelog-file<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                   <span class="org-rainbow-delimiters-depth-3">)</span>
                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"\tCentralised project templates"</span>
                   <span class="org-builtin">:keys</span> <span class="org-string">"o"</span>
                   <span class="org-builtin">:type</span> entry
                   <span class="org-builtin">:prepend</span> t
                   <span class="org-builtin">:template</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"* %{time-or-todo} %?"</span>
                              <span class="org-string">"%i"</span>
                              <span class="org-string">"%a"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                   <span class="org-builtin">:children</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Project todo"</span>
                               <span class="org-builtin">:keys</span> <span class="org-string">"t"</span>
                               <span class="org-builtin">:prepend</span> nil
                               <span class="org-builtin">:time-or-todo</span> <span class="org-string">"</span><span class="org-bold"><span class="org-warning">TODO</span></span><span class="org-string">"</span>
                               <span class="org-builtin">:heading</span> <span class="org-string">"Tasks"</span>
                               <span class="org-builtin">:file</span> +org-capture-central-project-todo-file<span class="org-rainbow-delimiters-depth-2">)</span>
                              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Project note"</span>
                               <span class="org-builtin">:keys</span> <span class="org-string">"n"</span>
                               <span class="org-builtin">:time-or-todo</span> <span class="org-string">"%U"</span>
                               <span class="org-builtin">:heading</span> <span class="org-string">"Notes"</span>
                               <span class="org-builtin">:file</span> +org-capture-central-project-notes-file<span class="org-rainbow-delimiters-depth-2">)</span>
                              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Project changelog"</span>
                               <span class="org-builtin">:keys</span> <span class="org-string">"c"</span>
                               <span class="org-builtin">:time-or-todo</span> <span class="org-string">"%U"</span>
                               <span class="org-builtin">:heading</span> <span class="org-string">"Unreleased"</span>
                               <span class="org-builtin">:file</span> +org-capture-central-project-changelog-file<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                   <span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">set-org-capture-templates</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">display-graphic-p</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">server-after-make-frame-hook</span>
              <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-capture-reinitialise-hook</span> <span class="org-rainbow-delimiters-depth-2">()</span>
                <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">display-graphic-p</span><span class="org-rainbow-delimiters-depth-3">)</span>
                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">set-org-capture-templates</span><span class="org-rainbow-delimiters-depth-3">)</span>
                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">remove-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">server-after-make-frame-hook</span>
                               <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-capture-reinitialise-hook</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
It would also be nice to improve how the capture dialogue looks
</p>
<details id='prettify-capture' class='code' open><summary class='named'><span class='name'>prettify-capture</span><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#prettify-capture'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-capture-select-template-prettier</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">&amp;optional</span> keys<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Select a capture template, in a prettier way than default</span>
<span class="org-doc">Lisp programs can force the template by setting KEYS to a string."</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-variable-name">org-capture-templates</span>
         <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-contextualize-keys</span>
              <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-capture-upgrade-templates</span> <span class="org-variable-name">org-capture-templates</span><span class="org-rainbow-delimiters-depth-1">)</span>
              <span class="org-variable-name">org-capture-templates-contexts</span><span class="org-rainbow-delimiters-depth-3">)</span>
             <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"t"</span> <span class="org-string">"Task"</span> entry <span class="org-rainbow-delimiters-depth-2">(</span>file+headline <span class="org-string">""</span> <span class="org-string">"Tasks"</span><span class="org-rainbow-delimiters-depth-2">)</span>
                <span class="org-string">"* </span><span class="org-bold"><span class="org-warning">TODO</span></span><span class="org-string"> %?\n  %u\n  %a"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> keys
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">assoc</span> keys <span class="org-variable-name">org-capture-templates</span><span class="org-rainbow-delimiters-depth-2">)</span>
            <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">error</span> <span class="org-string">"No capture template referred to by \"%s\" keys"</span> keys<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-mks</span> <span class="org-variable-name">org-capture-templates</span>
               <span class="org-string">"Select a capture template\n&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;"</span>
               <span class="org-string">"Template key: "</span>
               <span class="org-highlight-quoted-quote">`</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"q"</span> ,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">all-the-icons-octicon</span> <span class="org-string">"stop"</span> <span class="org-builtin">:face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">all-the-icons-red</span> <span class="org-builtin">:v-adjust</span> <span class="org-highlight-numbers-number">0.01</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-string">"\tAbort"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">advice-add</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">org-capture-select-template</span> <span class="org-builtin">:override</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-capture-select-template-prettier</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-mks-pretty</span> <span class="org-rainbow-delimiters-depth-2">(</span>table title <span class="org-type">&amp;optional</span> prompt specials<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Select a member of an alist with multiple keys. Prettified.</span>

<span class="org-doc">TABLE is the alist which should contain entries where the car is a string.</span>
<span class="org-doc">There should be two types of entries.</span>

<span class="org-doc">1. prefix descriptions like (\"a\" \"Description\")</span>
<span class="org-doc">   This indicates that `a' is a prefix key for multi-letter selection, and</span>
<span class="org-doc">   that there are entries following with keys like \"ab\", \"ax\"&#8230;</span>

<span class="org-doc">2. Select-able members must have more than two elements, with the first</span>
<span class="org-doc">   being the string of keys that lead to selecting it, and the second a</span>
<span class="org-doc">   short description string of the item.</span>

<span class="org-doc">The command will then make a temporary buffer listing all entries</span>
<span class="org-doc">that can be selected with a single key, and all the single key</span>
<span class="org-doc">prefixes.  When you press the key for a single-letter entry, it is selected.</span>
<span class="org-doc">When you press a prefix key, the commands (and maybe further prefixes)</span>
<span class="org-doc">under this key will be shown and offered for selection.</span>

<span class="org-doc">TITLE will be placed over the selection in the temporary buffer,</span>
<span class="org-doc">PROMPT will be used when prompting for a key.  SPECIALS is an</span>
<span class="org-doc">alist with (\"key\" \"description\") entries.  When one of these</span>
<span class="org-doc">is selected, only the bare key is returned."</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">save-window-excursion</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-variable-name">inhibit-quit</span> t<span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span>buffer <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-switch-to-buffer-other-window</span> <span class="org-string">"*Org Select*"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span>prompt <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> prompt <span class="org-string">"Select: "</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-variable-name">case-fold-search</span>
          current<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">unwind-protect</span>
          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">catch</span> <span class="org-highlight-quoted-quote">'</span><span class="org-constant">exit</span>
            <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">while</span> t
              <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq-local</span> <span class="org-variable-name">evil-normal-state-cursor</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">list</span> nil<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
              <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">erase-buffer</span><span class="org-rainbow-delimiters-depth-1">)</span>
              <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">insert</span> title <span class="org-string">"\n\n"</span><span class="org-rainbow-delimiters-depth-1">)</span>
              <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>des-keys nil<span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span>allowed-keys <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"\C-g"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span>tab-alternatives <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"\s"</span> <span class="org-string">"\t"</span> <span class="org-string">"\r"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-variable-name">cursor-type</span> nil<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                <span class="org-comment-delimiter">;; </span><span class="org-comment">Populate allowed keys and descriptions keys</span>
                <span class="org-comment-delimiter">;; </span><span class="org-comment">available with CURRENT selector.</span>
                <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>re <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"\\`%s</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\'"</span>
                                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> current <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">regexp-quote</span> current<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                      <span class="org-rainbow-delimiters-depth-1">(</span>prefix <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> current <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">concat</span> current <span class="org-string">" "</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">dolist</span> <span class="org-rainbow-delimiters-depth-1">(</span>entry table<span class="org-rainbow-delimiters-depth-1">)</span>
                    <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">pcase</span> entry
                      <span class="org-comment-delimiter">;; </span><span class="org-comment">Description.</span>
                      <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-highlight-quoted-quote">`</span><span class="org-rainbow-delimiters-depth-3">(</span>,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">and</span> key <span class="org-rainbow-delimiters-depth-2">(</span>pred <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">string-match</span> re<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span> ,desc<span class="org-rainbow-delimiters-depth-3">)</span>
                       <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>k <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">match-string</span> <span class="org-highlight-numbers-number">1</span> key<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                         <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">push</span> k des-keys<span class="org-rainbow-delimiters-depth-1">)</span>
                         <span class="org-comment-delimiter">;; </span><span class="org-comment">Keys ending in tab, space or RET are equivalent.</span>
                         <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">member</span> k tab-alternatives<span class="org-rainbow-delimiters-depth-2">)</span>
                             <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">push</span> <span class="org-string">"\t"</span> allowed-keys<span class="org-rainbow-delimiters-depth-2">)</span>
                           <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">push</span> k allowed-keys<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                         <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">insert</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">propertize</span> prefix <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">font-lock-comment-face</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">propertize</span> k <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">bold</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">propertize</span> <span class="org-string">"&#8250;"</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">font-lock-comment-face</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-string">"  "</span> desc <span class="org-string">"&#8230;"</span> <span class="org-string">"\n"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                      <span class="org-comment-delimiter">;; </span><span class="org-comment">Usable entry.</span>
                      <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-highlight-quoted-quote">`</span><span class="org-rainbow-delimiters-depth-3">(</span>,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">and</span> key <span class="org-rainbow-delimiters-depth-2">(</span>pred <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">string-match</span> re<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span> ,desc . ,_<span class="org-rainbow-delimiters-depth-3">)</span>
                       <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>k <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">match-string</span> <span class="org-highlight-numbers-number">1</span> key<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                         <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">insert</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">propertize</span> prefix <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">font-lock-comment-face</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">propertize</span> k <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">bold</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-string">"   "</span> desc <span class="org-string">"\n"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                         <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">push</span> k allowed-keys<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                      <span class="org-rainbow-delimiters-depth-2">(</span>_ nil<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                <span class="org-comment-delimiter">;; </span><span class="org-comment">Insert special entries, if any.</span>
                <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> specials
                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">insert</span> <span class="org-string">"&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;\n"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">pcase-dolist</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-quoted-quote">`</span><span class="org-rainbow-delimiters-depth-2">(</span>,key ,description<span class="org-rainbow-delimiters-depth-2">)</span> specials<span class="org-rainbow-delimiters-depth-1">)</span>
                    <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">insert</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"%s   %s\n"</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">propertize</span> key <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-1">(</span>bold all-the-icons-red<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span> description<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                    <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">push</span> key allowed-keys<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                <span class="org-comment-delimiter">;; </span><span class="org-comment">Display UI and let user select an entry or</span>
                <span class="org-comment-delimiter">;; </span><span class="org-comment">a sub-level prefix.</span>
                <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">goto-char</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">point-min</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">pos-visible-in-window-p</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">point-max</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-fit-window-to-buffer</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>pressed <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org--mks-read-key</span> allowed-keys prompt<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> current <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span> current pressed<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">cond</span>
                   <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">equal</span> pressed <span class="org-string">"\C-g"</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">user-error</span> <span class="org-string">"Abort"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                   <span class="org-comment-delimiter">;; </span><span class="org-comment">Selection is a prefix: open a new menu.</span>
                   <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">member</span> pressed des-keys<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                   <span class="org-comment-delimiter">;; </span><span class="org-comment">Selection matches an association: return it.</span>
                   <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>entry <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">assoc</span> current table<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">and</span> entry <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">throw</span> <span class="org-highlight-quoted-quote">'</span><span class="org-constant">exit</span> entry<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                   <span class="org-comment-delimiter">;; </span><span class="org-comment">Selection matches a special entry: return the</span>
                   <span class="org-comment-delimiter">;; </span><span class="org-comment">selection prefix.</span>
                   <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">assoc</span> current specials<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">throw</span> <span class="org-highlight-quoted-quote">'</span><span class="org-constant">exit</span> current<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                   <span class="org-rainbow-delimiters-depth-1">(</span>t <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">error</span> <span class="org-string">"No entry available"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> buffer <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">kill-buffer</span> buffer<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">advice-add</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">org-mks</span> <span class="org-builtin">:override</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-mks-pretty</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
The <a href="file:///home/runner/.emacs.d/bin/org-capture">org-capture bin</a> is rather nice, but I&rsquo;d be nicer with a smaller frame, and
no modeline.
</p>
<details id='capture,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#capture,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setf</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">alist-get</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">height</span> <span class="org-variable-name">+org-capture-frame-parameters</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-highlight-numbers-number">15</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(alist-get 'name +org-capture-frame-parameters) "&#10070; Capture") ;; ATM hardcoded in other places, so changing breaks stuff</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> +org-capture-fn
      <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-3">()</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">interactive</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">set-window-parameter</span> nil <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">mode-line-format</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">none</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-capture</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-roam" class="outline-5">
<h5 id="roam"><span class="section-number-5">6.3.2.5</span> Roam<a aria-hidden="true" href="#roam">#</a> </h5>
<div class="outline-text-5" id="text-6-3-2-5">
</div>
<div id="outline-container-basic-settings" class="outline-6">
<h6 id="basic-settings"><span class="section-number-6">6.3.2.5.1</span> Basic settings<a aria-hidden="true" href="#basic-settings">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-5-1">
<p>
I&rsquo;ll just set this to be within <kbd>Organisation</kbd> folder for now, in the future it
could be worth seeing if I could hook this up to a <a href="https://nextcloud.com/">Nextcloud</a> instance.
</p>
<details id='basic-settings,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#basic-settings,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> org-roam-directory <span class="org-string">"~/Desktop/TEC/Organisation/Roam/"</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
That said, if the directory doesn&rsquo;t exist we likely don&rsquo;t want to be using roam.
Since we don&rsquo;t want to trigger errors (which will happen as soon as roam tries
to initialise), let&rsquo;s not load roam.
</p>
<details id='basic-settings,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#basic-settings,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">package!</span> org-roam <span class="org-builtin">:disable</span> t<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-registering-roam-protocol" class="outline-6">
<h6 id="registering-roam-protocol"><span class="section-number-6">6.3.2.5.2</span> Registering roam protocol<a aria-hidden="true" href="#registering-roam-protocol">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-5-2">
<p>
The recommended method of registering a protocol is by registering a desktop
application, which seems reasonable.
</p>
<details id='registering-roam-protocol,code--1' class='code' open><summary><span class='lang'>Configuration File</span></summary>
    <div class='gutter'>
    <a href='#registering-roam-protocol,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-conf">[<span class="org-type">Desktop Entry</span>]
<span class="org-variable-name">Name</span>=Org-Protocol
<span class="org-variable-name">Exec</span>=emacsclient %u
<span class="org-variable-name">Icon</span>=emacs-icon
<span class="org-variable-name">Type</span>=Application
<span class="org-variable-name">Terminal</span>=false
<span class="org-variable-name">MimeType</span>=x-scheme-handler/org-protocol
</pre>
</div>
    </details>
<p>
To associate <code>org-protocol://</code> links with the desktop file,
</p>
<details id='registering-roam-protocol,code--2' class='code' open><summary><span class='lang'>Shell Script</span></summary>
    <div class='gutter'>
    <a href='#registering-roam-protocol,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell">xdg-mime default org-protocol.desktop x-scheme-handler/org-protocol
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-graph-behaviour" class="outline-6">
<h6 id="graph-behaviour"><span class="section-number-6">6.3.2.5.3</span> Graph Behaviour<a aria-hidden="true" href="#graph-behaviour">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-5-3">
<p>
By default, clicking on an <code>org-protocol://</code> link messes with the <kbd>svg</kbd> view. To fix
this we can use an <code>iframe</code>, however that requires shifting to an <kbd>html</kbd> file.
Hence, we need to do a bit of overriding.
</p>
<details id='graph-behaviour,code--1' class='code' open><summary><span class='lang'>HTML</span></summary>
    <div class='gutter'>
    <a href='#graph-behaviour,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-html">&lt;<span class="org-keyword">!DOCTYPE</span> html&gt;
&lt;<span class="org-function-name">html</span>&gt;
  &lt;<span class="org-function-name">head</span>&gt;
    &lt;<span class="org-function-name">meta</span> <span class="org-variable-name">charset</span>=<span class="org-string">"utf-8"</span>&gt;
    &lt;<span class="org-function-name">title</span>&gt;<span class="org-underline"><span class="org-bold">Roam Graph</span></span>&lt;/<span class="org-function-name">title</span>&gt;
    &lt;<span class="org-function-name">meta</span> <span class="org-variable-name">name</span>=<span class="org-string">"viewport"</span> <span class="org-variable-name">content</span>=<span class="org-string">"width=device-width"</span>&gt;
    &lt;<span class="org-function-name">style</span> <span class="org-variable-name">type</span>=<span class="org-string">"text/css"</span>&gt;
      body {
      background: white;
      }

      svg {
      position: relative;
      top: 50vh;
      left: 50vw;
      transform: translate(-50%, -50%);
      width: 95vw;
      }

      a &gt; polygon {
      transition-duration: 200ms;
      transition-property: fill;
      }

      a &gt; polyline {
      transition-duration: 400ms;
      transition-property: stroke;
      }

      a:hover &gt; polygon {
      fill: #d4d4d4;
      }
      a:hover &gt; polyline {
      stroke: #888;
      }
    &lt;/<span class="org-function-name">style</span>&gt;
    &lt;<span class="org-function-name">script</span>&gt;
      function create_iframe (url) {
      i = document.createElement('iframe');
      i.setAttribute('src', url);
      i.style.setProperty('display', 'none');
      document.body.append(i);
      }
      function listen_on_all_a () {
      document.querySelectorAll("svg a").forEach(elem =&gt; {
      elem.addEventListener('click', (e) =&gt; {
      e.preventDefault();
      create_iframe(elem.href.baseVal);
      });
      });
      }
    &lt;/<span class="org-function-name">script</span>&gt;
  &lt;/<span class="org-function-name">head</span>&gt;
  &lt;<span class="org-function-name">body</span> <span class="org-variable-name">onload</span>=<span class="org-string">"listen_on_all_a()"</span>&gt;
    <span class="org-variable-name">%s</span>
  &lt;/<span class="org-function-name">body</span>&gt;
&lt;/<span class="org-function-name">html</span>&gt;
</pre>
</div>
    </details>

<details id='graph-behaviour,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#graph-behaviour,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> org-roam
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> org-roam-graph-node-extra-config
        <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"shape"</span>      . <span class="org-string">"underline"</span><span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"style"</span>      . <span class="org-string">"rounded,filled"</span><span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"fillcolor"</span>  . <span class="org-string">"#EEEEEE"</span><span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"color"</span>      . <span class="org-string">"#C9C9C9"</span><span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"fontcolor"</span>  . <span class="org-string">"#111111"</span><span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"fontname"</span>   . <span class="org-string">"Overpass"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> +org-roam-graph--html-template
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">replace-regexp-in-string</span> <span class="org-string">"%</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">s]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span> <span class="org-string">"%%\\1"</span>
                                  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">f-read-text</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">concat</span> <span class="org-variable-name">doom-private-dir</span> <span class="org-string">"misc/org-roam-template.html"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defadvice!</span> +org-roam-graph--build-html <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">&amp;optional</span> node-query callback<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Generate a graph showing the relations between nodes in NODE-QUERY. HTML style."</span>
    <span class="org-builtin">:override</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-roam-graph--build</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">stringp</span> org-roam-graph-executable<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">user-error</span> <span class="org-string">"`</span><span class="org-string"><span class="org-constant">org-roam-graph-executable</span></span><span class="org-string">' is not a string"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">executable-find</span> org-roam-graph-executable<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">user-error</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">concat</span> <span class="org-string">"Cannot find executable %s to generate the graph.  "</span>
                          <span class="org-string">"Please adjust `</span><span class="org-string"><span class="org-constant">org-roam-graph-executable</span></span><span class="org-string">'"</span><span class="org-rainbow-delimiters-depth-2">)</span>
                  org-roam-graph-executable<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>node-query <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> node-query
                           <span class="org-highlight-quoted-quote">`</span><span class="org-rainbow-delimiters-depth-1">[</span><span class="org-builtin">:select</span> <span class="org-rainbow-delimiters-depth-2">[</span>file titles<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-builtin">:from</span> titles
                             ,@<span class="org-rainbow-delimiters-depth-2">(</span>org-roam-graph--expand-matcher <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">file</span> t<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">]</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>graph      <span class="org-rainbow-delimiters-depth-3">(</span>org-roam-graph--dot node-query<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>temp-dot   <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">make-temp-file</span> <span class="org-string">"graph."</span> nil <span class="org-string">".dot"</span> graph<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>temp-graph <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">make-temp-file</span> <span class="org-string">"graph."</span> nil <span class="org-string">".svg"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>temp-html  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">make-temp-file</span> <span class="org-string">"graph."</span> nil <span class="org-string">".html"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span>org-roam-message <span class="org-string">"building graph"</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">make-process</span>
       <span class="org-builtin">:name</span> <span class="org-string">"*org-roam-graph--build-process*"</span>
       <span class="org-builtin">:buffer</span> <span class="org-string">"*org-roam-graph--build-process*"</span>
       <span class="org-builtin">:command</span> <span class="org-highlight-quoted-quote">`</span><span class="org-rainbow-delimiters-depth-2">(</span>,org-roam-graph-executable ,temp-dot <span class="org-string">"-Tsvg"</span> <span class="org-string">"-o"</span> ,temp-graph<span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-builtin">:sentinel</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">progn</span>
                   <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-1">(</span>process _event<span class="org-rainbow-delimiters-depth-1">)</span>
                     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">=</span> <span class="org-highlight-numbers-number">0</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">process-exit-status</span> process<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">write-region</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> +org-roam-graph--html-template <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">f-read-text</span> temp-graph<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span> nil temp-html<span class="org-rainbow-delimiters-depth-2">)</span>
                       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> callback
                         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">funcall</span> callback temp-html<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-modeline-file-name" class="outline-6">
<h6 id="modeline-file-name"><span class="section-number-6">6.3.2.5.4</span> Modeline file name<a aria-hidden="true" href="#modeline-file-name">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-5-4">
<p>
All those numbers! It&rsquo;s messy. Let&rsquo;s adjust this in a similar way that I have in
the <a href="#window-title">Window title</a>.
</p>
<details id='modeline-file-name,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#modeline-file-name,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defadvice!</span> doom-modeline--buffer-file-name-roam-aware-a <span class="org-rainbow-delimiters-depth-2">(</span>orig-fun<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">doom-modeline-buffer-file-name</span> <span class="org-comment-delimiter">; </span><span class="org-comment">takes no args</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">s-contains-p</span> org-roam-directory <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> <span class="org-variable-name">buffer-file-name</span> <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">replace-regexp-in-string</span>
       <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">^</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">.*/</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[0-9]\\{4\\}</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[0-9]\\{2\\}</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[0-9]\\{2\\}</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">[0-9]*-"</span>
       <span class="org-string">"&#129172;(\\1-\\2-\\3) "</span>
       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">subst-char-in-string</span> ?_ ?  <span class="org-variable-name">buffer-file-name</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">funcall</span> orig-fun<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-nicer-generated-heading" class="outline-5">
<h5 id="nicer-generated-heading"><span class="section-number-5">6.3.2.6</span> Nicer generated heading <span class='acr'>ID</span><small>s</small><a aria-hidden="true" href="#nicer-generated-heading">#</a> </h5>
<div class="outline-text-5" id="text-6-3-2-6">
<p>
Thanks to alphapapa&rsquo;s <a href="https://github.com/alphapapa/unpackaged.el#export-to-html-with-useful-anchors">unpackaged.el</a>.
</p>

<p>
By default, <code>url-hexify-string</code> seemed to cause me some issues. Replacing that in
<code>a53899</code> resolved this for me. To go one step further, I create a function for
producing nice short links, like an inferior version of <code>reftex-label</code>.
</p>

<details id='nicer-generated-heading,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#nicer-generated-heading,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">org-reference-contraction-max-words</span> <span class="org-highlight-numbers-number">3</span>
  <span class="org-doc">"Maximum number of words in a reference reference."</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">org-reference-contraction-max-length</span> <span class="org-highlight-numbers-number">35</span>
  <span class="org-doc">"Maximum length of resulting reference reference, including joining characters."</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">org-reference-contraction-stripped-words</span>
  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"the"</span> <span class="org-string">"on"</span> <span class="org-string">"in"</span> <span class="org-string">"off"</span> <span class="org-string">"a"</span> <span class="org-string">"for"</span> <span class="org-string">"by"</span> <span class="org-string">"of"</span> <span class="org-string">"and"</span> <span class="org-string">"is"</span> <span class="org-string">"to"</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Superfluous words to be removed from a reference."</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">org-reference-contraction-joining-char</span> <span class="org-string">"-"</span>
  <span class="org-doc">"Character used to join words in the reference reference."</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-reference-contraction-truncate-words</span> <span class="org-rainbow-delimiters-depth-2">(</span>words<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Using `</span><span class="org-doc"><span class="org-constant">org-reference-contraction-max-length</span></span><span class="org-doc">' as the total character 'budget' for the WORDS</span>
<span class="org-doc">and truncate individual words to conform to this budget.</span>

<span class="org-doc">To arrive at a budget that accounts for words undershooting their requisite average length,</span>
<span class="org-doc">the number of charachters in the budget freed by short words is distributed among the words</span>
<span class="org-doc">exceeding the average length.  This adjusts the per-word budget to be the maximum feasable for</span>
<span class="org-doc">this particular situation, rather than the universal maximum average.</span>

<span class="org-doc">This budget-adjusted per-word maximum length is given by the mathematical expression below:</span>

<span class="org-doc">max length = \\floor{ \\frac{total length - chars for seperators - \\sum_{word \\leq average length} length(word) }{num(words) &gt; average length} }"</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">trucate each word to a max word length determined by</span>
  <span class="org-comment-delimiter">;;</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>total-length-budget <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">-</span> <span class="org-variable-name">org-reference-contraction-max-length</span>  <span class="org-comment-delimiter">; </span><span class="org-comment">how many non-separator chars we can use</span>
                                 <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">1-</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">length</span> words<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>word-length-budget <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">/</span> total-length-budget                      <span class="org-comment-delimiter">; </span><span class="org-comment">max length of each word to keep within budget</span>
                                <span class="org-variable-name">org-reference-contraction-max-words</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>num-overlong <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">-count</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-1">(</span>word<span class="org-rainbow-delimiters-depth-1">)</span>                            <span class="org-comment-delimiter">; </span><span class="org-comment">how many words exceed that budget</span>
                                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">&gt;</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">length</span> word<span class="org-rainbow-delimiters-depth-2">)</span> word-length-budget<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                               words<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>total-short-length <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">-sum</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">mapcar</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-2">(</span>word<span class="org-rainbow-delimiters-depth-2">)</span>                <span class="org-comment-delimiter">; </span><span class="org-comment">total length of words under that budget</span>
                                             <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">&lt;=</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">length</span> word<span class="org-rainbow-delimiters-depth-1">)</span> word-length-budget<span class="org-rainbow-delimiters-depth-3">)</span>
                                                 <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">length</span> word<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                                           words<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>max-length <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">/</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">-</span> total-length-budget total-short-length<span class="org-rainbow-delimiters-depth-3">)</span>       <span class="org-comment-delimiter">; </span><span class="org-comment">max(max-length) that we can have to fit within the budget</span>
                        num-overlong<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">mapcar</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-2">(</span>word<span class="org-rainbow-delimiters-depth-2">)</span>
              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">&lt;=</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">length</span> word<span class="org-rainbow-delimiters-depth-1">)</span> max-length<span class="org-rainbow-delimiters-depth-3">)</span>
                  word
                <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">substring</span> word <span class="org-highlight-numbers-number">0</span> max-length<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
            words<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-reference-contraction</span> <span class="org-rainbow-delimiters-depth-2">(</span>reference-string<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Give a contracted form of REFERENCE-STRING that is only contains alphanumeric characters.</span>
<span class="org-doc">Strips 'joining' words present in `</span><span class="org-doc"><span class="org-constant">org-reference-contraction-stripped-words</span></span><span class="org-doc">',</span>
<span class="org-doc">and then limits the result to the first `</span><span class="org-doc"><span class="org-constant">org-reference-contraction-max-words</span></span><span class="org-doc">' words.</span>
<span class="org-doc">If the total length is &gt; `</span><span class="org-doc"><span class="org-constant">org-reference-contraction-max-length</span></span><span class="org-doc">' then individual words are</span>
<span class="org-doc">truncated to fit within the limit using `</span><span class="org-doc"><span class="org-constant">org-reference-contraction-truncate-words</span></span><span class="org-doc">'."</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>reference-words
         <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">-filter</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-1">(</span>word<span class="org-rainbow-delimiters-depth-1">)</span>
                    <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">not</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">member</span> word <span class="org-variable-name">org-reference-contraction-stripped-words</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">split-string</span>
                   <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">-&gt;&gt;</span> reference-string
                        downcase
                        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">replace-regexp-in-string</span> <span class="org-string">"\\[\\[[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">]]+\\]\\[</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">]]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\]\\]"</span> <span class="org-string">"\\1"</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">get description from org-link</span>
                        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">replace-regexp-in-string</span> <span class="org-string">"[-/ ]+"</span> <span class="org-string">" "</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">replace seperator-type chars with space</span>
                        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">replace-regexp-in-string</span> <span class="org-string">"[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">a-z0-9 ]"</span> <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">strip chars which need %-encoding in a uri</span>
                        <span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-string">" "</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">&gt;</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">length</span> reference-words<span class="org-rainbow-delimiters-depth-2">)</span>
             <span class="org-variable-name">org-reference-contraction-max-words</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> reference-words
            <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">cl-subseq</span> reference-words <span class="org-highlight-numbers-number">0</span> <span class="org-variable-name">org-reference-contraction-max-words</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>

    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">&gt;</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">apply</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">+</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">1-</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">length</span> reference-words<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">mapcar</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">length</span> reference-words<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
             <span class="org-variable-name">org-reference-contraction-max-length</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> reference-words <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-reference-contraction-truncate-words</span> reference-words<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>

    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">string-join</span> reference-words <span class="org-variable-name">org-reference-contraction-joining-char</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
Now here&rsquo;s alphapapa&rsquo;s subtly tweaked mode.
</p>
<details id='nicer-generated-heading,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#nicer-generated-heading,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define-minor-mode</span> <span class="org-variable-name">unpackaged/org-export-html-with-useful-ids-mode</span>
  <span class="org-doc">"Attempt to export Org as HTML with useful link IDs.</span>
<span class="org-doc">Instead of random IDs like \"#orga1b2c3\", use heading titles,</span>
<span class="org-doc">made unique when necessary."</span>
  <span class="org-builtin">:global</span> t
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-variable-name">unpackaged/org-export-html-with-useful-ids-mode</span>
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">advice-add</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-export-get-reference</span> <span class="org-builtin">:override</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">unpackaged/org-export-get-reference</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">advice-remove</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-export-get-reference</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">unpackaged/org-export-get-reference</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-variable-name">unpackaged/org-export-html-with-useful-ids-mode</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">ensure enabled, and advice run</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">unpackaged/org-export-get-reference</span> <span class="org-rainbow-delimiters-depth-2">(</span>datum info<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Like `</span><span class="org-doc"><span class="org-constant">org-export-get-reference</span></span><span class="org-doc">', except uses heading titles instead of random numbers."</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>cache <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:internal-references</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">car</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">rassq</span> datum cache<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>crossrefs <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:crossrefs</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
               <span class="org-rainbow-delimiters-depth-3">(</span>cells <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-export-search-cells</span> datum<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">Preserve any pre-existing association between</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">a search cell and a reference, i.e., when some</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">previously published document referenced a location</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">within current file (see</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">`</span><span class="org-comment"><span class="org-constant">org-publish-resolve-external-link</span></span><span class="org-comment">').</span>
               <span class="org-comment-delimiter">;;</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">However, there is no guarantee that search cells are</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">unique, e.g., there might be duplicate custom ID or</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">two headings with the same title in the file.</span>
               <span class="org-comment-delimiter">;;</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">As a consequence, before re-using any reference to</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">an element or object, we check that it doesn't refer</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">to a previous element or object.</span>
               <span class="org-rainbow-delimiters-depth-3">(</span>new <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">cl-some</span>
                         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-1">(</span>cell<span class="org-rainbow-delimiters-depth-1">)</span>
                           <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>stored <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">cdr</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">assoc</span> cell crossrefs<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                             <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> stored
                               <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>old <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-export-format-reference</span> stored<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">not</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">assoc</span> old cache<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span> stored<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                         cells<span class="org-rainbow-delimiters-depth-2">)</span>
                        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-element-property</span> <span class="org-builtin">:raw-value</span> datum<span class="org-rainbow-delimiters-depth-3">)</span>
                          <span class="org-comment-delimiter">;; </span><span class="org-comment">Heading with a title</span>
                          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">unpackaged/org-export-new-named-reference</span> datum cache<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">member</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">car</span> datum<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-1">(</span>src-block table example fixed-width property-drawer<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                          <span class="org-comment-delimiter">;; </span><span class="org-comment">Nameable elements</span>
                          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">unpackaged/org-export-new-named-reference</span> datum cache<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                        <span class="org-comment-delimiter">;; </span><span class="org-bold"><span class="org-success">NOTE:</span></span><span class="org-comment"> This probably breaks some Org Export</span>
                        <span class="org-comment-delimiter">;; </span><span class="org-comment">feature, but if it does what I need, fine.</span>
                        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-export-format-reference</span>
                         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-export-new-reference</span> cache<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
               <span class="org-rainbow-delimiters-depth-3">(</span>reference-string new<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-comment-delimiter">;; </span><span class="org-comment">Cache contains both data already associated to</span>
          <span class="org-comment-delimiter">;; </span><span class="org-comment">a reference and in-use internal references, so as to make</span>
          <span class="org-comment-delimiter">;; </span><span class="org-comment">unique references.</span>
          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">dolist</span> <span class="org-rainbow-delimiters-depth-3">(</span>cell cells<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">push</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">cons</span> cell new<span class="org-rainbow-delimiters-depth-1">)</span> cache<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-comment-delimiter">;; </span><span class="org-comment">Retain a direct association between reference string and</span>
          <span class="org-comment-delimiter">;; </span><span class="org-comment">DATUM since (1) not every object or element can be given</span>
          <span class="org-comment-delimiter">;; </span><span class="org-comment">a search cell (2) it permits quick lookup.</span>
          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">push</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">cons</span> reference-string datum<span class="org-rainbow-delimiters-depth-3">)</span> cache<span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-put</span> info <span class="org-builtin">:internal-references</span> cache<span class="org-rainbow-delimiters-depth-2">)</span>
          reference-string<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">unpackaged/org-export-new-named-reference</span> <span class="org-rainbow-delimiters-depth-2">(</span>datum cache<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Return new reference for DATUM that is unique in CACHE."</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">cl-macrolet</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>inc-suffixf <span class="org-rainbow-delimiters-depth-2">(</span>place<span class="org-rainbow-delimiters-depth-2">)</span>
                             <span class="org-highlight-quoted-quote">`</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">progn</span>
                                <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">string-match</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">rx</span> bos
                                                  <span class="org-rainbow-delimiters-depth-2">(</span>minimal-match <span class="org-rainbow-delimiters-depth-3">(</span>group <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">1+</span> anything<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                                                  <span class="org-rainbow-delimiters-depth-2">(</span>optional <span class="org-string">"--"</span> <span class="org-rainbow-delimiters-depth-3">(</span>group <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">1+</span> digit<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                                                  eos<span class="org-rainbow-delimiters-depth-1">)</span>
                                              ,place<span class="org-rainbow-delimiters-depth-3">)</span>
                                <span class="org-comment-delimiter">;; </span><span class="org-bold"><span class="org-constant">HACK:</span></span><span class="org-comment"> `</span><span class="org-comment"><span class="org-constant">s1</span></span><span class="org-comment">' instead of a gensym.</span>
                                <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">-let*</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>s1 suffix<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">list</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">match-string</span> <span class="org-highlight-numbers-number">1</span> ,place<span class="org-rainbow-delimiters-depth-1">)</span>
                                                           <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">match-string</span> <span class="org-highlight-numbers-number">2</span> ,place<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                                        <span class="org-rainbow-delimiters-depth-2">(</span>suffix <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> suffix
                                                    <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">string-to-number</span> suffix<span class="org-rainbow-delimiters-depth-1">)</span>
                                                  <span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                                  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setf</span> ,place <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"%s--%s"</span> s1 <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">cl-incf</span> suffix<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>headline-p <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">eq</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">car</span> datum<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">headline</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>title <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> headline-p
                      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-element-property</span> <span class="org-builtin">:raw-value</span> datum<span class="org-rainbow-delimiters-depth-1">)</span>
                    <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-element-property</span> <span class="org-builtin">:name</span> datum<span class="org-rainbow-delimiters-depth-2">)</span>
                        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">concat</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-element-property</span> <span class="org-builtin">:raw-value</span>
                                                      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-element-property</span> <span class="org-builtin">:parent</span>
                                                                            <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-element-property</span> <span class="org-builtin">:parent</span> datum<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-comment-delimiter">;; </span><span class="org-comment">get ascii-only form of title without needing percent-encoding</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>ref <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">concat</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-reference-contraction</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">substring-no-properties</span> title<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">or</span> headline-p <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-element-property</span> <span class="org-builtin">:name</span> datum<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">concat</span> <span class="org-string">","</span>
                                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">pcase</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">car</span> datum<span class="org-rainbow-delimiters-depth-1">)</span>
                                    <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">src-block</span> <span class="org-string">"code"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                                    <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">example</span> <span class="org-string">"example"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                                    <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">fixed-width</span> <span class="org-string">"mono"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                                    <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">property-drawer</span> <span class="org-string">"properties"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                                    <span class="org-rainbow-delimiters-depth-1">(</span>_ <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">symbol-name</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">car</span> datum<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                                  <span class="org-string">"--1"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>parent <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> headline-p <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-element-property</span> <span class="org-builtin">:parent</span> datum<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">while</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">--any</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">equal</span> ref <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">car</span> it<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    cache<span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">Title not unique: make it so.</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> parent
            <span class="org-comment-delimiter">;; </span><span class="org-comment">Append ancestor title.</span>
            <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setf</span> title <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-element-property</span> <span class="org-builtin">:raw-value</span> parent<span class="org-rainbow-delimiters-depth-2">)</span>
                                <span class="org-string">"--"</span> title<span class="org-rainbow-delimiters-depth-1">)</span>
                  <span class="org-comment-delimiter">;; </span><span class="org-comment">get ascii-only form of title without needing percent-encoding</span>
                  ref <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-reference-contraction</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">substring-no-properties</span> title<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                  parent <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> headline-p <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-element-property</span> <span class="org-builtin">:parent</span> parent<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
          <span class="org-comment-delimiter">;; </span><span class="org-comment">No more ancestors: add and increment a number.</span>
          <span class="org-rainbow-delimiters-depth-3">(</span>inc-suffixf ref<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      ref<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">org-load-hook</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-variable-name">unpackaged/org-export-html-with-useful-ids-mode</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-nicer-org-return" class="outline-5">
<h5 id="nicer-org-return"><span class="section-number-5">6.3.2.7</span> Nicer <code>org-return</code><a aria-hidden="true" href="#nicer-org-return">#</a> </h5>
<div class="outline-text-5" id="text-6-3-2-7">
<p>
Once again, from <a href="https://github.com/alphapapa/unpackaged.el#org-return-dwim">unpackaged.el</a>
</p>
<details id='nicer-org-return,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#nicer-org-return,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">unpackaged/org-element-descendant-of</span> <span class="org-rainbow-delimiters-depth-2">(</span>type element<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Return non-nil if ELEMENT is a descendant of TYPE.</span>
<span class="org-doc">TYPE should be an element type, like `</span><span class="org-doc"><span class="org-constant">item</span></span><span class="org-doc">' or `</span><span class="org-doc"><span class="org-constant">paragraph</span></span><span class="org-doc">'.</span>
<span class="org-doc">ELEMENT should be a list like that returned by `</span><span class="org-doc"><span class="org-constant">org-element-context</span></span><span class="org-doc">'."</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">MAYBE: Use `</span><span class="org-comment"><span class="org-constant">org-element-lineage</span></span><span class="org-comment">'.</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when-let*</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>parent <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-element-property</span> <span class="org-builtin">:parent</span> element<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">eq</span> type <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">car</span> parent<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">unpackaged/org-element-descendant-of</span> type parent<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning-1">autoload</span></span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">unpackaged/org-return-dwim</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">&amp;optional</span> default<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"A helpful replacement for `</span><span class="org-doc"><span class="org-constant">org-return-indent</span></span><span class="org-doc">'.  With prefix, call `</span><span class="org-doc"><span class="org-constant">org-return-indent</span></span><span class="org-doc">'.</span>

<span class="org-doc">On headings, move point to position after entry content.  In</span>
<span class="org-doc">lists, insert a new item or end the list, with checkbox if</span>
<span class="org-doc">appropriate.  In tables, insert a new row or end the table."</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Inspired by John Kitchin: http://kitchingroup.cheme.cmu.edu/blog/2017/04/09/A-better-return-in-org-mode/</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">interactive</span> <span class="org-string">"P"</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> default
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-return</span> t<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">cond</span>
     <span class="org-comment-delimiter">;; </span><span class="org-comment">Act depending on context around point.</span>

     <span class="org-comment-delimiter">;; </span><span class="org-bold"><span class="org-success">NOTE:</span></span><span class="org-comment"> I prefer RET to not follow links, but by uncommenting this block, links will be</span>
     <span class="org-comment-delimiter">;; </span><span class="org-comment">followed.</span>

     <span class="org-comment-delimiter">;; </span><span class="org-comment">((eq 'link (car (org-element-context)))</span>
     <span class="org-comment-delimiter">;;  </span><span class="org-comment">;; Link: Open it.</span>
     <span class="org-comment-delimiter">;;  </span><span class="org-comment">(org-open-at-point-global))</span>

     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-at-heading-p</span><span class="org-rainbow-delimiters-depth-2">)</span>
      <span class="org-comment-delimiter">;; </span><span class="org-comment">Heading: Move to position after entry content.</span>
      <span class="org-comment-delimiter">;; </span><span class="org-bold"><span class="org-success">NOTE:</span></span><span class="org-comment"> This is probably the most interesting feature of this function.</span>
      <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>heading-start <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-entry-beginning-position</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">goto-char</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-entry-end-position</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">cond</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-at-heading-p</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">=</span> heading-start <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-entry-beginning-position</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">Entry ends on its heading; add newline after</span>
               <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">end-of-line</span><span class="org-rainbow-delimiters-depth-2">)</span>
               <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">insert</span> <span class="org-string">"\n\n"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
              <span class="org-rainbow-delimiters-depth-1">(</span>t
               <span class="org-comment-delimiter">;; </span><span class="org-comment">Entry ends after its heading; back up</span>
               <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">forward-line</span> <span class="org-highlight-numbers-number">-1</span><span class="org-rainbow-delimiters-depth-2">)</span>
               <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">end-of-line</span><span class="org-rainbow-delimiters-depth-2">)</span>
               <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-at-heading-p</span><span class="org-rainbow-delimiters-depth-3">)</span>
                 <span class="org-comment-delimiter">;; </span><span class="org-comment">At the same heading</span>
                 <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">forward-line</span><span class="org-rainbow-delimiters-depth-3">)</span>
                 <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">insert</span> <span class="org-string">"\n"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                 <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">forward-line</span> <span class="org-highlight-numbers-number">-1</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
               <span class="org-comment-delimiter">;; </span><span class="org-bold"><span class="org-error">FIXME:</span></span><span class="org-comment"> looking-back is supposed to be called with more arguments.</span>
               <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">while</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">not</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">looking-back</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">rx</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">repeat</span> <span class="org-highlight-numbers-number">3</span> <span class="org-rainbow-delimiters-depth-1">(</span>seq <span class="org-rainbow-delimiters-depth-2">(</span>optional blank<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-string">"\n"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                 <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">insert</span> <span class="org-string">"\n"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
               <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">forward-line</span> <span class="org-highlight-numbers-number">-1</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-at-item-checkbox-p</span><span class="org-rainbow-delimiters-depth-2">)</span>
      <span class="org-comment-delimiter">;; </span><span class="org-comment">Checkbox: Insert new item with checkbox.</span>
      <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-insert-todo-heading</span> nil<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-in-item-p</span><span class="org-rainbow-delimiters-depth-2">)</span>
      <span class="org-comment-delimiter">;; </span><span class="org-comment">Plain list.  Yes, this gets a little complicated...</span>
      <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>context <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-element-context</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">eq</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">plain-list</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">car</span> context<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>  <span class="org-comment-delimiter">; </span><span class="org-comment">First item in list</span>
                <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">eq</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">item</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">car</span> context<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">not</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">eq</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-element-property</span> <span class="org-builtin">:contents-begin</span> context<span class="org-rainbow-delimiters-depth-2">)</span>
                              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-element-property</span> <span class="org-builtin">:contents-end</span> context<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">unpackaged/org-element-descendant-of</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">item</span> context<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>  <span class="org-comment-delimiter">; </span><span class="org-comment">Element in list item, e.g. a link</span>
            <span class="org-comment-delimiter">;; </span><span class="org-comment">Non-empty item: Add new item.</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-insert-item</span><span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-comment-delimiter">;; </span><span class="org-comment">Empty item: Close the list.</span>
          <span class="org-comment-delimiter">;; </span><span class="org-bold"><span class="org-warning">TODO:</span></span><span class="org-comment"> Do this with org functions rather than operating on the text. Can't seem to find the right function.</span>
          <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">delete-region</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">line-beginning-position</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">line-end-position</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">insert</span> <span class="org-string">"\n"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">fboundp</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">org-inlinetask-in-task-p</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>org-inlinetask-in-task-p<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
      <span class="org-comment-delimiter">;; </span><span class="org-comment">Inline task: Don't insert a new heading.</span>
      <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-return</span> t<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-at-table-p</span><span class="org-rainbow-delimiters-depth-2">)</span>
      <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">cond</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">save-excursion</span>
               <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">beginning-of-line</span><span class="org-rainbow-delimiters-depth-2">)</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">See `</span><span class="org-comment"><span class="org-constant">org-table-next-field</span></span><span class="org-comment">'.</span>
               <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">cl-loop</span> with end = <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">line-end-position</span><span class="org-rainbow-delimiters-depth-3">)</span>
                        for cell = <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-element-table-cell-parser</span><span class="org-rainbow-delimiters-depth-3">)</span>
                        always <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">equal</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-element-property</span> <span class="org-builtin">:contents-begin</span> cell<span class="org-rainbow-delimiters-depth-1">)</span>
                                      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-element-property</span> <span class="org-builtin">:contents-end</span> cell<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                        while <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">re-search-forward</span> <span class="org-string">"|"</span> end t<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
             <span class="org-comment-delimiter">;; </span><span class="org-comment">Empty row: end the table.</span>
             <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">delete-region</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">line-beginning-position</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">line-end-position</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
             <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-return</span> t<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
            <span class="org-rainbow-delimiters-depth-3">(</span>t
             <span class="org-comment-delimiter">;; </span><span class="org-comment">Non-empty row: call `</span><span class="org-comment"><span class="org-constant">org-return-indent</span></span><span class="org-comment">'.</span>
             <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-return</span> t<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-rainbow-delimiters-depth-1">(</span>t
      <span class="org-comment-delimiter">;; </span><span class="org-comment">All other cases: call `</span><span class="org-comment"><span class="org-constant">org-return-indent</span></span><span class="org-comment">'.</span>
      <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-return</span> t<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">map!</span>
 <span class="org-builtin">:after</span> evil-org
 <span class="org-builtin">:map</span> evil-org-mode-map
 <span class="org-builtin">:i</span> <span class="org-rainbow-delimiters-depth-2">[</span>return<span class="org-rainbow-delimiters-depth-2">]</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">unpackaged/org-return-dwim</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-snippet-helper" class="outline-5">
<h5 id="snippet-helper"><span class="section-number-5">6.3.2.8</span> Snippet Helper<a aria-hidden="true" href="#snippet-helper">#</a> </h5>
<div class="outline-text-5" id="text-6-3-2-8">
<p>
For snippets which want to depend on the <code>#+thing:</code> on the current line.
This is mostly source blocks, and property args, so let&rsquo;s get fancy with them.
</p>

<p>
One-letter snippets are super-convenient, but for them to not be a pain
everywhere else we&rsquo;ll need a nice condition function to use in yasnippet.
</p>

<p>
By having this function give slightly more than a simple <code>t</code> or <code>nil</code>, we can
use in a second function to get the most popular language without explicit
global header args.
</p>
<details id='snippet-helper,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#snippet-helper,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+yas/org-src-lang</span> <span class="org-rainbow-delimiters-depth-2">()</span>
  <span class="org-doc">"Try to find the current language of the src/header at point.</span>
<span class="org-doc">Return nil otherwise."</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">save-excursion</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">pcase</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">downcase</span>
         <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">buffer-substring-no-properties</span>
          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">goto-char</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">line-beginning-position</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">ignore-errors</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">1-</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">search-forward</span> <span class="org-string">" "</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">line-end-position</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
              <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">1+</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">point</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"#+property:"</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">re-search-forward</span> <span class="org-string">"header-args:"</span><span class="org-rainbow-delimiters-depth-3">)</span>
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">buffer-substring-no-properties</span>
          <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">point</span><span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">forward-symbol</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">point</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">1+</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">point</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"#+begin_src"</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">buffer-substring-no-properties</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">point</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">forward-symbol</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">point</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">1+</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">point</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"#+header:"</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">search-forward</span> <span class="org-string">"#+begin_src"</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">+yas/org-src-lang</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span>_ nil<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+yas/org-src-header-p</span> <span class="org-rainbow-delimiters-depth-2">()</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">or</span>
   <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">looking-back</span> <span class="org-string">"^#\\+property:[ \t]+header-args:.*"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">line-beginning-position</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
   <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">looking-back</span> <span class="org-string">"^#\\+header:.*"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">line-beginning-position</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+yas/org-last-src-lang</span> <span class="org-rainbow-delimiters-depth-2">()</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">save-excursion</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">beginning-of-line</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">search-backward</span> <span class="org-string">"#+begin_src"</span> nil t<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">+yas/org-src-lang</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+yas/org-most-common-no-property-lang</span> <span class="org-rainbow-delimiters-depth-2">()</span>
  <span class="org-doc">"Find the lang with the most source blocks that has no global header-args, else nil."</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span>src-langs header-langs<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">save-excursion</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">goto-char</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">point-min</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">while</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">search-forward</span> <span class="org-string">"#+begin_src"</span> nil t<span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">push</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">+yas/org-src-lang</span><span class="org-rainbow-delimiters-depth-3">)</span> src-langs<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">goto-char</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">point-min</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">while</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">re-search-forward</span> <span class="org-string">"#\\+property: +header-args"</span> nil t<span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">push</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">+yas/org-src-lang</span><span class="org-rainbow-delimiters-depth-3">)</span> header-langs<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>

    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> src-langs
          <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">mapcar</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">car</span>
                  <span class="org-comment-delimiter">;; </span><span class="org-comment">sort alist by frequency (desc.)</span>
                  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">sort</span>
                   <span class="org-comment-delimiter">;; </span><span class="org-comment">generate alist with form (value . frequency)</span>
                   <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">cl-loop</span> for <span class="org-rainbow-delimiters-depth-1">(</span>n . m<span class="org-rainbow-delimiters-depth-1">)</span> in <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">seq-group-by</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">identity</span> src-langs<span class="org-rainbow-delimiters-depth-1">)</span>
                            collect <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">cons</span> n <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">length</span> m<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                   <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-1">(</span>a b<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">&gt;</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">cdr</span> a<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">cdr</span> b<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>

    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">car</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">cl-set-difference</span> src-langs header-langs <span class="org-builtin">:test</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">string=</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-translate-capital-keywords" class="outline-5">
<h5 id="translate-capital-keywords"><span class="section-number-5">6.3.2.9</span> Translate capital keywords (old) to lower case (new)<a aria-hidden="true" href="#translate-capital-keywords">#</a> </h5>
<div class="outline-text-5" id="text-6-3-2-9">
<p>
Everyone used to use <code>#+CAPITAL</code> keywords. Then people realised that <code>#+lowercase</code>
is actually both marginally easier and visually nicer, so now the capital
version is just used in the manual.
</p>
<blockquote>
<p>
Org is standardized on lower case. Uppercase is used in the manual as a poor
man&rsquo;s bold, and supported for historical reasons. &#x2014; <a href="https://orgmode.org/list/87tuuw3n15.fsf@nicolasgoaziou.fr">Nicolas Goaziou on the Org <span class='acr'>ML</span></a>
</p>
</blockquote>

<p>
To avoid sometimes having to choose between the hassle out of updating old
documents and using mixed syntax, I&rsquo;ll whip up a basic transcode-y function.
It likely misses some edged cases, but should mostly work.
</p>

<details id='translate-capital-keywords,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#translate-capital-keywords,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-syntax-convert-case-to-lower</span> <span class="org-rainbow-delimiters-depth-2">()</span>
  <span class="org-doc">"Convert all #+KEYWORDS to #+keywords."</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">interactive</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">save-excursion</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">goto-char</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">point-min</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">count</span> <span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-variable-name">case-fold-search</span> nil<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">while</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">re-search-forward</span> <span class="org-string">"#\\+[A-Z_]+"</span> nil t<span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">replace-match</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">downcase</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">match-string</span> <span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span> t<span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> count <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">1+</span> count<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">message</span> <span class="org-string">"Replaced %d occurances"</span> count<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-extra-links" class="outline-5">
<h5 id="extra-links"><span class="section-number-5">6.3.2.10</span> Extra links<a aria-hidden="true" href="#extra-links">#</a> </h5>
<div class="outline-text-5" id="text-6-3-2-10">
</div>
<div id="outline-container-extra-links-xkcd" class="outline-6">
<h6 id="extra-links-xkcd"><span class="section-number-6">6.3.2.10.1</span> xkcd<a aria-hidden="true" href="#extra-links-xkcd">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-10-1">
<p>
Because xkcd is cool, let&rsquo;s make it as easy and fun as possible to insert them.
Saving seconds adds up after all! (but only so much)
</p>

<p>
<img class='invertible' src='https://imgs.xkcd.com/comics/is_it_worth_the_time.png' title="Don't forget the time you spend finding the chart to look up what you save. And the time spent reading this reminder about the time spent. And the time trying to figure out if either of those actually make sense. Remember, every second counts toward your life total, including these right now." alt='Is It Worth the Time?'>
</p>

<details id='xkcd,code--3' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#xkcd,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-link-set-parameters</span> <span class="org-string">"xkcd"</span>
                         <span class="org-builtin">:image-data-fun</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">+org-xkcd-image-fn</span>
                         <span class="org-builtin">:follow</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">+org-xkcd-open-fn</span>
                         <span class="org-builtin">:export</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">+org-xkcd-export</span>
                         <span class="org-builtin">:complete</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">+org-xkcd-complete</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+org-xkcd-open-fn</span> <span class="org-rainbow-delimiters-depth-2">(</span>link<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">+org-xkcd-image-fn</span> nil link nil<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+org-xkcd-image-fn</span> <span class="org-rainbow-delimiters-depth-2">(</span>protocol link description<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Get image data for xkcd num LINK"</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>xkcd-info <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">+xkcd-fetch-info</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">string-to-number</span> link<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>img <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> xkcd-info <span class="org-builtin">:img</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>alt <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> xkcd-info <span class="org-builtin">:alt</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">message</span> alt<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">+org-image-file-data-fn</span> protocol <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">xkcd-download</span> img <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">string-to-number</span> link<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span> description<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+org-xkcd-export</span> <span class="org-rainbow-delimiters-depth-2">(</span>num desc backend _com<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Convert xkcd to html/LaTeX form"</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>xkcd-info <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">+xkcd-fetch-info</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">string-to-number</span> num<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>img <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> xkcd-info <span class="org-builtin">:img</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>alt <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> xkcd-info <span class="org-builtin">:alt</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>title <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> xkcd-info <span class="org-builtin">:title</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>file <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">xkcd-download</span> img <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">string-to-number</span> num<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">cond</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-export-derived-backend-p</span> backend <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">html</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"&lt;img class='invertible' src='%s' title=\"%s\" alt='%s'&gt;"</span> img <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">subst-char-in-string</span> ?\" ?<span class="org-warning">&#8220;</span> alt<span class="org-rainbow-delimiters-depth-3">)</span> title<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-export-derived-backend-p</span> backend <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">latex</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"\\begin{figure}[!htb]</span>
<span class="org-string">  \\centering</span>
<span class="org-string">  \\includegraphics[scale=0.4]{%s}%s</span>
<span class="org-string">\\end{figure}"</span> file <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">equal</span> desc <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"xkcd:%s"</span> num<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-string">""</span>
                      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"\n  \\caption*{\\label{xkcd:%s} %s}"</span>
                              num
                              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">or</span> desc
                                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-string">"\\textbf{%s} %s"</span> title alt<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-rainbow-delimiters-depth-1">(</span>t <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"https://xkcd.com/%s"</span> num<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+org-xkcd-complete</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">&amp;optional</span> arg<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Complete xkcd using `</span><span class="org-doc"><span class="org-constant">+xkcd-stored-info</span></span><span class="org-doc">'"</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"xkcd:%d"</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">+xkcd-select</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-music" class="outline-6">
<h6 id="music"><span class="section-number-6">6.3.2.10.2</span> Music<a aria-hidden="true" href="#music">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-10-2">
<p>
First, we set up all the necessarily &rsquo;utility&rsquo; functions.
</p>
<details id='music,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#music,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> org
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">org-music-player</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">mpris</span>
    <span class="org-doc">"Music player type. Curretly only supports mpris."</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">org-music-mpris-player</span> <span class="org-string">"Lollypop"</span>
    <span class="org-doc">"Name of the mpris player, used in the form org.gnome.MPRIS."</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">org-music-track-search-method</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">beets</span>
    <span class="org-doc">"Method to find the track file from the link."</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">org-music-beets-db</span> <span class="org-string">"~/Music/library.db"</span>
    <span class="org-doc">"Location of the beets DB, for when using beets as the `</span><span class="org-doc"><span class="org-constant">org-music-track-search-method</span></span><span class="org-doc">'"</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">org-music-folder</span> <span class="org-string">"~/Music/"</span>
    <span class="org-doc">"Location of your music folder, for when using file as the `</span><span class="org-doc"><span class="org-constant">org-music-track-search-method</span></span><span class="org-doc">'"</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">org-music-recognised-extensions</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"flac"</span> <span class="org-string">"mp4"</span> <span class="org-string">"m4a"</span> <span class="org-string">"aiff"</span> <span class="org-string">"wav"</span> <span class="org-string">"ogg"</span> <span class="org-string">"aiff"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"When searching for files in `</span><span class="org-doc"><span class="org-constant">org-music-track-search-method</span></span><span class="org-doc">', recognise these extensions as audio files."</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-music-get-link</span> <span class="org-rainbow-delimiters-depth-3">(</span>full <span class="org-type">&amp;optional</span> include-time<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Generate link string for currently playing track, optionally including a time-stamp"</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">pcase</span> <span class="org-variable-name">org-music-player</span> <span class="org-comment-delimiter">;; </span><span class="org-bold"><span class="org-success">NOTE</span></span><span class="org-comment"> this could do with better generalisation</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">mpris</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>track-metadata
                      <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-music-mpris-get-property</span> <span class="org-string">"Metadata"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                     <span class="org-rainbow-delimiters-depth-1">(</span>album-artist <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">caar</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">cadr</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">assoc</span> <span class="org-string">"xesam:albumArtist"</span> track-metadata<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                     <span class="org-rainbow-delimiters-depth-1">(</span>artist <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">equal</span> album-artist <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-1">)</span>
                                     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">s-contains-p</span> <span class="org-string">"various"</span> album-artist t<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                                 <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">caar</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">cadr</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">assoc</span> <span class="org-string">"xesam:artist"</span> track-metadata<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                               album-artist<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                     <span class="org-rainbow-delimiters-depth-1">(</span>track <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">car</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">cadr</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">assoc</span> <span class="org-string">"xesam:title"</span> track-metadata<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                     <span class="org-rainbow-delimiters-depth-1">(</span>start-time <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> include-time
                                   <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">/</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-music-mpris-get-property</span> <span class="org-string">"Position"</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-highlight-numbers-number">1000000</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> full
                    <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"[[music:%s][%s by %s]]"</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-music-format-link</span> artist track start-time<span class="org-rainbow-delimiters-depth-2">)</span> track artist<span class="org-rainbow-delimiters-depth-1">)</span>
                  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-music-format-link</span> artist track start-time<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span>_ <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">user-error!</span> <span class="org-string">"The specified music player: %s is not supported"</span> <span class="org-variable-name">org-music-player</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-music-format-link</span> <span class="org-rainbow-delimiters-depth-3">(</span>artist track <span class="org-type">&amp;optional</span> start-time end-time<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>artist <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">replace-regexp-in-string</span> <span class="org-string">":"</span> <span class="org-string">"\\:"</span> artist<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span>track <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">replace-regexp-in-string</span> <span class="org-string">":"</span> <span class="org-string">"\\:"</span> track<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span> artist <span class="org-string">":"</span> track
              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">cond</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">and</span> start-time end-time<span class="org-rainbow-delimiters-depth-1">)</span>
                     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"::%s-%s"</span>
                             <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-music-seconds-to-time</span> start-time<span class="org-rainbow-delimiters-depth-2">)</span>
                             <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-music-seconds-to-time</span> end-time<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span>start-time
                     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"::%s"</span>
                             <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-music-seconds-to-time</span> start-time<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-music-parse-link</span> <span class="org-rainbow-delimiters-depth-3">(</span>link<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>link-dc <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">-&gt;&gt;</span> link
                         <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">replace-regexp-in-string</span> <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">\\\\]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\\\:"</span> <span class="org-string">"\\1#COLON#"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                         <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">replace-regexp-in-string</span> <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">::[a-z0-9]*[0-9]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\'"</span> <span class="org-string">"\\1s"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>link-components <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">mapcar</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-2">(</span>lc<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">replace-regexp-in-string</span> <span class="org-string">"#COLON#"</span> <span class="org-string">":"</span> lc<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                                    <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">s-split</span> <span class="org-string">":"</span> link-dc<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>artist <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">0</span> link-components<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>track <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">1</span> link-components<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>durations <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">&gt;</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">length</span> link-components<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-highlight-numbers-number">3</span><span class="org-rainbow-delimiters-depth-2">)</span>
                                 <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">equal</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">2</span> link-components<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">s-split</span> <span class="org-string">"-"</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">3</span> link-components<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>start-time <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> durations
                         <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-music-time-to-seconds</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">car</span> durations<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>end-time <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">cdr</span> durations<span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-music-time-to-seconds</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">cadr</span> durations<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">list</span> artist track start-time end-time<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-music-seconds-to-time</span> <span class="org-rainbow-delimiters-depth-3">(</span>seconds<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Convert a number of seconds to a nice human duration, e.g. 5m21s.</span>
<span class="org-doc">This action is reversed by `</span><span class="org-doc"><span class="org-constant">org-music-time-to-seconds</span></span><span class="org-doc">'."</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">&lt;</span> seconds <span class="org-highlight-numbers-number">60</span><span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"%ss"</span> seconds<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">&lt;</span> seconds <span class="org-highlight-numbers-number">3600</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"%sm%ss"</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">/</span> seconds <span class="org-highlight-numbers-number">60</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-variable-name">%</span> seconds <span class="org-highlight-numbers-number">60</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"%sh%sm%ss"</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">/</span> seconds <span class="org-highlight-numbers-number">3600</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">/</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-variable-name">%</span> seconds <span class="org-highlight-numbers-number">3600</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-highlight-numbers-number">60</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-variable-name">%</span> seconds <span class="org-highlight-numbers-number">60</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-music-time-to-seconds</span> <span class="org-rainbow-delimiters-depth-3">(</span>time-str<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Get the number of seconds in a string produced by `</span><span class="org-doc"><span class="org-constant">org-music-seconds-to-time</span></span><span class="org-doc">'."</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>time-components <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">reverse</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">s-split</span> <span class="org-string">"[a-z]"</span> time-str<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>seconds <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">string-to-number</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">1</span> time-components<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>minutes <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">&gt;</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">length</span> time-components<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-highlight-numbers-number">2</span><span class="org-rainbow-delimiters-depth-1">)</span>
                      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">string-to-number</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">2</span> time-components<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>hours <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">&gt;</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">length</span> time-components<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-highlight-numbers-number">3</span><span class="org-rainbow-delimiters-depth-1">)</span>
                    <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">string-to-number</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">3</span> time-components<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">+</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">*</span> <span class="org-highlight-numbers-number">3600</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> hours <span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">*</span> <span class="org-highlight-numbers-number">60</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> minutes <span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span> seconds<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-music-play-track</span> <span class="org-rainbow-delimiters-depth-3">(</span>artist title <span class="org-type">&amp;optional</span> start-time end-time<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Play the track specified by ARTIST and TITLE, optionally skipping to START-TIME in, stopping at END-TIME."</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if-let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>file <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-music-find-track-file</span> artist title<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">pcase</span> <span class="org-variable-name">org-music-player</span>
          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">mpris</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-music-mpris-play</span> file start-time end-time<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span>_ <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">user-error!</span> <span class="org-string">"The specified music player: %s is not supported"</span> <span class="org-variable-name">org-music-player</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">user-error!</span> <span class="org-string">"Could not find the track '%s' by '%s'"</span> title artist<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">add-transient-hook!</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-music-play-track</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">require</span> <span class="org-highlight-quoted-quote">'</span><span class="org-constant">dbus</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-music-mpris-play</span> <span class="org-rainbow-delimiters-depth-3">(</span>file <span class="org-type">&amp;optional</span> start-time end-time<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>uri <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">url-encode-url</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">rng-file-name-uri</span> file<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-music-mpris-call-method</span> <span class="org-string">"OpenUri"</span> uri<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>track-id <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">caadr</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">assoc</span> <span class="org-string">"mpris:trackid"</span>
                                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-music-mpris-get-property</span> <span class="org-string">"Metadata"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> start-time
          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-music-mpris-call-method</span> <span class="org-string">"SetPosition"</span> <span class="org-builtin">:object-path</span> track-id
                                       <span class="org-builtin">:int64</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">round</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">*</span> start-time <span class="org-highlight-numbers-number">1000000</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> end-time
          <span class="org-rainbow-delimiters-depth-3">(</span>org-music-mpris-stop-at-time uri end-time<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">orgb3-music-mpris-stop-at-time</span> <span class="org-rainbow-delimiters-depth-3">(</span>url end-time<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Check that url is playing, and if it is stop it at END-TIME."</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">equal</span> url <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">caadr</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">assoc</span> <span class="org-string">"xesam:url"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-music-mpris-get-property</span> <span class="org-string">"Metadata"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>time-current <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">/</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">/</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-music-mpris-get-property</span> <span class="org-string">"Position"</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-highlight-numbers-number">10000</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-highlight-numbers-number">100.0</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
             <span class="org-rainbow-delimiters-depth-3">(</span>time-delta <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">-</span> end-time time-current<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">message</span> <span class="org-string">"%s"</span> time-delta<span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">&lt;</span> time-delta <span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-3">)</span>
            <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-music-mpris-call-method</span> <span class="org-string">"Pause"</span><span class="org-rainbow-delimiters-depth-3">)</span>
          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">&lt;</span> time-delta <span class="org-highlight-numbers-number">6</span><span class="org-rainbow-delimiters-depth-1">)</span>
              <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">run-at-time</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">max</span> <span class="org-highlight-numbers-number">0.001</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">*</span> <span class="org-highlight-numbers-number">0.9</span> time-delta<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span> nil <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-music-mpris-stop-at-time</span> url end-time<span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">run-at-time</span> <span class="org-highlight-numbers-number">5</span> nil <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-music-mpris-stop-at-time</span> url end-time<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-music-mpris-get-property</span> <span class="org-rainbow-delimiters-depth-3">(</span>property<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Return the value of org.mpris.MediaPlayer2.Player.PROPERTY."</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>dbus-get-property <span class="org-builtin">:session</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span> <span class="org-string">"org.gnome."</span> <span class="org-variable-name">org-music-mpris-player</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-string">"/org/mpris/MediaPlayer2"</span> <span class="org-string">"org.mpris.MediaPlayer2.Player"</span>
                       property<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-music-mpris-call-method</span> <span class="org-rainbow-delimiters-depth-3">(</span>property <span class="org-type">&amp;rest</span> args<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Call org.mpris.MediaPlayer2.Player.PROPERTY with ARGS, returning the result."</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">apply</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">dbus-call-method</span> <span class="org-builtin">:session</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span> <span class="org-string">"org.gnome."</span> <span class="org-variable-name">org-music-mpris-player</span><span class="org-rainbow-delimiters-depth-1">)</span>
           <span class="org-string">"/org/mpris/MediaPlayer2"</span> <span class="org-string">"org.mpris.MediaPlayer2.Player"</span>
           property args<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-music-guess-mpris-player</span> <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when-let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>players
                <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">-filter</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-2">(</span>interface<span class="org-rainbow-delimiters-depth-2">)</span>
                           <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">s-contains-p</span> <span class="org-string">"org.mpris.MediaPlayer2"</span> interface<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                         <span class="org-rainbow-delimiters-depth-1">(</span>dbus-call-method <span class="org-builtin">:session</span>
                                           dbus-service-dbus
                                           dbus-path-dbus
                                           dbus-interface-dbus
                                           <span class="org-string">"ListNames"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">replace-regexp-in-string</span> <span class="org-string">"org\\.mpris\\.MediaPlayer2\\."</span> <span class="org-string">""</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">car</span> players<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">eq</span> <span class="org-variable-name">org-music-player</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">mpris</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">unless</span> <span class="org-variable-name">org-music-mpris-player</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-music-mpris-player</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-music-guess-mpris-player</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-music-find-track-file</span> <span class="org-rainbow-delimiters-depth-3">(</span>artist title<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Try to find the file for TRACK by ARTIST, using `</span><span class="org-doc"><span class="org-constant">org-music-track-search-method</span></span><span class="org-doc">', returning nil if nothing could be found."</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">pcase</span> <span class="org-variable-name">org-music-track-search-method</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">file</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-music-find-file</span> artist title<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">beets</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-music-beets-find-file</span> artist title<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span>_ <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">user-error!</span> <span class="org-string">"The specified music search method: %s is not supported"</span> <span class="org-variable-name">org-music-track-search-method</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-music-beets-find-file</span> <span class="org-rainbow-delimiters-depth-3">(</span>artist title<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Find the file correspanding to a given artist and title."</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>artist-escaped <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">replace-regexp-in-string</span> <span class="org-string">"\""</span> <span class="org-string">"\\\""</span> artist<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>title-escaped <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">replace-regexp-in-string</span> <span class="org-string">"\""</span> <span class="org-string">"\\\""</span> title<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>file
            <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span>
             <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">shell-command-to-string</span>
              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span>
               <span class="org-string">"sqlite3 '%s' \"SELECT path FROM items WHERE albumartist IS '%s' AND title IS '%s' LIMIT 1 COLLATE NOCASE\""</span>
               <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">expand-file-name</span> <span class="org-variable-name">org-music-beets-db</span><span class="org-rainbow-delimiters-depth-3">)</span> artist-escaped title-escaped<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
             <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">shell-command-to-string</span>
              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span>
               <span class="org-string">"sqlite3 '%s' \"SELECT path FROM items WHERE artist IS '%s' AND title IS '%s' LIMIT 1 COLLATE NOCASE\""</span>
               <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">expand-file-name</span> <span class="org-variable-name">org-music-beets-db</span><span class="org-rainbow-delimiters-depth-3">)</span> artist-escaped title-escaped<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">&gt;</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">length</span> file<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">substring</span> file <span class="org-highlight-numbers-number">0</span> <span class="org-highlight-numbers-number">-1</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-music-find-file</span> <span class="org-rainbow-delimiters-depth-3">(</span>artist title<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Try to find a file in `</span><span class="org-doc"><span class="org-constant">org-music-folder</span></span><span class="org-doc">' which contains TITLE, looking first in ./ARTIST if possible."</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when-let*</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>music-folder <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">expand-file-name</span> <span class="org-variable-name">org-music-folder</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                <span class="org-rainbow-delimiters-depth-2">(</span>search-folders <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span>
                                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">-filter</span> <span class="org-comment-delimiter">; </span><span class="org-comment">look for folders which contain ARTIST</span>
                                  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-3">(</span>file-or-folder<span class="org-rainbow-delimiters-depth-3">)</span>
                                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">and</span>
                                     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">s-contains-p</span> artist <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">file-name-base</span> file-or-folder<span class="org-rainbow-delimiters-depth-2">)</span> t<span class="org-rainbow-delimiters-depth-1">)</span>
                                     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">file-directory-p</span> file-or-folder<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                                  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">directory-files</span> music-folder t<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">list</span> music-folder<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                <span class="org-rainbow-delimiters-depth-2">(</span>extension-regex <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-string">"\\.</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">%s</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\'"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">s-join</span> <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">"</span> <span class="org-variable-name">org-music-recognised-extensions</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                <span class="org-rainbow-delimiters-depth-2">(</span>tracks <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">-filter</span>
                         <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-2">(</span>file<span class="org-rainbow-delimiters-depth-2">)</span>
                           <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">s-contains-p</span> title <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">file-name-base</span> file<span class="org-rainbow-delimiters-depth-3">)</span> t<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                         <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">-flatten</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">mapcar</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-1">(</span>dir<span class="org-rainbow-delimiters-depth-1">)</span>
                                             <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">directory-files-recursively</span> dir extension-regex<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                                           search-folders<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">&gt;</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">length</span> tracks<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">message</span> <span class="org-string">"Warning: multiple matches for %s by %s found"</span> title artist<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">car</span> tracks<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Then we integrate this nicely with org-mode
</p>
<details id='music,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#music,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> org
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-link-set-parameters</span> <span class="org-string">"music"</span>
                           <span class="org-builtin">:follow</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-music-open-fn</span>
                           <span class="org-builtin">:export</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-music-export-text</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-link-set-parameters</span> <span class="org-string">"Music"</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">like music, but visually fancier</span>
                           <span class="org-comment-delimiter">;; </span><span class="org-bold"><span class="org-error">FIXME</span></span><span class="org-comment"> this should work as far as I can tell</span>
                           <span class="org-comment-delimiter">;; </span><span class="org-comment">:image-data-fun #'org-music-image-fn</span>
                           <span class="org-builtin">:follow</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-music-open-fn</span>
                           <span class="org-builtin">:export</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-music-fancy-export</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-music-open-fn</span> <span class="org-rainbow-delimiters-depth-3">(</span>link<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">apply</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-music-play-track</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-music-parse-link</span> link<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-music-insert-current-track</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">&amp;optional</span> include-time<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Insert link to currest track, including a timestamp when the universal argument is supplied."</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">interactive</span> <span class="org-string">"P"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">pp</span> include-time<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">insert</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-music-get-link</span> t include-time<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-music-export-text</span> <span class="org-rainbow-delimiters-depth-3">(</span>path desc backend _com <span class="org-type">&amp;optional</span> newline<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>track-info <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-music-parse-link</span> path<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>artist <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">0</span> track-info<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>track <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">1</span> track-info<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>start-time <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">2</span> track-info<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>end-time <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">3</span> track-info<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>emphasise <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">cond</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-export-derived-backend-p</span> backend <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">html</span><span class="org-rainbow-delimiters-depth-2">)</span>
                             <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-3">(</span>s<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-string">"&lt;span style=\"font-style: italic\"&gt;%s&lt;/span&gt;"</span> s<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-export-derived-backend-p</span> backend <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">latex</span><span class="org-rainbow-delimiters-depth-2">)</span>
                             <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-3">(</span>s<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-string">"\\emph{%s}"</span> s<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                            <span class="org-rainbow-delimiters-depth-1">(</span>t <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-3">(</span>s<span class="org-rainbow-delimiters-depth-3">)</span> s<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> desc
          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">concat</span>
           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">cond</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">and</span> start-time end-time<span class="org-rainbow-delimiters-depth-2">)</span>
                  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"%s to %s seconds of%s"</span> start-time end-time <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> newline <span class="org-string">" "</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span>start-time
                  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"%s seconds into%s"</span> start-time <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> newline <span class="org-string">" "</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">funcall</span> emphasise track<span class="org-rainbow-delimiters-depth-3">)</span>
           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> newline <span class="org-string">" "</span><span class="org-rainbow-delimiters-depth-3">)</span>
           <span class="org-string">"by "</span>
           artist<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-music-cover-image</span> <span class="org-rainbow-delimiters-depth-3">(</span>track-file<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Try to find a cover image for the track in the given location"</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">car</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">-filter</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-3">(</span>file<span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">-contains-p</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"png"</span> <span class="org-string">"jpg"</span> <span class="org-string">"jpeg"</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">file-name-extension</span> file<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">directory-files</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">file-name-directory</span> track-file<span class="org-rainbow-delimiters-depth-3">)</span> t <span class="org-string">"cover"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-music-image-fn</span> <span class="org-rainbow-delimiters-depth-3">(</span>_protocol link _description<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when-let*</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>track-data <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-music-parse-link</span> link<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                <span class="org-rainbow-delimiters-depth-2">(</span>cover-file <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-music-cover-image</span>
                             <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-music-find-track-file</span>
                              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">0</span> track-data<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">1</span> track-data<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">with-temp-buffer</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">set-buffer-multibyte</span> nil<span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">buffer-file-coding-system</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">binary</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">insert-file-contents-literally</span> cover-file<span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">buffer-substring-no-properties</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">point-min</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">point-max</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-music-fancy-export</span> <span class="org-rainbow-delimiters-depth-3">(</span>path desc backend _com<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>track-data <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-music-parse-link</span> path<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>file <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-music-find-track-file</span>
                  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">0</span> track-data<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">1</span> track-data<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>cover-img <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-music-cover-image</span> file<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>newline-str <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">cond</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-export-derived-backend-p</span> backend <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">html</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-string">"&lt;br&gt;"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                              <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-export-derived-backend-p</span> backend <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">latex</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-string">"\\newline "</span><span class="org-rainbow-delimiters-depth-1">)</span>
                              <span class="org-rainbow-delimiters-depth-1">(</span>t <span class="org-string">" "</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>text <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-music-export-text</span> path nil backend nil newline-str<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">cond</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-export-derived-backend-p</span> backend <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">html</span><span class="org-rainbow-delimiters-depth-3">)</span>
             <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-string">"&lt;div class='music-track'&gt;</span>
<span class="org-string">    &lt;img src='%s'&gt; &lt;span&gt;%s&lt;/span&gt;</span>
<span class="org-string">&lt;/div&gt;"</span> cover-img text<span class="org-rainbow-delimiters-depth-3">)</span>
             <span class="org-rainbow-delimiters-depth-2">)</span>
            <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-export-derived-backend-p</span> backend <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">latex</span><span class="org-rainbow-delimiters-depth-3">)</span>
             <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-string">"\\begin{tabular}{@{\\hspace{0.3\\columnwidth}}r@{\\hspace{0.1\\columnwidth}}p{0.4\\columnwidth}}</span>
<span class="org-string">  \\includegraphics[height=6em]{%s} &amp; \\vspace{-0.12\\columnwidth}%s</span>
<span class="org-string">\\end{tabular}"</span> cover-img text<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
            <span class="org-rainbow-delimiters-depth-2">(</span>t text<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-youtube" class="outline-6">
<h6 id="youtube"><span class="section-number-6">6.3.2.10.3</span> YouTube<a aria-hidden="true" href="#youtube">#</a> </h6>
<div class="outline-text-6" id="text-6-3-2-10-3">
<p>
The <code>[[yt:...]]</code> links preview nicely, but don&rsquo;t export nicely. Thankfully, we can
fix that.
</p>
<details id='youtube,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#youtube,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-link-set-parameters</span> <span class="org-string">"yt"</span> <span class="org-builtin">:export</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">+org-export-yt</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+org-export-yt</span> <span class="org-rainbow-delimiters-depth-2">(</span>path desc backend _com<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">cond</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-export-derived-backend-p</span> backend <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">html</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"&lt;iframe width='440' \</span>
<span class="org-string">height='335' \</span>
<span class="org-string">src='https://www.youtube.com/embed/%s' \</span>
<span class="org-string">frameborder='0' \</span>
<span class="org-string">allowfullscreen&gt;%s&lt;/iframe&gt;"</span> path <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">or</span> <span class="org-string">""</span> desc<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-export-derived-backend-p</span> backend <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">latex</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"\\href{https://youtu.be/%s}{%s}"</span> path <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">or</span> desc <span class="org-string">"youtube"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>t <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"https://youtu.be/%s"</span> path<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
</div>

<div id="outline-container-org-mode-visuals" class="outline-4">
<h4 id="org-mode-visuals"><span class="section-number-4">6.3.3</span> Visuals<a aria-hidden="true" href="#org-mode-visuals">#</a> </h4>
<div class="outline-text-4" id="text-6-3-3">
<p>
Here I try to do two things: improve the styling of the various documents, via
font changes etc, and also propagate colours from the current theme.
</p>

<p>
<img class='invertible' src='https://imgs.xkcd.com/comics/color_models.png' title="What if what *I* see as blue, *you* see as a slightly different blue because you're using Chrome instead of Firefox and despite a decade of messing with profiles we STILL can't get this right somehow." alt='Color Models'>
</p>
</div>

<div id="outline-container-editor" class="outline-5">
<h5 id="editor"><span class="section-number-5">6.3.3.1</span> In editor<a aria-hidden="true" href="#editor">#</a> </h5>
<div class="outline-text-5" id="text-6-3-3-1">
</div>
<div id="outline-container-font-display" class="outline-6">
<h6 id="font-display"><span class="section-number-6">6.3.3.1.1</span> Font Display<a aria-hidden="true" href="#font-display">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-1-1">
<p>
Mixed pitch is great. As is <code>+org-pretty-mode</code>, let&rsquo;s use them.
</p>
<details id='font-display,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#font-display,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">add-hook!</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">org-mode-hook</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">+org-pretty-mode</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">mixed-pitch-mode</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
Earlier I loaded the <code>org-pretty-table</code> package, let&rsquo;s enable it everywhere!
</p>
<details id='font-display,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#font-display,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">global-org-pretty-table-mode</span> t<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Let&rsquo;s make headings a bit bigger
</p>
<details id='font-display,code--3' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#font-display,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">custom-set-faces!</span>
  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>outline-1 <span class="org-builtin">:weight</span> extra-bold <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.25</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>outline-2 <span class="org-builtin">:weight</span> bold <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.15</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>outline-3 <span class="org-builtin">:weight</span> bold <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.12</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>outline-4 <span class="org-builtin">:weight</span> semi-bold <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.09</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>outline-5 <span class="org-builtin">:weight</span> semi-bold <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.06</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>outline-6 <span class="org-builtin">:weight</span> semi-bold <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.03</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>outline-8 <span class="org-builtin">:weight</span> semi-bold<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>outline-9 <span class="org-builtin">:weight</span> semi-bold<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
And the same with the title.
</p>
<details id='font-display,code--4' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#font-display,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">custom-set-faces!</span>
  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>org-document-title <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.2</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
It seems reasonable to have deadlines in the error face when they&rsquo;re passed.
</p>
<details id='font-display,code--5' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#font-display,code--5'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-agenda-deadline-faces</span>
      <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">1.001</span> . error<span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">1.0</span> . org-warning<span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">0.5</span> . org-upcoming-deadline<span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">0.0</span> . org-upcoming-distant-deadline<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
We can then have quote blocks stand out a bit more by making them <i>italic</i>.
</p>
<details id='font-display,code--6' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#font-display,code--6'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-fontify-quote-and-verse-blocks</span> t<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
While <code>org-hide-emphasis-markers</code> is very nice, it can sometimes make edits which
occur at the border a bit more fiddley. We can improve this situation without
sacrificing visual amenities with the <kbd>org-appear</kbd> package.
</p>
<details id='font-display,code--7' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#font-display,code--7'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">use-package!</span> org-appear
  <span class="org-builtin">:hook</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-mode</span> . org-appear-mode<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-builtin">:config</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> org-appear-autoemphasis t
        org-appear-autosubmarkers t
        org-appear-autolinks nil<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">for proper first-time setup, `</span><span class="org-comment"><span class="org-constant">org-appear--set-fragments</span></span><span class="org-comment">'</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">needs to be run after other hooks have acted.</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">run-at-time</span> nil nil <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-appear--set-fragments</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-symbols" class="outline-6">
<h6 id="symbols"><span class="section-number-6">6.3.3.1.2</span> Symbols<a aria-hidden="true" href="#symbols">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-1-2">
<p>
It&rsquo;s also nice to change the character used for collapsed items (by default <code>…</code>),
I think <code>▾</code> is better for indicating &rsquo;collapsed section&rsquo;.
and add an extra <code>org-bullet</code> to the default list of four.
I&rsquo;ve also added some fun alternatives, just commented out.
</p>
<details id='symbols,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#symbols,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">(use-package org-pretty-tags</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">:config</span>
<span class="org-comment-delimiter">;;  </span><span class="org-comment">(setq org-pretty-tags-surrogate-strings</span>
<span class="org-comment-delimiter">;;        </span><span class="org-comment">`(("uni"        . ,(all-the-icons-faicon   "graduation-cap" :face 'all-the-icons-purple  :v-adjust 0.01))</span>
<span class="org-comment-delimiter">;;          </span><span class="org-comment">("ucc"        . ,(all-the-icons-material "computer"       :face 'all-the-icons-silver  :v-adjust 0.01))</span>
<span class="org-comment-delimiter">;;          </span><span class="org-comment">("assignment" . ,(all-the-icons-material "library_books"  :face 'all-the-icons-orange  :v-adjust 0.01))</span>
<span class="org-comment-delimiter">;;          </span><span class="org-comment">("test"       . ,(all-the-icons-material "timer"          :face 'all-the-icons-red     :v-adjust 0.01))</span>
<span class="org-comment-delimiter">;;          </span><span class="org-comment">("lecture"    . ,(all-the-icons-fileicon "keynote"        :face 'all-the-icons-orange  :v-adjust 0.01))</span>
<span class="org-comment-delimiter">;;          </span><span class="org-comment">("email"      . ,(all-the-icons-faicon   "envelope"       :face 'all-the-icons-blue    :v-adjust 0.01))</span>
<span class="org-comment-delimiter">;;          </span><span class="org-comment">("read"       . ,(all-the-icons-octicon  "book"           :face 'all-the-icons-lblue   :v-adjust 0.01))</span>
<span class="org-comment-delimiter">;;          </span><span class="org-comment">("article"    . ,(all-the-icons-octicon  "file-text"      :face 'all-the-icons-yellow  :v-adjust 0.01))</span>
<span class="org-comment-delimiter">;;          </span><span class="org-comment">("web"        . ,(all-the-icons-faicon   "globe"          :face 'all-the-icons-green   :v-adjust 0.01))</span>
<span class="org-comment-delimiter">;;          </span><span class="org-comment">("info"       . ,(all-the-icons-faicon   "info-circle"    :face 'all-the-icons-blue    :v-adjust 0.01))</span>
<span class="org-comment-delimiter">;;          </span><span class="org-comment">("issue"      . ,(all-the-icons-faicon   "bug"            :face 'all-the-icons-red     :v-adjust 0.01))</span>
<span class="org-comment-delimiter">;;          </span><span class="org-comment">("someday"    . ,(all-the-icons-faicon   "calendar-o"     :face 'all-the-icons-cyan    :v-adjust 0.01))</span>
<span class="org-comment-delimiter">;;          </span><span class="org-comment">("idea"       . ,(all-the-icons-octicon  "light-bulb"     :face 'all-the-icons-yellow  :v-adjust 0.01))</span>
<span class="org-comment-delimiter">;;          </span><span class="org-comment">("emacs"      . ,(all-the-icons-fileicon "emacs"          :face 'all-the-icons-lpurple :v-adjust 0.01))))</span>
<span class="org-comment-delimiter">;;  </span><span class="org-comment">(org-pretty-tags-global-mode))</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> org-superstar
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> org-superstar-headline-bullets-list <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#9673;"</span> <span class="org-string">"&#9675;"</span> <span class="org-string">"&#10040;"</span> <span class="org-string">"&#10047;"</span> <span class="org-string">"&#10020;"</span> <span class="org-string">"&#10012;"</span> <span class="org-string">"&#9670;"</span> <span class="org-string">"&#9654;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">org-superstar-headline-bullets-list '("&#8544;" "&#8545;" "&#8546;" "&#8547;" "&#8548;" "&#8549;" "&#8550;" "&#8551;" "&#8552;" "&#8553;")</span>
        org-superstar-prettify-item-bullets t <span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-ellipsis</span> <span class="org-string">" &#9662; "</span>
      <span class="org-variable-name">org-hide-leading-stars</span> t
      <span class="org-variable-name">org-priority-highest</span> ?A
      <span class="org-variable-name">org-priority-lowest</span> ?E
      <span class="org-variable-name">org-priority-faces</span>
      <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>?A . <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">all-the-icons-red</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>?B . <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">all-the-icons-orange</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>?C . <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">all-the-icons-yellow</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>?D . <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">all-the-icons-green</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>?E . <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">all-the-icons-blue</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
It&rsquo;s also nice to make use of the Unicode characters for check boxes, and other commands.
</p>
<details id='symbols,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#symbols,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">appendq!</span> <span class="org-variable-name">+ligatures-extra-symbols</span>
          <span class="org-highlight-quoted-quote">`</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-builtin">:checkbox</span>      <span class="org-string">"&#9744;"</span>
            <span class="org-builtin">:pending</span>       <span class="org-string">"&#9724;"</span>
            <span class="org-builtin">:checkedbox</span>    <span class="org-string">"&#9745;"</span>
            <span class="org-builtin">:list_property</span> <span class="org-string">"&#8759;"</span>
            <span class="org-builtin">:em_dash</span>       <span class="org-string">"&#8212;"</span>
            <span class="org-builtin">:ellipses</span>      <span class="org-string">"&#8230;"</span>
            <span class="org-builtin">:title</span>         <span class="org-string">"&#120399;"</span>
            <span class="org-builtin">:subtitle</span>      <span class="org-string">"&#120425;"</span>
            <span class="org-builtin">:author</span>        <span class="org-string">"&#120380;"</span>
            <span class="org-builtin">:date</span>          <span class="org-string">"&#120383;"</span>
            <span class="org-builtin">:property</span>      <span class="org-string">"&#9784;"</span>
            <span class="org-builtin">:options</span>       <span class="org-string">"&#8997;"</span>
            <span class="org-builtin">:latex_class</span>   <span class="org-string">"&#127282;"</span>
            <span class="org-builtin">:latex_header</span>  <span class="org-string">"&#8677;"</span>
            <span class="org-builtin">:beamer_header</span> <span class="org-string">"&#8608;"</span>
            <span class="org-builtin">:attr_latex</span>    <span class="org-string">"&#127259;"</span>
            <span class="org-builtin">:attr_html</span>     <span class="org-string">"&#127255;"</span>
            <span class="org-builtin">:begin_quote</span>   <span class="org-string">"&#10094;"</span>
            <span class="org-builtin">:end_quote</span>     <span class="org-string">"&#10095;"</span>
            <span class="org-builtin">:caption</span>       <span class="org-string">"&#9776;"</span>
            <span class="org-builtin">:header</span>        <span class="org-string">"&#8250;"</span>
            <span class="org-builtin">:results</span>       <span class="org-string">"&#129078;"</span>
            <span class="org-builtin">:begin_export</span>  <span class="org-string">"&#11246;"</span>
            <span class="org-builtin">:end_export</span>    <span class="org-string">"&#11244;"</span>
            <span class="org-builtin">:properties</span>    <span class="org-string">"&#9881;"</span>
            <span class="org-builtin">:end</span>           <span class="org-string">"&#8718;"</span>
            <span class="org-builtin">:priority_a</span>   ,<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">propertize</span> <span class="org-string">"&#9873;"</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">all-the-icons-red</span><span class="org-rainbow-delimiters-depth-3">)</span>
            <span class="org-builtin">:priority_b</span>   ,<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">propertize</span> <span class="org-string">"&#11014;"</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">all-the-icons-orange</span><span class="org-rainbow-delimiters-depth-3">)</span>
            <span class="org-builtin">:priority_c</span>   ,<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">propertize</span> <span class="org-string">"&#9632;"</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">all-the-icons-yellow</span><span class="org-rainbow-delimiters-depth-3">)</span>
            <span class="org-builtin">:priority_d</span>   ,<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">propertize</span> <span class="org-string">"&#11015;"</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">all-the-icons-green</span><span class="org-rainbow-delimiters-depth-3">)</span>
            <span class="org-builtin">:priority_e</span>   ,<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">propertize</span> <span class="org-string">"&#10067;"</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">face</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">all-the-icons-blue</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">set-ligatures!</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">org-mode</span>
  <span class="org-builtin">:merge</span> t
  <span class="org-builtin">:checkbox</span>      <span class="org-string">"[ ]"</span>
  <span class="org-builtin">:pending</span>       <span class="org-string">"[-]"</span>
  <span class="org-builtin">:checkedbox</span>    <span class="org-string">"[X]"</span>
  <span class="org-builtin">:list_property</span> <span class="org-string">"::"</span>
  <span class="org-builtin">:em_dash</span>       <span class="org-string">"---"</span>
  <span class="org-builtin">:ellipsis</span>      <span class="org-string">"..."</span>
  <span class="org-builtin">:title</span>         <span class="org-string">"#+title:"</span>
  <span class="org-builtin">:subtitle</span>      <span class="org-string">"#+subtitle:"</span>
  <span class="org-builtin">:author</span>        <span class="org-string">"#+author:"</span>
  <span class="org-builtin">:date</span>          <span class="org-string">"#+date:"</span>
  <span class="org-builtin">:property</span>      <span class="org-string">"#+property:"</span>
  <span class="org-builtin">:options</span>       <span class="org-string">"#+options:"</span>
  <span class="org-builtin">:latex_class</span>   <span class="org-string">"#+latex_class:"</span>
  <span class="org-builtin">:latex_header</span>  <span class="org-string">"#+latex_header:"</span>
  <span class="org-builtin">:beamer_header</span> <span class="org-string">"#+beamer_header:"</span>
  <span class="org-builtin">:attr_latex</span>    <span class="org-string">"#+attr_latex:"</span>
  <span class="org-builtin">:attr_html</span>     <span class="org-string">"#+attr_latex:"</span>
  <span class="org-builtin">:begin_quote</span>   <span class="org-string">"#+begin_quote"</span>
  <span class="org-builtin">:end_quote</span>     <span class="org-string">"#+end_quote"</span>
  <span class="org-builtin">:caption</span>       <span class="org-string">"#+caption:"</span>
  <span class="org-builtin">:header</span>        <span class="org-string">"#+header:"</span>
  <span class="org-builtin">:begin_export</span>  <span class="org-string">"#+begin_export"</span>
  <span class="org-builtin">:end_export</span>    <span class="org-string">"#+end_export"</span>
  <span class="org-builtin">:results</span>       <span class="org-string">"#+RESULTS:"</span>
  <span class="org-builtin">:property</span>      <span class="org-string">":PROPERTIES:"</span>
  <span class="org-builtin">:end</span>           <span class="org-string">":END:"</span>
  <span class="org-builtin">:priority_a</span>    <span class="org-string">"[#A]"</span>
  <span class="org-builtin">:priority_b</span>    <span class="org-string">"[#B]"</span>
  <span class="org-builtin">:priority_c</span>    <span class="org-string">"[#C]"</span>
  <span class="org-builtin">:priority_d</span>    <span class="org-string">"[#D]"</span>
  <span class="org-builtin">:priority_e</span>    <span class="org-string">"[#E]"</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-put</span> <span class="org-variable-name">+ligatures-extra-symbols</span> <span class="org-builtin">:name</span> <span class="org-string">"&#8269;"</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-latex-fragments" class="outline-6">
<h6 id="latex-fragments"><span class="section-number-6">6.3.3.1.3</span> LaTeX Fragments<a aria-hidden="true" href="#latex-fragments">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-1-3">
<p>
First off, we want those fragments to look good.
</p>
<details id='latex-fragments,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#latex-fragments,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-highlight-latex-and-related</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>native script entities<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
What&rsquo;s better than syntax-highlighted LaTeX is <i>rendered</i> LaTeX though, and we can
have this be performed automatically with <kbd>org-fragtog</kbd>.
</p>
<details id='latex-fragments,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#latex-fragments,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">use-package!</span> org-fragtog
  <span class="org-builtin">:hook</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-mode</span> . org-fragtog-mode<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
It&rsquo;s nice to customise the look of LaTeX fragments so they fit better in the
text &#x2014; like this \(\sqrt{\beta^2+3}-\sum_{\phi=1}^\infty \frac{x^\phi-1}{\Gamma(a)}\). Let&rsquo;s start by adding a sans font.
</p>
<details id='latex-fragments,code--3' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#latex-fragments,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-format-latex-header</span> <span class="org-string">"\\documentclass{article}</span>
<span class="org-string">\\usepackage[usenames]{color}</span>

<span class="org-string">\\usepackage[T1]{fontenc}</span>

<span class="org-string">\\usepackage{booktabs}</span>

<span class="org-string">\\pagestyle{empty}             % do not remove</span>
<span class="org-string">% The settings below are copied from fullpage.sty</span>
<span class="org-string">\\setlength{\\textwidth}{\\paperwidth}</span>
<span class="org-string">\\addtolength{\\textwidth}{-3cm}</span>
<span class="org-string">\\setlength{\\oddsidemargin}{1.5cm}</span>
<span class="org-string">\\addtolength{\\oddsidemargin}{-2.54cm}</span>
<span class="org-string">\\setlength{\\evensidemargin}{\\oddsidemargin}</span>
<span class="org-string">\\setlength{\\textheight}{\\paperheight}</span>
<span class="org-string">\\addtolength{\\textheight}{-\\headheight}</span>
<span class="org-string">\\addtolength{\\textheight}{-\\headsep}</span>
<span class="org-string">\\addtolength{\\textheight}{-\\footskip}</span>
<span class="org-string">\\addtolength{\\textheight}{-3cm}</span>
<span class="org-string">\\setlength{\\topmargin}{1.5cm}</span>
<span class="org-string">\\addtolength{\\topmargin}{-2.54cm}</span>
<span class="org-string">% my custom stuff</span>
<span class="org-string">\\usepackage[nofont,plaindd]{bmc-maths}</span>
<span class="org-string">\\usepackage{arev}</span>
<span class="org-string">"</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
We can either render from a <code>dvi</code> or <code>pdf</code> file, so let&rsquo;s benchmark <code>latex</code> and
<code>pdflatex</code>.
</p>
<div id='latex-fragments,table--1' class='table'>
    <div class='gutter'><a href='#latex-fragments,table--1'>#</a></div>
    <div class='tabular'>
    <table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left"><code>latex</code> time</th>
<th scope="col" class="org-left"><code>pdflatex</code> time</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">135 &plusmn; 2 ms</td>
<td class="org-left">215 &plusmn; 3 ms</td>
</tr>
</tbody>
</table>
    </div>    </div>

<p>
On the rendering side, there are two <code>.dvi</code>-to-image converters which I am
interested in: <code>dvipng</code> and <code>dvisvgm</code>. Then with the a <code>.pdf</code> we have <code>pdf2svg</code>.
For inline preview we care about speed, while for exporting we care about file
size and prefer a vector graphic.
</p>

<p>
Using the above latex expression and benchmarking lead to the following results:
</p>
<div id='latex-fragments,table--2' class='table'>
    <div class='gutter'><a href='#latex-fragments,table--2'>#</a></div>
    <div class='tabular'>
    <table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left"><code>dvipng</code> time</th>
<th scope="col" class="org-left"><code>dvisvgm</code> time</th>
<th scope="col" class="org-left"><code>pdf2svg</code> time</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">89 &plusmn; 2 ms</td>
<td class="org-left">178 &plusmn; 2 ms</td>
<td class="org-left">12 &plusmn; 2 ms</td>
</tr>
</tbody>
</table>
    </div>    </div>

<p>
Now let&rsquo;s combine this to see what&rsquo;s best
</p>
<div id='latex-fragments,table--3' class='table'>
    <div class='gutter'><a href='#latex-fragments,table--3'>#</a></div>
    <div class='tabular'>
    <table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Tool chain</th>
<th scope="col" class="org-left">Total time</th>
<th scope="col" class="org-left">Resultant file size</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>latex</code> + <code>dvipng</code></td>
<td class="org-left">226 &plusmn; 2 ms</td>
<td class="org-left">7 KiB</td>
</tr>

<tr>
<td class="org-left"><code>latex</code> + <code>dvisvgm</code></td>
<td class="org-left">392 &plusmn; 4 ms</td>
<td class="org-left">8 KiB</td>
</tr>

<tr>
<td class="org-left"><code>pdflatex</code> + <code>pdf2svg</code></td>
<td class="org-left">230 &plusmn; 2 ms</td>
<td class="org-left">16 KiB</td>
</tr>
</tbody>
</table>
    </div>    </div>

<p>
So, let&rsquo;s use <code>dvipng</code> for previewing LaTeX fragments in-Emacs, but <code>dvisvgm</code> for <a href="#exporting-html">LaTeX Rendering</a>.
<i>Unfortunately: it seems that svg sizing is annoying <span class='acr'>ATM</span>, so let&rsquo;s actually not do this right now.</i>
</p>

<p>
As well as having a sans font, there are a few other tweaks which can make them
look better. Namely making sure that the colours switch when the theme does.
</p>
<details id='latex-fragments,code--4' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#latex-fragments,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">make background of fragments transparent</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(let ((dvipng--plist (alist-get 'dvipng org-preview-latex-process-alist)))</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">(plist-put dvipng--plist :use-xcolor t)</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">(plist-put dvipng--plist :image-converter '("dvipng -D %D -bg 'transparent' -T tight -o %O %f")))</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">add-hook!</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">doom-load-theme-hook</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+org-refresh-latex-background</span> <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">plist-put!</span> <span class="org-variable-name">org-format-latex-options</span>
                <span class="org-builtin">:background</span>
                <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">face-attribute</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">cadr</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">assq</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">default</span> <span class="org-variable-name">face-remapping-alist</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                                    <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">default</span><span class="org-rainbow-delimiters-depth-2">)</span>
                                <span class="org-builtin">:background</span> nil t<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
It&rsquo;d be nice to make <code>mhchem</code> equations able to be rendered.
<span class='acr'>NB</span>: This doesn&rsquo;t work at the moment.
</p>
<details id='latex-fragments,code--5' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#latex-fragments,code--5'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">org-latex-regexps</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"\\ce"</span> <span class="org-string">"^\\\\ce{</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">\000{}]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">{[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">\000}]+?}</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">}"</span> <span class="org-highlight-numbers-number">0</span> nil<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-stolen-from-scimax" class="outline-6">
<h6 id="stolen-from-scimax"><span class="section-number-6">6.3.3.1.4</span> Stolen from <a href="https://github.com/jkitchin/scimax">scimax</a> (semi-working right now)<a aria-hidden="true" href="#stolen-from-scimax">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-1-4">
<p>
I want fragment justification
</p>
<details id='stolen-from-scimax,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#stolen-from-scimax,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">scimax-org-latex-fragment-justify</span> <span class="org-rainbow-delimiters-depth-2">(</span>justification<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Justify the latex fragment at point with JUSTIFICATION.</span>
<span class="org-doc">JUSTIFICATION is a symbol for 'left, 'center or 'right."</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">interactive</span>
   <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">list</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">intern-soft</span>
          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">completing-read</span> <span class="org-string">"Justification (left): "</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span>left center right<span class="org-rainbow-delimiters-depth-3">)</span>
                           nil t nil nil <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">left</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>ov <span class="org-rainbow-delimiters-depth-2">(</span>ov-at<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>beg <span class="org-rainbow-delimiters-depth-2">(</span>ov-beg ov<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>end <span class="org-rainbow-delimiters-depth-2">(</span>ov-end ov<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>shift <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">-</span> beg <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">line-beginning-position</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>img <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">overlay-get</span> ov <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">display</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>img <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">and</span> img <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">consp</span> img<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">eq</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">car</span> img<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">image</span><span class="org-rainbow-delimiters-depth-1">)</span>
                        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">image-type-available-p</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">cdr</span> img<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-builtin">:type</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                   img<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         space-left offset<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">and</span> img
               <span class="org-comment-delimiter">;; </span><span class="org-comment">This means the equation is at the start of the line</span>
               <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">=</span> beg <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">line-beginning-position</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
               <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">or</span>
                <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">string=</span> <span class="org-string">""</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">s-trim</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">buffer-substring</span> end <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">line-end-position</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">eq</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">latex-environment</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">car</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-element-context</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> space-left <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">-</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">window-max-chars-per-line</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">car</span> <span class="org-rainbow-delimiters-depth-1">(</span>image-size img<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
            offset <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">floor</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">cond</span>
                           <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">eq</span> justification <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">center</span><span class="org-rainbow-delimiters-depth-2">)</span>
                            <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">-</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">/</span> space-left <span class="org-highlight-numbers-number">2</span><span class="org-rainbow-delimiters-depth-3">)</span> shift<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                           <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">eq</span> justification <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">right</span><span class="org-rainbow-delimiters-depth-2">)</span>
                            <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">-</span> space-left shift<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                           <span class="org-rainbow-delimiters-depth-1">(</span>t
                            <span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">&gt;=</span> offset <span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">overlay-put</span> ov <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">before-string</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">make-string</span> offset ?\ <span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">scimax-org-latex-fragment-justify-advice</span> <span class="org-rainbow-delimiters-depth-2">(</span>beg end image imagetype<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"After advice function to justify fragments."</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">scimax-org-latex-fragment-justify</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> <span class="org-variable-name">org-format-latex-options</span> <span class="org-builtin">:justify</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">left</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>


<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">scimax-toggle-latex-fragment-justification</span> <span class="org-rainbow-delimiters-depth-2">()</span>
  <span class="org-doc">"Toggle if LaTeX fragment justification options can be used."</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">interactive</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">not</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">get</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">scimax-org-latex-fragment-justify-advice</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">enabled</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">progn</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">advice-add</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">org--format-latex-make-overlay</span> <span class="org-builtin">:after</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">scimax-org-latex-fragment-justify-advice</span><span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">put</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">scimax-org-latex-fragment-justify-advice</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">enabled</span> t<span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">message</span> <span class="org-string">"Latex fragment justification enabled"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">advice-remove</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">org--format-latex-make-overlay</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">scimax-org-latex-fragment-justify-advice</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">put</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">scimax-org-latex-fragment-justify-advice</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">enabled</span> nil<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">message</span> <span class="org-string">"Latex fragment justification disabled"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
There&rsquo;s also this lovely equation numbering stuff I&rsquo;ll nick
</p>
<details id='stolen-from-scimax,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#stolen-from-scimax,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">Numbered equations all have (1) as the number for fragments with vanilla</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">org-mode. This code injects the correct numbers into the previews so they</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">look good.</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">scimax-org-renumber-environment</span> <span class="org-rainbow-delimiters-depth-2">(</span>orig-func <span class="org-type">&amp;rest</span> args<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"A function to inject numbers in LaTeX fragment previews."</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>results <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-rainbow-delimiters-depth-1">(</span>counter <span class="org-highlight-numbers-number">-1</span><span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">numberp</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> results <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">cl-loop</span> for <span class="org-rainbow-delimiters-depth-2">(</span>begin . env<span class="org-rainbow-delimiters-depth-2">)</span> in
                           <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-element-map</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-element-parse-buffer</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">latex-environment</span>
                             <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-1">(</span>env<span class="org-rainbow-delimiters-depth-1">)</span>
                               <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">cons</span>
                                <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-element-property</span> <span class="org-builtin">:begin</span> env<span class="org-rainbow-delimiters-depth-2">)</span>
                                <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-element-property</span> <span class="org-builtin">:value</span> env<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                           collect
                           <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">cond</span>
                            <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">string-match</span> <span class="org-string">"\\\\begin{equation}"</span> env<span class="org-rainbow-delimiters-depth-2">)</span>
                                  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">not</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">string-match</span> <span class="org-string">"\\\\tag{"</span> env<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                             <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">incf</span> counter<span class="org-rainbow-delimiters-depth-1">)</span>
                             <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">cons</span> begin counter<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                            <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">string-match</span> <span class="org-string">"\\\\begin{align}"</span> env<span class="org-rainbow-delimiters-depth-1">)</span>
                             <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">prog2</span>
                                 <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">incf</span> counter<span class="org-rainbow-delimiters-depth-2">)</span>
                                 <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">cons</span> begin counter<span class="org-rainbow-delimiters-depth-2">)</span>
                               <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">with-temp-buffer</span>
                                 <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">insert</span> env<span class="org-rainbow-delimiters-depth-3">)</span>
                                 <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">goto-char</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">point-min</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                                 <span class="org-comment-delimiter">;; </span><span class="org-comment">\\ is used for a new line. Each one leads to a number</span>
                                 <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">incf</span> counter <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">count-matches</span> <span class="org-string">"\\\\$"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                                 <span class="org-comment-delimiter">;; </span><span class="org-comment">unless there are nonumbers.</span>
                                 <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">goto-char</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">point-min</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                                 <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">decf</span> counter <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">count-matches</span> <span class="org-string">"\\nonumber"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                            <span class="org-rainbow-delimiters-depth-3">(</span>t
                             <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">cons</span> begin nil<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>

    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> numberp <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">cdr</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">assoc</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">point</span><span class="org-rainbow-delimiters-depth-1">)</span> results<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setf</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">car</span> args<span class="org-rainbow-delimiters-depth-2">)</span>
            <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">concat</span>
             <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-string">"\\setcounter{equation}{%s}\n"</span> numberp<span class="org-rainbow-delimiters-depth-3">)</span>
             <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">car</span> args<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">apply</span> orig-func args<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>


<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">scimax-toggle-latex-equation-numbering</span> <span class="org-rainbow-delimiters-depth-2">()</span>
  <span class="org-doc">"Toggle whether LaTeX fragments are numbered."</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">interactive</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">not</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">get</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">scimax-org-renumber-environment</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">enabled</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">progn</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">advice-add</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">org-create-formula-image</span> <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">scimax-org-renumber-environment</span><span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">put</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">scimax-org-renumber-environment</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">enabled</span> t<span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">message</span> <span class="org-string">"Latex numbering enabled"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">advice-remove</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">org-create-formula-image</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">scimax-org-renumber-environment</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">put</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">scimax-org-renumber-environment</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">enabled</span> nil<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">message</span> <span class="org-string">"Latex numbering disabled."</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">advice-add</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">org-create-formula-image</span> <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">scimax-org-renumber-environment</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">put</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">scimax-org-renumber-environment</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">enabled</span> t<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-org-plot" class="outline-5">
<h5 id="org-plot"><span class="section-number-5">6.3.3.2</span> Org Plot<a aria-hidden="true" href="#org-plot">#</a> </h5>
<div class="outline-text-5" id="text-6-3-3-2">
<p>
We can use some of the variables in <kbd>org-plot</kbd> to use the current doom theme
colours.
</p>
<details id='org-plot,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#org-plot,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> org-plot
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-plot/generate-theme</span> <span class="org-rainbow-delimiters-depth-3">(</span>_type<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Use the current Doom theme colours to generate a GnuPlot preamble."</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-string">"</span>
<span class="org-string">fgt = \"textcolor rgb '%s'\" # foreground text</span>
<span class="org-string">fgat = \"textcolor rgb '%s'\" # foreground alt text</span>
<span class="org-string">fgl = \"linecolor rgb '%s'\" # foreground line</span>
<span class="org-string">fgal = \"linecolor rgb '%s'\" # foreground alt line</span>

<span class="org-string"># foreground colors</span>
<span class="org-string">set border lc rgb '%s'</span>
<span class="org-string"># change text colors of  tics</span>
<span class="org-string">set xtics @fgt</span>
<span class="org-string">set ytics @fgt</span>
<span class="org-string"># change text colors of labels</span>
<span class="org-string">set title @fgt</span>
<span class="org-string">set xlabel @fgt</span>
<span class="org-string">set ylabel @fgt</span>
<span class="org-string"># change a text color of key</span>
<span class="org-string">set key @fgt</span>

<span class="org-string"># line styles</span>
<span class="org-string">set linetype 1 lw 2 lc rgb '%s' # red</span>
<span class="org-string">set linetype 2 lw 2 lc rgb '%s' # blue</span>
<span class="org-string">set linetype 3 lw 2 lc rgb '%s' # green</span>
<span class="org-string">set linetype 4 lw 2 lc rgb '%s' # magenta</span>
<span class="org-string">set linetype 5 lw 2 lc rgb '%s' # orange</span>
<span class="org-string">set linetype 6 lw 2 lc rgb '%s' # yellow</span>
<span class="org-string">set linetype 7 lw 2 lc rgb '%s' # teal</span>
<span class="org-string">set linetype 8 lw 2 lc rgb '%s' # violet</span>

<span class="org-string"># palette</span>
<span class="org-string">set palette maxcolors 8</span>
<span class="org-string">set palette defined ( 0 '%s',\</span>
<span class="org-string">1 '%s',\</span>
<span class="org-string">2 '%s',\</span>
<span class="org-string">3 '%s',\</span>
<span class="org-string">4 '%s',\</span>
<span class="org-string">5 '%s',\</span>
<span class="org-string">6 '%s',\</span>
<span class="org-string">7 '%s' )</span>
<span class="org-string">"</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">fg</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">fg-alt</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">fg</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">fg-alt</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">fg</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-comment-delimiter">;; </span><span class="org-comment">colours</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">red</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">blue</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">green</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">magenta</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">orange</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">yellow</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">teal</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">violet</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-comment-delimiter">;; </span><span class="org-comment">duplicated</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">red</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">blue</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">green</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">magenta</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">orange</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">yellow</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">teal</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">violet</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-plot/gnuplot-term-properties</span> <span class="org-rainbow-delimiters-depth-3">(</span>_type<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-string">"background rgb '%s' size 1050,650"</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">bg</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> org-plot/gnuplot-script-preamble <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-plot/generate-theme</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> org-plot/gnuplot-term-extra <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-plot/gnuplot-term-properties</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-exporting-general" class="outline-5">
<h5 id="exporting-general"><span class="section-number-5">6.3.3.3</span> Exporting (general)<a aria-hidden="true" href="#exporting-general">#</a> </h5>
<div class="outline-text-5" id="text-6-3-3-3">
<details id='exporting-general,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#exporting-general,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-export-headline-levels</span> <span class="org-highlight-numbers-number">5</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">I like nesting</span>
</pre>
</div>
    </details>
<p>
I&rsquo;m also going to make use of an item in <kbd>ox-extra</kbd> so that I can add an <kbd>:ignore:</kbd>
tag to headings for the content to be kept, but the heading itself ignored
(unlike <kbd>:noexport:</kbd> which ignored both heading and content). This is useful when
I want to use headings to provide a structure for writing that doesn&rsquo;t appear in
the final documents.
</p>
<details id='exporting-general,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#exporting-general,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">require</span> <span class="org-highlight-quoted-quote">'</span><span class="org-constant">ox-extra</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">ox-extras-activate</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>ignore-headlines<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-exporting-html" class="outline-5">
<h5 id="exporting-html"><span class="section-number-5">6.3.3.4</span> Exporting to <span class='acr'>HTML</span><a aria-hidden="true" href="#exporting-html">#</a> </h5>
<div class="outline-text-5" id="text-6-3-3-4">
<p>
I want to tweak a whole bunch of things. While I&rsquo;ll want my tweaks almost all
the time, occasionally I may want to test how something turns out using a more
default config. With that in mind, a global minor mode seems like the most
appropriate architecture to use.
</p>
<details id='exporting-html,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#exporting-html,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define-minor-mode</span> <span class="org-variable-name">org-fancy-html-export-mode</span>
  <span class="org-doc">"Toggle my fabulous org export tweaks. While this mode itself does a little bit,</span>
<span class="org-doc">the vast majority of the change in behaviour comes from switch statements in:</span>
<span class="org-doc"> - `</span><span class="org-doc"><span class="org-constant">org-html-template-fancier</span></span><span class="org-doc">'</span>
<span class="org-doc"> - `</span><span class="org-doc"><span class="org-constant">org-html--build-meta-info-extended</span></span><span class="org-doc">'</span>
<span class="org-doc"> - `</span><span class="org-doc"><span class="org-constant">org-html-src-block-collapsable</span></span><span class="org-doc">'</span>
<span class="org-doc"> - `</span><span class="org-doc"><span class="org-constant">org-html-block-collapsable</span></span><span class="org-doc">'</span>
<span class="org-doc"> - `</span><span class="org-doc"><span class="org-constant">org-html-table-wrapped</span></span><span class="org-doc">'</span>
<span class="org-doc"> - `</span><span class="org-doc"><span class="org-constant">org-html--format-toc-headline-colapseable</span></span><span class="org-doc">'</span>
<span class="org-doc"> - `</span><span class="org-doc"><span class="org-constant">org-html--toc-text-stripped-leaves</span></span><span class="org-doc">'</span>
<span class="org-doc"> - `</span><span class="org-doc"><span class="org-constant">org-export-html-headline-anchor</span></span><span class="org-doc">'"</span>
  <span class="org-builtin">:global</span> t
  <span class="org-builtin">:init-value</span> t
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-variable-name">org-fancy-html-export-mode</span>
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-html-style-default</span> org-html-style-fancy
            <span class="org-variable-name">org-html-meta-tags</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-html-meta-tags-fancy</span>
            <span class="org-variable-name">org-html-checkbox-type</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">html-span</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-html-style-default</span> org-html-style-plain
          <span class="org-variable-name">org-html-meta-tags</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-html-meta-tags-default</span>
          <span class="org-variable-name">org-html-checkbox-type</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">html</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
There are quite a few instances where I want to modify variables defined in
<kbd>ox-html</kbd>, so we&rsquo;ll wrap the contents of this section in an <code>(after! ox-html ...)</code>
block.
</p>
<details id='exporting-html,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#exporting-html,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> ox-html
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">define-minor-mode</span> <span class="org-variable-name">org-fancy-html-export-mode</span>
    <span class="org-doc">"Toggle my fabulous org export tweaks. While this mode itself does a little bit,</span>
<span class="org-doc">  the vast majority of the change in behaviour comes from switch statements in:</span>
<span class="org-doc">   - `</span><span class="org-doc"><span class="org-constant">org-html-template-fancier</span></span><span class="org-doc">'</span>
<span class="org-doc">   - `</span><span class="org-doc"><span class="org-constant">org-html--build-meta-info-extended</span></span><span class="org-doc">'</span>
<span class="org-doc">   - `</span><span class="org-doc"><span class="org-constant">org-html-src-block-collapsable</span></span><span class="org-doc">'</span>
<span class="org-doc">   - `</span><span class="org-doc"><span class="org-constant">org-html-block-collapsable</span></span><span class="org-doc">'</span>
<span class="org-doc">   - `</span><span class="org-doc"><span class="org-constant">org-html-table-wrapped</span></span><span class="org-doc">'</span>
<span class="org-doc">   - `</span><span class="org-doc"><span class="org-constant">org-html--format-toc-headline-colapseable</span></span><span class="org-doc">'</span>
<span class="org-doc">   - `</span><span class="org-doc"><span class="org-constant">org-html--toc-text-stripped-leaves</span></span><span class="org-doc">'</span>
<span class="org-doc">   - `</span><span class="org-doc"><span class="org-constant">org-export-html-headline-anchor</span></span><span class="org-doc">'"</span>
    <span class="org-builtin">:global</span> t
    <span class="org-builtin">:init-value</span> t
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-variable-name">org-fancy-html-export-mode</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-html-style-default</span> org-html-style-fancy
              <span class="org-variable-name">org-html-meta-tags</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-html-meta-tags-fancy</span>
              <span class="org-variable-name">org-html-checkbox-type</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">html-span</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-html-style-default</span> org-html-style-plain
            <span class="org-variable-name">org-html-meta-tags</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-html-meta-tags-default</span>
            <span class="org-variable-name">org-html-checkbox-type</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">html</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defadvice!</span> org-html-template-fancier <span class="org-rainbow-delimiters-depth-3">(</span>orig-fn contents info<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Return complete document string after HTML conversion.</span>
<span class="org-doc">  CONTENTS is the transcoded contents string.  INFO is a plist</span>
<span class="org-doc">  holding export options. Adds a few extra things to the body</span>
<span class="org-doc">  compared to the default implementation."</span>
    <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-html-template</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">not</span> <span class="org-variable-name">org-fancy-html-export-mode</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">bound-and-true-p</span> +org-msg-currently-exporting<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">funcall</span> orig-fn contents info<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">not</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-html-html5-p</span> info<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-html-xhtml-p</span> info<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>xml-declaration <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:html-xml-declaration</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                <span class="org-rainbow-delimiters-depth-2">(</span>decl <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">stringp</span> xml-declaration<span class="org-rainbow-delimiters-depth-2">)</span> xml-declaration<span class="org-rainbow-delimiters-depth-1">)</span>
                          <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">cdr</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">assoc</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:html-extension</span><span class="org-rainbow-delimiters-depth-3">)</span>
                                      xml-declaration<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                          <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">cdr</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">assoc</span> <span class="org-string">"html"</span> xml-declaration<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                          <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
           <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">not</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">not</span> decl<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">string=</span> <span class="org-string">""</span> decl<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
             <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"%s\n"</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> decl
                             <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">and</span> <span class="org-variable-name">org-html-coding-system</span>
                                      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">fboundp</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">coding-system-get</span><span class="org-rainbow-delimiters-depth-3">)</span>
                                      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">coding-system-get</span> <span class="org-variable-name">org-html-coding-system</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">mime-charset</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                                 <span class="org-string">"iso-8859-1"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-variable-name">org-html-doctype</span> info<span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-string">"\n"</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">concat</span> <span class="org-string">"&lt;html"</span>
               <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">cond</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-html-xhtml-p</span> info<span class="org-rainbow-delimiters-depth-2">)</span>
                      <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span>
                       <span class="org-string">" xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"%s\" xml:lang=\"%s\""</span>
                       <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:language</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:language</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-html-html5-p</span> info<span class="org-rainbow-delimiters-depth-2">)</span>
                      <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">" lang=\"%s\""</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:language</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
               <span class="org-string">"&gt;\n"</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-string">"&lt;head&gt;\n"</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-html--build-meta-info</span> info<span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-html--build-head</span> info<span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-html--build-mathjax-config</span> info<span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-string">"&lt;/head&gt;\n"</span>
       <span class="org-string">"&lt;body&gt;\n&lt;input type='checkbox' id='theme-switch'&gt;&lt;div id='page'&gt;&lt;label id='switch-label' for='theme-switch'&gt;&lt;/label&gt;"</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>link-up <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-trim</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:html-link-up</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
             <span class="org-rainbow-delimiters-depth-1">(</span>link-home <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-trim</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:html-link-home</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">string=</span> link-up <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">string=</span> link-home <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
           <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:html-home/up-format</span><span class="org-rainbow-delimiters-depth-2">)</span>
                   <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">or</span> link-up link-home<span class="org-rainbow-delimiters-depth-2">)</span>
                   <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">or</span> link-home link-up<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">Preamble.</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-html--build-pre/postamble</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">preamble</span> info<span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">Document contents.</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>div <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">assq</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">content</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:html-divs</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-string">"&lt;%s id=\"%s\"&gt;\n"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">1</span> div<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">2</span> div<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">Document title.</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:with-title</span><span class="org-rainbow-delimiters-depth-3">)</span>
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>title <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:with-title</span><span class="org-rainbow-delimiters-depth-1">)</span>
                           <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:title</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
               <span class="org-rainbow-delimiters-depth-2">(</span>subtitle <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:subtitle</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
               <span class="org-rainbow-delimiters-depth-2">(</span>html5-fancy <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-html--html5-fancy-p</span> info<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
           <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> title
             <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span>
              <span class="org-string">"&lt;div class='page-header'&gt;&lt;div class='page-meta'&gt;%s, %s&lt;/div&gt;&lt;h1 class=\"title\"&gt;%s%s&lt;/h1&gt;&lt;/div&gt;\n"</span>
              <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-export-data</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:date</span><span class="org-rainbow-delimiters-depth-1">)</span> info<span class="org-rainbow-delimiters-depth-3">)</span>
              <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-export-data</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:author</span><span class="org-rainbow-delimiters-depth-1">)</span> info<span class="org-rainbow-delimiters-depth-3">)</span>
              <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-export-data</span> title info<span class="org-rainbow-delimiters-depth-3">)</span>
              <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> subtitle
                  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span>
                   <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> html5-fancy
                       <span class="org-string">"&lt;p class=\"subtitle\"&gt;%s&lt;/p&gt;\n"</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">concat</span> <span class="org-string">"\n"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-html-close-tag</span> <span class="org-string">"br"</span> nil info<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-string">"\n"</span>
                             <span class="org-string">"&lt;span class=\"subtitle\"&gt;%s&lt;/span&gt;\n"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                   <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-export-data</span> subtitle info<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
       contents
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"&lt;/%s&gt;\n"</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">1</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">assq</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">content</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:html-divs</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">Postamble.</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-html--build-pre/postamble</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">postamble</span> info<span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">Possibly use the Klipse library live code blocks.</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:html-klipsify-src</span><span class="org-rainbow-delimiters-depth-3">)</span>
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">concat</span> <span class="org-string">"&lt;script&gt;"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:html-klipse-selection-script</span><span class="org-rainbow-delimiters-depth-1">)</span>
                 <span class="org-string">"&lt;/script&gt;&lt;script src=\""</span>
                 <span class="org-variable-name">org-html-klipse-js</span>
                 <span class="org-string">"\"&gt;&lt;/script&gt;&lt;link rel=\"stylesheet\" type=\"text/css\" href=\""</span>
                 <span class="org-variable-name">org-html-klipse-css</span> <span class="org-string">"\"/&gt;"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">Closing document.</span>
       <span class="org-string">"&lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defadvice!</span> org-html-toc-linked <span class="org-rainbow-delimiters-depth-3">(</span>depth info <span class="org-type">&amp;optional</span> scope<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Build a table of contents.</span>
<span class="org-doc">  </span>
<span class="org-doc">  Just like `</span><span class="org-doc"><span class="org-constant">org-html-toc</span></span><span class="org-doc">', except the header is a link to \"#\".</span>
<span class="org-doc">  </span>
<span class="org-doc">  DEPTH is an integer specifying the depth of the table.  INFO is</span>
<span class="org-doc">  a plist used as a communication channel.  Optional argument SCOPE</span>
<span class="org-doc">  is an element defining the scope of the table.  Return the table</span>
<span class="org-doc">  of contents as a string, or nil if it is empty."</span>
    <span class="org-builtin">:override</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-html-toc</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>toc-entries
       <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">mapcar</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-2">(</span>headline<span class="org-rainbow-delimiters-depth-2">)</span>
             <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">cons</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-html--format-toc-headline</span> headline info<span class="org-rainbow-delimiters-depth-3">)</span>
               <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-export-get-relative-level</span> headline info<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
           <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-export-collect-headlines</span> info depth scope<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> toc-entries
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>toc <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">concat</span> <span class="org-string">"&lt;div id=\"text-table-of-contents\"&gt;"</span>
               <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-html--toc-text</span> toc-entries<span class="org-rainbow-delimiters-depth-3">)</span>
               <span class="org-string">"&lt;/div&gt;\n"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> scope toc
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>outer-tag <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-html--html5-fancy-p</span> info<span class="org-rainbow-delimiters-depth-2">)</span>
                     <span class="org-string">"nav"</span>
                   <span class="org-string">"div"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">concat</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-string">"&lt;%s id=\"table-of-contents\"&gt;\n"</span> outer-tag<span class="org-rainbow-delimiters-depth-3">)</span>
              <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">top-level</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:html-toplevel-hlevel</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"&lt;h%d&gt;&lt;a href=\"#\" style=\"color:inherit; text-decoration: none;\"&gt;%s&lt;/a&gt;&lt;/h%d&gt;\n"</span>
                    top-level
                    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-html--translate</span> <span class="org-string">"Table of Contents"</span> info<span class="org-rainbow-delimiters-depth-2">)</span>
                    top-level<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
              toc
              <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-string">"&lt;/%s&gt;\n"</span> outer-tag<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-html-meta-tags-fancy</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">info</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Use the INFO plist to construct the meta tags, as described in `</span><span class="org-doc"><span class="org-constant">org-html-meta-tags</span></span><span class="org-doc">'."</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>title <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-html-plain-text</span>
                  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-element-interpret-data</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:title</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span> info<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span>author <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:with-author</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>auth <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:author</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                         <span class="org-comment-delimiter">;; </span><span class="org-comment">Return raw Org syntax.</span>
                         <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">and</span> auth <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-html-plain-text</span>
                                    <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-element-interpret-data</span> auth<span class="org-rainbow-delimiters-depth-1">)</span> info<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">list</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-string-nw-p</span> author<span class="org-rainbow-delimiters-depth-3">)</span>
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">list</span> <span class="org-string">"name"</span> <span class="org-string">"author"</span> author<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-string-nw-p</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:description</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">list</span> <span class="org-string">"name"</span> <span class="org-string">"description"</span>
               <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:description</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"name"</span> <span class="org-string">"generator"</span> <span class="org-string">"org mode"</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"name"</span> <span class="org-string">"theme-color"</span> <span class="org-string">"#77aa99"</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"property"</span> <span class="org-string">"og:type"</span> <span class="org-string">"article"</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">list</span> <span class="org-string">"property"</span> <span class="org-string">"og:title"</span> title<span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>subtitle <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-export-data</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:subtitle</span><span class="org-rainbow-delimiters-depth-3">)</span> info<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-string-nw-p</span> subtitle<span class="org-rainbow-delimiters-depth-1">)</span>
           <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">list</span> <span class="org-string">"property"</span> <span class="org-string">"og:description"</span> subtitle<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"property"</span> <span class="org-string">"og:image"</span> <span class="org-string">"https://tecosaur.com/resources/org/nib.png"</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"property"</span> <span class="org-string">"og:image:type"</span> <span class="org-string">"image/png"</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"property"</span> <span class="org-string">"og:image:width"</span> <span class="org-string">"200"</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"property"</span> <span class="org-string">"og:image:height"</span> <span class="org-string">"200"</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"property"</span> <span class="org-string">"og:image:alt"</span> <span class="org-string">"Green fountain pen nib"</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-string-nw-p</span> author<span class="org-rainbow-delimiters-depth-3">)</span>
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">list</span> <span class="org-string">"property"</span> <span class="org-string">"og:article:author:first_name"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">car</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">s-split-up-to</span> <span class="org-string">" "</span> author <span class="org-highlight-numbers-number">2</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-string-nw-p</span> author<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">s-contains-p</span> <span class="org-string">" "</span> author<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">list</span> <span class="org-string">"property"</span> <span class="org-string">"og:article:author:last_name"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">cadr</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">s-split-up-to</span> <span class="org-string">" "</span> author <span class="org-highlight-numbers-number">2</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">list</span> <span class="org-string">"property"</span> <span class="org-string">"og:article:published_time"</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format-time-string</span> <span class="org-string">"%FT%T%z"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">functionp</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-html-meta-tags-default</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">defalias</span> <span class="org-highlight-quoted-quote">'</span><span class="org-function-name">org-html-meta-tags-default</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">ignore</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-html-meta-tags</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-html-meta-tags-fancy</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> org-html-style-plain <span class="org-variable-name">org-html-style-default</span>
        <span class="org-variable-name">org-html-htmlize-output-type</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">css</span>
        <span class="org-variable-name">org-html-doctype</span> <span class="org-string">"html5"</span>
        <span class="org-variable-name">org-html-html5-fancy</span> t<span class="org-rainbow-delimiters-depth-2">)</span>
  
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-html-reload-fancy-style</span> <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">interactive</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> org-html-style-fancy
          <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">f-read-text</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">expand-file-name</span> <span class="org-string">"misc/org-export-header.html"</span> <span class="org-variable-name">doom-private-dir</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                  <span class="org-string">"&lt;script&gt;\n"</span>
                  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">f-read-text</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">expand-file-name</span> <span class="org-string">"misc/org-css/main.js"</span> <span class="org-variable-name">doom-private-dir</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                  <span class="org-string">"&lt;/script&gt;\n&lt;style&gt;\n"</span>
                  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">f-read-text</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">expand-file-name</span> <span class="org-string">"misc/org-css/main.css"</span> <span class="org-variable-name">doom-private-dir</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                  <span class="org-string">"&lt;/style&gt;"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> <span class="org-variable-name">org-fancy-html-export-mode</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-html-style-default</span> org-html-style-fancy<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-html-reload-fancy-style</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">org-html-export-collapsed</span> nil<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">eval</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span>cl-pushnew <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-builtin">:collapsed</span> <span class="org-string">"COLLAPSED"</span> <span class="org-string">"collapsed"</span> <span class="org-variable-name">org-html-export-collapsed</span> t<span class="org-rainbow-delimiters-depth-1">)</span>
                     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-export-backend-options</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-export-get-backend</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">html</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">org-default-properties</span> <span class="org-string">"EXPORT_COLLAPSED"</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defadvice!</span> org-html-src-block-collapsable <span class="org-rainbow-delimiters-depth-3">(</span>orig-fn src-block contents info<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Wrap the usual &lt;pre&gt; block in a &lt;details&gt;"</span>
    <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-html-src-block</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">not</span> <span class="org-variable-name">org-fancy-html-export-mode</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">bound-and-true-p</span> +org-msg-currently-exporting<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">funcall</span> orig-fn src-block contents info<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>properties <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">cadr</span> src-block<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
             <span class="org-rainbow-delimiters-depth-3">(</span>lang <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">mode-name-to-lang-name</span>
                    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> properties <span class="org-builtin">:language</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
             <span class="org-rainbow-delimiters-depth-3">(</span>name <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> properties <span class="org-builtin">:name</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
             <span class="org-rainbow-delimiters-depth-3">(</span>ref <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-export-get-reference</span> src-block info<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
             <span class="org-rainbow-delimiters-depth-3">(</span>collapsed-p <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">member</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-export-read-attribute</span> <span class="org-builtin">:attr_html</span> src-block <span class="org-builtin">:collapsed</span><span class="org-rainbow-delimiters-depth-3">)</span>
                                      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:collapsed</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                                  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"y"</span> <span class="org-string">"yes"</span> <span class="org-string">"t"</span> t <span class="org-string">"true"</span> <span class="org-string">"all"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span>
         <span class="org-string">"&lt;details id='%s' class='code'%s&gt;&lt;summary%s&gt;%s&lt;/summary&gt;</span>
<span class="org-string">  &lt;div class='gutter'&gt;</span>
<span class="org-string">  &lt;a href='#%s'&gt;#&lt;/a&gt;</span>
<span class="org-string">  &lt;button title='Copy to clipboard' onclick='copyPreToClipbord(this)'&gt;&#9112;&lt;/button&gt;\</span>
<span class="org-string">  &lt;/div&gt;</span>
<span class="org-string">  %s</span>
<span class="org-string">  &lt;/details&gt;"</span>
         ref
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> collapsed-p <span class="org-string">""</span> <span class="org-string">" open"</span><span class="org-rainbow-delimiters-depth-3">)</span>
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> name <span class="org-string">" class='named'"</span> <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-3">)</span>
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">not</span> name<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span> <span class="org-string">"&lt;span class='lang'&gt;"</span> lang <span class="org-string">"&lt;/span&gt;"</span><span class="org-rainbow-delimiters-depth-1">)</span>
           <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"&lt;span class='name'&gt;%s&lt;/span&gt;&lt;span class='lang'&gt;%s&lt;/span&gt;"</span> name lang<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
         ref
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> name
             <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">replace-regexp-in-string</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"&lt;pre</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string"> class=\"[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">\"]+\"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">? id=\"%s\"&gt;"</span> ref<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-string">"&lt;pre\\1&gt;"</span>
                                       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">funcall</span> orig-fn src-block contents info<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
           <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">funcall</span> orig-fn src-block contents info<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">mode-name-to-lang-name</span> <span class="org-rainbow-delimiters-depth-3">(</span>mode<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">cadr</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">assoc</span> mode
                     <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"asymptote"</span> <span class="org-string">"Asymptote"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"awk"</span> <span class="org-string">"Awk"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"C"</span> <span class="org-string">"C"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"clojure"</span> <span class="org-string">"Clojure"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"css"</span> <span class="org-string">"CSS"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"D"</span> <span class="org-string">"D"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"ditaa"</span> <span class="org-string">"ditaa"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"dot"</span> <span class="org-string">"Graphviz"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"calc"</span> <span class="org-string">"Emacs Calc"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"emacs-lisp"</span> <span class="org-string">"Emacs Lisp"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"fortran"</span> <span class="org-string">"Fortran"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"gnuplot"</span> <span class="org-string">"gnuplot"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"haskell"</span> <span class="org-string">"Haskell"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"hledger"</span> <span class="org-string">"hledger"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"java"</span> <span class="org-string">"Java"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"js"</span> <span class="org-string">"Javascript"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"latex"</span> <span class="org-string">"LaTeX"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"ledger"</span> <span class="org-string">"Ledger"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"lisp"</span> <span class="org-string">"Lisp"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"lilypond"</span> <span class="org-string">"Lilypond"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"lua"</span> <span class="org-string">"Lua"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"matlab"</span> <span class="org-string">"MATLAB"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"mscgen"</span> <span class="org-string">"Mscgen"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"ocaml"</span> <span class="org-string">"Objective Caml"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"octave"</span> <span class="org-string">"Octave"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"org"</span> <span class="org-string">"Org mode"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"oz"</span> <span class="org-string">"OZ"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"plantuml"</span> <span class="org-string">"Plantuml"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"processing"</span> <span class="org-string">"Processing.js"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"python"</span> <span class="org-string">"Python"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"R"</span> <span class="org-string">"R"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"ruby"</span> <span class="org-string">"Ruby"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"sass"</span> <span class="org-string">"Sass"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"scheme"</span> <span class="org-string">"Scheme"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"screen"</span> <span class="org-string">"Gnu Screen"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"sed"</span> <span class="org-string">"Sed"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"sh"</span> <span class="org-string">"shell"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"sql"</span> <span class="org-string">"SQL"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"sqlite"</span> <span class="org-string">"SQLite"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"forth"</span> <span class="org-string">"Forth"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"io"</span> <span class="org-string">"IO"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"J"</span> <span class="org-string">"J"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"makefile"</span> <span class="org-string">"Makefile"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"maxima"</span> <span class="org-string">"Maxima"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"perl"</span> <span class="org-string">"Perl"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"picolisp"</span> <span class="org-string">"Pico Lisp"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"scala"</span> <span class="org-string">"Scala"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"shell"</span> <span class="org-string">"Shell Script"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"ebnf2ps"</span> <span class="org-string">"ebfn2ps"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"cpp"</span> <span class="org-string">"C++"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"abc"</span> <span class="org-string">"ABC"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"coq"</span> <span class="org-string">"Coq"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"groovy"</span> <span class="org-string">"Groovy"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"bash"</span> <span class="org-string">"bash"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"csh"</span> <span class="org-string">"csh"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"ash"</span> <span class="org-string">"ash"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"dash"</span> <span class="org-string">"dash"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"ksh"</span> <span class="org-string">"ksh"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"mksh"</span> <span class="org-string">"mksh"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"posh"</span> <span class="org-string">"posh"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"ada"</span> <span class="org-string">"Ada"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"asm"</span> <span class="org-string">"Assembler"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"caml"</span> <span class="org-string">"Caml"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"delphi"</span> <span class="org-string">"Delphi"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"html"</span> <span class="org-string">"HTML"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"idl"</span> <span class="org-string">"IDL"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"mercury"</span> <span class="org-string">"Mercury"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"metapost"</span> <span class="org-string">"MetaPost"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"modula-2"</span> <span class="org-string">"Modula-2"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"pascal"</span> <span class="org-string">"Pascal"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"ps"</span> <span class="org-string">"PostScript"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"prolog"</span> <span class="org-string">"Prolog"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"simula"</span> <span class="org-string">"Simula"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"tcl"</span> <span class="org-string">"tcl"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"tex"</span> <span class="org-string">"LaTeX"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"plain-tex"</span> <span class="org-string">"TeX"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"verilog"</span> <span class="org-string">"Verilog"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"vhdl"</span> <span class="org-string">"VHDL"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"xml"</span> <span class="org-string">"XML"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"nxml"</span> <span class="org-string">"XML"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"conf"</span> <span class="org-string">"Configuration File"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
        mode<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-html-block-collapsable</span> <span class="org-rainbow-delimiters-depth-3">(</span>orig-fn block contents info<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Wrap the usual block in a &lt;details&gt;"</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">not</span> <span class="org-variable-name">org-fancy-html-export-mode</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">bound-and-true-p</span> +org-msg-currently-exporting<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">funcall</span> orig-fn block contents info<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>ref <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-export-get-reference</span> block info<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
            <span class="org-rainbow-delimiters-depth-3">(</span>type <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">pcase</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">car</span> block<span class="org-rainbow-delimiters-depth-2">)</span>
                    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">property-drawer</span> <span class="org-string">"Properties"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
            <span class="org-rainbow-delimiters-depth-3">(</span>collapsed-default <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">pcase</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">car</span> block<span class="org-rainbow-delimiters-depth-2">)</span>
                                 <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">property-drawer</span> t<span class="org-rainbow-delimiters-depth-2">)</span>
                                 <span class="org-rainbow-delimiters-depth-2">(</span>_ nil<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
            <span class="org-rainbow-delimiters-depth-3">(</span>collapsed-value <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-export-read-attribute</span> <span class="org-builtin">:attr_html</span> block <span class="org-builtin">:collapsed</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
            <span class="org-rainbow-delimiters-depth-3">(</span>collapsed-p <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">member</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-export-read-attribute</span> <span class="org-builtin">:attr_html</span> block <span class="org-builtin">:collapsed</span><span class="org-rainbow-delimiters-depth-3">)</span>
                                     <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"y"</span> <span class="org-string">"yes"</span> <span class="org-string">"t"</span> t <span class="org-string">"true"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                             <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">member</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:collapsed</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"all"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span>
         <span class="org-string">"&lt;details id='%s' class='code'%s&gt;</span>
<span class="org-string">  &lt;summary%s&gt;%s&lt;/summary&gt;</span>
<span class="org-string">  &lt;div class='gutter'&gt;\</span>
<span class="org-string">  &lt;a href='#%s'&gt;#&lt;/a&gt;</span>
<span class="org-string">  &lt;button title='Copy to clipboard' onclick='copyPreToClipbord(this)'&gt;&#9112;&lt;/button&gt;\</span>
<span class="org-string">  &lt;/div&gt;</span>
<span class="org-string">  %s\n</span>
<span class="org-string">  &lt;/details&gt;"</span>
         ref
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> collapsed-p collapsed-default<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-string">""</span> <span class="org-string">" open"</span><span class="org-rainbow-delimiters-depth-3">)</span>
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> type <span class="org-string">" class='named'"</span> <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-3">)</span>
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> type <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"&lt;span class='type'&gt;%s&lt;/span&gt;"</span> type<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-3">)</span>
         ref
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">funcall</span> orig-fn block contents info<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">advice-add</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">org-html-example-block</span>   <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-html-block-collapsable</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">advice-add</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">org-html-fixed-width</span>     <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-html-block-collapsable</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">advice-add</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">org-html-property-drawer</span> <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-html-block-collapsable</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">htmlize-before-hook</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">highlight-numbers--turn-on</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defadvice!</span> org-html-table-wrapped <span class="org-rainbow-delimiters-depth-3">(</span>orig-fn table contents info<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Wrap the usual &lt;table&gt; in a &lt;div&gt;"</span>
    <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-html-table</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">not</span> <span class="org-variable-name">org-fancy-html-export-mode</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">bound-and-true-p</span> +org-msg-currently-exporting<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">funcall</span> orig-fn table contents info<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>name <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">cadr</span> table<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-builtin">:name</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
             <span class="org-rainbow-delimiters-depth-3">(</span>ref <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-export-get-reference</span> table info<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"&lt;div id='%s' class='table'&gt;</span>
<span class="org-string">  &lt;div class='gutter'&gt;&lt;a href='#%s'&gt;#&lt;/a&gt;&lt;/div&gt;</span>
<span class="org-string">  &lt;div class='tabular'&gt;</span>
<span class="org-string">  %s</span>
<span class="org-string">  &lt;/div&gt;\</span>
<span class="org-string">  &lt;/div&gt;"</span>
                ref ref
                <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> name
                    <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">replace-regexp-in-string</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"&lt;table id=\"%s\""</span> ref<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-string">"&lt;table"</span>
                                              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">funcall</span> orig-fn table contents info<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">funcall</span> orig-fn table contents info<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defadvice!</span> org-html--format-toc-headline-colapseable <span class="org-rainbow-delimiters-depth-3">(</span>orig-fn headline info<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Add a label and checkbox to `</span><span class="org-doc"><span class="org-constant">org-html--format-toc-headline</span></span><span class="org-doc">'s usual output,</span>
<span class="org-doc">  to allow the TOC to be a collapseable tree."</span>
    <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-html--format-toc-headline</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">not</span> <span class="org-variable-name">org-fancy-html-export-mode</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">bound-and-true-p</span> +org-msg-currently-exporting<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">funcall</span> orig-fn headline info<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>id <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-element-property</span> <span class="org-builtin">:CUSTOM_ID</span> headline<span class="org-rainbow-delimiters-depth-2">)</span>
                    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-export-get-reference</span> headline info<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"&lt;input type='checkbox' id='toc--%s'/&gt;&lt;label for='toc--%s'&gt;%s&lt;/label&gt;"</span>
                id id <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">funcall</span> orig-fn headline info<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defadvice!</span> org-html--toc-text-stripped-leaves <span class="org-rainbow-delimiters-depth-3">(</span>orig-fn toc-entries<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Remove label"</span>
    <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-html--toc-text</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">not</span> <span class="org-variable-name">org-fancy-html-export-mode</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">bound-and-true-p</span> +org-msg-currently-exporting<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">funcall</span> orig-fn toc-entries<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">replace-regexp-in-string</span> <span class="org-string">"&lt;input [</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">&gt;]+&gt;&lt;label [</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">&gt;]+&gt;</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.+?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">&lt;/label&gt;&lt;/li&gt;"</span> <span class="org-string">"\\1&lt;/li&gt;"</span>
                                <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">funcall</span> orig-fn toc-entries<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-html-text-markup-alist</span>
        <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">bold</span> . <span class="org-string">"&lt;b&gt;%s&lt;/b&gt;"</span><span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-rainbow-delimiters-depth-1">(</span>code . <span class="org-string">"&lt;code&gt;%s&lt;/code&gt;"</span><span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-rainbow-delimiters-depth-1">(</span>italic . <span class="org-string">"&lt;i&gt;%s&lt;/i&gt;"</span><span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-rainbow-delimiters-depth-1">(</span>strike-through . <span class="org-string">"&lt;del&gt;%s&lt;/del&gt;"</span><span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-rainbow-delimiters-depth-1">(</span>underline . <span class="org-string">"&lt;span class=\"underline\"&gt;%s&lt;/span&gt;"</span><span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-rainbow-delimiters-depth-1">(</span>verbatim . <span class="org-string">"&lt;kbd&gt;%s&lt;/kbd&gt;"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">appendq!</span> <span class="org-variable-name">org-html-checkbox-types</span>
            <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">html-span</span>
               <span class="org-rainbow-delimiters-depth-2">(</span>on . <span class="org-string">"&lt;span class='checkbox'&gt;&lt;/span&gt;"</span><span class="org-rainbow-delimiters-depth-2">)</span>
               <span class="org-rainbow-delimiters-depth-2">(</span>off . <span class="org-string">"&lt;span class='checkbox'&gt;&lt;/span&gt;"</span><span class="org-rainbow-delimiters-depth-2">)</span>
               <span class="org-rainbow-delimiters-depth-2">(</span>trans . <span class="org-string">"&lt;span class='checkbox'&gt;&lt;/span&gt;"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-html-checkbox-type</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">html-span</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-export-html-headline-anchor</span> <span class="org-rainbow-delimiters-depth-3">(</span>text backend info<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-export-derived-backend-p</span> backend <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">html</span><span class="org-rainbow-delimiters-depth-2">)</span>
               <span class="org-variable-name">org-fancy-html-export-mode</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">bound-and-true-p</span> +org-msg-currently-exporting<span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">replace-regexp-in-string</span>
         <span class="org-string">"&lt;h</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[0-9]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"> id=\"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[a-z0-9-]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\"&gt;</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.*[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string"> ]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">&lt;\\/h[0-9]&gt;"</span> <span class="org-comment-delimiter">; </span><span class="org-comment">this is quite restrictive, but due to `</span><span class="org-comment"><span class="org-constant">org-reference-contraction</span></span><span class="org-comment">' I can do this</span>
         <span class="org-string">"&lt;h\\1 id=\"\\2\"&gt;\\3&lt;a aria-hidden=\"true\" href=\"#\\2\"&gt;#&lt;/a&gt; &lt;/h\\1&gt;"</span>
         text<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">org-export-filter-headline-functions</span>
               <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">org-export-html-headline-anchor</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(setq-default org-html-with-latex `dvisvgm)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-html-mathjax-options</span>
        <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>path <span class="org-string">"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"</span> <span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-rainbow-delimiters-depth-1">(</span>scale <span class="org-string">"1"</span><span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-rainbow-delimiters-depth-1">(</span>autonumber <span class="org-string">"ams"</span><span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-rainbow-delimiters-depth-1">(</span>multlinewidth <span class="org-string">"85%"</span><span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-rainbow-delimiters-depth-1">(</span>tagindent <span class="org-string">".8em"</span><span class="org-rainbow-delimiters-depth-1">)</span>
          <span class="org-rainbow-delimiters-depth-1">(</span>tagside <span class="org-string">"right"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-html-mathjax-template</span>
        <span class="org-string">"&lt;script&gt;</span>
<span class="org-string">  MathJax = {</span>
<span class="org-string">    chtml: {</span>
<span class="org-string">      scale: %SCALE</span>
<span class="org-string">    },</span>
<span class="org-string">    svg: {</span>
<span class="org-string">      scale: %SCALE,</span>
<span class="org-string">      fontCache: \"global\"</span>
<span class="org-string">    },</span>
<span class="org-string">    tex: {</span>
<span class="org-string">      tags: \"%AUTONUMBER\",</span>
<span class="org-string">      multlineWidth: \"%MULTLINEWIDTH\",</span>
<span class="org-string">      tagSide: \"%TAGSIDE\",</span>
<span class="org-string">      tagIndent: \"%TAGINDENT\"</span>
<span class="org-string">    }</span>
<span class="org-string">  };</span>
<span class="org-string">  &lt;/script&gt;</span>
<span class="org-string">  &lt;script id=\"MathJax-script\" async</span>
<span class="org-string">          src=\"%PATH\"&gt;&lt;/script&gt;"</span><span class="org-rainbow-delimiters-depth-2">)</span>
<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
<div id="outline-container-extra-header-content" class="outline-6">
<h6 id="extra-header-content"><span class="section-number-6">6.3.3.4.1</span> Extra header content<a aria-hidden="true" href="#extra-header-content">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-4-1">
<p>
We want to tack on a few more bits to the start of the body. Unfortunately, there
doesn&rsquo;t seem to be any nice variable or hook, so we&rsquo;ll just override the
relevant function.
</p>

<p>
This is done to allow me to add the date and author to the page header,
implement a <span class='acr'>CSS</span>-only light/dark theme toggle, and a sprinkle of <a href="https://ogp.me/">Open Graph</a>
metadata.
</p>
<details id='extra-header-content,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-header-content,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defadvice!</span> org-html-template-fancier <span class="org-rainbow-delimiters-depth-2">(</span>orig-fn contents info<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Return complete document string after HTML conversion.</span>
<span class="org-doc">CONTENTS is the transcoded contents string.  INFO is a plist</span>
<span class="org-doc">holding export options. Adds a few extra things to the body</span>
<span class="org-doc">compared to the default implementation."</span>
  <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-html-template</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">not</span> <span class="org-variable-name">org-fancy-html-export-mode</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">bound-and-true-p</span> +org-msg-currently-exporting<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">funcall</span> orig-fn contents info<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">concat</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">not</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-html-html5-p</span> info<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-html-xhtml-p</span> info<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>xml-declaration <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:html-xml-declaration</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
              <span class="org-rainbow-delimiters-depth-1">(</span>decl <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">stringp</span> xml-declaration<span class="org-rainbow-delimiters-depth-1">)</span> xml-declaration<span class="org-rainbow-delimiters-depth-3">)</span>
                        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">cdr</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">assoc</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:html-extension</span><span class="org-rainbow-delimiters-depth-2">)</span>
                                    xml-declaration<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">cdr</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">assoc</span> <span class="org-string">"html"</span> xml-declaration<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                        <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">not</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">not</span> decl<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">string=</span> <span class="org-string">""</span> decl<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
           <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"%s\n"</span>
                   <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> decl
                           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">and</span> <span class="org-variable-name">org-html-coding-system</span>
                                    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">fboundp</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">coding-system-get</span><span class="org-rainbow-delimiters-depth-2">)</span>
                                    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">coding-system-get</span> <span class="org-variable-name">org-html-coding-system</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">mime-charset</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                               <span class="org-string">"iso-8859-1"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-variable-name">org-html-doctype</span> info<span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-string">"\n"</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span> <span class="org-string">"&lt;html"</span>
             <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">cond</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-html-xhtml-p</span> info<span class="org-rainbow-delimiters-depth-1">)</span>
                    <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span>
                     <span class="org-string">" xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"%s\" xml:lang=\"%s\""</span>
                     <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:language</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:language</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                   <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-html-html5-p</span> info<span class="org-rainbow-delimiters-depth-1">)</span>
                    <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">" lang=\"%s\""</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:language</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
             <span class="org-string">"&gt;\n"</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-string">"&lt;head&gt;\n"</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-html--build-meta-info</span> info<span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-html--build-head</span> info<span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-html--build-mathjax-config</span> info<span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-string">"&lt;/head&gt;\n"</span>
     <span class="org-string">"&lt;body&gt;\n&lt;input type='checkbox' id='theme-switch'&gt;&lt;div id='page'&gt;&lt;label id='switch-label' for='theme-switch'&gt;&lt;/label&gt;"</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>link-up <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-trim</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:html-link-up</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
           <span class="org-rainbow-delimiters-depth-3">(</span>link-home <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-trim</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:html-link-home</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">string=</span> link-up <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">string=</span> link-home <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:html-home/up-format</span><span class="org-rainbow-delimiters-depth-1">)</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> link-up link-home<span class="org-rainbow-delimiters-depth-1">)</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> link-home link-up<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-comment-delimiter">;; </span><span class="org-comment">Preamble.</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-html--build-pre/postamble</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">preamble</span> info<span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-comment-delimiter">;; </span><span class="org-comment">Document contents.</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>div <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">assq</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">content</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:html-divs</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"&lt;%s id=\"%s\"&gt;\n"</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">1</span> div<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">2</span> div<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-comment-delimiter">;; </span><span class="org-comment">Document title.</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:with-title</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>title <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:with-title</span><span class="org-rainbow-delimiters-depth-3">)</span>
                         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:title</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
             <span class="org-rainbow-delimiters-depth-1">(</span>subtitle <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:subtitle</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
             <span class="org-rainbow-delimiters-depth-1">(</span>html5-fancy <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-html--html5-fancy-p</span> info<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> title
           <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span>
            <span class="org-string">"&lt;div class='page-header'&gt;&lt;div class='page-meta'&gt;%s, %s&lt;/div&gt;&lt;h1 class=\"title\"&gt;%s%s&lt;/h1&gt;&lt;/div&gt;\n"</span>
            <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-export-data</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:date</span><span class="org-rainbow-delimiters-depth-3">)</span> info<span class="org-rainbow-delimiters-depth-2">)</span>
            <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-export-data</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:author</span><span class="org-rainbow-delimiters-depth-3">)</span> info<span class="org-rainbow-delimiters-depth-2">)</span>
            <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-export-data</span> title info<span class="org-rainbow-delimiters-depth-2">)</span>
            <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> subtitle
                <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">if</span> html5-fancy
                     <span class="org-string">"&lt;p class=\"subtitle\"&gt;%s&lt;/p&gt;\n"</span>
                   <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">concat</span> <span class="org-string">"\n"</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-html-close-tag</span> <span class="org-string">"br"</span> nil info<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-string">"\n"</span>
                           <span class="org-string">"&lt;span class=\"subtitle\"&gt;%s&lt;/span&gt;\n"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-export-data</span> subtitle info<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
              <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     contents
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"&lt;/%s&gt;\n"</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">nth</span> <span class="org-highlight-numbers-number">1</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">assq</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">content</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:html-divs</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-comment-delimiter">;; </span><span class="org-comment">Postamble.</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-html--build-pre/postamble</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">postamble</span> info<span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-comment-delimiter">;; </span><span class="org-comment">Possibly use the Klipse library live code blocks.</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:html-klipsify-src</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">concat</span> <span class="org-string">"&lt;script&gt;"</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:html-klipse-selection-script</span><span class="org-rainbow-delimiters-depth-3">)</span>
               <span class="org-string">"&lt;/script&gt;&lt;script src=\""</span>
               <span class="org-variable-name">org-html-klipse-js</span>
               <span class="org-string">"\"&gt;&lt;/script&gt;&lt;link rel=\"stylesheet\" type=\"text/css\" href=\""</span>
               <span class="org-variable-name">org-html-klipse-css</span> <span class="org-string">"\"/&gt;"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-comment-delimiter">;; </span><span class="org-comment">Closing document.</span>
     <span class="org-string">"&lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
I think it would be nice if &ldquo;Table of Contents&rdquo; brought you back to the top of
the page. Well, since we&rsquo;ve done this much advising already&#x2026;
</p>
<details id='extra-header-content,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-header-content,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defadvice!</span> org-html-toc-linked <span class="org-rainbow-delimiters-depth-2">(</span>depth info <span class="org-type">&amp;optional</span> scope<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Build a table of contents.</span>

<span class="org-doc">Just like `</span><span class="org-doc"><span class="org-constant">org-html-toc</span></span><span class="org-doc">', except the header is a link to \"#\".</span>

<span class="org-doc">DEPTH is an integer specifying the depth of the table.  INFO is</span>
<span class="org-doc">a plist used as a communication channel.  Optional argument SCOPE</span>
<span class="org-doc">is an element defining the scope of the table.  Return the table</span>
<span class="org-doc">of contents as a string, or nil if it is empty."</span>
  <span class="org-builtin">:override</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-html-toc</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>toc-entries
     <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">mapcar</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-1">(</span>headline<span class="org-rainbow-delimiters-depth-1">)</span>
           <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">cons</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-html--format-toc-headline</span> headline info<span class="org-rainbow-delimiters-depth-2">)</span>
             <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-export-get-relative-level</span> headline info<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-export-collect-headlines</span> info depth scope<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> toc-entries
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>toc <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span> <span class="org-string">"&lt;div id=\"text-table-of-contents\"&gt;"</span>
             <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-html--toc-text</span> toc-entries<span class="org-rainbow-delimiters-depth-2">)</span>
             <span class="org-string">"&lt;/div&gt;\n"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> scope toc
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>outer-tag <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-html--html5-fancy-p</span> info<span class="org-rainbow-delimiters-depth-1">)</span>
                   <span class="org-string">"nav"</span>
                 <span class="org-string">"div"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"&lt;%s id=\"table-of-contents\"&gt;\n"</span> outer-tag<span class="org-rainbow-delimiters-depth-2">)</span>
            <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">top-level</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:html-toplevel-hlevel</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
              <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-string">"&lt;h%d&gt;&lt;a href=\"#\" style=\"color:inherit; text-decoration: none;\"&gt;%s&lt;/a&gt;&lt;/h%d&gt;\n"</span>
                  top-level
                  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-html--translate</span> <span class="org-string">"Table of Contents"</span> info<span class="org-rainbow-delimiters-depth-1">)</span>
                  top-level<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
            toc
            <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"&lt;/%s&gt;\n"</span> outer-tag<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Lastly, let&rsquo;s pile on some metadata. This gives my pages nice embeds.
</p>
<details id='extra-header-content,code--3' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#extra-header-content,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-html-meta-tags-fancy</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">info</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Use the INFO plist to construct the meta tags, as described in `</span><span class="org-doc"><span class="org-constant">org-html-meta-tags</span></span><span class="org-doc">'."</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>title <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-html-plain-text</span>
                <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-element-interpret-data</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:title</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span> info<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-rainbow-delimiters-depth-1">(</span>author <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:with-author</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>auth <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:author</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                       <span class="org-comment-delimiter">;; </span><span class="org-comment">Return raw Org syntax.</span>
                       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">and</span> auth <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-html-plain-text</span>
                                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-element-interpret-data</span> auth<span class="org-rainbow-delimiters-depth-3">)</span> info<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">list</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-string-nw-p</span> author<span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">list</span> <span class="org-string">"name"</span> <span class="org-string">"author"</span> author<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-string-nw-p</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:description</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">list</span> <span class="org-string">"name"</span> <span class="org-string">"description"</span>
             <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:description</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"name"</span> <span class="org-string">"generator"</span> <span class="org-string">"org mode"</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"name"</span> <span class="org-string">"theme-color"</span> <span class="org-string">"#77aa99"</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"property"</span> <span class="org-string">"og:type"</span> <span class="org-string">"article"</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">list</span> <span class="org-string">"property"</span> <span class="org-string">"og:title"</span> title<span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>subtitle <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-export-data</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:subtitle</span><span class="org-rainbow-delimiters-depth-2">)</span> info<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-string-nw-p</span> subtitle<span class="org-rainbow-delimiters-depth-3">)</span>
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">list</span> <span class="org-string">"property"</span> <span class="org-string">"og:description"</span> subtitle<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"property"</span> <span class="org-string">"og:image"</span> <span class="org-string">"https://tecosaur.com/resources/org/nib.png"</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"property"</span> <span class="org-string">"og:image:type"</span> <span class="org-string">"image/png"</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"property"</span> <span class="org-string">"og:image:width"</span> <span class="org-string">"200"</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"property"</span> <span class="org-string">"og:image:height"</span> <span class="org-string">"200"</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"property"</span> <span class="org-string">"og:image:alt"</span> <span class="org-string">"Green fountain pen nib"</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-string-nw-p</span> author<span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">list</span> <span class="org-string">"property"</span> <span class="org-string">"og:article:author:first_name"</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">car</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">s-split-up-to</span> <span class="org-string">" "</span> author <span class="org-highlight-numbers-number">2</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-string-nw-p</span> author<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">s-contains-p</span> <span class="org-string">" "</span> author<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">list</span> <span class="org-string">"property"</span> <span class="org-string">"og:article:author:last_name"</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">cadr</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">s-split-up-to</span> <span class="org-string">" "</span> author <span class="org-highlight-numbers-number">2</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">list</span> <span class="org-string">"property"</span> <span class="org-string">"og:article:published_time"</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format-time-string</span> <span class="org-string">"%FT%T%z"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">functionp</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-html-meta-tags-default</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">defalias</span> <span class="org-highlight-quoted-quote">'</span><span class="org-function-name">org-html-meta-tags-default</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">ignore</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-html-meta-tags</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-html-meta-tags-fancy</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-custom-css-js" class="outline-6">
<h6 id="custom-css-js"><span class="section-number-6">6.3.3.4.2</span> Custom <span class='acr'>CSS</span>/<span class='acr'>JS</span><a aria-hidden="true" href="#custom-css-js">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-4-2">
<p>
The default org <span class='acr'>HTML</span> export is &#x2026; alright, but we can really jazz it up.
<a href="https://lepisma.xyz">lepisma.xyz</a> has a really nice style, and from and org export too!
Suffice to say I&rsquo;ve snatched it, with a few of my own tweaks applied.
</p>

<details id='custom-css-js,code--1' class='code' open><summary><span class='lang'>HTML</span></summary>
    <div class='gutter'>
    <a href='#custom-css-js,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-html">&lt;<span class="org-function-name">link</span> <span class="org-variable-name">rel</span>=<span class="org-string">"icon"</span> <span class="org-variable-name">href</span>=<span class="org-string">"https://tecosaur.com/resources/org/nib.ico"</span> <span class="org-variable-name">type</span>=<span class="org-string">"image/ico"</span> /&gt;

&lt;<span class="org-function-name">link</span> <span class="org-variable-name">rel</span>=<span class="org-string">"preload"</span> <span class="org-variable-name">as</span>=<span class="org-string">"font"</span> <span class="org-variable-name">crossorigin</span>=<span class="org-string">"anonymous"</span> <span class="org-variable-name">type</span>=<span class="org-string">"font/woff2"</span> <span class="org-variable-name">href</span>=<span class="org-string">"https://tecosaur.com/resources/org/etbookot-roman-webfont.woff2"</span>&gt;
&lt;<span class="org-function-name">link</span> <span class="org-variable-name">rel</span>=<span class="org-string">"preload"</span> <span class="org-variable-name">as</span>=<span class="org-string">"font"</span> <span class="org-variable-name">crossorigin</span>=<span class="org-string">"anonymous"</span> <span class="org-variable-name">type</span>=<span class="org-string">"font/woff2"</span> <span class="org-variable-name">href</span>=<span class="org-string">"https://tecosaur.com/resources/org/etbookot-italic-webfont.woff2"</span>&gt;
&lt;<span class="org-function-name">link</span> <span class="org-variable-name">rel</span>=<span class="org-string">"preload"</span> <span class="org-variable-name">as</span>=<span class="org-string">"font"</span> <span class="org-variable-name">crossorigin</span>=<span class="org-string">"anonymous"</span> <span class="org-variable-name">type</span>=<span class="org-string">"font/woff2"</span> <span class="org-variable-name">href</span>=<span class="org-string">"https://tecosaur.com/resources/org/Merriweather-TextRegular.woff2"</span>&gt;
&lt;<span class="org-function-name">link</span> <span class="org-variable-name">rel</span>=<span class="org-string">"preload"</span> <span class="org-variable-name">as</span>=<span class="org-string">"font"</span> <span class="org-variable-name">crossorigin</span>=<span class="org-string">"anonymous"</span> <span class="org-variable-name">type</span>=<span class="org-string">"font/woff2"</span> <span class="org-variable-name">href</span>=<span class="org-string">"https://tecosaur.com/resources/org/Merriweather-TextItalic.woff2"</span>&gt;
&lt;<span class="org-function-name">link</span> <span class="org-variable-name">rel</span>=<span class="org-string">"preload"</span> <span class="org-variable-name">as</span>=<span class="org-string">"font"</span> <span class="org-variable-name">crossorigin</span>=<span class="org-string">"anonymous"</span> <span class="org-variable-name">type</span>=<span class="org-string">"font/woff2"</span> <span class="org-variable-name">href</span>=<span class="org-string">"https://tecosaur.com/resources/org/Merriweather-TextBold.woff2"</span>&gt;
</pre>
</div>
    </details>

<details id='custom-css-js,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#custom-css-js,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> org-html-style-plain <span class="org-variable-name">org-html-style-default</span>
      <span class="org-variable-name">org-html-htmlize-output-type</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">css</span>
      <span class="org-variable-name">org-html-doctype</span> <span class="org-string">"html5"</span>
      <span class="org-variable-name">org-html-html5-fancy</span> t<span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-html-reload-fancy-style</span> <span class="org-rainbow-delimiters-depth-2">()</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">interactive</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> org-html-style-fancy
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">concat</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">f-read-text</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">expand-file-name</span> <span class="org-string">"misc/org-export-header.html"</span> <span class="org-variable-name">doom-private-dir</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                <span class="org-string">"&lt;script&gt;\n"</span>
                <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">f-read-text</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">expand-file-name</span> <span class="org-string">"misc/org-css/main.js"</span> <span class="org-variable-name">doom-private-dir</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                <span class="org-string">"&lt;/script&gt;\n&lt;style&gt;\n"</span>
                <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">f-read-text</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">expand-file-name</span> <span class="org-string">"misc/org-css/main.css"</span> <span class="org-variable-name">doom-private-dir</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                <span class="org-string">"&lt;/style&gt;"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-variable-name">org-fancy-html-export-mode</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-html-style-default</span> org-html-style-fancy<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-html-reload-fancy-style</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-collapsable-src-example" class="outline-6">
<h6 id="collapsable-src-example"><span class="section-number-6">6.3.3.4.3</span> Collapsable src and example blocks<a aria-hidden="true" href="#collapsable-src-example">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-4-3">
<p>
By wrapping the <code>&lt;pre&gt;</code> element in a <code>&lt;details&gt;</code> block, we can obtain collapsable
blocks with no <span class='acr'>CSS</span>, though we will toss a little in anyway to have this looking
somewhat spiffy.
</p>

<p>
Since this collapsability seems useful to have on by default for certain chunks
of code, it would be nice if you could set it with <kbd>#+attr_html: :collapsed t</kbd>.
</p>

<p>
It would be nice to also have a corresponding global / session-local way of
setting this, but I haven&rsquo;t quite been able to get that working (yet).
</p>

<details id='collapsable-src-example,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#collapsable-src-example,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">org-html-export-collapsed</span> nil<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">eval</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>cl-pushnew <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:collapsed</span> <span class="org-string">"COLLAPSED"</span> <span class="org-string">"collapsed"</span> <span class="org-variable-name">org-html-export-collapsed</span> t<span class="org-rainbow-delimiters-depth-3">)</span>
                   <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-export-backend-options</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-export-get-backend</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">html</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">org-default-properties</span> <span class="org-string">"EXPORT_COLLAPSED"</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
We can take our src block modification a step further, and add a gutter on the
side of the src block containing both an anchor referencing the current block,
and a button to copy the content of the block.
</p>

<details id='src-blocks' class='code' open><summary class='named'><span class='name'>Src blocks</span><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#src-blocks'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defadvice!</span> org-html-src-block-collapsable <span class="org-rainbow-delimiters-depth-2">(</span>orig-fn src-block contents info<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Wrap the usual &lt;pre&gt; block in a &lt;details&gt;"</span>
  <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-html-src-block</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">not</span> <span class="org-variable-name">org-fancy-html-export-mode</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">bound-and-true-p</span> +org-msg-currently-exporting<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">funcall</span> orig-fn src-block contents info<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>properties <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">cadr</span> src-block<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>lang <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">mode-name-to-lang-name</span>
                  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> properties <span class="org-builtin">:language</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>name <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> properties <span class="org-builtin">:name</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>ref <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-export-get-reference</span> src-block info<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>collapsed-p <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">member</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-export-read-attribute</span> <span class="org-builtin">:attr_html</span> src-block <span class="org-builtin">:collapsed</span><span class="org-rainbow-delimiters-depth-2">)</span>
                                    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:collapsed</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                                <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"y"</span> <span class="org-string">"yes"</span> <span class="org-string">"t"</span> t <span class="org-string">"true"</span> <span class="org-string">"all"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span>
       <span class="org-string">"&lt;details id='%s' class='code'%s&gt;&lt;summary%s&gt;%s&lt;/summary&gt;</span>
<span class="org-string">&lt;div class='gutter'&gt;</span>
<span class="org-string">&lt;a href='#%s'&gt;#&lt;/a&gt;</span>
<span class="org-string">&lt;button title='Copy to clipboard' onclick='copyPreToClipbord(this)'&gt;&#9112;&lt;/button&gt;\</span>
<span class="org-string">&lt;/div&gt;</span>
<span class="org-string">%s</span>
<span class="org-string">&lt;/details&gt;"</span>
       ref
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> collapsed-p <span class="org-string">""</span> <span class="org-string">" open"</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> name <span class="org-string">" class='named'"</span> <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">not</span> name<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">concat</span> <span class="org-string">"&lt;span class='lang'&gt;"</span> lang <span class="org-string">"&lt;/span&gt;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-string">"&lt;span class='name'&gt;%s&lt;/span&gt;&lt;span class='lang'&gt;%s&lt;/span&gt;"</span> name lang<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
       ref
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> name
           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">replace-regexp-in-string</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"&lt;pre</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string"> class=\"[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">\"]+\"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">? id=\"%s\"&gt;"</span> ref<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-string">"&lt;pre\\1&gt;"</span>
                                     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">funcall</span> orig-fn src-block contents info<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">funcall</span> orig-fn src-block contents info<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">mode-name-to-lang-name</span> <span class="org-rainbow-delimiters-depth-2">(</span>mode<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">cadr</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">assoc</span> mode
                   <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"asymptote"</span> <span class="org-string">"Asymptote"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"awk"</span> <span class="org-string">"Awk"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"C"</span> <span class="org-string">"C"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"clojure"</span> <span class="org-string">"Clojure"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"css"</span> <span class="org-string">"CSS"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"D"</span> <span class="org-string">"D"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"ditaa"</span> <span class="org-string">"ditaa"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"dot"</span> <span class="org-string">"Graphviz"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"calc"</span> <span class="org-string">"Emacs Calc"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"emacs-lisp"</span> <span class="org-string">"Emacs Lisp"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"fortran"</span> <span class="org-string">"Fortran"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"gnuplot"</span> <span class="org-string">"gnuplot"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"haskell"</span> <span class="org-string">"Haskell"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"hledger"</span> <span class="org-string">"hledger"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"java"</span> <span class="org-string">"Java"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"js"</span> <span class="org-string">"Javascript"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"latex"</span> <span class="org-string">"LaTeX"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"ledger"</span> <span class="org-string">"Ledger"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"lisp"</span> <span class="org-string">"Lisp"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"lilypond"</span> <span class="org-string">"Lilypond"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"lua"</span> <span class="org-string">"Lua"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"matlab"</span> <span class="org-string">"MATLAB"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"mscgen"</span> <span class="org-string">"Mscgen"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"ocaml"</span> <span class="org-string">"Objective Caml"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"octave"</span> <span class="org-string">"Octave"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"org"</span> <span class="org-string">"Org mode"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"oz"</span> <span class="org-string">"OZ"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"plantuml"</span> <span class="org-string">"Plantuml"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"processing"</span> <span class="org-string">"Processing.js"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"python"</span> <span class="org-string">"Python"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"R"</span> <span class="org-string">"R"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"ruby"</span> <span class="org-string">"Ruby"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"sass"</span> <span class="org-string">"Sass"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"scheme"</span> <span class="org-string">"Scheme"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"screen"</span> <span class="org-string">"Gnu Screen"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"sed"</span> <span class="org-string">"Sed"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"sh"</span> <span class="org-string">"shell"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"sql"</span> <span class="org-string">"SQL"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"sqlite"</span> <span class="org-string">"SQLite"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"forth"</span> <span class="org-string">"Forth"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"io"</span> <span class="org-string">"IO"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"J"</span> <span class="org-string">"J"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"makefile"</span> <span class="org-string">"Makefile"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"maxima"</span> <span class="org-string">"Maxima"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"perl"</span> <span class="org-string">"Perl"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"picolisp"</span> <span class="org-string">"Pico Lisp"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"scala"</span> <span class="org-string">"Scala"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"shell"</span> <span class="org-string">"Shell Script"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"ebnf2ps"</span> <span class="org-string">"ebfn2ps"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"cpp"</span> <span class="org-string">"C++"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"abc"</span> <span class="org-string">"ABC"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"coq"</span> <span class="org-string">"Coq"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"groovy"</span> <span class="org-string">"Groovy"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"bash"</span> <span class="org-string">"bash"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"csh"</span> <span class="org-string">"csh"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"ash"</span> <span class="org-string">"ash"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"dash"</span> <span class="org-string">"dash"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"ksh"</span> <span class="org-string">"ksh"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"mksh"</span> <span class="org-string">"mksh"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"posh"</span> <span class="org-string">"posh"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"ada"</span> <span class="org-string">"Ada"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"asm"</span> <span class="org-string">"Assembler"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"caml"</span> <span class="org-string">"Caml"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"delphi"</span> <span class="org-string">"Delphi"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"html"</span> <span class="org-string">"HTML"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"idl"</span> <span class="org-string">"IDL"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"mercury"</span> <span class="org-string">"Mercury"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"metapost"</span> <span class="org-string">"MetaPost"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"modula-2"</span> <span class="org-string">"Modula-2"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"pascal"</span> <span class="org-string">"Pascal"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"ps"</span> <span class="org-string">"PostScript"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"prolog"</span> <span class="org-string">"Prolog"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"simula"</span> <span class="org-string">"Simula"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"tcl"</span> <span class="org-string">"tcl"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"tex"</span> <span class="org-string">"LaTeX"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"plain-tex"</span> <span class="org-string">"TeX"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"verilog"</span> <span class="org-string">"Verilog"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"vhdl"</span> <span class="org-string">"VHDL"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"xml"</span> <span class="org-string">"XML"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"nxml"</span> <span class="org-string">"XML"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"conf"</span> <span class="org-string">"Configuration File"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
      mode<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<details id='example-fixed-width' class='code' open><summary class='named'><span class='name'>Example, fixed width, and property blocks</span><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#example-fixed-width'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-html-block-collapsable</span> <span class="org-rainbow-delimiters-depth-2">(</span>orig-fn block contents info<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Wrap the usual block in a &lt;details&gt;"</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">not</span> <span class="org-variable-name">org-fancy-html-export-mode</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">bound-and-true-p</span> +org-msg-currently-exporting<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">funcall</span> orig-fn block contents info<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>ref <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-export-get-reference</span> block info<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span>type <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">pcase</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">car</span> block<span class="org-rainbow-delimiters-depth-1">)</span>
                  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">property-drawer</span> <span class="org-string">"Properties"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span>collapsed-default <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">pcase</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">car</span> block<span class="org-rainbow-delimiters-depth-1">)</span>
                               <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">property-drawer</span> t<span class="org-rainbow-delimiters-depth-1">)</span>
                               <span class="org-rainbow-delimiters-depth-1">(</span>_ nil<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span>collapsed-value <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-export-read-attribute</span> <span class="org-builtin">:attr_html</span> block <span class="org-builtin">:collapsed</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span>collapsed-p <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">member</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-export-read-attribute</span> <span class="org-builtin">:attr_html</span> block <span class="org-builtin">:collapsed</span><span class="org-rainbow-delimiters-depth-2">)</span>
                                   <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"y"</span> <span class="org-string">"yes"</span> <span class="org-string">"t"</span> t <span class="org-string">"true"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                           <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">member</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:collapsed</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"all"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span>
       <span class="org-string">"&lt;details id='%s' class='code'%s&gt;</span>
<span class="org-string">&lt;summary%s&gt;%s&lt;/summary&gt;</span>
<span class="org-string">&lt;div class='gutter'&gt;\</span>
<span class="org-string">&lt;a href='#%s'&gt;#&lt;/a&gt;</span>
<span class="org-string">&lt;button title='Copy to clipboard' onclick='copyPreToClipbord(this)'&gt;&#9112;&lt;/button&gt;\</span>
<span class="org-string">&lt;/div&gt;</span>
<span class="org-string">%s\n</span>
<span class="org-string">&lt;/details&gt;"</span>
       ref
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> collapsed-p collapsed-default<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-string">""</span> <span class="org-string">" open"</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> type <span class="org-string">" class='named'"</span> <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> type <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-string">"&lt;span class='type'&gt;%s&lt;/span&gt;"</span> type<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-2">)</span>
       ref
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">funcall</span> orig-fn block contents info<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">advice-add</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">org-html-example-block</span>   <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-html-block-collapsable</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">advice-add</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">org-html-fixed-width</span>     <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-html-block-collapsable</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">advice-add</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">org-html-property-drawer</span> <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-html-block-collapsable</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-include-extra-font" class="outline-6">
<h6 id="include-extra-font"><span class="section-number-6">6.3.3.4.4</span> Include extra font-locking in htmlize<a aria-hidden="true" href="#include-extra-font">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-4-4">
<p>
Org uses <a href="https://github.com/hniksic/emacs-htmlize">htmlize.el</a> to export buffers with syntax highlighting.
</p>

<p>
The works fantastically, for the most part. Minor modes that provide
font-locking are <i>not</i> loaded, and so do not impact the result.
</p>

<p>
By enabling these modes in <code>htmlize-before-hook</code> we can correct this behaviour.
</p>

<details id='include-extra-font,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#include-extra-font,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">htmlize-before-hook</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">highlight-numbers--turn-on</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-handle-table-overflow" class="outline-6">
<h6 id="handle-table-overflow"><span class="section-number-6">6.3.3.4.5</span> Handle table overflow<a aria-hidden="true" href="#handle-table-overflow">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-4-5">
<p>
In order to accommodate wide tables &#x2014;particularly on mobile devices&#x2014; we want
to set a maximum width and scroll overflow. Unfortunately, this cannot be applied
directly to the <code>table</code> element, so we have to wrap it in a <code>div</code>.
</p>

<p>
While we&rsquo;re at it, we can a link gutter, as we did with src blocks, and show the
<code>#+name</code>, if one is given.
</p>

<details id='handle-table-overflow,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#handle-table-overflow,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defadvice!</span> org-html-table-wrapped <span class="org-rainbow-delimiters-depth-2">(</span>orig-fn table contents info<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Wrap the usual &lt;table&gt; in a &lt;div&gt;"</span>
  <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-html-table</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">not</span> <span class="org-variable-name">org-fancy-html-export-mode</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">bound-and-true-p</span> +org-msg-currently-exporting<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">funcall</span> orig-fn table contents info<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>name <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">cadr</span> table<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-builtin">:name</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>ref <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-export-get-reference</span> table info<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"&lt;div id='%s' class='table'&gt;</span>
<span class="org-string">&lt;div class='gutter'&gt;&lt;a href='#%s'&gt;#&lt;/a&gt;&lt;/div&gt;</span>
<span class="org-string">&lt;div class='tabular'&gt;</span>
<span class="org-string">%s</span>
<span class="org-string">&lt;/div&gt;\</span>
<span class="org-string">&lt;/div&gt;"</span>
              ref ref
              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> name
                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">replace-regexp-in-string</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"&lt;table id=\"%s\""</span> ref<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-string">"&lt;table"</span>
                                            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">funcall</span> orig-fn table contents info<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">funcall</span> orig-fn table contents info<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-toc-as-collapsable" class="outline-6">
<h6 id="toc-as-collapsable"><span class="section-number-6">6.3.3.4.6</span> <span class='acr'>TOC</span> as a collapsable tree<a aria-hidden="true" href="#toc-as-collapsable">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-4-6">
<p>
The <span class='acr'>TOC</span> is much nicer to navigate as a collapsable tree. Unfortunately we cannot
achieve this with <span class='acr'>CSS</span> alone. Thankfully we can avoid <span class='acr'>JS</span> though, by adapting the
<span class='acr'>TOC</span> generation code to use a <code>label</code> for each item, and a hidden <code>checkbox</code> to keep
track of state.
</p>

<p>
To add this, we need to change one line in <a href="file:///home/runner/.emacs.d/.local/straight/repos/org-mode/lisp/ox-html.el#MissingReference">org-html&#x2013;format-toc-headline</a>.
</p>

<p>
Since we can actually accomplish the desired effect by adding advice <i>around</i> the
function, without overriding it &#x2014; let&rsquo;s do that to reduce the bug surface of
this config a tad.
</p>
<details id='toc-as-collapsable,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#toc-as-collapsable,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defadvice!</span> org-html--format-toc-headline-colapseable <span class="org-rainbow-delimiters-depth-2">(</span>orig-fn headline info<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Add a label and checkbox to `</span><span class="org-doc"><span class="org-constant">org-html--format-toc-headline</span></span><span class="org-doc">'s usual output,</span>
<span class="org-doc">to allow the TOC to be a collapseable tree."</span>
  <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-html--format-toc-headline</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">not</span> <span class="org-variable-name">org-fancy-html-export-mode</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">bound-and-true-p</span> +org-msg-currently-exporting<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">funcall</span> orig-fn headline info<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>id <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-element-property</span> <span class="org-builtin">:CUSTOM_ID</span> headline<span class="org-rainbow-delimiters-depth-1">)</span>
                  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-export-get-reference</span> headline info<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"&lt;input type='checkbox' id='toc--%s'/&gt;&lt;label for='toc--%s'&gt;%s&lt;/label&gt;"</span>
              id id <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">funcall</span> orig-fn headline info<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Now, leaves (headings with no children) shouldn&rsquo;t have the <code>label</code> item. The
obvious way to achieve this is by including some <i>if no children&#x2026;</i> logic in
<code>org-html--format-toc-headline-colapseable</code>. Unfortunately, I can&rsquo;t my elisp isn&rsquo;t
up to par to extract the number of child headings from the mountain of info that
org provides.
</p>
<details id='toc-as-collapsable,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#toc-as-collapsable,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defadvice!</span> org-html--toc-text-stripped-leaves <span class="org-rainbow-delimiters-depth-2">(</span>orig-fn toc-entries<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Remove label"</span>
  <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-html--toc-text</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">not</span> <span class="org-variable-name">org-fancy-html-export-mode</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">bound-and-true-p</span> +org-msg-currently-exporting<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">funcall</span> orig-fn toc-entries<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">replace-regexp-in-string</span> <span class="org-string">"&lt;input [</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">&gt;]+&gt;&lt;label [</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">&gt;]+&gt;</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.+?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">&lt;/label&gt;&lt;/li&gt;"</span> <span class="org-string">"\\1&lt;/li&gt;"</span>
                              <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">funcall</span> orig-fn toc-entries<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-make-verbatim-different" class="outline-6">
<h6 id="make-verbatim-different"><span class="section-number-6">6.3.3.4.7</span> Make verbatim different to code<a aria-hidden="true" href="#make-verbatim-different">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-4-7">
<p>
Since we have <kbd>verbatim</kbd> and <code>code</code>, let&rsquo;s make use of the difference.
</p>

<p>
We can use <code>code</code> exclusively for code snippets and commands like: &ldquo;calling <code>(message
"Hello")</code> in batch-mode Emacs prints to stdout like <code>echo</code>&rdquo;.
Then we can use <kbd>verbatim</kbd> for miscellaneous &rsquo;other monospace&rsquo; like keyboard
shortcuts: &ldquo;either <kbd>C-c C-c</kbd> or <kbd>C-g</kbd> is likely the most useful keybinding in Emacs&rdquo;,
or file names: &ldquo;I keep my configuration in <kbd>~/.config/doom/</kbd>&rdquo;, among other things.
</p>

<p>
Then, styling these two cases differently can help improve clarity in a document.
</p>

<details id='make-verbatim-different,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#make-verbatim-different,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-html-text-markup-alist</span>
      <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">bold</span> . <span class="org-string">"&lt;b&gt;%s&lt;/b&gt;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>code . <span class="org-string">"&lt;code&gt;%s&lt;/code&gt;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>italic . <span class="org-string">"&lt;i&gt;%s&lt;/i&gt;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>strike-through . <span class="org-string">"&lt;del&gt;%s&lt;/del&gt;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>underline . <span class="org-string">"&lt;span class=\"underline\"&gt;%s&lt;/span&gt;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>verbatim . <span class="org-string">"&lt;kbd&gt;%s&lt;/kbd&gt;"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-change-checkbox-type" class="outline-6">
<h6 id="change-checkbox-type"><span class="section-number-6">6.3.3.4.8</span> Change checkbox type<a aria-hidden="true" href="#change-checkbox-type">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-4-8">
<p>
We also want to use <span class='acr'>HTML</span> checkboxes, however we want to get a bit fancier than default
</p>
<details id='change-checkbox-type,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#change-checkbox-type,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">appendq!</span> <span class="org-variable-name">org-html-checkbox-types</span>
          <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">html-span</span>
             <span class="org-rainbow-delimiters-depth-1">(</span>on . <span class="org-string">"&lt;span class='checkbox'&gt;&lt;/span&gt;"</span><span class="org-rainbow-delimiters-depth-1">)</span>
             <span class="org-rainbow-delimiters-depth-1">(</span>off . <span class="org-string">"&lt;span class='checkbox'&gt;&lt;/span&gt;"</span><span class="org-rainbow-delimiters-depth-1">)</span>
             <span class="org-rainbow-delimiters-depth-1">(</span>trans . <span class="org-string">"&lt;span class='checkbox'&gt;&lt;/span&gt;"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-html-checkbox-type</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">html-span</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<ul class="org-ul">
<li class="off"><span class='checkbox'></span> I&rsquo;m yet to do this</li>
<li class="trans"><span class='checkbox'></span> Work in progress</li>
<li class="on"><span class='checkbox'></span> This is done</li>
</ul>
</div>
</div>
<div id="outline-container-header-anchors" class="outline-6">
<h6 id="header-anchors"><span class="section-number-6">6.3.3.4.9</span> Header anchors<a aria-hidden="true" href="#header-anchors">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-4-9">
<p>
I want to add GitHub-style links on hover for headings.
</p>
<details id='header-anchors,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#header-anchors,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-export-html-headline-anchor</span> <span class="org-rainbow-delimiters-depth-2">(</span>text backend info<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-export-derived-backend-p</span> backend <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">html</span><span class="org-rainbow-delimiters-depth-1">)</span>
             <span class="org-variable-name">org-fancy-html-export-mode</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">bound-and-true-p</span> +org-msg-currently-exporting<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">replace-regexp-in-string</span>
       <span class="org-string">"&lt;h</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[0-9]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"> id=\"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[a-z0-9-]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\"&gt;</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.*[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string"> ]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">&lt;\\/h[0-9]&gt;"</span> <span class="org-comment-delimiter">; </span><span class="org-comment">this is quite restrictive, but due to `</span><span class="org-comment"><span class="org-constant">org-reference-contraction</span></span><span class="org-comment">' I can do this</span>
       <span class="org-string">"&lt;h\\1 id=\"\\2\"&gt;\\3&lt;a aria-hidden=\"true\" href=\"#\\2\"&gt;#&lt;/a&gt; &lt;/h\\1&gt;"</span>
       text<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">org-export-filter-headline-functions</span>
             <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">org-export-html-headline-anchor</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
It&rsquo;s worth noting that <code>+org-msg-currently-exporting</code> is defined in <a href="#org-msg">Org Msg</a>.
</p>
</div>
</div>
<div id="outline-container-acronyms" class="outline-6">
<h6 id="acronyms"><span class="section-number-6">6.3.3.4.10</span> Acronyms<a aria-hidden="true" href="#acronyms">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-4-10">
<p>
I want to style acronyms nicely. For the sake of convenience in implementation
I&rsquo;ve actually done this under the <a href="#org-latex-acronyms">LaTeX export section</a>, for the sake of
convenance in implementation (this transformation was first added there).
</p>
</div>
</div>
<div id="outline-container-latex-rendering" class="outline-6">
<h6 id="latex-rendering"><span class="section-number-6">6.3.3.4.11</span> LaTeX Rendering<a aria-hidden="true" href="#latex-rendering">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-4-11">
</div>
<ol class="org-ol">
<li><a id="pre-rendered"></a>Pre-rendered<br>
<div class="outline-text-7" id="text-6-3-3-4-11-1">
<p>
I consider <code>dvisvgm</code> to be a rather compelling option. However this isn&rsquo;t scaled
very well at the moment.
</p>
<details id='pre-rendered,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#pre-rendered,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">(setq-default org-html-with-latex `dvisvgm)</span>
</pre>
</div>
    </details>
</div>
</li>

<li><a id="mathjax"></a>MathJax<br>
<div class="outline-text-7" id="text-6-3-3-4-11-2">
<p>
If MathJax is used, we want to use version 3 instead of the default version 2.
Looking at a <a href="https://www.intmath.com/cg5/katex-mathjax-comparison.php">comparison</a> we seem to find that it is ~5 times as fast, uses a
single file instead of multiple, but seems to be a bit bigger unfortunately.
Thankfully this can be mitigated my adding the <code>async</code> attribute to defer loading.
</p>

<details id='mathjax,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#mathjax,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-html-mathjax-options</span>
      <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>path <span class="org-string">"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"</span> <span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>scale <span class="org-string">"1"</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>autonumber <span class="org-string">"ams"</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>multlinewidth <span class="org-string">"85%"</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>tagindent <span class="org-string">".8em"</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>tagside <span class="org-string">"right"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-html-mathjax-template</span>
      <span class="org-string">"&lt;script&gt;</span>
<span class="org-string">MathJax = {</span>
<span class="org-string">  chtml: {</span>
<span class="org-string">    scale: %SCALE</span>
<span class="org-string">  },</span>
<span class="org-string">  svg: {</span>
<span class="org-string">    scale: %SCALE,</span>
<span class="org-string">    fontCache: \"global\"</span>
<span class="org-string">  },</span>
<span class="org-string">  tex: {</span>
<span class="org-string">    tags: \"%AUTONUMBER\",</span>
<span class="org-string">    multlineWidth: \"%MULTLINEWIDTH\",</span>
<span class="org-string">    tagSide: \"%TAGSIDE\",</span>
<span class="org-string">    tagIndent: \"%TAGINDENT\"</span>
<span class="org-string">  }</span>
<span class="org-string">};</span>
<span class="org-string">&lt;/script&gt;</span>
<span class="org-string">&lt;script id=\"MathJax-script\" async</span>
<span class="org-string">        src=\"%PATH\"&gt;&lt;/script&gt;"</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-exporting-latex" class="outline-5">
<h5 id="exporting-latex"><span class="section-number-5">6.3.3.5</span> Exporting to LaTeX<a aria-hidden="true" href="#exporting-latex">#</a> </h5>
<div class="outline-text-5" id="text-6-3-3-5">
</div>
<div id="outline-container-compiling" class="outline-6">
<h6 id="compiling"><span class="section-number-6">6.3.3.5.1</span> Compiling<a aria-hidden="true" href="#compiling">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-5-1">
<p>
By default Org uses <code>pdflatex</code> &times; 3 + <code>bibtex</code>. This simply won&rsquo;t do in our
modern world. <code>latexmk</code> + <code>biber</code> (which is used automatically with <code>latexmk</code>) is a
simply superior combination.
</p>

<details id='compiling,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#compiling,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">org-latex-compilers = ("pdflatex" "xelatex" "lualatex"), which are the possible values for %latex</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-latex-pdf-process</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"latexmk -%latex -shell-escape -interaction=nonstopmode -f -pdf -output-directory=%o %f"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
While <code>org-latex-pdf-process</code> does support a function, and we could use that
instead, this would no longer use the log buffer &#x2014; it&rsquo;s a bit blind, you give
it the file name and expect it to do its thing.
</p>

<p>
The default values of <code>org-latex-compilers</code> is given in commented form to see how
<code>org-latex-pdf-process</code> works with them.
</p>

<p>
While the <code>-%latex</code> above is slightly hacky (<code>-pdflatex</code> expects to be given a
value) it allows us to leave <code>org-latex-compilers</code> unmodified.
This is nice in case I open an org file that uses <kbd>#+LATEX_COMPILER</kbd> for example,
it should still work.
</p>
</div>
</div>

<div id="outline-container-org-latex-acronyms" class="outline-6">
<h6 id="org-latex-acronyms"><span class="section-number-6">6.3.3.5.2</span> Acronyms<a aria-hidden="true" href="#org-latex-acronyms">#</a> </h6>
<div class="outline-text-6" id="text-org-latex-acronyms">
<p>
I like automatically using spaced small caps for acronyms. For strings I want to
be unaffected let&rsquo;s use <code>;</code> as a prefix to prevent the transformation &#x2014; i.e.
<code>;JFK</code> (as one would want for two-letter geographic locations and names).
</p>

<p>
While this is the LaTeX section, it&rsquo;s convenient to also provide <span class='acr'>HTML</span> acronyms here.
</p>
<details id='acronyms,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#acronyms,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">tec/org-export-latex-filter-acronym</span> <span class="org-rainbow-delimiters-depth-2">(</span>text backend info<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>the-backend
         <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">cond</span>
          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-export-derived-backend-p</span> backend <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">latex</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">latex</span><span class="org-rainbow-delimiters-depth-3">)</span>
          <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-export-derived-backend-p</span> backend <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">html</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">html</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-variable-name">case-fold-search</span> nil<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> the-backend
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">replace-regexp-in-string</span>
       <span class="org-string">"[;\\\\]?\\b[A-Z][A-Z]+s?"</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-3">(</span>all-caps-str<span class="org-rainbow-delimiters-depth-3">)</span>
         <span class="org-comment-delimiter">;; </span><span class="org-comment">only format as acronym if str doesn't start with ";" or "\" (for LaTeX commands)</span>
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">cond</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">equal</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">aref</span> all-caps-str <span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-3">)</span> ?\;<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">substring</span> all-caps-str <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
               <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">equal</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">aref</span> all-caps-str <span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-3">)</span> ?\\<span class="org-rainbow-delimiters-depth-2">)</span> all-caps-str<span class="org-rainbow-delimiters-depth-1">)</span>
               <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">equal</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">aref</span> all-caps-str <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">-</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">length</span> all-caps-str<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span> ?s<span class="org-rainbow-delimiters-depth-2">)</span>
                <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">pcase</span> the-backend
                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">latex</span>
                   <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span> <span class="org-string">"\\textls*[70]{\\textsc{"</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">s-downcase</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">substring</span> all-caps-str <span class="org-highlight-numbers-number">0</span> <span class="org-highlight-numbers-number">-1</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                           <span class="org-string">"}\\protect\\scalebox{.91}[.84]{s}}"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">html</span>
                   <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span> <span class="org-string">"&lt;span class='acr'&gt;"</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">substring</span> all-caps-str <span class="org-highlight-numbers-number">0</span> <span class="org-highlight-numbers-number">-1</span><span class="org-rainbow-delimiters-depth-2">)</span>
                           <span class="org-string">"&lt;/span&gt;&lt;small&gt;s&lt;/small&gt;"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
               <span class="org-rainbow-delimiters-depth-1">(</span>t <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">pcase</span> the-backend
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">latex</span>
                     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span> <span class="org-string">"\\textls*[70]{\\textsc{"</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">s-downcase</span> all-caps-str<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-string">"}}"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">html</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span> <span class="org-string">"&lt;span class='acr'&gt;"</span> all-caps-str <span class="org-string">"&lt;/span&gt;"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
       text t t<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">org-export-filter-plain-text-functions</span>
             <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">tec/org-export-latex-filter-acronym</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-comment-delimiter">;; </span><span class="org-bold"><span class="org-error">FIXME</span></span><span class="org-comment"> I want to process headings, but this causes issues ATM,</span>
<span class="org-comment-delimiter">;;       </span><span class="org-comment">specifically it passes (and formats) the entire section contents</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(add-to-list 'org-export-filter-headline-functions</span>
<span class="org-comment-delimiter">;;              </span><span class="org-comment">'tec/org-export-latex-filter-acronym)</span>
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-nicer-checkboxes" class="outline-6">
<h6 id="nicer-checkboxes"><span class="section-number-6">6.3.3.5.3</span> Nicer checkboxes<a aria-hidden="true" href="#nicer-checkboxes">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-5-3">
<details id='nicer-checkboxes,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#nicer-checkboxes,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+org-export-latex-fancy-item-checkboxes</span> <span class="org-rainbow-delimiters-depth-2">(</span>text backend info<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-export-derived-backend-p</span> backend <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">latex</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">replace-regexp-in-string</span>
     <span class="org-string">"\\\\item\\[{$\\\\</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">\\w+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">$}\\]"</span>
     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-2">(</span>fullmatch<span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">concat</span> <span class="org-string">"\\\\item["</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">pcase</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">substring</span> fullmatch <span class="org-highlight-numbers-number">9</span> <span class="org-highlight-numbers-number">-3</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">content of capture group</span>
                             <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"square"</span>   <span class="org-string">"\\\\ifdefined\\\\checkboxUnchecked\\\\checkboxUnchecked\\\\else$\\\\square$\\\\fi"</span>    <span class="org-rainbow-delimiters-depth-1">)</span>
                             <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"boxminus"</span> <span class="org-string">"\\\\ifdefined\\\\checkboxTransitive\\\\checkboxTransitive\\\\else$\\\\boxminus$\\\\fi"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                             <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"boxtimes"</span> <span class="org-string">"\\\\ifdefined\\\\checkboxChecked\\\\checkboxChecked\\\\else$\\\\boxtimes$\\\\fi"</span>      <span class="org-rainbow-delimiters-depth-1">)</span>
                             <span class="org-rainbow-delimiters-depth-1">(</span>_ <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">substring</span> fullmatch <span class="org-highlight-numbers-number">9</span> <span class="org-highlight-numbers-number">-3</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-string">"]"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     text<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">org-export-filter-item-functions</span>
             <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">+org-export-latex-fancy-item-checkboxes</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-class-templates" class="outline-6">
<h6 id="class-templates"><span class="section-number-6">6.3.3.5.4</span> Class templates<a aria-hidden="true" href="#class-templates">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-5-4">
<p>
We&rsquo;ll be setting up an nice preamble to use in a new default export class.
</p>

<details id='latex-fancy-preamble' class='code' open><summary class='named'><span class='name'>latex-fancy-preamble</span><span class='lang'>LaTeX</span></summary>
    <div class='gutter'>
    <a href='#latex-fancy-preamble'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-LaTeX"><span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">usepackage</span></span>[<span class="org-variable-name">T1</span>]{<span class="org-function-name">fontenc</span>}<span class="org-font-latex-sedate"><span class="org-keyword">\n</span></span>\
<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">usepackage</span></span>[<span class="org-variable-name">osf,largesc,helvratio=0.9</span>]{<span class="org-function-name">newpxtext</span>}<span class="org-font-latex-sedate"><span class="org-keyword">\n</span></span>\
<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">usepackage</span></span>[<span class="org-variable-name">scale=0.9</span>]{<span class="org-function-name">sourcecodepro</span>}<span class="org-font-latex-sedate"><span class="org-keyword">\n</span></span>\
<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">usepackage</span></span>{<span class="org-function-name">bmc-maths</span>}<span class="org-font-latex-sedate"><span class="org-keyword">\n</span></span>\

<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">usepackage</span></span>[<span class="org-variable-name">activate={true,nocompatibility},final,tracking=true,kerning=true,spacing=true,factor=2000</span>]{<span class="org-function-name">microtype</span>}<span class="org-font-latex-sedate"><span class="org-keyword">\n</span></span>\
<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">usepackage</span></span>{<span class="org-function-name">xcolor</span>}<span class="org-font-latex-sedate"><span class="org-keyword">\n</span></span>\
<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">usepackage</span></span>{<span class="org-function-name">booktabs</span>}

<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">usepackage</span></span>{<span class="org-function-name">subcaption</span>}
<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">usepackage</span></span>[<span class="org-variable-name">hypcap=true</span>]{<span class="org-function-name">caption</span>}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">setkomafont</span>{caption}{<span class="org-font-latex-warning">\</span><span class="org-type"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-type"><span class="org-keyword">sffamily</span></span><span class="org-font-latex-warning">\</span><span class="org-type"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-type"><span class="org-keyword">small</span></span>}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">setkomafont</span>{captionlabel}{<span class="org-font-latex-warning">\</span><span class="org-font-latex-bold"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-font-latex-bold"><span class="org-keyword">upshape</span></span><span class="org-font-latex-warning">\</span><span class="org-font-latex-bold"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-font-latex-bold"><span class="org-keyword">bfseries</span></span>}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">captionsetup</span>{justification=raggedright,singlelinecheck=true}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">setcapindent</span>{0pt}

<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">setlength</span></span>{<span class="org-variable-name"><span class="org-font-latex-warning">\</span></span><span class="org-variable-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-variable-name"><span class="org-keyword">parskip</span></span>}{<span class="org-variable-name"><span class="org-font-latex-warning">\</span></span><span class="org-variable-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-variable-name"><span class="org-keyword">baselineskip</span></span>}<span class="org-font-latex-sedate"><span class="org-keyword">\n</span></span>\
<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">setlength</span></span>{<span class="org-variable-name"><span class="org-font-latex-warning">\</span></span><span class="org-variable-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-variable-name"><span class="org-keyword">parindent</span></span>}{<span class="org-variable-name">0pt</span>}<span class="org-font-latex-sedate"><span class="org-keyword">\n</span></span>\

<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">AtBeginEnvironment</span>{quote}{<span class="org-font-latex-warning">\</span><span class="org-font-latex-italic"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-font-latex-italic"><span class="org-keyword">itshape</span></span>}

<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">usepackage</span></span>{<span class="org-function-name">pifont</span>}
<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">newcommand</span></span>{<span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">checkboxUnchecked</span></span>}{<span class="org-function-name"><span class="org-font-latex-math">$\</span></span><span class="org-function-name"><span class="org-font-latex-math"><span class="org-keyword">\square</span></span></span><span class="org-function-name"><span class="org-font-latex-math">$</span></span>}
<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">newcommand</span></span>{<span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">checkboxTransitive</span></span>}{<span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">rlap</span></span><span class="org-function-name">{</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">raisebox</span></span><span class="org-function-name">{-0.1ex}{</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">hspace</span></span><span class="org-function-name">{0.35ex}</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-type"><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span></span><span class="org-type"><span class="org-function-name"><span class="org-keyword">Large</span></span></span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span></span></span><span class="org-keyword"><span class="org-function-name"><span class="org-keyword">textbf</span></span></span><span class="org-function-name"> -}}</span><span class="org-function-name"><span class="org-font-latex-math">$\</span></span><span class="org-function-name"><span class="org-font-latex-math"><span class="org-keyword">\square</span></span></span><span class="org-function-name"><span class="org-font-latex-math">$</span></span>}
<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">newcommand</span></span>{<span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">checkboxChecked</span></span>}{<span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">rlap</span></span><span class="org-function-name">{</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">raisebox</span></span><span class="org-function-name">{0.2ex}{</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">hspace</span></span><span class="org-function-name">{0.35ex}</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-type"><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span></span><span class="org-type"><span class="org-function-name"><span class="org-keyword">scriptsize</span></span></span><span class="org-function-name"> </span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">ding</span></span><span class="org-function-name">{52}}}</span><span class="org-function-name"><span class="org-font-latex-math">$\</span></span><span class="org-function-name"><span class="org-font-latex-math"><span class="org-keyword">\square</span></span></span><span class="org-function-name"><span class="org-font-latex-math">$</span></span>}

<span class="org-comment-delimiter">% </span><span class="org-comment">args = #1 Name, #2 Colour, #3 Ding, #4 Label</span>
<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">newcommand</span></span>{<span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">defsimplebox</span></span>}[<span class="org-variable-name">4</span>]{<span class="org-function-name"><span class="org-comment">%</span></span>
<span class="org-function-name">  </span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">definecolor</span></span><span class="org-function-name">{#1}{HTML}{#2}</span>
<span class="org-function-name">  </span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">newenvironment</span></span><span class="org-function-name">{#1}</span>
<span class="org-function-name">  {</span><span class="org-function-name"><span class="org-comment">%</span></span>
<span class="org-function-name">    </span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">par</span></span><span class="org-function-name"> </span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">vspace</span></span><span class="org-function-name">{-0.7</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">baselineskip</span></span><span class="org-function-name">}</span><span class="org-function-name"><span class="org-comment">%</span></span>
<span class="org-function-name">    </span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">textcolor</span></span><span class="org-function-name">{#1}{#3} </span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">textcolor</span></span><span class="org-function-name">{#1}{</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-keyword"><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span></span><span class="org-keyword"><span class="org-function-name"><span class="org-keyword">textbf</span></span></span><span class="org-function-name">{</span><span class="org-font-latex-bold"><span class="org-function-name">#4</span></span><span class="org-function-name">}}</span><span class="org-function-name"><span class="org-comment">%</span></span>
<span class="org-function-name">    </span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">vspace</span></span><span class="org-function-name">{-0.8</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">baselineskip</span></span><span class="org-function-name">}</span>
<span class="org-function-name">    </span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">begin</span></span><span class="org-function-name">{addmargin}[1em]{1em}</span>
<span class="org-function-name">  }{</span><span class="org-function-name"><span class="org-comment">%</span></span>
<span class="org-function-name">    </span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">end</span></span><span class="org-function-name">{addmargin}</span>
<span class="org-function-name">    </span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">vspace</span></span><span class="org-function-name">{-0.5</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">baselineskip</span></span><span class="org-function-name">}</span>
<span class="org-function-name">  }</span><span class="org-function-name"><span class="org-comment">%</span></span>
}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">defsimplebox</span>{warning}{e66100}{<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">ding</span>{68}}{Warning}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">defsimplebox</span>{info}{3584e4}{<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">ding</span>{68}}{Information}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">defsimplebox</span>{success}{26a269}{<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">ding</span>{68}}{<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">vspace</span></span>{<span class="org-function-name">-</span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-function-name"><span class="org-keyword">baselineskip</span></span>}}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">defsimplebox</span>{error}{c01c28}{<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">ding</span>{68}}{Important}
</pre>
</div>
    </details>

<p>
The <kbd>hyperref</kbd> setup needs to be handled separately however.
</p>
<details id='latex-fancy-hyperref' class='code' open><summary class='named'><span class='name'>latex-fancy-hyperref</span><span class='lang'>LaTeX</span></summary>
    <div class='gutter'>
    <a href='#latex-fancy-hyperref'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-LaTeX"><span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">colorlet</span>{greenyblue}{blue!70!green}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">colorlet</span>{blueygreen}{blue!40!green}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">providecolor</span>{link}{named}{greenyblue}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">providecolor</span>{cite}{named}{blueygreen}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">hypersetup</span>{
  pdfauthor={<span class="org-comment">%a},</span>
  pdftitle={<span class="org-comment">%t},</span>
  pdfkeywords={<span class="org-comment">%k},</span>
  pdfsubject={<span class="org-comment">%d},</span>
  pdfcreator={<span class="org-comment">%c},</span>
  pdflang={<span class="org-comment">%L},</span>
  breaklinks=true,
  colorlinks=true,
  linkcolor=,
  urlcolor=link,
  citecolor=cite<span class="org-font-latex-sedate"><span class="org-keyword">\n</span></span>}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">urlstyle</span>{same}
</pre>
</div>
    </details>

<details id='class-templates,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#class-templates,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> ox-latex
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">org-latex-classes</span>
               <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"fancy-article"</span>
                 <span class="org-string">"\\documentclass{scrartcl}\n</span>
<span class="org-string">&lt;&lt;latex-fancy-preamble&gt;&gt;</span>
<span class="org-string">"</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"\\section{%s}"</span> . <span class="org-string">"\\section*{%s}"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"\\subsection{%s}"</span> . <span class="org-string">"\\subsection*{%s}"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"\\subsubsection{%s}"</span> . <span class="org-string">"\\subsubsection*{%s}"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"\\paragraph{%s}"</span> . <span class="org-string">"\\paragraph*{%s}"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"\\subparagraph{%s}"</span> . <span class="org-string">"\\subparagraph*{%s}"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">org-latex-classes</span>
               <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"blank"</span>
                 <span class="org-string">"[NO-DEFAULT-PACKAGES]</span>
<span class="org-string">               [NO-PACKAGES]</span>
<span class="org-string">               [EXTRA]"</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"\\section{%s}"</span> . <span class="org-string">"\\section*{%s}"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"\\subsection{%s}"</span> . <span class="org-string">"\\subsection*{%s}"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"\\subsubsection{%s}"</span> . <span class="org-string">"\\subsubsection*{%s}"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"\\paragraph{%s}"</span> . <span class="org-string">"\\paragraph*{%s}"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"\\subparagraph{%s}"</span> . <span class="org-string">"\\subparagraph*{%s}"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">org-latex-classes</span>
               <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"bmc-article"</span>
                 <span class="org-string">"\\documentclass[article,code,maths]{bmc}</span>
<span class="org-string">               [NO-DEFAULT-PACKAGES]</span>
<span class="org-string">               [NO-PACKAGES]</span>
<span class="org-string">               [EXTRA]"</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"\\section{%s}"</span> . <span class="org-string">"\\section*{%s}"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"\\subsection{%s}"</span> . <span class="org-string">"\\subsection*{%s}"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"\\subsubsection{%s}"</span> . <span class="org-string">"\\subsubsection*{%s}"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"\\paragraph{%s}"</span> . <span class="org-string">"\\paragraph*{%s}"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"\\subparagraph{%s}"</span> . <span class="org-string">"\\subparagraph*{%s}"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">org-latex-classes</span>
               <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"bmc"</span>
                 <span class="org-string">"\\documentclass[code,maths]{bmc}</span>
<span class="org-string">               [NO-DEFAULT-PACKAGES]</span>
<span class="org-string">               [NO-PACKAGES]</span>
<span class="org-string">               [EXTRA]"</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"\\chapter{%s}"</span> . <span class="org-string">"\\chapter*{%s}"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"\\section{%s}"</span> . <span class="org-string">"\\section*{%s}"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"\\subsection{%s}"</span> . <span class="org-string">"\\subsection*{%s}"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"\\subsubsection{%s}"</span> . <span class="org-string">"\\subsubsection*{%s}"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"\\paragraph{%s}"</span> . <span class="org-string">"\\paragraph*{%s}"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                 <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"\\subparagraph{%s}"</span> . <span class="org-string">"\\subparagraph*{%s}"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-latex-default-class</span> <span class="org-string">"fancy-article"</span>
      <span class="org-variable-name">org-latex-tables-booktabs</span> t
      <span class="org-variable-name">org-latex-hyperref-template</span> <span class="org-string">"</span>
<span class="org-string">&lt;&lt;latex-fancy-hyperref&gt;&gt;</span>
<span class="org-string">"</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-cleverer-preamble" class="outline-6">
<h6 id="cleverer-preamble"><span class="section-number-6">6.3.3.5.5</span> A cleverer preamble<a aria-hidden="true" href="#cleverer-preamble">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-5-5">
<p>
We always want some particular elements in the preamble, let&rsquo;s call this
the &ldquo;universal preamble&rdquo;
</p>
<details id='org-latex-universal' class='code' open><summary class='named'><span class='name'>org-latex-universal-preamble</span><span class='lang'>LaTeX</span></summary>
    <div class='gutter'>
    <a href='#org-latex-universal'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-LaTeX"><span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">usepackage</span></span>[<span class="org-variable-name">main,include</span>]{<span class="org-function-name">embedall</span>}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">IfFileExists</span>{./<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">jobname</span>.org}{<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">embedfile</span>[desc=The original file]{<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">jobname</span>.org}}{}
</pre>
</div>
    </details>

<p>
We could have every package we could possibly need in every one of
<code>org-latex-classes</code>, but that&rsquo;s <i>horribly</i> inefficient and I don&rsquo;t want to think
about maintaining that.
</p>

<p>
Instead, we can have a &ldquo;universal preamble&rdquo; which contains a snippet which we
want to <i>always</i> appear, and then conditional preamble snippets, which are only
included when a certain regex is successfully found in the Org buffer.
</p>

<details id='org-latex-conditional' class='code' open><summary class='named'><span class='name'>org-latex-conditional-preamble</span><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#org-latex-conditional'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">org-latex-universal-preamble</span> <span class="org-string">"</span>
<span class="org-string">&lt;&lt;org-latex-universal-preamble&gt;&gt;</span>
<span class="org-string">"</span>
  <span class="org-doc">"Preamble to be included in every export."</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">org-latex-conditional-preambles</span>
  <span class="org-highlight-quoted-quote">`</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>t . <span class="org-variable-name">org-latex-universal-preamble</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"\\[\\[</span><span class="org-string"><span class="org-constant">file:.*\\.svg\\</span></span><span class="org-string">]\\]"</span> . <span class="org-string">"\\usepackage{svg}"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Snippets which are conditionally included in the preamble of a LaTeX export.</span>

<span class="org-doc">Alist where when the car results in a non-nil value, the cdr is inserted in</span>
<span class="org-doc">the preamble.  The car may be a:</span>
<span class="org-doc">- string, which is used as a regex search in the buffer</span>
<span class="org-doc">- symbol, the value of which used</span>
<span class="org-doc">- function, the result of the function is used</span>

<span class="org-doc">The cdr may be a:</span>
<span class="org-doc">- string, which is inserted without processing</span>
<span class="org-doc">- symbol, the value of which is inserted</span>
<span class="org-doc">- function, the result of which is inserted"</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defadvice!</span> org-latex-header-smart-preamble <span class="org-rainbow-delimiters-depth-2">(</span>orig-fn tpl def-pkg pkg snippets-p <span class="org-type">&amp;optional</span> extra<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Dynamically insert preamble content based on `</span><span class="org-doc"><span class="org-constant">org-latex-conditional-preambles</span></span><span class="org-doc">'."</span>
  <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-splice-latex-header</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>header <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">funcall</span> orig-fn tpl def-pkg pkg snippets-p extra<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> snippets-p header
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span> header
              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">mapconcat</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-1">(</span>term-preamble<span class="org-rainbow-delimiters-depth-1">)</span>
                           <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">pcase</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">car</span> term-preamble<span class="org-rainbow-delimiters-depth-3">)</span>
                                   <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>pred stringp<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">save-excursion</span>
                                                       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">goto-char</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">point-min</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                                                       <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">search-forward-regexp</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">car</span> term-preamble<span class="org-rainbow-delimiters-depth-3">)</span> nil t<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                                   <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>pred functionp<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">funcall</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">car</span> term-preamble<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                                   <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>pred symbolp<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">symbol-value</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">car</span> term-preamble<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                                   <span class="org-rainbow-delimiters-depth-3">(</span>_ <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">user-error</span> <span class="org-string">"org-latex-conditional-preambles key %s unable to be used"</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">car</span> term-preamble<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                             <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">pcase</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">cdr</span> term-preamble<span class="org-rainbow-delimiters-depth-3">)</span>
                               <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>pred stringp<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">cdr</span> term-preamble<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                               <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>pred functionp<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">funcall</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">cdr</span> term-preamble<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                               <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>pred symbolp<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">symbol-value</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">cdr</span> term-preamble<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                               <span class="org-rainbow-delimiters-depth-3">(</span>_ <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">user-error</span> <span class="org-string">"org-latex-conditional-preambles value %s unable to be used"</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">cdr</span> term-preamble<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                         <span class="org-variable-name">org-latex-conditional-preambles</span>
                         <span class="org-string">"\n"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-pretty-code-blocks" class="outline-6">
<h6 id="pretty-code-blocks"><span class="section-number-6">6.3.3.5.6</span> Pretty code blocks<a aria-hidden="true" href="#pretty-code-blocks">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-5-6">
<p>
We could just use minted for syntax highlighting &#x2014; however, we can do better!
The <kbd>engrave-faces</kbd> package lets us use Emacs&rsquo; font-lock for syntax highlighting,
exporting that as LaTeX commands.
</p>

<details id='pretty-code-blocks,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#pretty-code-blocks,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-latex-listings</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">engraved</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-comment-delimiter">; </span><span class="org-bold"><span class="org-success">NOTE</span></span><span class="org-comment"> non-standard value</span>
</pre>
</div>
    </details>

<p>
Thanks to <code>org-latex-conditional-preambles</code> and some copy-paste with the <kbd>minted</kbd>
entry in <code>org-latex-scr-block</code> we can easily add this as a recognised
<code>org-latex-listings</code> value.
</p>

<details id='pretty-code-blocks,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#pretty-code-blocks,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defadvice!</span> org-latex-src-block-engraved <span class="org-rainbow-delimiters-depth-2">(</span>orig-fn src-block contents info<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Like `</span><span class="org-doc"><span class="org-constant">org-latex-src-block</span></span><span class="org-doc">', but supporting an engraved backend"</span>
  <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-latex-src-block</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">eq</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">engraved</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:latex-listings</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-latex-scr-block--engraved</span> src-block contents info<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">funcall</span> orig-fn src-block contents info<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defadvice!</span> org-latex-inline-src-block-engraved <span class="org-rainbow-delimiters-depth-2">(</span>orig-fn inline-src-block contents info<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Like `</span><span class="org-doc"><span class="org-constant">org-latex-inline-src-block</span></span><span class="org-doc">', but supporting an engraved backend"</span>
  <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-latex-inline-src-block</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">eq</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">engraved</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:latex-listings</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-latex-inline-scr-block--engraved</span> inline-src-block contents info<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">funcall</span> orig-fn src-block contents info<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> org-latex-engraved-code-preamble <span class="org-string">"</span>
<span class="org-string">&lt;&lt;org-latex-engraved-code-preamble&gt;&gt;</span>
<span class="org-string">"</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">org-latex-conditional-preambles</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"#\\+BEGIN_SRC</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">#\\+begin_src"</span> . org-latex-engraved-code-preamble<span class="org-rainbow-delimiters-depth-2">)</span> t<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">org-latex-conditional-preambles</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"#\\+BEGIN_SRC</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">#\\+begin_src"</span> . engrave-faces-latex-gen-preamble<span class="org-rainbow-delimiters-depth-2">)</span> t<span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-latex-scr-block--engraved</span> <span class="org-rainbow-delimiters-depth-2">(</span>src-block contents info<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>lang <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-element-property</span> <span class="org-builtin">:language</span> src-block<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>attributes <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-export-read-attribute</span> <span class="org-builtin">:attr_latex</span> src-block<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">float</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> attributes <span class="org-builtin">:float</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>num-start <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-export-get-loc</span> src-block info<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>retain-labels <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-element-property</span> <span class="org-builtin">:retain-labels</span> src-block<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>caption <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-element-property</span> <span class="org-builtin">:caption</span> src-block<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>caption-above-p <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-latex--caption-above-p</span> src-block info<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>caption-str <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-latex--caption/label-string</span> src-block info<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>placement <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-unbracket-string</span> <span class="org-string">"["</span> <span class="org-string">"]"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> attributes <span class="org-builtin">:placement</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:latex-default-figure-position</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>float-env
          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">cond</span>
           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">string=</span> <span class="org-string">"multicolumn"</span> float<span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"\\begin{listing*}[%s]\n%s%%s\n%s\\end{listing*}"</span>
                    placement
                    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> caption-above-p caption-str <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-2">)</span>
                    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> caption-above-p <span class="org-string">""</span> caption-str<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
           <span class="org-rainbow-delimiters-depth-3">(</span>caption
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"\\begin{listing}[%s]\n%s%%s\n%s\\end{listing}"</span>
                    placement
                    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> caption-above-p caption-str <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-2">)</span>
                    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> caption-above-p <span class="org-string">""</span> caption-str<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">string=</span> <span class="org-string">"t"</span> float<span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"\\begin{listing}[%s]\n"</span>
                            placement<span class="org-rainbow-delimiters-depth-2">)</span>
                    <span class="org-string">"%s\n\\end{listing}"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
           <span class="org-rainbow-delimiters-depth-3">(</span>t <span class="org-string">"%s"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>options <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:latex-minted-options</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>content-buffer
          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">with-temp-buffer</span>
            <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">insert</span>
             <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>code-info <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-export-unravel-code</span> src-block<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span>max-width
                     <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">apply</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">max</span>
                            <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">mapcar</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">length</span>
                                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-split-string</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">car</span> code-info<span class="org-rainbow-delimiters-depth-1">)</span>
                                                      <span class="org-string">"\n"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
               <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-export-format-code</span>
                <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">car</span> code-info<span class="org-rainbow-delimiters-depth-3">)</span>
                <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-1">(</span>loc _num ref<span class="org-rainbow-delimiters-depth-1">)</span>
                  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span>
                   loc
                   <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> ref
                     <span class="org-comment-delimiter">;; </span><span class="org-comment">Ensure references are flushed to the right,</span>
                     <span class="org-comment-delimiter">;; </span><span class="org-comment">separated with 6 spaces from the widest line</span>
                     <span class="org-comment-delimiter">;; </span><span class="org-comment">of code.</span>
                     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">concat</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">make-string</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">+</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">-</span> max-width <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">length</span> loc<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-highlight-numbers-number">6</span><span class="org-rainbow-delimiters-depth-2">)</span>
                                          ?\s<span class="org-rainbow-delimiters-depth-1">)</span>
                             <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"(%s)"</span> ref<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                nil <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">and</span> retain-labels <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">cdr</span> code-info<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
            <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">funcall</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-src-get-lang-mode</span> lang<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
            <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">engrave-faces-latex-buffer</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>content
          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">with-current-buffer</span> content-buffer
            <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">buffer-string</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>body
          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span>
           <span class="org-string">"\\begin{Code}\n\\begin{Verbatim}[%s]\n%s\\end{Verbatim}\n\\end{Code}"</span>
           <span class="org-comment-delimiter">;; </span><span class="org-comment">Options.</span>
           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">concat</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-latex--make-option-string</span>
             <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">not</span> num-start<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">assoc</span> <span class="org-string">"linenos"</span> options<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                 options
               <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">append</span>
                <span class="org-highlight-quoted-quote">`</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"linenos"</span><span class="org-rainbow-delimiters-depth-2">)</span>
                  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"firstnumber"</span> ,<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">number-to-string</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">1+</span> num-start<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                options<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>local-options <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-get</span> attributes <span class="org-builtin">:options</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">and</span> local-options <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">concat</span> <span class="org-string">","</span> local-options<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
           content<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">kill-buffer</span> content-buffer<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Return value.</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> float-env body<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-latex-inline-scr-block--engraved</span> <span class="org-rainbow-delimiters-depth-2">(</span>inline-src-block _contents info<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>options <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">org-latex--make-option-string</span>
                  <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:latex-minted-options</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
        code-buffer code<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> code-buffer
          <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">with-temp-buffer</span>
            <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">insert</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-element-property</span> <span class="org-builtin">:value</span> inline-src-block<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
            <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">funcall</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-src-get-lang-mode</span>
                      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-element-property</span> <span class="org-builtin">:language</span> inline-src-block<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
            <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">engrave-faces-latex-buffer</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> code <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">with-current-buffer</span> code-buffer
                 <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">buffer-string</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">kill-buffer</span> code-buffer<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">format</span> <span class="org-string">"\\Verb%s{%s}"</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">string=</span> options <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-string">""</span>
              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"[%s]"</span> options<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
            code<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Whenever this is used, in order for it to actually work (and look a little
better) we add bit to the preamble:
</p>

<details id='org-latex-engraved' class='code' open><summary class='named'><span class='name'>org-latex-engraved-code-preamble</span><span class='lang'>LaTeX</span></summary>
    <div class='gutter'>
    <a href='#org-latex-engraved'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-LaTeX"><span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">usepackage</span></span>{<span class="org-function-name">fvextra</span>}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">fvset</span>{
  commandchars=<span class="org-font-latex-warning">\\\\\\</span>{<span class="org-font-latex-warning">\\</span>},
  highlightcolor=white!95!black!80!blue,
  breaklines=true,
  breaksymbol=<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">color</span>{white!60!black}<span class="org-font-latex-warning">\</span><span class="org-type"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-type"><span class="org-keyword">tiny</span></span><span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">ensuremath</span></span>{<span class="org-font-latex-math"><span class="org-font-latex-warning">\</span></span><span class="org-font-latex-math"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-font-latex-math"><span class="org-keyword">hookrightarrow</span></span>}}
<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span></span><span class="org-keyword"><span class="org-keyword">renewcommand</span></span><span class="org-function-name"><span class="org-font-latex-warning">\</span></span><span class="org-function-name"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword">theFancyVerbLine</span>{<span class="org-font-latex-warning">\</span><span class="org-type"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-type"><span class="org-keyword">footnotesize</span></span><span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">color</span>{black!40!white}<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">arabic</span></span>{<span class="org-variable-name">FancyVerbLine</span>}}

<span class="org-comment-delimiter">% </span><span class="org-comment">TODO have code boxes keep line vertical alignment</span>
<span class="org-font-latex-warning">\</span><span class="org-keyword"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-keyword"><span class="org-keyword">usepackage</span></span>[<span class="org-variable-name">breakable,xparse</span>]{<span class="org-function-name">tcolorbox</span>}
<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">DeclareTColorBox</span>[]{Code}{o}<span class="org-comment">%</span>
{colback=white!97!black, colframe=white!94!black,
  fontupper=<span class="org-font-latex-warning">\</span><span class="org-font-latex-warning"><span class="org-keyword">\</span></span><span class="org-keyword">color</span>{EFD}<span class="org-font-latex-warning">\</span><span class="org-type"><span class="org-font-latex-warning"><span class="org-keyword">\</span></span></span><span class="org-type"><span class="org-keyword">footnotesize</span></span>,
  IfNoValueTF={#1}<span class="org-comment">%</span>
  {boxsep=2pt, arc=2.5pt, outer arc=2.5pt,
    boxrule=0.5pt, left=2pt}<span class="org-comment">%</span>
  {boxsep=2.5pt, arc=0pt, outer arc=0pt,
    boxrule=0pt, leftrule=1.5pt, left=0.5pt},
  right=2pt, top=1pt, bottom=0.5pt,
  breakable}
</pre>
</div>
    </details>

<p>
At some point it would be nice to make the box colours easily customisable. At
the moment it&rsquo;s fairly easy to change the syntax highlighting colours with
<code class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">engrave-faces-preset-styles</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">engrave-faces-generate-preset</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span></code>, but perhaps a toggle which specifies whether
to use the default values, the current theme, or any named theme could be a good
idea. It should also possible to set the box background dynamically to match.
The named theme could work by looking for a style definition with a certain name
in a cache dir, and then switching to that theme and producing (and saving) the
style definition if it doesn&rsquo;t exist.
</p>

<p>
Now let&rsquo;s have the example block be styled similarly.
</p>
<details id='pretty-code-blocks,code--3' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#pretty-code-blocks,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defadvice!</span> org-latex-example-block-engraved <span class="org-rainbow-delimiters-depth-2">(</span>orig-fn example-block contents info<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Like `</span><span class="org-doc"><span class="org-constant">org-latex-example-block</span></span><span class="org-doc">', but supporting an engraved backend"</span>
  <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-latex-example-block</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>output-block <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">funcall</span> orig-fn example-block contents info<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">eq</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">engraved</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:latex-listings</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">format</span> <span class="org-string">"\\begin{Code}[alt]\n%s\n\\end{Code}"</span> output-block<span class="org-rainbow-delimiters-depth-1">)</span>
      output-block<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
In addition to the vastly superior visual output, this should also be much
faster to for code-heavy documents (like this config).
</p>

<p>
Performing a little benchmark with this document, I find that this is indeed the
case.
</p>

<div id='pretty-code-blocks,table--1' class='table'>
    <div class='gutter'><a href='#pretty-code-blocks,table--1'>#</a></div>
    <div class='tabular'>
    <table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">LaTeX syntax highlighting backend</th>
<th scope="col" class="org-left">Compile time</th>
<th scope="col" class="org-left">Overhead</th>
<th scope="col" class="org-right">Overhead ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">verbatim</td>
<td class="org-left">12 s</td>
<td class="org-left">0</td>
<td class="org-right">0.0</td>
</tr>

<tr>
<td class="org-left">lstlistings</td>
<td class="org-left">15 s</td>
<td class="org-left">3 s</td>
<td class="org-right">0.2</td>
</tr>

<tr>
<td class="org-left">Engrave</td>
<td class="org-left">34 s</td>
<td class="org-left">22 s</td>
<td class="org-right">1.8</td>
</tr>

<tr>
<td class="org-left">Pygments (Minted)</td>
<td class="org-left">184 s</td>
<td class="org-left">172 s</td>
<td class="org-right">14.3</td>
</tr>
</tbody>
</table>
    </div>    </div>

<p>
Treating the verbatim (no syntax highlighting) result as a baseline; this
rudimentary test suggest that <kbd>engrave-faces</kbd> is around eight times faster than
<kbd>pygments</kbd>, and takes three times as long as no syntax highlighting (verbatim).
</p>
</div>
</div>

<div id="outline-container-remove-non-ascii" class="outline-6">
<h6 id="remove-non-ascii"><span class="section-number-6">6.3.3.5.7</span> Remove non-ascii chars<a aria-hidden="true" href="#remove-non-ascii">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-5-7">
<p>
When using <code>pdflatex</code>, almost non-ascii characters are generally problematic, and
don&rsquo;t appear in the pdf. It&rsquo;s preferable to see that there was <i>some</i> character
which wasn&rsquo;t displayed as opposed to nothing.
</p>

<p>
So, as a basic first-pass we replace every non-ascii char with <kbd>¿</kbd>. In future I
could add sensible replacements (e.g. turn <kbd>§</kbd> into <kbd>\S</kbd>, and <kbd>…</kbd> with <kbd>\ldots</kbd>).
</p>

<details id='remove-non-ascii,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#remove-non-ascii,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">+org-latex-replace-non-ascii-chars</span> <span class="org-rainbow-delimiters-depth-2">(</span>text backend info<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Replace non-ascii chars with \\char\"XYZ forms."</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-export-derived-backend-p</span> backend <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">latex</span><span class="org-rainbow-delimiters-depth-1">)</span>
             <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">string=</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:latex-compiler</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-string">"pdflatex"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">replace-regexp-in-string</span> <span class="org-string">"[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">[:ascii:]]"</span> <span class="org-string">"&#191;"</span> text<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">org-export-filter-final-output-functions</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">+org-latex-replace-non-ascii-chars</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-support-images-from" class="outline-6">
<h6 id="support-images-from"><span class="section-number-6">6.3.3.5.8</span> Support images from <span class='acr'>URL</span><small>s</small><a aria-hidden="true" href="#support-images-from">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-5-8">
<p>
You can link to remote images easily, and they work nicely with <span class='acr'>HTML</span>-based
exports. However, LaTeX can only include local files, and so the current
behaviour of <kbd>org-latex-link</kbd> is just to insert a <span class='acr'>URL</span> to the image.
</p>

<p>
We can do better than that by downloading the image to a predictable location,
and using that. By making the filename predictable as opposed to just another
tempfile, this can provide a caching mechanism.
</p>

<details id='support-images-from,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#support-images-from,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defadvice!</span> +org-latex-link <span class="org-rainbow-delimiters-depth-2">(</span>orig-fn link desc info<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Acts as `</span><span class="org-doc"><span class="org-constant">org-latex-link</span></span><span class="org-doc">', but supports remote images."</span>
  <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-latex-link</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> o-link link
        o-desc desc
        o-info info<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">member</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">cadr</span> link<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-builtin">:type</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"http"</span> <span class="org-string">"https"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
           <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">member</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">file-name-extension</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">cadr</span> link<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-builtin">:path</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                   <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"png"</span> <span class="org-string">"jpg"</span> <span class="org-string">"jpeg"</span> <span class="org-string">"pdf"</span> <span class="org-string">"svg"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">org-latex-link--remote</span> link desc info<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">funcall</span> orig-fn link desc info<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-latex-link--remote</span> <span class="org-rainbow-delimiters-depth-2">(</span>link _desc info<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span>url <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-get</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">cadr</span> link<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-builtin">:raw-link</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>ext <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">file-name-extension</span> url<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span>target <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">format</span> <span class="org-string">"%s%s.%s"</span>
                         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-variable-name">temporary-file-directory</span><span class="org-rainbow-delimiters-depth-3">)</span>
                         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">replace-regexp-in-string</span> <span class="org-string">"[./]"</span> <span class="org-string">"-"</span>
                                                   <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">file-name-sans-extension</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">substring</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">cadr</span> link<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-builtin">:path</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-highlight-numbers-number">2</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                         ext<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">file-exists-p</span> target<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">url-copy-file</span> url target<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">setcdr</span> link <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">--&gt;</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">cadr</span> link<span class="org-rainbow-delimiters-depth-2">)</span>
                   <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-put</span> it <span class="org-builtin">:type</span> <span class="org-string">"file"</span><span class="org-rainbow-delimiters-depth-2">)</span>
                   <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-put</span> it <span class="org-builtin">:path</span> target<span class="org-rainbow-delimiters-depth-2">)</span>
                   <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-put</span> it <span class="org-builtin">:raw-link</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">concat</span> <span class="org-string">"file:"</span> target<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                   <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">list</span> it<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">concat</span> <span class="org-string">"% fetched from "</span> url <span class="org-string">"\n"</span>
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">org-latex--inline-image</span> link info<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-chameleon-aka-match" class="outline-6">
<h6 id="chameleon-aka-match"><span class="section-number-6">6.3.3.5.9</span> Chameleon &#x2014; aka. match theme<a aria-hidden="true" href="#chameleon-aka-match">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-5-9">
<p>
Once the idea of having the look of the LaTeX document produced match the
current Emacs theme, I was enraptured. The result is the pseudo-class <code>chameleon</code>.
</p>
<details id='chameleon-aka-match,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#chameleon-aka-match,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> ox
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">ox-chameleon-base-class</span> <span class="org-string">"fancy-article"</span>
    <span class="org-doc">"The base class that chameleon builds on"</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">ox-chameleon--p</span> nil
    <span class="org-doc">"Used to indicate whether the current export is trying to blend in. Set just before being accessed."</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-comment-delimiter">;; </span><span class="org-comment">(setf (alist-get :filter-latex-class</span>
  <span class="org-comment-delimiter">;;                  </span><span class="org-comment">(org-export-backend-filters</span>
  <span class="org-comment-delimiter">;;                   </span><span class="org-comment">(org-export-get-backend 'latex)))</span>
  <span class="org-comment-delimiter">;;       </span><span class="org-comment">'ox-chameleon-latex-class-detector-filter)</span>

  <span class="org-comment-delimiter">;; </span><span class="org-comment">(defun ox-chameleon-latex-class-detector-filter (info backend)</span>
  <span class="org-comment-delimiter">;;   </span><span class="org-comment">""</span>
  <span class="org-comment-delimiter">;;   </span><span class="org-comment">(setq ox-chameleon--p (when (equal (plist-get info :latex-class)</span>
  <span class="org-comment-delimiter">;;                                      </span><span class="org-comment">"chameleon")</span>
  <span class="org-comment-delimiter">;;                           </span><span class="org-comment">(plist-put info :latex-class ox-chameleon-base-class)</span>
  <span class="org-comment-delimiter">;;                           </span><span class="org-comment">t)))</span>

  <span class="org-comment-delimiter">;; </span><span class="org-bold"><span class="org-warning">TODO</span></span><span class="org-comment"> make this less hacky. One ideas was as follows</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(map-put (org-export-backend-filters (org-export-get-backend 'latex))</span>
  <span class="org-comment-delimiter">;;           </span><span class="org-comment">:filter-latex-class 'ox-chameleon-latex-class-detector-filter))</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Never seemed to execute though</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defadvice!</span> ox-chameleon-org-latex-detect <span class="org-rainbow-delimiters-depth-3">(</span>orig-fun info<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-export-install-filters</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">ox-chameleon--p</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">equal</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">plist-get</span> info <span class="org-builtin">:latex-class</span><span class="org-rainbow-delimiters-depth-3">)</span>
                                       <span class="org-string">"chameleon"</span><span class="org-rainbow-delimiters-depth-2">)</span>
                            <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">plist-put</span> info <span class="org-builtin">:latex-class</span> <span class="org-variable-name">ox-chameleon-base-class</span><span class="org-rainbow-delimiters-depth-2">)</span>
                            t<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">funcall</span> orig-fun info<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defadvice!</span> ox-chameleon-org-latex-export <span class="org-rainbow-delimiters-depth-3">(</span>orig-fn info <span class="org-type">&amp;optional</span> template snippet?<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-latex-make-preamble</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">funcall</span> orig-fn info<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">not</span> <span class="org-variable-name">ox-chameleon--p</span><span class="org-rainbow-delimiters-depth-1">)</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">funcall</span> orig-fn info template snippet?<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">concat</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">funcall</span> orig-fn info template snippet?<span class="org-rainbow-delimiters-depth-2">)</span>
              <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">ox-chameleon-generate-colourings</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">ox-chameleon-generate-colourings</span> <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">apply</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">format</span>
           <span class="org-string">"%% make document follow Emacs theme</span>
<span class="org-string">\\definecolor{bg}{HTML}{%s}</span>
<span class="org-string">\\definecolor{fg}{HTML}{%s}</span>

<span class="org-string">\\definecolor{red}{HTML}{%s}</span>
<span class="org-string">\\definecolor{orange}{HTML}{%s}</span>
<span class="org-string">\\definecolor{green}{HTML}{%s}</span>
<span class="org-string">\\definecolor{teal}{HTML}{%s}</span>
<span class="org-string">\\definecolor{yellow}{HTML}{%s}</span>
<span class="org-string">\\definecolor{blue}{HTML}{%s}</span>
<span class="org-string">\\definecolor{dark-blue}{HTML}{%s}</span>
<span class="org-string">\\definecolor{magenta}{HTML}{%s}</span>
<span class="org-string">\\definecolor{violet}{HTML}{%s}</span>
<span class="org-string">\\definecolor{cyan}{HTML}{%s}</span>
<span class="org-string">\\definecolor{dark-cyan}{HTML}{%s}</span>

<span class="org-string">\\definecolor{level1}{HTML}{%s}</span>
<span class="org-string">\\definecolor{level2}{HTML}{%s}</span>
<span class="org-string">\\definecolor{level3}{HTML}{%s}</span>
<span class="org-string">\\definecolor{level4}{HTML}{%s}</span>
<span class="org-string">\\definecolor{level5}{HTML}{%s}</span>
<span class="org-string">\\definecolor{level6}{HTML}{%s}</span>
<span class="org-string">\\definecolor{level7}{HTML}{%s}</span>
<span class="org-string">\\definecolor{level8}{HTML}{%s}</span>

<span class="org-string">\\definecolor{link}{HTML}{%s}</span>
<span class="org-string">\\definecolor{cite}{HTML}{%s}</span>
<span class="org-string">\\definecolor{itemlabel}{HTML}{%s}</span>
<span class="org-string">\\definecolor{code}{HTML}{%s}</span>
<span class="org-string">\\definecolor{verbatim}{HTML}{%s}</span>

<span class="org-string">\\pagecolor{bg}</span>
<span class="org-string">\\color{fg}</span>

<span class="org-string">\\addtokomafont{section}{\\color{level1}}</span>
<span class="org-string">\\newkomafont{sectionprefix}{\\color{level1}}</span>
<span class="org-string">\\addtokomafont{subsection}{\\color{level2}}</span>
<span class="org-string">\\newkomafont{subsectionprefix}{\\color{level2}}</span>
<span class="org-string">\\addtokomafont{subsubsection}{\\color{level3}}</span>
<span class="org-string">\\newkomafont{subsubsectionprefix}{\\color{level3}}</span>
<span class="org-string">\\addtokomafont{paragraph}{\\color{level4}}</span>
<span class="org-string">\\newkomafont{paragraphprefix}{\\color{level4}}</span>
<span class="org-string">\\addtokomafont{subparagraph}{\\color{level5}}</span>
<span class="org-string">\\newkomafont{subparagraphprefix}{\\color{level5}}</span>

<span class="org-string">\\renewcommand{\\labelitemi}{\\textcolor{itemlabel}{\\textbullet}}</span>
<span class="org-string">\\renewcommand{\\labelitemii}{\\textcolor{itemlabel}{\\normalfont\\bfseries \\textendash}}</span>
<span class="org-string">\\renewcommand{\\labelitemiii}{\\textcolor{itemlabel}{\\textasteriskcentered}}</span>
<span class="org-string">\\renewcommand{\\labelitemiv}{\\textcolor{itemlabel}{\\textperiodcentered}}</span>

<span class="org-string">\\renewcommand{\\labelenumi}{\\textcolor{itemlabel}{\\theenumi.}}</span>
<span class="org-string">\\renewcommand{\\labelenumii}{\\textcolor{itemlabel}{(\\theenumii)}}</span>
<span class="org-string">\\renewcommand{\\labelenumiii}{\\textcolor{itemlabel}{\\theenumiii.}}</span>
<span class="org-string">\\renewcommand{\\labelenumiv}{\\textcolor{itemlabel}{\\theenumiv.}}</span>

<span class="org-string">\\DeclareTextFontCommand{\\texttt}{\\color{code}\\ttfamily}</span>
<span class="org-string">\\makeatletter</span>
<span class="org-string">\\def\\verbatim@font{\\color{verbatim}\\normalfont\\ttfamily}</span>
<span class="org-string">\\makeatother</span>
<span class="org-string">%% end customisations</span>
<span class="org-string">"</span>
           <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">mapcar</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">doom-rpartial</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">substring</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span>
                   <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">list</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">face-attribute</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">solaire-default-face</span> <span class="org-builtin">:background</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">face-attribute</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">default</span> <span class="org-builtin">:foreground</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-comment-delimiter">;;</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">red</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">orange</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">green</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">teal</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">yellow</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">blue</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">dark-blue</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">magenta</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">violet</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">cyan</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">dark-cyan</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-comment-delimiter">;;</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">face-attribute</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">outline-1</span> <span class="org-builtin">:foreground</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">face-attribute</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">outline-2</span> <span class="org-builtin">:foreground</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">face-attribute</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">outline-3</span> <span class="org-builtin">:foreground</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">face-attribute</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">outline-4</span> <span class="org-builtin">:foreground</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">face-attribute</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">outline-5</span> <span class="org-builtin">:foreground</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">face-attribute</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">outline-6</span> <span class="org-builtin">:foreground</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">face-attribute</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">outline-7</span> <span class="org-builtin">:foreground</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">face-attribute</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">outline-8</span> <span class="org-builtin">:foreground</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-comment-delimiter">;;</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">face-attribute</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">link</span> <span class="org-builtin">:foreground</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">face-attribute</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">org-ref-cite-face</span> <span class="org-builtin">:foreground</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">doom-color</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">yellow</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">face-attribute</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">org-list-dt</span> <span class="org-builtin">:foreground</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">face-attribute</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">org-code</span> <span class="org-builtin">:foreground</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">face-attribute</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">org-verbatim</span> <span class="org-builtin">:foreground</span><span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-exporting-latex-make" class="outline-6">
<h6 id="exporting-latex-make"><span class="section-number-6">6.3.3.5.10</span> Make verbatim different to code<a aria-hidden="true" href="#exporting-latex-make">#</a> </h6>
<div class="outline-text-6" id="text-6-3-3-5-10">
<p>
Since have just gone to so much effort above let&rsquo;s make the most of it by making
<kbd>verbatim</kbd> use <code>verb</code> instead of <code>protectedtexttt</code> (default).
</p>

<p>
This gives the same advantages as mentioned in the <a href="#make-verbatim-different"><span class='acr'>HTML</span> export section</a>.
</p>

<details id='make-verbatim-different,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#make-verbatim-different,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-latex-text-markup-alist</span>
      <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">bold</span> . <span class="org-string">"\\textbf{%s}"</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>code . protectedtexttt<span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>italic . <span class="org-string">"\\emph{%s}"</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>strike-through . <span class="org-string">"\\sout{%s}"</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>underline . <span class="org-string">"\\uline{%s}"</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>verbatim . verb<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-exporting-beamer" class="outline-5">
<h5 id="exporting-beamer"><span class="section-number-5">6.3.3.6</span> Exporting to Beamer<a aria-hidden="true" href="#exporting-beamer">#</a> </h5>
<div class="outline-text-5" id="text-6-3-3-6">
<p>
It&rsquo;s nice to use a different theme
</p>
<details id='exporting-beamer,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#exporting-beamer,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-beamer-theme</span> <span class="org-string">"[progressbar=foot]metropolis"</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
Then customise it a bit
</p>
<details id='exporting-beamer,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#exporting-beamer,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp">
</pre>
</div>
    </details>
<p>
And I think that it&rsquo;s natural to divide a presentation into sections, e.g.
Introduction, Overview&#x2026; so let&rsquo;s set bump up the headline level that becomes a
frame from <code>1</code> to <code>2</code>.
</p>
<details id='exporting-beamer,code--3' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#exporting-beamer,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-beamer-frame-level</span> <span class="org-highlight-numbers-number">2</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-exporting-markdown" class="outline-5">
<h5 id="exporting-markdown"><span class="section-number-5">6.3.3.7</span> Exporting to Markdown<a aria-hidden="true" href="#exporting-markdown">#</a> </h5>
<div class="outline-text-5" id="text-6-3-3-7">
<p>
When I want to paste exported markdown somewhere (for example when using <a href="#emacs-anywhere-configuration">Emacs
Anywhere</a>), it can be preferable to have unicode characters for <kbd>---</kbd> etc. instead
of <kbd>&amp;#x2014;</kbd>.
</p>

<p>
To accomplish this, we just need to locally rebind the alist which provides
these substitution.
</p>

<details id='exporting-markdown,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#exporting-markdown,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defadvice!</span> org-md-plain-text-unicode-a <span class="org-rainbow-delimiters-depth-2">(</span>orig-fn text info<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Locally rebind `</span><span class="org-doc"><span class="org-constant">org-html-special-string-regexps</span></span><span class="org-doc">'"</span>
  <span class="org-builtin">:around</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">org-md-plain-text</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-variable-name">org-html-special-string-regexps</span>
         <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"\\\\-"</span> . <span class="org-string">"-"</span><span class="org-rainbow-delimiters-depth-3">)</span>
           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"---</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">-]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span> . <span class="org-string">"&#8212;\\1"</span><span class="org-rainbow-delimiters-depth-3">)</span>
           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"--</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">-]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span> . <span class="org-string">"&#8211;\\1"</span><span class="org-rainbow-delimiters-depth-3">)</span>
           <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"\\.\\.\\."</span> . <span class="org-string">"&#8230;"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">funcall</span> orig-fn text <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">plist-put</span> info <span class="org-builtin">:with-smart-quotes</span> nil<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
In the future, I may want to check <kbd>info</kbd> to only have this active when <kbd>ox-gfm</kbd> is
being used.
</p>
</div>
</div>
</div>

<div id="outline-container-babel" class="outline-4">
<h4 id="babel"><span class="section-number-4">6.3.4</span> Babel<a aria-hidden="true" href="#babel">#</a> </h4>
<div class="outline-text-4" id="text-6-3-4">
<p>
Doom lazy-loads babel languages, with is lovely.
</p>

<p>
We need to tell babel to use python3. Who uses python2 anymore anyway? And why
doesn&rsquo;t <code>python</code> refer to the latest version!?
</p>
<details id='babel,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#babel,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">org-babel-python-command</span> <span class="org-string">"python3"</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
We also like auto-completion here
</p>
<details id='babel,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#babel,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">tec-org-python</span> <span class="org-rainbow-delimiters-depth-2">()</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">eq</span> <span class="org-variable-name">major-mode</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">python-mode</span><span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">progn</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-variable-name">anaconda-mode</span> t<span class="org-rainbow-delimiters-depth-1">)</span>
             <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-variable-name">company-mode</span> t<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">org-src-mode-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">tec-org-python</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-org-mode-ess" class="outline-4">
<h4 id="org-mode-ess"><span class="section-number-4">6.3.5</span> <span class='acr'>ESS</span><a aria-hidden="true" href="#org-mode-ess">#</a> </h4>
<div class="outline-text-4" id="text-6-3-5">
<p>
We don&rsquo;t want <code>R</code> evaluation to hang the editor, hence
</p>
<details id='ess,code--3' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#ess,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> ess-eval-visibly <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">nowait</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
<p>
Syntax highlighting is nice, so let&rsquo;s turn all of that on
</p>
<details id='ess,code--4' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#ess,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> ess-R-font-lock-keywords
      <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>ess-R-fl-keyword:keywords . t<span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>ess-R-fl-keyword:constants . t<span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>ess-R-fl-keyword:modifiers . t<span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>ess-R-fl-keyword:fun-defs . t<span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>ess-R-fl-keyword:assign-ops . t<span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>ess-R-fl-keyword:%op% . t<span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>ess-fl-keyword:fun-calls . t<span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>ess-fl-keyword:numbers . t<span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>ess-fl-keyword:operators . t<span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>ess-fl-keyword:delimiters . t<span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>ess-fl-keyword:= . t<span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>ess-R-fl-keyword:F&amp;T . t<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-language-configuration-latex" class="outline-3">
<h3 id="language-configuration-latex"><span class="section-number-3">6.4</span> LaTeX<a aria-hidden="true" href="#language-configuration-latex">#</a> </h3>
<div class="outline-text-3" id="text-6-4">
<p>
<img class='invertible' src='https://imgs.xkcd.com/comics/file_extensions.png' title="I have never been lied to by data in a .txt file which has been hand-aligned." alt='File Extensions'>
</p>
</div>
<div id="outline-container-be-implemented-ideas" class="outline-4">
<h4 id="be-implemented-ideas"><span class="section-number-4">6.4.1</span> To-be-implemented ideas<a aria-hidden="true" href="#be-implemented-ideas">#</a> </h4>
<div class="outline-text-4" id="text-6-4-1">
<ul class="org-ul">
<li><p>
Paste image from clipboard
</p>
<ul class="org-ul">
<li>Determine first folder in <code>graphicspath</code> if applicable</li>
<li>Ask for file name</li>
<li>Use <code>xclip</code> to save file to graphics folder, or current directory (whichever applies)</li>
</ul>
<details id=',code--3' class='code' open><summary><span class='lang'>Shell Script</span></summary>
    <div class='gutter'>
    <a href='#,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-shell"><span class="org-builtin">command</span> -v xclip &gt;/dev/null <span class="org-highlight-numbers-number">2</span>&gt;&amp;<span class="org-highlight-numbers-number">1</span> || <span class="org-rainbow-delimiters-depth-1">{</span> <span class="org-type">echo</span> &gt;&amp;<span class="org-highlight-numbers-number">1</span> <span class="org-string">"no xclip"</span>; <span class="org-keyword">exit</span> <span class="org-highlight-numbers-number">1</span>; <span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-keyword">if</span>
    xclip -selection clipboard -target image/png -o &gt;/dev/null <span class="org-highlight-numbers-number">2</span>&gt;&amp;<span class="org-highlight-numbers-number">1</span>
<span class="org-keyword">then</span>
    xclip -selection clipboard -target image/png -o &gt;$<span class="org-highlight-numbers-number">1</span> <span class="org-highlight-numbers-number">2</span>&gt;/dev/null
    <span class="org-type">echo</span> $<span class="org-highlight-numbers-number">1</span>
<span class="org-keyword">else</span>
    <span class="org-type">echo</span> <span class="org-string">"no image"</span>
<span class="org-keyword">fi</span>
</pre>
</div>
    </details>
<ul class="org-ul">
<li>Insert figure, with filled in details as a result (activate <kbd>yasnippet</kbd> with
filename as variable maybe?)</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-compilation" class="outline-4">
<h4 id="compilation"><span class="section-number-4">6.4.2</span> Compilation<a aria-hidden="true" href="#compilation">#</a> </h4>
<div class="outline-text-4" id="text-6-4-2">
<details id='compilation,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#compilation,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">TeX-save-query</span> nil
      <span class="org-variable-name">TeX-show-compilation</span> t
      <span class="org-variable-name">TeX-command-extra-options</span> <span class="org-string">"-shell-escape"</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> latex
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">TeX-command-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"XeLaTeX"</span> <span class="org-string">"%`xelatex%(mode)%' %t"</span> TeX-run-TeX nil t<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
For viewing the <span class='acr'>PDF</span>, I rather like the pdf-tools viewer. While auctex is trying
to be nice in recognising that I have some <span class='acr'>PDF</span> viewing apps installed, I&rsquo;d
rather not have it default to using them, so let&rsquo;s re-order the preferences.
</p>
<details id='compilation,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#compilation,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">+latex-viewers</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>pdf-tools evince zathura okular skim sumatrapdf<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-snippet-helpers" class="outline-4">
<h4 id="snippet-helpers"><span class="section-number-4">6.4.3</span> Snippet helpers<a aria-hidden="true" href="#snippet-helpers">#</a> </h4>
<div class="outline-text-4" id="text-6-4-3">
</div>
<div id="outline-container-template" class="outline-5">
<h5 id="template"><span class="section-number-5">6.4.3.1</span> Template<a aria-hidden="true" href="#template">#</a> </h5>
<div class="outline-text-5" id="text-6-4-3-1">
<p>
For use in the new-file template, let&rsquo;s set out a nice preamble we may want to use.
Then let&rsquo;s bind the content to a function, and define some nice helpers.
</p>
<details id='template,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#template,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> tec/yas-latex-template-preamble <span class="org-string">"</span>
<span class="org-string">&lt;&lt;latex-nice-preamble&gt;&gt;</span>
<span class="org-string">"</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">tec/yas-latex-get-class-choice</span> <span class="org-rainbow-delimiters-depth-2">()</span>
  <span class="org-doc">"Prompt user for LaTeX class choice"</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> tec/yas-latex-class-choice <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">ivy-read</span> <span class="org-string">"Select document class: "</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"article"</span> <span class="org-string">"scrartcl"</span> <span class="org-string">"bmc"</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-builtin">:def</span> <span class="org-string">"bmc"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">tec/yas-latex-preamble-if</span> <span class="org-rainbow-delimiters-depth-2">()</span>
  <span class="org-doc">"Based on class choice prompt for insertion of default preamble"</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">equal</span> tec/yas-latex-class-choice <span class="org-string">"bmc"</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">nil</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">eq</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">read-char-choice</span> <span class="org-string">"Include default preamble? [Type y/n]"</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>?y ?n<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span> ?y<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-deliminators" class="outline-5">
<h5 id="deliminators"><span class="section-number-5">6.4.3.2</span> Deliminators<a aria-hidden="true" href="#deliminators">#</a> </h5>
<div class="outline-text-5" id="text-6-4-3-2">
<details id='deliminators,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#deliminators,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> tex
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">tec/tex-last-delim-char</span> nil
    <span class="org-doc">"Last open delim expanded in a tex document"</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">tec/tex-delim-dot-second</span> t
    <span class="org-doc">"When the `</span><span class="org-doc"><span class="org-constant">tec/tex-last-delim-char</span></span><span class="org-doc">' is . a second charachter (this) is prompted for"</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">tec/get-open-delim-char</span> <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-doc">"Exclusivly read next char to tec/tex-last-delim-char"</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">tec/tex-delim-dot-second</span> nil<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">tec/tex-last-delim-char</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">read-char-exclusive</span> <span class="org-string">"Opening deliminator, recognises: 9 ( [ { &lt; | ."</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">eql</span> ?. <span class="org-variable-name">tec/tex-last-delim-char</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">tec/tex-delim-dot-second</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">read-char-exclusive</span> <span class="org-string">"Other deliminator, recognises: 0 9 (  ) [ ] { } &lt; &gt; |"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">tec/tex-open-delim-from-char</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">&amp;optional</span> open-char<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Find the associated opening delim as string"</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">unless</span> open-char <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> open-char <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">eql</span> ?. <span class="org-variable-name">tec/tex-last-delim-char</span><span class="org-rainbow-delimiters-depth-3">)</span>
                                          <span class="org-variable-name">tec/tex-delim-dot-second</span>
                                        <span class="org-variable-name">tec/tex-last-delim-char</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">pcase</span> open-char
      <span class="org-rainbow-delimiters-depth-1">(</span>?\( <span class="org-string">"("</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span>?9  <span class="org-string">"("</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span>?\[ <span class="org-string">"["</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span>?\{ <span class="org-string">"\\{"</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span>?&lt;  <span class="org-string">"&lt;"</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span>?|  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-variable-name">tec/tex-delim-dot-second</span> <span class="org-string">"."</span> <span class="org-string">"|"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span>_   <span class="org-string">"."</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">tec/tex-close-delim-from-char</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">&amp;optional</span> open-char<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-doc">"Find the associated closing delim as string"</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-variable-name">tec/tex-delim-dot-second</span>
        <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">pcase</span> <span class="org-variable-name">tec/tex-delim-dot-second</span>
          <span class="org-rainbow-delimiters-depth-2">(</span>?\) <span class="org-string">")"</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span>?0  <span class="org-string">")"</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span>?\] <span class="org-string">"]"</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span>?\} <span class="org-string">"\\}"</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span>?\&gt; <span class="org-string">"&gt;"</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span>?|  <span class="org-string">"|"</span><span class="org-rainbow-delimiters-depth-2">)</span>
          <span class="org-rainbow-delimiters-depth-2">(</span>_   <span class="org-string">"."</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">pcase</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">or</span> open-char <span class="org-variable-name">tec/tex-last-delim-char</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span>?\( <span class="org-string">")"</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span>?9  <span class="org-string">")"</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span>?\[ <span class="org-string">"]"</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span>?\{ <span class="org-string">"\\}"</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span>?&lt;  <span class="org-string">"&gt;"</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span>?\) <span class="org-string">")"</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span>?0  <span class="org-string">")"</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span>?\] <span class="org-string">"]"</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span>?\} <span class="org-string">"\\}"</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span>?\&gt; <span class="org-string">"&gt;"</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span>?|  <span class="org-string">"|"</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-rainbow-delimiters-depth-2">(</span>_   <span class="org-string">"."</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">tec/tex-next-char-smart-close-delim</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">&amp;optional</span> open-char<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">bound-and-true-p</span> <span class="org-variable-name">smartparens-mode</span><span class="org-rainbow-delimiters-depth-1">)</span>
         <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">eql</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">char-after</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">pcase</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">or</span> open-char <span class="org-variable-name">tec/tex-last-delim-char</span><span class="org-rainbow-delimiters-depth-3">)</span>
                             <span class="org-rainbow-delimiters-depth-3">(</span>?\( ?\)<span class="org-rainbow-delimiters-depth-3">)</span>
                             <span class="org-rainbow-delimiters-depth-3">(</span>?\[ ?\]<span class="org-rainbow-delimiters-depth-3">)</span>
                             <span class="org-rainbow-delimiters-depth-3">(</span>?{ ?}<span class="org-rainbow-delimiters-depth-3">)</span>
                             <span class="org-rainbow-delimiters-depth-3">(</span>?&lt; ?&gt;<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">tec/tex-delim-yas-expand</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">&amp;optional</span> open-char<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">yas-expand-snippet</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">yas-lookup-snippet</span> <span class="org-string">"_deliminators"</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">latex-mode</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">point</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">+</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">point</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">tec/tex-next-char-smart-close-delim</span> open-char<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-highlight-numbers-number">2</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-editor-visuals" class="outline-4">
<h4 id="editor-visuals"><span class="section-number-4">6.4.4</span> Editor visuals<a aria-hidden="true" href="#editor-visuals">#</a> </h4>
<div class="outline-text-4" id="text-6-4-4">
<p>
Once again, <i>all hail mixed pitch mode!</i>
</p>
<details id='editor-visuals,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#editor-visuals,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">LaTeX-mode-hook</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-variable-name">mixed-pitch-mode</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Let&rsquo;s enhance <code>TeX-fold-math</code> a bit
</p>
<details id='editor-visuals,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#editor-visuals,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> latex
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">setcar</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">assoc</span> <span class="org-string">"&#8902;"</span> <span class="org-variable-name">LaTeX-fold-math-spec-list</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-string">"&#9733;"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">make \star bigger</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">TeX-fold-math-spec-list</span>
      <span class="org-highlight-quoted-quote">`</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-comment-delimiter">;; </span><span class="org-comment">missing/better symbols</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#8804;"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"le"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#8805;"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"ge"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#8800;"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"ne"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">conviniance shorts -- these don't work nicely ATM</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">("&#8249;" ("left"))</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">("&#8250;" ("right"))</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">private macros</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#8477;"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"RR"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#8469;"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"NN"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#8484;"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"ZZ"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#8474;"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"QQ"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#8450;"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"CC"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#8473;"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"PP"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#8461;"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"HH"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#120124;"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"EE"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#119889;"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"dd"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">known commands</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">""</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"phantom"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-2">(</span>num den<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">and</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">TeX-string-single-token-p</span> num<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">TeX-string-single-token-p</span> den<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
                                <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">concat</span> num <span class="org-string">"&#65295;"</span> den<span class="org-rainbow-delimiters-depth-3">)</span>
                              <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">concat</span> <span class="org-string">"&#10090;"</span> num <span class="org-string">"&#65295;"</span> den <span class="org-string">"&#10091;"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"frac"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-2">(</span>arg<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">concat</span> <span class="org-string">"&#8730;"</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">TeX-fold-parenthesize-as-neccesary</span> arg<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"sqrt"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-2">(</span>arg<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">concat</span> <span class="org-string">"&#11105;"</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">TeX-fold-parenthesize-as-neccesary</span> arg<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"vec"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#8216;</span><span class="org-string"><span class="org-constant">{1}</span></span><span class="org-string">&#8217;"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"text"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">private commands</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"|{1}|"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"abs"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#8214;{1}&#8214;"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"norm"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#8970;{1}&#8971;"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"floor"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#8968;{1}&#8969;"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"ceil"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#8970;{1}&#8969;"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"round"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#119889;{1}/&#119889;{2}"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"dv"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#8706;{1}/&#8706;{2}"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"pdv"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">fancification</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"{1}"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"mathrm"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-2">(</span>word<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">string-offset-roman-chars</span> <span class="org-highlight-numbers-number">119743</span> word<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"mathbf"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-2">(</span>word<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">string-offset-roman-chars</span> <span class="org-highlight-numbers-number">119951</span> word<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"mathcal"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-2">(</span>word<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">string-offset-roman-chars</span> <span class="org-highlight-numbers-number">120003</span> word<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"mathfrak"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-2">(</span>word<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">string-offset-roman-chars</span> <span class="org-highlight-numbers-number">120055</span> word<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"mathbb"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-2">(</span>word<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">string-offset-roman-chars</span> <span class="org-highlight-numbers-number">120159</span> word<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"mathsf"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-2">(</span>word<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">string-offset-roman-chars</span> <span class="org-highlight-numbers-number">120367</span> word<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"mathtt"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-2">)</span>
      <span class="org-variable-name">TeX-fold-macro-spec-list</span>
      <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">as the defaults</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"[f]"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"footnote"</span> <span class="org-string">"marginpar"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"[c]"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"cite"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"[l]"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"label"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"[r]"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"ref"</span> <span class="org-string">"pageref"</span> <span class="org-string">"eqref"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"[i]"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"index"</span> <span class="org-string">"glossary"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"..."</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"dots"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"{1}"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"emph"</span> <span class="org-string">"textit"</span> <span class="org-string">"textsl"</span> <span class="org-string">"textmd"</span> <span class="org-string">"textrm"</span> <span class="org-string">"textsf"</span> <span class="org-string">"texttt"</span>
                <span class="org-string">"textbf"</span> <span class="org-string">"textsc"</span> <span class="org-string">"textup"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">tweaked defaults</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#169;"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"copyright"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#174;"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"textregistered"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#8482;"</span>  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"texttrademark"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"[1]:||&#9658;"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"item"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#10081;&#10081;&#8198;{1}"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"part"</span> <span class="org-string">"part*"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#10081;&#8198;{1}"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"chapter"</span> <span class="org-string">"chapter*"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#167;&#8198;{1}"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"section"</span> <span class="org-string">"section*"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#167;&#167;&#8198;{1}"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"subsection"</span> <span class="org-string">"subsection*"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#167;&#167;&#167;&#8198;{1}"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"subsubsection"</span> <span class="org-string">"subsubsection*"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#182;&#8198;{1}"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"paragraph"</span> <span class="org-string">"paragraph*"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#182;&#182;&#8198;{1}"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"subparagraph"</span> <span class="org-string">"subparagraph*"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">extra</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#11030;&#8198;{1}"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"begin"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&#11031;&#8198;{1}"</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"end"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">string-offset-roman-chars</span> <span class="org-rainbow-delimiters-depth-2">(</span>offset word<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Shift the codepoint of each charachter in WORD by OFFSET with an extra -6 shift if the letter is lowercase"</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">apply</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">string</span>
         <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">mapcar</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-2">(</span>c<span class="org-rainbow-delimiters-depth-2">)</span>
                   <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">string-offset-apply-roman-char-exceptions</span>
                    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">+</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">&gt;=</span> c <span class="org-highlight-numbers-number">97</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">-</span> c <span class="org-highlight-numbers-number">6</span><span class="org-rainbow-delimiters-depth-2">)</span> c<span class="org-rainbow-delimiters-depth-1">)</span> offset<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
                 word<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">string-offset-roman-char-exceptions</span>
  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-comment-delimiter">;; </span><span class="org-comment">lowercase serif</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">119892</span> .  <span class="org-highlight-numbers-number">8462</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">&#8462;</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">lowercase caligraphic</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">119994</span> . <span class="org-highlight-numbers-number">8495</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">&#8495;</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">119996</span> . <span class="org-highlight-numbers-number">8458</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">&#8458;</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">120004</span> . <span class="org-highlight-numbers-number">8500</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">&#8500;</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">caligraphic</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">119965</span> . <span class="org-highlight-numbers-number">8492</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">&#8492;</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">119968</span> . <span class="org-highlight-numbers-number">8496</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">&#8496;</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">119969</span> . <span class="org-highlight-numbers-number">8497</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">&#8497;</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">119971</span> . <span class="org-highlight-numbers-number">8459</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">&#8459;</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">119972</span> . <span class="org-highlight-numbers-number">8464</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">&#8464;</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">119975</span> . <span class="org-highlight-numbers-number">8466</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">&#8466;</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">119976</span> . <span class="org-highlight-numbers-number">8499</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">&#8499;</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">119981</span> . <span class="org-highlight-numbers-number">8475</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">&#8475;</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">fraktur</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">120070</span> . <span class="org-highlight-numbers-number">8493</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">&#8493;</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">120075</span> . <span class="org-highlight-numbers-number">8460</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">&#8460;</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">120076</span> . <span class="org-highlight-numbers-number">8465</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">&#8465;</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">120085</span> . <span class="org-highlight-numbers-number">8476</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">&#8476;</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">120092</span> . <span class="org-highlight-numbers-number">8488</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">&#8488;</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">blackboard</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">120122</span> . <span class="org-highlight-numbers-number">8450</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">&#8450;</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">120127</span> . <span class="org-highlight-numbers-number">8461</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">&#8461;</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">120133</span> . <span class="org-highlight-numbers-number">8469</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">&#8469;</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">120135</span> . <span class="org-highlight-numbers-number">8473</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">&#8473;</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">120136</span> . <span class="org-highlight-numbers-number">8474</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">&#8474;</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">120137</span> . <span class="org-highlight-numbers-number">8477</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">&#8477;</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-highlight-numbers-number">120145</span> . <span class="org-highlight-numbers-number">8484</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">&#8484;</span>
    <span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"An alist of deceptive codepoints, and then where the glyph actually resides."</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">string-offset-apply-roman-char-exceptions</span> <span class="org-rainbow-delimiters-depth-2">(</span>char<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Sometimes the codepoint doesn't contain the char you expect.</span>
<span class="org-doc">Such special cases should be remapped to another value, as given in `</span><span class="org-doc"><span class="org-constant">string-offset-roman-char-exceptions</span></span><span class="org-doc">'."</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">assoc</span> char <span class="org-variable-name">string-offset-roman-char-exceptions</span><span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">cdr</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">assoc</span> char <span class="org-variable-name">string-offset-roman-char-exceptions</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    char<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">TeX-fold-parenthesize-as-neccesary</span> <span class="org-rainbow-delimiters-depth-2">(</span>tokens <span class="org-type">&amp;optional</span> suppress-left suppress-right<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Add &#10090; &#10091; parenthesis as if multiple LaTeX tokens appear to be present"</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">TeX-string-single-token-p</span> tokens<span class="org-rainbow-delimiters-depth-3">)</span> tokens
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">concat</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">if</span> suppress-left <span class="org-string">""</span> <span class="org-string">"&#10090;"</span><span class="org-rainbow-delimiters-depth-1">)</span>
            tokens
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">if</span> suppress-right <span class="org-string">""</span> <span class="org-string">"&#10091;"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">TeX-string-single-token-p</span> <span class="org-rainbow-delimiters-depth-2">(</span>teststring<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Return t if TESTSTRING appears to be a single token, nil otherwise"</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">string-match-p</span> <span class="org-string">"^\\\\?\\w+$"</span> teststring<span class="org-rainbow-delimiters-depth-3">)</span> t nil<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Some local keybindings to make life a bit easier
</p>
<details id='editor-visuals,code--3' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#editor-visuals,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> tex
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">map!</span>
   <span class="org-builtin">:map</span> <span class="org-variable-name">LaTeX-mode-map</span>
   <span class="org-builtin">:ei</span> <span class="org-rainbow-delimiters-depth-3">[</span>C-return<span class="org-rainbow-delimiters-depth-3">]</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">LaTeX-insert-item</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">TeX-electric-math</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">"</span> . <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Maths deliminators can be de-emphasised a bit
</p>
<details id='editor-visuals,code--4' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#editor-visuals,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">Making \( \) less visible</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defface</span> <span class="org-variable-name">unimportant-latex-face</span>
  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>t
     <span class="org-builtin">:inherit</span> <span class="org-variable-name">font-lock-comment-face</span> <span class="org-builtin">:family</span> <span class="org-string">"Overpass"</span> <span class="org-builtin">:weight</span> light<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Face used to make \\(\\), \\[</span><span class="org-doc"><span class="org-constant">\\</span></span><span class="org-doc">] less visible."</span>
  <span class="org-builtin">:group</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">LaTeX-math</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">font-lock-add-keywords</span>
 <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">latex-mode</span>
 <span class="org-highlight-quoted-quote">`</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>,<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">rx</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">and</span> <span class="org-string">"\\"</span> <span class="org-rainbow-delimiters-depth-3">(</span>any <span class="org-string">"()[]"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-highlight-numbers-number">0</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">unimportant-latex-face</span> prepend<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
 <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">end</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">font-lock-add-keywords</span>
 <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">latex-mode</span>
 <span class="org-highlight-quoted-quote">`</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>,<span class="org-string">"\\\\[[:word:]]+"</span> <span class="org-highlight-numbers-number">0</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">font-lock-keyword-face</span> prepend<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
 <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">end</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
And enable shell escape for the preview
</p>
<details id='editor-visuals,code--5' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#editor-visuals,code--5'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> <span class="org-variable-name">preview-LaTeX-command</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"%`%l \"\\nonstopmode\\nofiles\</span>
<span class="org-string">\\PassOptionsToPackage{"</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">","</span> . <span class="org-variable-name">preview-required-option-list</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-string">"}{preview}\</span>
<span class="org-string">\\AtBeginDocument{\\ifx\\ifPreview\\undefined"</span>
<span class="org-variable-name">preview-default-preamble</span> <span class="org-string">"\\fi}\"%' \"\\detokenize{\" %t \"}\""</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-latex-cdlatex" class="outline-4">
<h4 id="latex-cdlatex"><span class="section-number-4">6.4.5</span> <span class='acr'>CDL</span>aTeX<a aria-hidden="true" href="#latex-cdlatex">#</a> </h4>
<div class="outline-text-4" id="text-6-4-5">
<p>
The symbols and modifies are very nice by default, but could do with a bit of
fleshing out. Let&rsquo;s change the prefix to a key which is similarly rarely used,
but more convenient, like <kbd>;</kbd>.
</p>
<details id='cdlatex,code--3' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#cdlatex,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> cdlatex
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">cdlatex-math-symbol-prefix ?\; ;; doesn't work at the moment :(</span>
   <span class="org-variable-name">cdlatex-math-symbol-alist</span>
   <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">adding missing functions to 3rd level symbols</span>
     <span class="org-rainbow-delimiters-depth-1">(</span>?_    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"\\downarrow"</span>  <span class="org-string">""</span>           <span class="org-string">"\\inf"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-rainbow-delimiters-depth-1">(</span>?2    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"^2"</span>           <span class="org-string">"\\sqrt{?}"</span>     <span class="org-string">""</span>     <span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-rainbow-delimiters-depth-1">(</span>?3    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"^3"</span>           <span class="org-string">"\\sqrt[3]{?}"</span>  <span class="org-string">""</span>     <span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-rainbow-delimiters-depth-1">(</span>?^    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"\\uparrow"</span>    <span class="org-string">""</span>           <span class="org-string">"\\sup"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-rainbow-delimiters-depth-1">(</span>?k    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"\\kappa"</span>      <span class="org-string">""</span>           <span class="org-string">"\\ker"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-rainbow-delimiters-depth-1">(</span>?m    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"\\mu"</span>         <span class="org-string">""</span>           <span class="org-string">"\\lim"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-rainbow-delimiters-depth-1">(</span>?c    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">""</span>             <span class="org-string">"\\circ"</span>     <span class="org-string">"\\cos"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-rainbow-delimiters-depth-1">(</span>?d    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"\\delta"</span>      <span class="org-string">"\\partial"</span>  <span class="org-string">"\\dim"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-rainbow-delimiters-depth-1">(</span>?D    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"\\Delta"</span>      <span class="org-string">"\\nabla"</span>    <span class="org-string">"\\deg"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-comment-delimiter">;; </span><span class="org-comment">no idea why \Phi isnt on 'F' in first place, \phi is on 'f'.</span>
     <span class="org-rainbow-delimiters-depth-1">(</span>?F    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"\\Phi"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-comment-delimiter">;; </span><span class="org-comment">now just conveniance</span>
     <span class="org-rainbow-delimiters-depth-1">(</span>?.    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"\\cdot"</span> <span class="org-string">"\\dots"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-rainbow-delimiters-depth-1">(</span>?:    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"\\vdots"</span> <span class="org-string">"\\ddots"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-rainbow-delimiters-depth-1">(</span>?*    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"\\times"</span> <span class="org-string">"\\star"</span> <span class="org-string">"\\ast"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
   <span class="org-variable-name">cdlatex-math-modify-alist</span>
   <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">my own stuff</span>
     <span class="org-rainbow-delimiters-depth-1">(</span>?B    <span class="org-string">"\\mathbb"</span>        nil          t    nil  nil<span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-rainbow-delimiters-depth-1">(</span>?a    <span class="org-string">"\\abs"</span>           nil          t    nil  nil<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-synctex" class="outline-4">
<h4 id="synctex"><span class="section-number-4">6.4.6</span> SyncTeX<a aria-hidden="true" href="#synctex">#</a> </h4>
<div class="outline-text-4" id="text-6-4-6">
<details id='synctex,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#synctex,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> tex
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">TeX-view-program-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"Evince"</span> <span class="org-string">"evince %o"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">TeX-view-program-selection</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span>output-pdf <span class="org-string">"Evince"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-fixes" class="outline-4">
<h4 id="fixes"><span class="section-number-4">6.4.7</span> Fixes<a aria-hidden="true" href="#fixes">#</a> </h4>
<div class="outline-text-4" id="text-6-4-7">
<p>
In case of Emacs28,
</p>
<details id='fixes,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#fixes,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">when</span> <span class="org-variable-name">EMACS28+</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">add-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">latex-mode-hook</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">TeX-latex-mode</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-python" class="outline-3">
<h3 id="python"><span class="section-number-3">6.5</span> Python<a aria-hidden="true" href="#python">#</a> </h3>
<div class="outline-text-3" id="text-6-5">
<p>
Since I&rsquo;m using <kbd>mypyls</kbd>, as suggested in <a href="file:///home/runner/.emacs.d/modules/lang/python/README.html#MissingReference">:lang python <span class='acr'>LSP</span> support</a> I&rsquo;ll tweak the
priority of <kbd>mypyls</kbd>
</p>
<details id='python,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#python,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> lsp-python-ms
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">set-lsp-priority!</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">mspyls</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-r" class="outline-3">
<h3 id="r"><span class="section-number-3">6.6</span> R<a aria-hidden="true" href="#r">#</a> </h3>
<div class="outline-text-3" id="text-6-6">
</div>
<div id="outline-container-r-editor-visuals" class="outline-4">
<h4 id="r-editor-visuals"><span class="section-number-4">6.6.1</span> Editor Visuals<a aria-hidden="true" href="#r-editor-visuals">#</a> </h4>
<div class="outline-text-4" id="text-6-6-1">
<details id='editor-visuals,code--6' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#editor-visuals,code--6'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">after!</span> ess-r-mode
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">appendq!</span> <span class="org-variable-name">+ligatures-extra-symbols</span>
            <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-builtin">:assign</span> <span class="org-string">"&#10229;"</span>
              <span class="org-builtin">:multiply</span> <span class="org-string">"&#215;"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">set-ligatures!</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">ess-r-mode</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Functional</span>
    <span class="org-builtin">:def</span> <span class="org-string">"function"</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Types</span>
    <span class="org-builtin">:null</span> <span class="org-string">"NULL"</span>
    <span class="org-builtin">:true</span> <span class="org-string">"TRUE"</span>
    <span class="org-builtin">:false</span> <span class="org-string">"FALSE"</span>
    <span class="org-builtin">:int</span> <span class="org-string">"int"</span>
    <span class="org-builtin">:floar</span> <span class="org-string">"float"</span>
    <span class="org-builtin">:bool</span> <span class="org-string">"bool"</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Flow</span>
    <span class="org-builtin">:not</span> <span class="org-string">"!"</span>
    <span class="org-builtin">:and</span> <span class="org-string">"&amp;&amp;"</span> <span class="org-builtin">:or</span> <span class="org-string">"||"</span>
    <span class="org-builtin">:for</span> <span class="org-string">"for"</span>
    <span class="org-builtin">:in</span> <span class="org-string">"%in%"</span>
    <span class="org-builtin">:return</span> <span class="org-string">"return"</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Other</span>
    <span class="org-builtin">:assign</span> <span class="org-string">"&lt;-"</span>
    <span class="org-builtin">:multiply</span> <span class="org-string">"%*%"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
<div id="outline-container-language-configuration-graphviz" class="outline-3">
<h3 id="language-configuration-graphviz"><span class="section-number-3">6.7</span> Graphviz<a aria-hidden="true" href="#language-configuration-graphviz">#</a> </h3>
<div class="outline-text-3" id="text-6-7">
<details id='graphviz,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#graphviz,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">use-package!</span> graphviz-dot-mode
  <span class="org-builtin">:commands</span> graphviz-dot-mode
  <span class="org-builtin">:mode</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"\\.dot\\'"</span> <span class="org-string">"\\.gz\\'"</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-builtin">:init</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">after!</span> org
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">setcdr</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">assoc</span> <span class="org-string">"dot"</span> <span class="org-variable-name">org-src-lang-modes</span><span class="org-rainbow-delimiters-depth-1">)</span>
            <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">graphviz-dot</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">use-package!</span> company-graphviz-dot
  <span class="org-builtin">:after</span> graphviz-dot-mode<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-markdown" class="outline-3">
<h3 id="markdown"><span class="section-number-3">6.8</span> Markdown<a aria-hidden="true" href="#markdown">#</a> </h3>
<div class="outline-text-3" id="text-6-8">
<p>
Let&rsquo;s use mixed pitch, because it&rsquo;s great
</p>
<details id='markdown,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#markdown,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">add-hook!</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">gfm-mode</span> markdown-mode<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-variable-name">mixed-pitch-mode</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Most of the time when I write markdown, it&rsquo;s going into some app/website which
will do it&rsquo;s own line wrapping, hence we <i>only</i> want to use visual line wrapping. No hard stuff.
</p>
<details id='markdown,code--2' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#markdown,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">add-hook!</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">gfm-mode</span> markdown-mode<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-variable-name">visual-line-mode</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">turn-off-auto-fill</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>

<p>
Since markdown is often seen as rendered <span class='acr'>HTML</span>, let&rsquo;s try to somewhat mirror the
style or markdown renderers.
</p>

<p>
Most markdown renders seem to make the first three headings levels larger than
normal text, the first two much so. Then the fourth level tends to be the same
as body text, while the fifth and sixth are (increasingly) smaller, with the
sixth greyed out. Since the sixth level is so small, I&rsquo;ll turn up the boldness a notch.
</p>
<details id='markdown,code--3' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#markdown,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">custom-set-faces!</span>
  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>markdown-header-face-1 <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.25</span> <span class="org-builtin">:weight</span> extra-bold <span class="org-builtin">:inherit</span> markdown-header-face<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>markdown-header-face-2 <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.15</span> <span class="org-builtin">:weight</span> bold       <span class="org-builtin">:inherit</span> markdown-header-face<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>markdown-header-face-3 <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.08</span> <span class="org-builtin">:weight</span> bold       <span class="org-builtin">:inherit</span> markdown-header-face<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>markdown-header-face-4 <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.00</span> <span class="org-builtin">:weight</span> bold       <span class="org-builtin">:inherit</span> markdown-header-face<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>markdown-header-face-5 <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">0.90</span> <span class="org-builtin">:weight</span> bold       <span class="org-builtin">:inherit</span> markdown-header-face<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>markdown-header-face-6 <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">0.75</span> <span class="org-builtin">:weight</span> extra-bold <span class="org-builtin">:inherit</span> markdown-header-face<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>
<div id="outline-container-beancount" class="outline-3">
<h3 id="beancount"><span class="section-number-3">6.9</span> Beancount<a aria-hidden="true" href="#beancount">#</a> </h3>
<div class="outline-text-3" id="text-6-9">
<p>
There are a number of rather compelling advantages to <a href="https://plaintextaccounting.org/">plain text accounting</a>,
with <a href="https://www.ledger-cli.org/">ledger</a> being the most obvious example. However, <a href="https://github.com/beancount/beancount">beancount</a>, a more recent
implementation of the idea is ledger-compatable (meaning I can switch easily if
I change my mind) and has a gorgeous front-end &#x2014; <a href="https://beancount.github.io/fava/">fava</a>.
</p>

<p>
Of course, there&rsquo;s an Emacs mode for this.
</p>

<details id='beancount,code--1' class='code' open><summary><span class='lang'>Emacs Lisp</span></summary>
    <div class='gutter'>
    <a href='#beancount,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">use-package!</span> beancount
  <span class="org-builtin">:mode</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"\\.beancount\\'"</span> . beancount-mode<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-builtin">:init</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">after!</span> all-the-icons
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">all-the-icons-icon-alist</span>
                 <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"\\.beancount\\'"</span> all-the-icons-material <span class="org-string">"attach_money"</span> <span class="org-builtin">:face</span> all-the-icons-lblue<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">add-to-list</span> <span class="org-highlight-quoted-quote">'</span><span class="org-variable-name">all-the-icons-mode-icon-alist</span>
                 <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-1">(</span>beancount-mode all-the-icons-material <span class="org-string">"attach_money"</span> <span class="org-builtin">:face</span> all-the-icons-lblue<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-builtin">:config</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> beancount-electric-currency t<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">defun</span> <span class="org-function-name">beancount-bal</span> <span class="org-rainbow-delimiters-depth-3">()</span>
    <span class="org-doc">"Run bean-report bal."</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">interactive</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-variable-name">compilation-read-command</span> nil<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-rainbow-delimiters-depth-1">(</span>beancount--run <span class="org-string">"bean-report"</span>
                      <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">file-relative-name</span> <span class="org-variable-name">buffer-file-name</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-string">"bal"</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">map!</span> <span class="org-builtin">:map</span> beancount-mode-map
        <span class="org-builtin">:n</span> <span class="org-string">"TAB"</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">beancount-align-to-previous-number</span>
        <span class="org-builtin">:i</span> <span class="org-string">"RET"</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">cmd!</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-function-name">newline-and-indent</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span>beancount-align-to-previous-number<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
    </details>
</div>
</div>


<div id="outline-container-snippets" class="outline-3">
<h3 id="snippets"><span class="section-number-3">6.10</span> Snippets<a aria-hidden="true" href="#snippets">#</a> </h3>
<div class="outline-text-3" id="text-6-10">
</div>
<div id="outline-container-latex-mode" class="outline-4">
<h4 id="latex-mode"><span class="section-number-4">6.10.1</span> latex mode<a aria-hidden="true" href="#latex-mode">#</a> </h4>
<div class="outline-text-4" id="text-6-10-1">
<p>
File Template
</p>
<details id='latex-mode,code--1' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: LaTeX template                                                                                         </span>
<span class="org-comment"># --</span>
\documentclass${<span class="org-warning">1</span>:[${<span class="org-warning">2</span>:opt1,...<span class="org-keyword">}</span>]<span class="org-keyword">}</span>{`(tec/yas-latex-get-class-choice)`<span class="org-keyword">}</span>

\title{${<span class="org-warning">3</span>:`(s-titleized-words (file-name-base buffer-file-name))`<span class="org-keyword">}}</span>
\author{${<span class="org-warning">4</span>:`(user-full-name)`<span class="org-keyword">}}</span>
\date{${<span class="org-warning">5</span>:`(format-time-string <span class="org-string">"%Y-%m-%d"</span>)`<span class="org-keyword">}}</span>
`(<span class="org-keyword">if</span> (tec/yas-latex-preamble-if) tec/yas-latex-template-preamble <span class="org-string">""</span>)`
\begin{document<span class="org-keyword">}</span>

\maketitle

<span class="org-keyword">$</span><span class="org-string">0</span>

\end{document<span class="org-keyword">}</span>
</pre>
</div>
    </details>

<p>
deliminators
</p>
<details id='latex-mode,code--2' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--2'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># name: _deliminators                                                                 </span>
<span class="org-comment"># --</span>
\left`(tec/tex-open-delim-from-char)` `%`<span class="org-keyword">$</span><span class="org-string">1</span> \right`(tec/tex-close-delim-from-char)` <span class="org-keyword">$</span><span class="org-string">0</span>

</pre>
</div>
    </details>

<p>
aligned equals
</p>
<details id='latex-mode,code--3' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># key: ==</span>
<span class="org-comment"># name: aligned equals</span>
<span class="org-comment"># --</span>
<span class="org-type">&amp;=</span> 
</pre>
</div>
    </details>

<p>
begin alias
</p>
<details id='latex-mode,code--4' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: begin-alias</span>
<span class="org-comment"># key: beg</span>
<span class="org-comment"># type: command</span>
<span class="org-comment"># --</span>
(doom-snippets-expand :name <span class="org-string">"begin"</span>)
</pre>
</div>
    </details>

<p>
cases
</p>
<details id='latex-mode,code--5' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--5'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># key: cs</span>
<span class="org-comment"># name: cases</span>
<span class="org-comment"># group: math</span>
<span class="org-comment"># condition: (texmathp)</span>
<span class="org-comment"># --</span>
\begin{cases<span class="org-keyword">}</span>
  `%`<span class="org-keyword">$</span><span class="org-string">1</span>
\end{cases<span class="org-keyword">}$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
code
</p>
<details id='latex-mode,code--6' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--6'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: code</span>
<span class="org-comment"># --</span>
\begin{minted<span class="org-keyword">}</span>{${<span class="org-warning">1</span>:language<span class="org-keyword">}}</span>
${<span class="org-warning">0</span>:`%`<span class="org-keyword">}</span>
\end{minted<span class="org-keyword">}</span>

</pre>
</div>
    </details>

<p>
corollary
</p>
<details id='latex-mode,code--7' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--7'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: corollary</span>
<span class="org-comment"># key: clr</span>
<span class="org-comment"># group: theorems</span>
<span class="org-comment"># --</span>
\begin{corollary<span class="org-keyword">}</span>${<span class="org-warning">1</span>:[${<span class="org-warning">2</span>:name<span class="org-keyword">}</span>]<span class="org-keyword">}</span>
  `%`<span class="org-keyword">$</span><span class="org-string">0</span>
\end{corollary<span class="org-keyword">}</span>
</pre>
</div>
    </details>

<p>
definition
</p>
<details id='latex-mode,code--8' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--8'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: definition</span>
<span class="org-comment"># key: def</span>
<span class="org-comment"># group: theorems</span>
<span class="org-comment"># --</span>
\begin{definition<span class="org-keyword">}</span>${<span class="org-warning">1</span>:[${<span class="org-warning">2</span>:name<span class="org-keyword">}</span>]<span class="org-keyword">}</span>
  `%`<span class="org-keyword">$</span><span class="org-string">0</span>
\end{definition<span class="org-keyword">}</span>
</pre>
</div>
    </details>

<p>
deliminators
</p>
<details id='latex-mode,code--9' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--9'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: deliminators</span>
<span class="org-comment"># key: @</span>
<span class="org-comment"># condition: (texmathp)</span>
<span class="org-comment"># type: command                                                    </span>
<span class="org-comment"># --</span>
(tec/get-open-delim-char)
(yas-expand-snippet (yas-lookup-snippet <span class="org-string">"_deliminators"</span> 'latex-mode))
</pre>
</div>
    </details>

<p>
deliminators   angle
</p>
<details id='latex-mode,code--10' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--10'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: deliminators - angle &lt;&gt;</span>
<span class="org-comment"># key: &lt;</span>
<span class="org-comment"># condition: (texmathp)</span>
<span class="org-comment"># type: command                  </span>
<span class="org-comment"># --</span>
(<span class="org-keyword">setq</span> tec/tex-last-delim-char ?\&lt;)
(<span class="org-keyword">setq</span> tec/tex-delim-dot-second nil)
(tec/tex-delim-yas-expand)
</pre>
</div>
    </details>

<p>
deliminators   bracket
</p>
<details id='latex-mode,code--11' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--11'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: deliminators - bracket []</span>
<span class="org-comment"># key: [</span>
<span class="org-comment"># condition: (texmathp)</span>
<span class="org-comment"># type: command</span>
<span class="org-comment"># --</span>
(<span class="org-keyword">setq</span> tec/tex-last-delim-char ?\[)
(<span class="org-keyword">setq</span> tec/tex-delim-dot-second nil)
(tec/tex-delim-yas-expand)
</pre>
</div>
    </details>

<p>
deliminators   curly
</p>
<details id='latex-mode,code--12' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--12'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: deliminators - curley {}</span>
<span class="org-comment"># key: {</span>
<span class="org-comment"># condition: (texmathp)</span>
<span class="org-comment"># type: command                  </span>
<span class="org-comment"># --</span>
(<span class="org-keyword">setq</span> tec/tex-last-delim-char ?\{)
(<span class="org-keyword">setq</span> tec/tex-delim-dot-second nil)
(tec/tex-delim-yas-expand)

</pre>
</div>
    </details>

<p>
deliminators   paren
</p>
<details id='latex-mode,code--13' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--13'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: deliminators - paren ()</span>
<span class="org-comment"># key: (</span>
<span class="org-comment"># condition: (texmathp)</span>
<span class="org-comment"># type: command</span>
<span class="org-comment"># --</span>
(<span class="org-keyword">setq</span> tec/tex-last-delim-char ?\()
(<span class="org-keyword">setq</span> tec/tex-delim-dot-second nil)
(tec/tex-delim-yas-expand)
</pre>
</div>
    </details>

<p>
enumerate
</p>
<details id='latex-mode,code--14' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--14'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: enumerate</span>
<span class="org-comment"># key: en          </span>
<span class="org-comment"># --</span>
\begin{enumerate<span class="org-keyword">}</span>
`(<span class="org-keyword">if</span> % % <span class="org-string">"  \\item "</span>)`<span class="org-keyword">$</span><span class="org-string">0</span>
\end{enumerate<span class="org-keyword">}</span>
</pre>
</div>
    </details>

<p>
example
</p>
<details id='latex-mode,code--15' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--15'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: example</span>
<span class="org-comment"># key: eg</span>
<span class="org-comment"># group: theorems</span>
<span class="org-comment"># --</span>
\begin{example<span class="org-keyword">}</span>${<span class="org-warning">1</span>:[${<span class="org-warning">2</span>:name<span class="org-keyword">}</span>]<span class="org-keyword">}</span>
  `%`<span class="org-keyword">$</span><span class="org-string">0</span>
\end{example<span class="org-keyword">}</span>
</pre>
</div>
    </details>

<p>
frac short
</p>
<details id='latex-mode,code--16' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--16'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># key: /</span>
<span class="org-comment"># name: frac-short</span>
<span class="org-comment"># group: math</span>
<span class="org-comment"># condition: (texmathp)      </span>
<span class="org-comment"># --</span>
\frac{${<span class="org-warning">1</span>:`(<span class="org-keyword">or</span> % <span class="org-string">""</span>)`<span class="org-keyword">}}</span>{<span class="org-keyword">$</span><span class="org-string">2</span><span class="org-keyword">}$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
int ^
</p>
<details id='latex-mode,code--17' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--17'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># key: int</span>
<span class="org-comment"># name: int_^</span>
<span class="org-comment"># --</span>
\int${<span class="org-warning">1</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">0</span>) <span class="org-string">"_"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">1</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">1</span>) <span class="org-string">"{"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">1</span>:left<span class="org-keyword">}</span>${<span class="org-warning">1</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">1</span>) <span class="org-string">"}"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">2</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">0</span>) <span class="org-string">"^"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">2</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">1</span>) <span class="org-string">"{"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">2</span>:right<span class="org-keyword">}</span>${<span class="org-warning">2</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">1</span>) <span class="org-string">"}"</span>)<span class="org-keyword">}</span> <span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
itemize
</p>
<details id='latex-mode,code--18' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--18'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: itemize</span>
<span class="org-comment"># key: it</span>
<span class="org-comment"># uuid: it              </span>
<span class="org-comment"># --</span>
\begin{itemize<span class="org-keyword">}</span>
`(<span class="org-keyword">if</span> % % <span class="org-string">"  \\item "</span>)`<span class="org-keyword">$</span><span class="org-string">0</span>
\end{itemize<span class="org-keyword">}</span>
</pre>
</div>
    </details>

<p>
lemma
</p>
<details id='latex-mode,code--19' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--19'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: lemma</span>
<span class="org-comment"># key: lmm</span>
<span class="org-comment"># group: theorems</span>
<span class="org-comment"># --</span>
\begin{lemma<span class="org-keyword">}</span>${<span class="org-warning">1</span>:[${<span class="org-warning">2</span>:name<span class="org-keyword">}</span>]<span class="org-keyword">}</span>
  `%`<span class="org-keyword">$</span><span class="org-string">0</span>
\end{lemma<span class="org-keyword">}</span>
</pre>
</div>
    </details>

<p>
lim
</p>
<details id='latex-mode,code--20' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--20'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: lim</span>
<span class="org-comment"># key: lim</span>
<span class="org-comment"># --</span>
\lim_{${<span class="org-warning">1</span>:n<span class="org-keyword">}</span> \to ${<span class="org-warning">2</span>:\infty<span class="org-keyword">}}</span> <span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
mathclap
</p>
<details id='latex-mode,code--21' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--21'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># key: mc</span>
<span class="org-comment"># name: mathclap</span>
<span class="org-comment"># group: math</span>
<span class="org-comment"># condition: (texmathp)</span>
<span class="org-comment"># --</span>
\mathclap{`%`<span class="org-keyword">$</span><span class="org-string">1</span><span class="org-keyword">}$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
prod ^
</p>
<details id='latex-mode,code--22' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--22'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># key: prod</span>
<span class="org-comment"># name: prod_^</span>
<span class="org-comment"># --</span>
\prod${<span class="org-warning">1</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">0</span>) <span class="org-string">"_"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">1</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">1</span>) <span class="org-string">"{"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">1</span>:i=1<span class="org-keyword">}</span>${<span class="org-warning">1</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">1</span>) <span class="org-string">"}"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">2</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">0</span>) <span class="org-string">"^"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">2</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">1</span>) <span class="org-string">"{"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">2</span>:n<span class="org-keyword">}</span>${<span class="org-warning">2</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">1</span>) <span class="org-string">"}"</span>)<span class="org-keyword">}</span> <span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
proof
</p>
<details id='latex-mode,code--23' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--23'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: proof</span>
<span class="org-comment"># key: prf</span>
<span class="org-comment"># group: theorems</span>
<span class="org-comment"># --</span>
\begin{proof<span class="org-keyword">}</span>${<span class="org-warning">1</span>:[${<span class="org-warning">2</span>:name<span class="org-keyword">}</span>]<span class="org-keyword">}</span>
  `%`<span class="org-keyword">$</span><span class="org-string">0</span>
\end{proof<span class="org-keyword">}</span>
</pre>
</div>
    </details>

<p>
remark
</p>
<details id='latex-mode,code--24' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--24'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: remark</span>
<span class="org-comment"># key: rmk</span>
<span class="org-comment"># group: theorems</span>
<span class="org-comment"># --</span>
\begin{remark<span class="org-keyword">}</span>${<span class="org-warning">1</span>:[${<span class="org-warning">2</span>:name<span class="org-keyword">}</span>]<span class="org-keyword">}</span>
  `%`<span class="org-keyword">$</span><span class="org-string">0</span>
\end{remark<span class="org-keyword">}</span>
</pre>
</div>
    </details>

<p>
sum ^
</p>
<details id='latex-mode,code--25' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--25'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># key: sum</span>
<span class="org-comment"># name: sum_^</span>
<span class="org-comment"># --</span>
\sum${<span class="org-warning">1</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">0</span>) <span class="org-string">"_"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">1</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">1</span>) <span class="org-string">"{"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">1</span>:i=1<span class="org-keyword">}</span>${<span class="org-warning">1</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">1</span>) <span class="org-string">"}"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">2</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">0</span>) <span class="org-string">"^"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">2</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">1</span>) <span class="org-string">"{"</span>)
<span class="org-keyword">}</span>${<span class="org-warning">2</span>:n<span class="org-keyword">}</span>${<span class="org-warning">2</span>:<span class="org-preprocessor">$(</span><span class="org-keyword">when</span> (&gt; (length yas-text) <span class="org-highlight-numbers-number">1</span>) <span class="org-string">"}"</span>)<span class="org-keyword">}</span> <span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
theorem
</p>
<details id='latex-mode,code--26' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#latex-mode,code--26'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: theorem</span>
<span class="org-comment"># key: thm</span>
<span class="org-comment"># group: theorems</span>
<span class="org-comment"># --</span>
\begin{theorem<span class="org-keyword">}</span>${<span class="org-warning">1</span>:[${<span class="org-warning">2</span>:name<span class="org-keyword">}</span>]<span class="org-keyword">}</span>
  `%`<span class="org-keyword">$</span><span class="org-string">0</span>
\end{theorem<span class="org-keyword">}</span>
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-markdown-mode" class="outline-4">
<h4 id="markdown-mode"><span class="section-number-4">6.10.2</span> markdown mode<a aria-hidden="true" href="#markdown-mode">#</a> </h4>
<div class="outline-text-4" id="text-6-10-2">
<p>
File Template
</p>
<details id='markdown-mode,code--1' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#markdown-mode,code--1'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Org template</span>
<span class="org-comment"># --</span>
# ${<span class="org-warning">1</span>:`(s-titleized-words (file-name-base buffer-file-name))`<span class="org-keyword">}</span>

<span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>
</div>
</div>

<div id="outline-container-snippets-org-mode" class="outline-4">
<h4 id="snippets-org-mode"><span class="section-number-4">6.10.3</span> org mode<a aria-hidden="true" href="#snippets-org-mode">#</a> </h4>
<div class="outline-text-4" id="text-6-10-3">
<p>
File Template
</p>
<details id='org-mode,code--3' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--3'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Org template                        </span>
<span class="org-comment"># --</span>
#+title: ${<span class="org-warning">1</span>:`(s-titleized-words (file-name-base buffer-file-name))`<span class="org-keyword">}</span>
#+author: ${<span class="org-warning">2</span>:`(user-full-name)`<span class="org-keyword">}</span>
#+date: ${<span class="org-warning">3</span>: `(format-time-string <span class="org-string">"%Y-%m-%d"</span>)`<span class="org-keyword">}</span>

<span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
display maths
</p>
<details id='org-mode,code--4' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--4'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: display math</span>
<span class="org-comment"># key: M</span>
<span class="org-comment"># condition: t</span>
# expand-env: ((yas-after-exit-snippet-hook (<span class="org-keyword">lambda</span> () (org-edit-special) (evil-insert-state) (insert <span class="org-string">"\n  \n"</span>) (left-char))))
<span class="org-comment"># --</span>
\\[`%`<span class="org-keyword">$</span><span class="org-string">0</span>\\]
</pre>
</div>
    </details>

<p>
elisp src
</p>
<details id='org-mode,code--5' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--5'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: elisp src</span>
<span class="org-comment"># uuid: src_elisp</span>
<span class="org-comment"># key: &lt;el</span>
<span class="org-comment"># condition: t</span>
<span class="org-comment"># expand-env: ((yas-after-exit-snippet-hook #'org-edit-src-code))</span>
<span class="org-comment"># --</span>
<span class="org-comment">#+begin_src emacs-lisp</span>
`%`<span class="org-keyword">$</span><span class="org-string">0</span>
<span class="org-comment">#+end_src</span>
</pre>
</div>
    </details>

<p>
global property
</p>
<details id='org-mode,code--6' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--6'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Global property</span>
<span class="org-comment"># key: #+p</span>
# condition: (&gt; <span class="org-highlight-numbers-number">20</span> (line-number-at-pos))
<span class="org-comment"># --</span>
<span class="org-comment">#+property: $</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
header arg dir
</p>
<details id='org-mode,code--7' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--7'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Header arg - dir</span>
<span class="org-comment"># key: d</span>
<span class="org-comment"># condition: (+yas/org-src-header-p)</span>
<span class="org-comment"># --</span>
:dir `(file-relative-name (read-directory-name <span class="org-string">"Working directory: "</span>))` <span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
header arg eval
</p>
<details id='org-mode,code--8' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--8'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Header arg - eval</span>
<span class="org-comment"># key: v</span>
<span class="org-comment"># condition: (+yas/org-src-header-p)</span>
<span class="org-comment"># --</span>
:eval `(ivy-read <span class="org-string">"Evaluate: "</span> '(<span class="org-string">"no"</span> <span class="org-string">"query"</span> <span class="org-string">"no-export"</span> <span class="org-string">"query-export"</span>))` <span class="org-keyword">$</span><span class="org-string">0</span>

</pre>
</div>
    </details>

<p>
header arg export
</p>
<details id='org-mode,code--9' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--9'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Header arg - export</span>
<span class="org-comment"># key: e</span>
<span class="org-comment"># condition: (+yas/org-src-header-p)</span>
<span class="org-comment"># --</span>
:exports `(ivy-read <span class="org-string">"Exports: "</span> '(<span class="org-string">"code"</span> <span class="org-string">"results"</span> <span class="org-string">"both"</span> <span class="org-string">"none"</span>))` <span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
header arg results
</p>
<details id='org-mode,code--10' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--10'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Header arg - results</span>
<span class="org-comment"># key: r</span>
<span class="org-comment"># condition: (+yas/org-src-header-p)</span>
<span class="org-comment"># --</span>
:results `
(replace-regexp-in-string <span class="org-string">"(default)"</span> <span class="org-string">""</span>
(concat
    (ivy-read <span class="org-string">"Result collection: "</span> '(<span class="org-string">"(default)"</span> <span class="org-string">"value "</span> <span class="org-string">"output "</span>) :preselect <span class="org-string">"(default)"</span>)
    (ivy-read <span class="org-string">"Result type: "</span> '(<span class="org-string">"(default)"</span> <span class="org-string">"table "</span> <span class="org-string">"vector "</span> <span class="org-string">"list "</span> <span class="org-string">"verbatim "</span> <span class="org-string">"file "</span>) :preselect <span class="org-string">"(default)"</span>)
    (ivy-read <span class="org-string">"Result format: "</span> '(<span class="org-string">"(default)"</span> <span class="org-string">"code "</span> <span class="org-string">"drawer "</span> <span class="org-string">"html "</span> <span class="org-string">"latex "</span> <span class="org-string">"link "</span> <span class="org-string">"graphics "</span> <span class="org-string">"org "</span> <span class="org-string">"pp "</span> <span class="org-string">"raw "</span>) :preselect <span class="org-string">"(default)"</span>)
    (ivy-read <span class="org-string">"Result handling: "</span> '(<span class="org-string">"(default)"</span> <span class="org-string">"silent "</span> <span class="org-string">"replace "</span> <span class="org-string">"append "</span> <span class="org-string">"prepend "</span>) :preselect <span class="org-string">"(default)"</span>)))
`<span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
header arg session
</p>
<details id='org-mode,code--11' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--11'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Header arg - session</span>
<span class="org-comment"># key: s</span>
<span class="org-comment"># condition: (+yas/org-src-header-p)</span>
<span class="org-comment"># --</span>
:session <span class="org-string">"${</span><span class="org-warning">1</span><span class="org-string">:`(file-name-base (buffer-file-name))`-session}"</span> <span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
inline math
</p>
<details id='org-mode,code--12' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--12'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: inline math</span>
<span class="org-comment"># key: m</span>
<span class="org-comment"># condition: t</span>
<span class="org-comment"># expand-env: ((yas-after-exit-snippet-hook (lambda () (org-edit-special) (evil-insert-state))))</span>
<span class="org-comment"># --</span>
\\(`%`<span class="org-keyword">$</span><span class="org-string">0</span>\\)
</pre>
</div>
    </details>

<p>
property header args
</p>
<details id='org-mode,code--13' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--13'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: Property - header arg</span>
<span class="org-comment"># key: h</span>
# condition: (<span class="org-keyword">or</span> (looking-back <span class="org-string">"^#\\+PROPERTY:.*"</span> (line-beginning-position)) (looking-back <span class="org-string">"^#\\+property:.*"</span> (line-beginning-position)))
<span class="org-comment"># --</span>
header-args:${<span class="org-warning">1</span>:`(<span class="org-keyword">or</span> (+yas/org-most-common-no-property-lang) <span class="org-string">"?"</span>)`<span class="org-keyword">}</span> <span class="org-keyword">$</span><span class="org-string">0</span>
</pre>
</div>
    </details>

<p>
python src
</p>
<details id='org-mode,code--14' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--14'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: python src</span>
<span class="org-comment"># uuid: src_python</span>
<span class="org-comment"># key: &lt;py</span>
<span class="org-comment"># condition: t</span>
<span class="org-comment"># expand-env: ((yas-after-exit-snippet-hook #'org-edit-src-code))</span>
<span class="org-comment"># --</span>
<span class="org-comment">#+begin_src python</span>
`%`<span class="org-keyword">$</span><span class="org-string">0</span>
<span class="org-comment">#+end_src</span>
</pre>
</div>
    </details>

<p>
src
</p>
<details id='org-mode,code--15' class='code' open><summary><span class='lang'>snippet</span></summary>
    <div class='gutter'>
    <a href='#org-mode,code--15'>#</a>
    <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>    </div>
    <div class="org-src-container">
<pre class="src src-snippet"><span class="org-comment"># -*- mode: snippet -*-</span>
<span class="org-comment"># name: #+begin_src</span>
<span class="org-comment"># uuid: src</span>
<span class="org-comment"># key: src</span>
<span class="org-comment"># --</span>
#+begin_src ${<span class="org-warning">1</span>:`(+yas/org-last-src-lang)`<span class="org-keyword">}</span>
`%`<span class="org-keyword">$</span><span class="org-string">0</span>
<span class="org-comment">#+end_src</span>
</pre>
</div>
    </details>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2021-02-06 07:56 UTC, <a href="https://github.com/tecosaur/emacs-config/commit/0c50e2a" style="text-decoration: none"><code style="padding: 0; color: var(--text-light); font-size: inherit; opacity: 0.7">0c50e2a</code></a></p>
<p class="author">Author: tecosaur</p>
<p class="date">Created: 2021-02-11 Thu 00:10</p>
</div>
</div>
</body>
</html>
