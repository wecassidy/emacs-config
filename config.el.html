<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<!-- Created by htmlize-1.56 in css mode. -->
<html>
  <head>
    <title>config.el</title>
  <style>
    body > pre {
      font-size: 1rem;
      max-width: min(100rem, 100%);
      width: max-content;
      white-space: pre-wrap;
      margin: auto;
    }
  </style>
    <style type="text/css">
    <!--
      body {
        color: #383a42;
        background-color: #fafafa;
      }
      .bold {
        /* bold */
        font-weight: bold;
      }
      .builtin {
        /* font-lock-builtin-face */
        color: #a626a4;
      }
      .comment {
        /* font-lock-comment-face */
        color: #9ca0a4;
      }
      .comment-delimiter {
        /* font-lock-comment-delimiter-face */
        color: #9ca0a4;
      }
      .constant {
        /* font-lock-constant-face */
        color: #b751b6;
      }
      .doc {
        /* font-lock-doc-face */
        color: #84888b;
        font-style: italic;
      }
      .error {
        /* error */
        color: #e45649;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #a626a4;
      }
      .highlight-numbers-number {
        /* highlight-numbers-number */
        color: #da8548;
        font-weight: bold;
      }
      .highlight-quoted-quote {
        /* highlight-quoted-quote */
        color: #4078f2;
      }
      .highlight-quoted-symbol {
        /* highlight-quoted-symbol */
        color: #986801;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #e45649;
      }
      .negation-char {
        /* font-lock-negation-char-face */
        color: #4078f2;
        font-weight: bold;
      }
      .rainbow-delimiters-depth-1 {
        /* rainbow-delimiters-depth-1-face */
        color: #4078f2;
      }
      .rainbow-delimiters-depth-2 {
        /* rainbow-delimiters-depth-2-face */
        color: #a626a4;
      }
      .rainbow-delimiters-depth-3 {
        /* rainbow-delimiters-depth-3-face */
        color: #50a14f;
      }
      .regexp-grouping-backslash {
        /* font-lock-regexp-grouping-backslash */
        color: #4078f2;
        font-weight: bold;
      }
      .regexp-grouping-construct {
        /* font-lock-regexp-grouping-construct */
        color: #4078f2;
        font-weight: bold;
      }
      .string {
        /* font-lock-string-face */
        color: #50a14f;
      }
      .success {
        /* success */
        color: #50a14f;
      }
      .type {
        /* font-lock-type-face */
        color: #986801;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #6a1868;
      }
      .warning {
        /* warning */
        color: #986801;
      }
      .warning-1 {
        /* font-lock-warning-face */
        color: #986801;
      }

      a {
        color: inherit;
        background-color: inherit;
        font: inherit;
        text-decoration: inherit;
      }
      a:hover {
        text-decoration: underline;
      }
    -->
    </style>
  </head>
  <body>
    <pre>
<span class="comment-delimiter">;;; </span><span class="comment">config.el -*- lexical-binding: t; -*-
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Personal Information][Personal Information:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> <span class="variable-name">user-full-name</span> <span class="string">"TEC"</span>
      <span class="variable-name">user-mail-address</span> <span class="string">"tec@tecosaur.com"</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Personal Information:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Personal Information][Personal Information:2]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> <span class="variable-name">auth-sources</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span><span class="string">"~/.authinfo.gpg"</span><span class="rainbow-delimiters-depth-2">)</span>
      <span class="variable-name">auth-source-cache-expiry</span> nil<span class="rainbow-delimiters-depth-1">)</span> <span class="comment-delimiter">; </span><span class="comment">default is 7200 (2h)
</span><span class="comment-delimiter">;; </span><span class="comment">Personal Information:2 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Simple settings][Simple settings:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq-default</span>
 <span class="variable-name">delete-by-moving-to-trash</span> t                      <span class="comment-delimiter">; </span><span class="comment">Delete files to trash
</span> <span class="variable-name">window-combination-resize</span> t                      <span class="comment-delimiter">; </span><span class="comment">take new window space from all other windows (not just current)
</span> x-stretch-cursor t<span class="rainbow-delimiters-depth-1">)</span>                              <span class="comment-delimiter">; </span><span class="comment">Stretch cursor to the glyph width
</span>
<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> <span class="variable-name">undo-limit</span> <span class="highlight-numbers-number">80000000</span>                         <span class="comment-delimiter">; </span><span class="comment">Raise undo-limit to 80Mb
</span>      <span class="variable-name">evil-want-fine-undo</span> t                       <span class="comment-delimiter">; </span><span class="comment">By default while in insert all changes are one big blob. Be more granular
</span>      <span class="variable-name">auto-save-default</span> t                         <span class="comment-delimiter">; </span><span class="comment">Nobody likes to loose work, I certainly don't
</span>      truncate-string-ellipsis <span class="string">"&#226;&#128;&#166;"</span><span class="rainbow-delimiters-depth-1">)</span>               <span class="comment-delimiter">; </span><span class="comment">Unicode ellispis are nicer than "...", and also save /precious/ space
</span>
<span class="rainbow-delimiters-depth-1">(</span><span class="variable-name">display-time-mode</span> <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-1">)</span>                             <span class="comment-delimiter">; </span><span class="comment">Enable time in the mode-line
</span>
<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">equal</span> <span class="string">"Battery status not available"</span>
           <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">battery</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
    <span class="rainbow-delimiters-depth-2">(</span><span class="variable-name">display-battery-mode</span> <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-2">)</span>                        <span class="comment-delimiter">; </span><span class="comment">On laptops it's nice to know how much power you have
</span>  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> <span class="variable-name">password-cache-expiry</span> nil<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>               <span class="comment-delimiter">; </span><span class="comment">I can trust my desktops ... can't I? (no battery = desktop)
</span>
<span class="rainbow-delimiters-depth-1">(</span><span class="variable-name">global-subword-mode</span> <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-1">)</span>                           <span class="comment-delimiter">; </span><span class="comment">Iterate through CamelCase words
</span><span class="comment-delimiter">;; </span><span class="comment">Simple settings:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Frame sizing][Frame sizing:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="function-name">add-to-list</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">default-frame-alist</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span>height . <span class="highlight-numbers-number">24</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="rainbow-delimiters-depth-1">(</span><span class="function-name">add-to-list</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">default-frame-alist</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span>width . <span class="highlight-numbers-number">80</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Frame sizing:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Auto-customisations][Auto-customisations:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq-default</span> <span class="variable-name">custom-file</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">expand-file-name</span> <span class="string">".custom.el"</span> <span class="variable-name">doom-private-dir</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">file-exists-p</span> <span class="variable-name">custom-file</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="constant">load</span> <span class="variable-name">custom-file</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Auto-customisations:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Windows][Windows:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> <span class="variable-name">evil-vsplit-window-right</span> t
      <span class="variable-name">evil-split-window-below</span> t<span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Windows:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Windows][Windows:2]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defadvice!</span> prompt-for-buffer <span class="rainbow-delimiters-depth-2">(</span><span class="type">&amp;rest</span> _<span class="rainbow-delimiters-depth-2">)</span>
  <span class="builtin">:after</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span>evil-window-split evil-window-vsplit<span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">+ivy/switch-buffer</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Windows:2 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Windows][Windows:3]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> <span class="variable-name">+ivy-buffer-preview</span> t<span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Windows:3 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Windows][Windows:4]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">map!</span> <span class="builtin">:map</span> <span class="variable-name">evil-window-map</span>
      <span class="string">"SPC"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">rotate-layout</span>
      <span class="comment-delimiter">;; </span><span class="comment">Navigation
</span>      <span class="string">"&lt;left&gt;"</span>     <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">evil-window-left</span>
      <span class="string">"&lt;down&gt;"</span>     <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">evil-window-down</span>
      <span class="string">"&lt;up&gt;"</span>       <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">evil-window-up</span>
      <span class="string">"&lt;right&gt;"</span>    <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">evil-window-right</span>
      <span class="comment-delimiter">;; </span><span class="comment">Swapping windows
</span>      <span class="string">"C-&lt;left&gt;"</span>       <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">+evil/window-move-left</span>
      <span class="string">"C-&lt;down&gt;"</span>       <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">+evil/window-move-down</span>
      <span class="string">"C-&lt;up&gt;"</span>         <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">+evil/window-move-up</span>
      <span class="string">"C-&lt;right&gt;"</span>      <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">+evil/window-move-right</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Windows:4 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Buffer defaults][Buffer defaults:1]]
</span><span class="comment-delimiter">;; </span><span class="comment">(setq-default major-mode 'org-mode)
</span><span class="comment-delimiter">;; </span><span class="comment">Buffer defaults:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Font Face][Font Face:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> <span class="variable-name">doom-font</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">font-spec</span> <span class="builtin">:family</span> <span class="string">"JetBrains Mono"</span> <span class="builtin">:size</span> <span class="highlight-numbers-number">24</span><span class="rainbow-delimiters-depth-2">)</span>
      <span class="variable-name">doom-big-font</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">font-spec</span> <span class="builtin">:family</span> <span class="string">"JetBrains Mono"</span> <span class="builtin">:size</span> <span class="highlight-numbers-number">36</span><span class="rainbow-delimiters-depth-2">)</span>
      <span class="variable-name">doom-variable-pitch-font</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">font-spec</span> <span class="builtin">:family</span> <span class="string">"Overpass"</span> <span class="builtin">:size</span> <span class="highlight-numbers-number">24</span><span class="rainbow-delimiters-depth-2">)</span>
      <span class="variable-name">doom-serif-font</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">font-spec</span> <span class="builtin">:family</span> <span class="string">"IBM Plex Mono"</span> <span class="builtin">:weight</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">light</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Font Face:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Theme and modeline][Theme and modeline:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> <span class="variable-name">doom-theme</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">doom-vibrant</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">delq!</span> t <span class="variable-name">custom-theme-load-path</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Theme and modeline:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Theme and modeline][Theme and modeline:2]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">custom-set-faces!</span>
  <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span>doom-modeline-buffer-modified <span class="builtin">:foreground</span> <span class="string">"orange"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Theme and modeline:2 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Theme and modeline][Theme and modeline:3]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defun</span> <span class="function-name">doom-modeline-conditional-buffer-encoding</span> <span class="rainbow-delimiters-depth-2">()</span>
  <span class="doc">"We expect the encoding to be LF UTF-8, so only show the modeline when this is not the case"</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq-local</span> doom-modeline-buffer-encoding
              <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">unless</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">eq</span> <span class="variable-name">buffer-file-coding-system</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">utf-8-unix</span><span class="rainbow-delimiters-depth-2">)</span>
                          <span class="rainbow-delimiters-depth-2">(</span><span class="constant">eq</span> <span class="variable-name">buffer-file-coding-system</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">utf-8</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">after-change-major-mode-hook</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">doom-modeline-conditional-buffer-encoding</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Theme and modeline:3 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Miscellaneous][Miscellaneous:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> <span class="variable-name">display-line-numbers-type</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">relative</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Miscellaneous:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Miscellaneous][Miscellaneous:2]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> <span class="variable-name">doom-fallback-buffer-name</span> <span class="string">"&#226;&#150;&#186; Doom"</span>
      <span class="variable-name">+doom-dashboard-name</span> <span class="string">"&#226;&#150;&#186; Doom"</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Miscellaneous:2 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Miscellaneous][Miscellaneous:3]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">custom-set-faces!</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span>doom-modeline-evil-insert-state <span class="builtin">:weight</span> bold <span class="builtin">:foreground</span> <span class="string">"#339CDB"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Miscellaneous:3 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Mouse buttons][Mouse buttons:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">map!</span> <span class="builtin">:n</span> <span class="rainbow-delimiters-depth-2">[</span>mouse-8<span class="rainbow-delimiters-depth-2">]</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">better-jumper-jump-backward</span>
      <span class="builtin">:n</span> <span class="rainbow-delimiters-depth-2">[</span>mouse-9<span class="rainbow-delimiters-depth-2">]</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">better-jumper-jump-forward</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Mouse buttons:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Window title][Window title:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> <span class="variable-name">frame-title-format</span>
      <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span><span class="string">""</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="builtin">:eval</span>
         <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-2">(</span>s-contains-p org-roam-directory <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">or</span> <span class="variable-name">buffer-file-name</span> <span class="string">""</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
             <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">replace-regexp-in-string</span>
              <span class="string">".*/[0-9]*-?"</span> <span class="string">"&#226;&#152;&#176; "</span>
              <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">subst-char-in-string</span> ?_ ?  <span class="variable-name">buffer-file-name</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="string">"%b"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="builtin">:eval</span>
         <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>project-name <span class="rainbow-delimiters-depth-1">(</span><span class="variable-name">projectile-project-name</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">unless</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">string=</span> <span class="string">"-"</span> project-name<span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">buffer-modified-p</span><span class="rainbow-delimiters-depth-2">)</span>  <span class="string">" &#226;&#151;&#137; %s"</span> <span class="string">" &#226;&#128;&#134;&#226;&#151;&#143;&#226;&#128;&#134; %s"</span><span class="rainbow-delimiters-depth-1">)</span> project-name<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Window title:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Splash screen][Splash screen:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defvar</span> <span class="variable-name">fancy-splash-image-template</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="constant">expand-file-name</span> <span class="string">"misc/splash-images/blackhole-lines-template.svg"</span> <span class="variable-name">doom-private-dir</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="doc">"Default template svg used for the splash image, with substitutions from "</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defvar</span> <span class="variable-name">fancy-splash-image-nil</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="constant">expand-file-name</span> <span class="string">"misc/splash-images/transparent-pixel.png"</span> <span class="variable-name">doom-private-dir</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="doc">"An image to use at minimum size, usually a transparent pixel"</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> <span class="variable-name">fancy-splash-sizes</span>
      <span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="builtin">:height</span> <span class="highlight-numbers-number">500</span> <span class="builtin">:min-height</span> <span class="highlight-numbers-number">50</span> <span class="builtin">:padding</span> <span class="rainbow-delimiters-depth-1">(</span><span class="highlight-numbers-number">0</span> . <span class="highlight-numbers-number">4</span><span class="rainbow-delimiters-depth-1">)</span> <span class="builtin">:template</span> ,<span class="rainbow-delimiters-depth-1">(</span><span class="constant">expand-file-name</span> <span class="string">"misc/splash-images/blackhole-lines-0.svg"</span> <span class="variable-name">doom-private-dir</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="builtin">:height</span> <span class="highlight-numbers-number">440</span> <span class="builtin">:min-height</span> <span class="highlight-numbers-number">42</span> <span class="builtin">:padding</span> <span class="rainbow-delimiters-depth-1">(</span><span class="highlight-numbers-number">1</span> . <span class="highlight-numbers-number">4</span><span class="rainbow-delimiters-depth-1">)</span> <span class="builtin">:template</span> ,<span class="rainbow-delimiters-depth-1">(</span><span class="constant">expand-file-name</span> <span class="string">"misc/splash-images/blackhole-lines-0.svg"</span> <span class="variable-name">doom-private-dir</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="builtin">:height</span> <span class="highlight-numbers-number">400</span> <span class="builtin">:min-height</span> <span class="highlight-numbers-number">38</span> <span class="builtin">:padding</span> <span class="rainbow-delimiters-depth-1">(</span><span class="highlight-numbers-number">1</span> . <span class="highlight-numbers-number">4</span><span class="rainbow-delimiters-depth-1">)</span> <span class="builtin">:template</span> ,<span class="rainbow-delimiters-depth-1">(</span><span class="constant">expand-file-name</span> <span class="string">"misc/splash-images/blackhole-lines-1.svg"</span> <span class="variable-name">doom-private-dir</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="builtin">:height</span> <span class="highlight-numbers-number">350</span> <span class="builtin">:min-height</span> <span class="highlight-numbers-number">36</span> <span class="builtin">:padding</span> <span class="rainbow-delimiters-depth-1">(</span><span class="highlight-numbers-number">1</span> . <span class="highlight-numbers-number">3</span><span class="rainbow-delimiters-depth-1">)</span> <span class="builtin">:template</span> ,<span class="rainbow-delimiters-depth-1">(</span><span class="constant">expand-file-name</span> <span class="string">"misc/splash-images/blackhole-lines-2.svg"</span> <span class="variable-name">doom-private-dir</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="builtin">:height</span> <span class="highlight-numbers-number">300</span> <span class="builtin">:min-height</span> <span class="highlight-numbers-number">34</span> <span class="builtin">:padding</span> <span class="rainbow-delimiters-depth-1">(</span><span class="highlight-numbers-number">1</span> . <span class="highlight-numbers-number">3</span><span class="rainbow-delimiters-depth-1">)</span> <span class="builtin">:template</span> ,<span class="rainbow-delimiters-depth-1">(</span><span class="constant">expand-file-name</span> <span class="string">"misc/splash-images/blackhole-lines-3.svg"</span> <span class="variable-name">doom-private-dir</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="builtin">:height</span> <span class="highlight-numbers-number">250</span> <span class="builtin">:min-height</span> <span class="highlight-numbers-number">32</span> <span class="builtin">:padding</span> <span class="rainbow-delimiters-depth-1">(</span><span class="highlight-numbers-number">1</span> . <span class="highlight-numbers-number">2</span><span class="rainbow-delimiters-depth-1">)</span> <span class="builtin">:template</span> ,<span class="rainbow-delimiters-depth-1">(</span><span class="constant">expand-file-name</span> <span class="string">"misc/splash-images/blackhole-lines-4.svg"</span> <span class="variable-name">doom-private-dir</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="builtin">:height</span> <span class="highlight-numbers-number">200</span> <span class="builtin">:min-height</span> <span class="highlight-numbers-number">30</span> <span class="builtin">:padding</span> <span class="rainbow-delimiters-depth-1">(</span><span class="highlight-numbers-number">1</span> . <span class="highlight-numbers-number">2</span><span class="rainbow-delimiters-depth-1">)</span> <span class="builtin">:template</span> ,<span class="rainbow-delimiters-depth-1">(</span><span class="constant">expand-file-name</span> <span class="string">"misc/splash-images/blackhole-lines-5.svg"</span> <span class="variable-name">doom-private-dir</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="builtin">:height</span> <span class="highlight-numbers-number">100</span> <span class="builtin">:min-height</span> <span class="highlight-numbers-number">24</span> <span class="builtin">:padding</span> <span class="rainbow-delimiters-depth-1">(</span><span class="highlight-numbers-number">1</span> . <span class="highlight-numbers-number">2</span><span class="rainbow-delimiters-depth-1">)</span> <span class="builtin">:template</span> ,<span class="rainbow-delimiters-depth-1">(</span><span class="constant">expand-file-name</span> <span class="string">"misc/splash-images/emacs-e-template.svg"</span> <span class="variable-name">doom-private-dir</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="builtin">:height</span> <span class="highlight-numbers-number">0</span>   <span class="builtin">:min-height</span> <span class="highlight-numbers-number">0</span>  <span class="builtin">:padding</span> <span class="rainbow-delimiters-depth-1">(</span><span class="highlight-numbers-number">0</span> . <span class="highlight-numbers-number">0</span><span class="rainbow-delimiters-depth-1">)</span> <span class="builtin">:file</span> ,<span class="variable-name">fancy-splash-image-nil</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defvar</span> <span class="variable-name">fancy-splash-sizes</span>
  <span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="builtin">:height</span> <span class="highlight-numbers-number">500</span> <span class="builtin">:min-height</span> <span class="highlight-numbers-number">50</span> <span class="builtin">:padding</span> <span class="rainbow-delimiters-depth-1">(</span><span class="highlight-numbers-number">0</span> . <span class="highlight-numbers-number">2</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="builtin">:height</span> <span class="highlight-numbers-number">440</span> <span class="builtin">:min-height</span> <span class="highlight-numbers-number">42</span> <span class="builtin">:padding</span> <span class="rainbow-delimiters-depth-1">(</span><span class="highlight-numbers-number">1</span> . <span class="highlight-numbers-number">4</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="builtin">:height</span> <span class="highlight-numbers-number">330</span> <span class="builtin">:min-height</span> <span class="highlight-numbers-number">35</span> <span class="builtin">:padding</span> <span class="rainbow-delimiters-depth-1">(</span><span class="highlight-numbers-number">1</span> . <span class="highlight-numbers-number">3</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="builtin">:height</span> <span class="highlight-numbers-number">200</span> <span class="builtin">:min-height</span> <span class="highlight-numbers-number">30</span> <span class="builtin">:padding</span> <span class="rainbow-delimiters-depth-1">(</span><span class="highlight-numbers-number">1</span> . <span class="highlight-numbers-number">2</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="builtin">:height</span> <span class="highlight-numbers-number">0</span>   <span class="builtin">:min-height</span> <span class="highlight-numbers-number">0</span>  <span class="builtin">:padding</span> <span class="rainbow-delimiters-depth-1">(</span><span class="highlight-numbers-number">0</span> . <span class="highlight-numbers-number">0</span><span class="rainbow-delimiters-depth-1">)</span> <span class="builtin">:file</span> ,<span class="variable-name">fancy-splash-image-nil</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="doc">"list of plists with the following properties
  :height the height of the image
  :min-height minimum `</span><span class="doc"><span class="constant">frame-height</span></span><span class="doc">' for image
  :padding `</span><span class="doc"><span class="constant">+doom-dashboard-banner-padding</span></span><span class="doc">' to apply
  :template non-default template file
  :file file to use instead of template"</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defvar</span> <span class="variable-name">fancy-splash-template-colours</span>
  <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"$colour1"</span> . keywords<span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="string">"$colour2"</span> . type<span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="string">"$colour3"</span> . base5<span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="string">"$colour4"</span> . base8<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="doc">"list of colour-replacement alists of the form (\"$placeholder\" . 'theme-colour) which applied the template"</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">unless</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">file-exists-p</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">expand-file-name</span> <span class="string">"theme-splashes"</span> <span class="variable-name">doom-cache-dir</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">make-directory</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">expand-file-name</span> <span class="string">"theme-splashes"</span> <span class="variable-name">doom-cache-dir</span><span class="rainbow-delimiters-depth-3">)</span> t<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defun</span> <span class="function-name">fancy-splash-filename</span> <span class="rainbow-delimiters-depth-2">(</span>theme-name height<span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="constant">expand-file-name</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">concat</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">file-name-as-directory</span> <span class="string">"theme-splashes"</span><span class="rainbow-delimiters-depth-1">)</span>
                            theme-name
                            <span class="string">"-"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">number-to-string</span> height<span class="rainbow-delimiters-depth-1">)</span> <span class="string">".svg"</span><span class="rainbow-delimiters-depth-3">)</span>
                    <span class="variable-name">doom-cache-dir</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defun</span> <span class="function-name">fancy-splash-clear-cache</span> <span class="rainbow-delimiters-depth-2">()</span>
  <span class="doc">"Delete all cached fancy splash images"</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">interactive</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">delete-directory</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">expand-file-name</span> <span class="string">"theme-splashes"</span> <span class="variable-name">doom-cache-dir</span><span class="rainbow-delimiters-depth-3">)</span> t<span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="constant">message</span> <span class="string">"Cache cleared!"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defun</span> <span class="function-name">fancy-splash-generate-image</span> <span class="rainbow-delimiters-depth-2">(</span>template height<span class="rainbow-delimiters-depth-2">)</span>
  <span class="doc">"Read TEMPLATE and create an image if HEIGHT with colour substitutions as
   described by `</span><span class="doc"><span class="constant">fancy-splash-template-colours</span></span><span class="doc">' for the current theme"</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">with-temp-buffer</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">insert-file-contents</span> template<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">re-search-forward</span> <span class="string">"$height"</span> nil t<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">replace-match</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">number-to-string</span> height<span class="rainbow-delimiters-depth-1">)</span> nil nil<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">dolist</span> <span class="rainbow-delimiters-depth-1">(</span>substitution <span class="variable-name">fancy-splash-template-colours</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">goto-char</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">point-min</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">while</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">re-search-forward</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">car</span> substitution<span class="rainbow-delimiters-depth-3">)</span> nil t<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">replace-match</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">doom-color</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">cdr</span> substitution<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span> nil nil<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">write-region</span> nil nil
                  <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">fancy-splash-filename</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">symbol-name</span> <span class="variable-name">doom-theme</span><span class="rainbow-delimiters-depth-2">)</span> height<span class="rainbow-delimiters-depth-1">)</span> nil nil<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defun</span> <span class="function-name">fancy-splash-generate-images</span> <span class="rainbow-delimiters-depth-2">()</span>
  <span class="doc">"Perform `</span><span class="doc"><span class="constant">fancy-splash-generate-image</span></span><span class="doc">' in bulk"</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">dolist</span> <span class="rainbow-delimiters-depth-3">(</span>size <span class="variable-name">fancy-splash-sizes</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">unless</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> size <span class="builtin">:file</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">fancy-splash-generate-image</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> size <span class="builtin">:file</span><span class="rainbow-delimiters-depth-3">)</span>
                                       <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> size <span class="builtin">:template</span><span class="rainbow-delimiters-depth-3">)</span>
                                       <span class="variable-name">fancy-splash-image-template</span><span class="rainbow-delimiters-depth-2">)</span>
                                   <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> size <span class="builtin">:height</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defun</span> <span class="function-name">ensure-theme-splash-images-exist</span> <span class="rainbow-delimiters-depth-2">(</span><span class="type">&amp;optional</span> height<span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">unless</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">file-exists-p</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">fancy-splash-filename</span>
                          <span class="rainbow-delimiters-depth-2">(</span><span class="constant">symbol-name</span> <span class="variable-name">doom-theme</span><span class="rainbow-delimiters-depth-2">)</span>
                          <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> height
                              <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">car</span> <span class="variable-name">fancy-splash-sizes</span><span class="rainbow-delimiters-depth-1">)</span> <span class="builtin">:height</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">fancy-splash-generate-images</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defun</span> <span class="function-name">get-appropriate-splash</span> <span class="rainbow-delimiters-depth-2">()</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>height <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">frame-height</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">cl-some</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-2">(</span>size<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">&gt;=</span> height <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> size <span class="builtin">:min-height</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span> size<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
             <span class="variable-name">fancy-splash-sizes</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> fancy-splash-last-size nil<span class="rainbow-delimiters-depth-1">)</span>
<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> fancy-splash-last-theme nil<span class="rainbow-delimiters-depth-1">)</span>
<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defun</span> <span class="function-name">set-appropriate-splash</span> <span class="rainbow-delimiters-depth-2">(</span><span class="type">&amp;rest</span> _<span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>appropriate-image <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">get-appropriate-splash</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">unless</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">equal</span> appropriate-image fancy-splash-last-size<span class="rainbow-delimiters-depth-2">)</span>
                 <span class="rainbow-delimiters-depth-2">(</span><span class="constant">equal</span> <span class="variable-name">doom-theme</span> fancy-splash-last-theme<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">unless</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> appropriate-image <span class="builtin">:file</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">ensure-theme-splash-images-exist</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> appropriate-image <span class="builtin">:height</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> <span class="variable-name">fancy-splash-image</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> appropriate-image <span class="builtin">:file</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">fancy-splash-filename</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">symbol-name</span> <span class="variable-name">doom-theme</span><span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> appropriate-image <span class="builtin">:height</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> <span class="variable-name">+doom-dashboard-banner-padding</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> appropriate-image <span class="builtin">:padding</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> fancy-splash-last-size appropriate-image<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> fancy-splash-last-theme <span class="variable-name">doom-theme</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">+doom-dashboard-reload</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">window-size-change-functions</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">set-appropriate-splash</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="rainbow-delimiters-depth-1">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">doom-load-theme-hook</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">set-appropriate-splash</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Splash screen:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::daemon initialisation][daemon initialisation]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defun</span> <span class="function-name">greedily-do-daemon-setup</span> <span class="rainbow-delimiters-depth-2">()</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="constant">require</span> <span class="highlight-quoted-quote">'</span><span class="constant">org</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">require</span> <span class="highlight-quoted-quote">'</span><span class="constant">mu4e</span> nil t<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> mu4e-confirm-quit t<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> +mu4e-lock-greedy t<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> +mu4e-lock-relaxed t<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span>+mu4e-lock-add-watcher<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-1">(</span>+mu4e-lock-available t<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span>mu4e~start<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">require</span> <span class="highlight-quoted-quote">'</span><span class="constant">elfeed</span> nil t<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">run-at-time</span> nil <span class="rainbow-delimiters-depth-1">(</span><span class="constant">*</span> <span class="highlight-numbers-number">8</span> <span class="highlight-numbers-number">60</span> <span class="highlight-numbers-number">60</span><span class="rainbow-delimiters-depth-1">)</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">elfeed-update</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">daemonp</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">emacs-startup-hook</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">greedily-do-daemon-setup</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">daemon initialisation ends here
</span>
<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">use-package!</span> keycast
  <span class="builtin">:commands</span> <span class="variable-name">keycast-mode</span>
  <span class="builtin">:config</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">define-minor-mode</span> <span class="variable-name">keycast-mode</span>
    <span class="doc">"Show current command and its key binding in the mode line."</span>
    <span class="builtin">:global</span> t
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> <span class="variable-name">keycast-mode</span>
        <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">progn</span>
          <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">pre-command-hook</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">keycast--update</span> t<span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-to-list</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">global-mode-string</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">""</span> mode-line-keycast <span class="string">" "</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">remove-hook</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">pre-command-hook</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">keycast--update</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> <span class="variable-name">global-mode-string</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">remove</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">""</span> mode-line-keycast <span class="string">" "</span><span class="rainbow-delimiters-depth-3">)</span> <span class="variable-name">global-mode-string</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">custom-set-faces!</span>
    <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span>keycast-command <span class="builtin">:inherit</span> doom-modeline-debug
                      <span class="builtin">:height</span> <span class="highlight-numbers-number">0.9</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span>keycast-key <span class="builtin">:inherit</span> custom-modified
                  <span class="builtin">:height</span> <span class="highlight-numbers-number">1.1</span>
                  <span class="builtin">:weight</span> bold<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">use-package!</span> gif-screencast
  <span class="builtin">:commands</span> gif-screencast-mode
  <span class="builtin">:config</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">map!</span> <span class="builtin">:map</span> gif-screencast-mode-map
        <span class="builtin">:g</span> <span class="string">"&lt;f8&gt;"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">gif-screencast-toggle-pause</span>
        <span class="builtin">:g</span> <span class="string">"&lt;f9&gt;"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">gif-screencast-stop</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> gif-screencast-program <span class="string">"maim"</span>
        gif-screencast-args <span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"--quality"</span> <span class="string">"3"</span> <span class="string">"-i"</span> ,<span class="rainbow-delimiters-depth-1">(</span><span class="function-name">string-trim-right</span>
                                                     <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">shell-command-to-string</span>
                                                      <span class="string">"xdotool getactivewindow"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        gif-screencast-optimize-args <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"--batch"</span> <span class="string">"--optimize=3"</span> <span class="string">"--usecolormap=/tmp/doom-color-theme"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">gif-screencast-write-colormap</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="rainbow-delimiters-depth-3">(</span>f-write-text
     <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">replace-regexp-in-string</span>
      <span class="string">"\n+"</span> <span class="string">"\n"</span>
      <span class="rainbow-delimiters-depth-2">(</span><span class="constant">mapconcat</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-1">(</span>c<span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">listp</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">cdr</span> c<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                                 <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">cadr</span> c<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span> <span class="variable-name">doom-themes--colors</span> <span class="string">"\n"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
     <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">utf-8</span>
     <span class="string">"/tmp/doom-color-theme"</span> <span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span>gif-screencast-write-colormap<span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">doom-load-theme-hook</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">gif-screencast-write-colormap</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">use-package!</span> vlf-setup
  <span class="builtin">:defer-incrementally</span> vlf-tune vlf-base vlf-write vlf-search vlf-occur vlf-follow vlf-ediff vlf<span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">use-package!</span> screenshot
  <span class="builtin">:defer</span> t
  <span class="builtin">:config</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> screenshot-upload-fn <span class="string">"upload %s 2&gt;/dev/null"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">use-package!</span> auto-activating-snippets
  <span class="builtin">:hook</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">LaTeX-mode</span> . <span class="variable-name">auto-activating-snippets-mode</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="builtin">:config</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">require</span> <span class="highlight-quoted-quote">'</span><span class="constant">latex-auto-activating-snippets</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">use-package!</span> latex-auto-activating-snippets
  <span class="builtin">:config</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">als-tex-fold-maybe</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">unless</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">equal</span> <span class="string">"/"</span> als-transient-snippet-key<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">+latex-fold-last-macro-a</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">aas-post-snippet-expand-hook</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">als-tex-fold-maybe</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">use-package!</span> engrave-faces-latex
  <span class="builtin">:after</span> ox-latex<span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">use-package!</span> ox-gfm
  <span class="builtin">:after</span> org<span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">use-package!</span> org-pandoc-import
  <span class="builtin">:after</span> org<span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">use-package</span> org-roam-server
  <span class="builtin">:after</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">org-roam</span> server<span class="rainbow-delimiters-depth-2">)</span>
  <span class="builtin">:config</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> org-roam-server-host <span class="string">"127.0.0.1"</span>
        org-roam-server-port <span class="highlight-numbers-number">8078</span>
        org-roam-server-export-inline-images t
        org-roam-server-authenticate nil
        org-roam-server-network-label-truncate t
        org-roam-server-network-label-truncate-length <span class="highlight-numbers-number">60</span>
        org-roam-server-network-label-wrap-length <span class="highlight-numbers-number">20</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">org-roam-server-open</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="doc">"Ensure the server is active, then open the roam graph."</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">interactive</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="variable-name">org-roam-server-mode</span> <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">browse-url-xdg-open</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">format</span> <span class="string">"http://localhost:%d"</span> org-roam-server-port<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">use-package!</span> authinfo-color-mode
  <span class="builtin">:mode</span> <span class="rainbow-delimiters-depth-2">(</span><span class="string">"authinfo.gpg\\'"</span> . authinfo-color-mode<span class="rainbow-delimiters-depth-2">)</span>
  <span class="builtin">:init</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">advice-add</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">authinfo-mode</span> <span class="builtin">:override</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">authinfo-color-mode</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Abbrev mode][Abbrev mode:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">use-package</span> abbrev
  <span class="builtin">:init</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq-default</span> <span class="variable-name">abbrev-mode</span> t<span class="rainbow-delimiters-depth-2">)</span>
  <span class="comment-delimiter">;; </span><span class="comment">a hook funtion that sets the abbrev-table to org-mode-abbrev-table
</span>  <span class="comment-delimiter">;; </span><span class="comment">whenever the major mode is a text mode
</span>  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">tec/set-text-mode-abbrev-table</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">derived-mode-p</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">text-mode</span><span class="rainbow-delimiters-depth-1">)</span>
        <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> <span class="variable-name">local-abbrev-table</span> org-mode-abbrev-table<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="builtin">:commands</span> <span class="variable-name">abbrev-mode</span>
  <span class="builtin">:hook</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="variable-name">abbrev-mode</span> . tec/set-text-mode-abbrev-table<span class="rainbow-delimiters-depth-2">)</span>
  <span class="builtin">:config</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> <span class="variable-name">abbrev-file-name</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">expand-file-name</span> <span class="string">"abbrev.el"</span> <span class="variable-name">doom-private-dir</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> <span class="variable-name">save-abbrevs</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">silently</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Abbrev mode:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Calc][Calc:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">calc-mode-hook</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calctex-mode</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Calc:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Centaur Tabs][Centaur Tabs:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> centaur-tabs
  <span class="rainbow-delimiters-depth-2">(</span>centaur-tabs-mode <span class="highlight-numbers-number">-1</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> centaur-tabs-height <span class="highlight-numbers-number">36</span>
        centaur-tabs-set-icons t
        centaur-tabs-modified-marker <span class="string">"o"</span>
        centaur-tabs-close-button <span class="string">"&#195;&#151;"</span>
        centaur-tabs-set-bar <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">above</span>
        centaur-tabs-gray-out-icons <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">buffer</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span>centaur-tabs-change-fonts <span class="string">"P22 Underground Book"</span> <span class="highlight-numbers-number">160</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">(setq x-underline-at-descent-line t)
</span><span class="comment-delimiter">;; </span><span class="comment">Centaur Tabs:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Company][Company:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> company
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> company-idle-delay <span class="highlight-numbers-number">0.5</span>
        company-minimum-prefix-length <span class="highlight-numbers-number">2</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> company-show-numbers t<span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">evil-normal-state-entry-hook</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">company-abort</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span> <span class="comment-delimiter">;; </span><span class="comment">make aborting less annoying.
</span><span class="comment-delimiter">;; </span><span class="comment">Company:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Company][Company:2]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq-default</span> <span class="variable-name">history-length</span> <span class="highlight-numbers-number">1000</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq-default</span> prescient-history-length <span class="highlight-numbers-number">1000</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Company:2 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Plain Text][Plain Text:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="function-name">set-company-backend!</span>
  <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span>text-mode
    markdown-mode
    gfm-mode<span class="rainbow-delimiters-depth-2">)</span>
  <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span><span class="builtin">:seperate</span>
    company-ispell
    company-files
    company-yasnippet<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Plain Text:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*ESS][ESS:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="function-name">set-company-backend!</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">ess-r-mode</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span>company-R-args company-R-objects company-dabbrev-code <span class="builtin">:separate</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">ESS:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Elcord][Elcord:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> elcord-use-major-mode-as-main-icon t<span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Elcord:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*[[https://github.com/zachcurry/emacs-anywhere\][Emacs Anywhere\]] configuration][[[https://github.com/zachcurry/emacs-anywhere][Emacs Anywhere]] configuration:2]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defun</span> <span class="function-name">markdown-window-p</span> <span class="rainbow-delimiters-depth-2">(</span>window-title<span class="rainbow-delimiters-depth-2">)</span>
  <span class="doc">"Judges from WINDOW-TITLE whether the current window likes markdown"</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">string-match-p</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">rx</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> <span class="string">"Stack Exchange"</span> <span class="string">"Stack Overflow"</span>
                              <span class="string">"Pull Request"</span> <span class="string">"Issue"</span> <span class="string">"Discord"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                      window-title<span class="rainbow-delimiters-depth-3">)</span> <span class="warning-1">t nil</span><span class="warning-1"><span class="rainbow-delimiters-depth-2">)</span></span><span class="warning-1"><span class="rainbow-delimiters-depth-1">)</span></span>
<span class="comment-delimiter">;; </span><span class="comment">[[https://github.com/zachcurry/emacs-anywhere][Emacs Anywhere]] configuration:2 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*[[https://github.com/zachcurry/emacs-anywhere\][Emacs Anywhere\]] configuration][[[https://github.com/zachcurry/emacs-anywhere][Emacs Anywhere]] configuration:3]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defvar</span> <span class="variable-name">emacs-anywhere--active-markdown</span> nil
  <span class="doc">"Whether the buffer started off as markdown.
Affects behaviour of `</span><span class="doc"><span class="constant">emacs-anywhere--finalise-content</span></span><span class="doc">'"</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defun</span> <span class="function-name">emacs-anywhere--finalise-content</span> <span class="rainbow-delimiters-depth-2">(</span><span class="type">&amp;optional</span> _frame<span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">when</span> <span class="variable-name">emacs-anywhere--active-markdown</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">fundamental-mode</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">goto-char</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">point-min</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">insert</span> <span class="string">"#+property: header-args :exports both\n#+options: toc:nil\n"</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">rename-buffer</span> <span class="string">"*EA Pre Export*"</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span>org-export-to-buffer <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">gfm</span> ea--buffer-name<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">kill-buffer</span> <span class="string">"*EA Pre Export*"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">gui-select-text</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">buffer-string</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">define-minor-mode</span> <span class="variable-name">emacs-anywhere-mode</span>
  <span class="doc">"To tweak the current buffer for some emacs-anywhere considerations"</span>
  <span class="builtin">:init-value</span> nil
  <span class="builtin">:keymap</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">list</span>
           <span class="comment-delimiter">;; </span><span class="comment">Finish edit, but be smart in org mode
</span>           <span class="rainbow-delimiters-depth-3">(</span><span class="constant">cons</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">kbd</span> <span class="string">"C-c C-c"</span><span class="rainbow-delimiters-depth-1">)</span>
                 <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">cmd!</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">eq</span> <span class="variable-name">major-mode</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-mode</span><span class="rainbow-delimiters-depth-1">)</span>
                                <span class="rainbow-delimiters-depth-1">(</span>org-in-src-block-p<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                           <span class="rainbow-delimiters-depth-3">(</span>org-ctrl-c-ctrl-c<span class="rainbow-delimiters-depth-3">)</span>
                         <span class="rainbow-delimiters-depth-3">(</span><span class="constant">delete-frame</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
           <span class="comment-delimiter">;; </span><span class="comment">Abort edit. emacs-anywhere saves the current edit for next time.
</span>           <span class="rainbow-delimiters-depth-3">(</span><span class="constant">cons</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">kbd</span> <span class="string">"C-c C-k"</span><span class="rainbow-delimiters-depth-1">)</span>
                 <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">cmd!</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> ea-on nil<span class="rainbow-delimiters-depth-2">)</span>
                       <span class="rainbow-delimiters-depth-2">(</span><span class="constant">delete-frame</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">when</span> <span class="variable-name">emacs-anywhere-mode</span>
    <span class="comment-delimiter">;; </span><span class="comment">line breaking
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">turn-off-auto-fill</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="variable-name">visual-line-mode</span> t<span class="rainbow-delimiters-depth-3">)</span>
    <span class="comment-delimiter">;; </span><span class="comment">DEL/C-SPC to clear (first keystroke only)
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">set-transient-map</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>keymap <span class="rainbow-delimiters-depth-1">(</span><span class="constant">make-sparse-keymap</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="constant">define-key</span> keymap <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">kbd</span> <span class="string">"DEL"</span><span class="rainbow-delimiters-depth-3">)</span>   <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">cmd!</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">delete-region</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">point-min</span><span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">point-max</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="constant">define-key</span> keymap <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">kbd</span> <span class="string">"C-SPC"</span><span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">cmd!</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">delete-region</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">point-min</span><span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">point-max</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                         keymap<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="comment-delimiter">;; </span><span class="comment">disable tabs
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">bound-and-true-p</span> centaur-tabs-mode<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span>centaur-tabs-local-mode t<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defun</span> <span class="function-name">ea-popup-handler</span> <span class="rainbow-delimiters-depth-2">(</span>app-name window-title x y w h<span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">interactive</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="constant">set-frame-size</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">selected-frame</span><span class="rainbow-delimiters-depth-3">)</span> <span class="highlight-numbers-number">80</span> <span class="highlight-numbers-number">12</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="comment-delimiter">;; </span><span class="comment">position the frame near the mouse
</span>  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>mousepos <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">split-string</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">shell-command-to-string</span> <span class="string">"xdotool getmouselocation | sed -E \"s/ screen:0 window:[</span><span class="string"><span class="negation-char">^</span></span><span class="string"> ]*|x:|y://g\""</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
         <span class="rainbow-delimiters-depth-1">(</span>mouse-x <span class="rainbow-delimiters-depth-2">(</span><span class="constant">-</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">string-to-number</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">0</span> mousepos<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span> <span class="highlight-numbers-number">100</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
         <span class="rainbow-delimiters-depth-1">(</span>mouse-y <span class="rainbow-delimiters-depth-2">(</span><span class="constant">-</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">string-to-number</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">1</span> mousepos<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span> <span class="highlight-numbers-number">50</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">set-frame-position</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">selected-frame</span><span class="rainbow-delimiters-depth-1">)</span> mouse-x mouse-y<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">set-frame-name</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">concat</span> <span class="string">"Quick Edit &#226;&#136;&#183; "</span> ea-app-name <span class="string">" &#226;&#128;&#148; "</span>
                          <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">truncate-string-to-width</span>
                           <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">string-trim</span>
                            <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">string-trim-right</span> window-title
                                               <span class="rainbow-delimiters-depth-1">(</span><span class="constant">format</span> <span class="string">"-[A-Za-z0-9 ]*%s"</span> ea-app-name<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                            <span class="string">"[\s-]+"</span> <span class="string">"[\s-]+"</span><span class="rainbow-delimiters-depth-2">)</span>
                           <span class="highlight-numbers-number">45</span> nil nil <span class="string">"&#226;&#128;&#166;"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">when-let</span> <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>selection <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">gui-get-selection</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">PRIMARY</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">insert</span> selection<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="comment-delimiter">;; </span><span class="comment">convert buffer to org mode if markdown
</span>  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">markdown-window-p</span> window-title<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">shell-command-on-region</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">point-min</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">point-max</span><span class="rainbow-delimiters-depth-1">)</span>
                             <span class="string">"pandoc -f markdown -t org"</span> nil t<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="variable-name">deactivate-mark</span><span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">goto-char</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">point-max</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="comment-delimiter">;; </span><span class="comment">remove any blank newline at end
</span>  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">delete-trailing-whitespace</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="constant">delete-char</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">-</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">skip-chars-backward</span> <span class="string">"\n"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="comment-delimiter">;; </span><span class="comment">set major mode
</span>  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">org-mode</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="comment-delimiter">;; </span><span class="comment">set markdown status
</span>  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq-local</span> <span class="variable-name">emacs-anywhere--active-markdown</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">markdown-window-p</span> window-title<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">advice-add</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">ea--delete-frame-handler</span> <span class="builtin">:before</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">emacs-anywhere--finalise-content</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="comment-delimiter">;; </span><span class="comment">I'll be honest with myself, I /need/ spellcheck
</span>  <span class="rainbow-delimiters-depth-2">(</span>spell-fu-buffer<span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">evil-insert-state</span><span class="rainbow-delimiters-depth-2">)</span> <span class="comment-delimiter">; </span><span class="comment">start in insert
</span>  <span class="rainbow-delimiters-depth-2">(</span><span class="variable-name">emacs-anywhere-mode</span> <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">ea-popup-hook</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">ea-popup-handler</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">[[https://github.com/zachcurry/emacs-anywhere][Emacs Anywhere]] configuration:3 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*[[https://github.com/zachcurry/emacs-anywhere\][Emacs Anywhere\]] configuration][[[https://github.com/zachcurry/emacs-anywhere][Emacs Anywhere]] configuration:4]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">add-hook!</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span>mu4e-compose-mode org-msg-edit-mode circe-channel-mode<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span>emoticon-to-emoji <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">[[https://github.com/zachcurry/emacs-anywhere][Emacs Anywhere]] configuration:4 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Eros-eval][Eros-eval:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> <span class="variable-name">eros-eval-result-prefix</span> <span class="string">"&#226;&#159;&#185; "</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Eros-eval:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*EVIL][EVIL:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> evil-escape <span class="rainbow-delimiters-depth-2">(</span><span class="variable-name">evil-escape-mode</span> <span class="highlight-numbers-number">-1</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">EVIL:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*EVIL][EVIL:2]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> evil <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> <span class="variable-name">evil-ex-substitute-global</span> t<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span> <span class="comment-delimiter">; </span><span class="comment">I like my s/../.. to by global by default
</span><span class="comment-delimiter">;; </span><span class="comment">EVIL:2 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Info colours][Info colours:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">use-package!</span> info-colors
  <span class="builtin">:commands</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">info-colors-fontify-node</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">Info-selection-hook</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">info-colors-fontify-node</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">Info-mode-hook</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">mixed-pitch-mode</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Info colours:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Configuration][Configuration:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> <span class="variable-name">ispell-dictionary</span> <span class="string">"en-custom"</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Configuration:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Configuration][Configuration:2]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> <span class="variable-name">ispell-personal-dictionary</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">expand-file-name</span> <span class="string">".ispell_personal"</span> <span class="variable-name">doom-private-dir</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Configuration:2 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Ivy][Ivy:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> ivy-read-action-function <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">ivy-hydra-read-action</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Ivy:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Ivy][Ivy:2]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> ivy-sort-max-size <span class="highlight-numbers-number">50000</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Ivy:2 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Magit][Magit:1]]
</span><span class="comment-delimiter">;; </span><span class="comment">(after! magit
</span><span class="comment-delimiter">;;   </span><span class="comment">(magit-delta-mode +1))
</span><span class="comment-delimiter">;; </span><span class="comment">Magit:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Org Chef][Org Chef:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">use-package!</span> org-chef
  <span class="builtin">:commands</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">org-chef-insert-recipe</span> org-chef-get-recipe-from-url<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Org Chef:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Projectile][Projectile:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> <span class="variable-name">projectile-ignored-projects</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span><span class="string">"~/"</span> <span class="string">"/tmp"</span> <span class="string">"~/.emacs.d/.local/straight/repos/"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defun</span> <span class="variable-name">projectile-ignored-project-function</span> <span class="rainbow-delimiters-depth-2">(</span>filepath<span class="rainbow-delimiters-depth-2">)</span>
  <span class="doc">"Return t if FILEPATH is within any of `</span><span class="doc"><span class="constant">projectile-ignored-projects</span></span><span class="doc">'"</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">mapcar</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-2">(</span>p<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span>s-starts-with-p p filepath<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span> <span class="variable-name">projectile-ignored-projects</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Projectile:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Smart Parentheses][Smart Parentheses:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="function-name">sp-local-pair</span>
 <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span>org-mode<span class="rainbow-delimiters-depth-2">)</span>
 <span class="string">"&lt;&lt;"</span> <span class="string">"&gt;&gt;"</span>
 <span class="builtin">:actions</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span>insert<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Smart Parentheses:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Spray][Spray:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> spray-wpm <span class="highlight-numbers-number">500</span>
      spray-height <span class="highlight-numbers-number">700</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Spray:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Tramp][Tramp:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> tramp
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">setenv</span> <span class="string">"SHELL"</span> <span class="string">"/bin/bash"</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> tramp-shell-prompt-pattern <span class="string">"</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(?:</span></span><span class="string">^</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">|</span></span><span class="string"></span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">[</span><span class="string"><span class="negation-char">^</span></span><span class="string">]#$%&gt;\n]*#?[]#$%&gt;&#238;&#130;&#176;] *</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">&#27;\\[[0-9;]*[a-zA-Z] *</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">*"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span> <span class="comment-delimiter">;; </span><span class="comment">default + &#238;&#130;&#176;
</span><span class="comment-delimiter">;; </span><span class="comment">Tramp:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Guix][Guix:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> tramp
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">appendq!</span> tramp-remote-path
            <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"~/.guix-profile/bin"</span> <span class="string">"~/.guix-profile/sbin"</span>
              <span class="string">"/run/current-system/profile/bin"</span>
              <span class="string">"/run/current-system/profile/sbin"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Guix:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Treemacs][Treemacs:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> treemacs
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">treemacs-file-ignore-extensions</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">()</span>
    <span class="doc">"File extension which `</span><span class="doc"><span class="constant">treemacs-ignore-filter</span></span><span class="doc">' will ensure are ignored"</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">treemacs-file-ignore-globs</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">()</span>
    <span class="doc">"Globs which will are transformed to `</span><span class="doc"><span class="constant">treemacs-file-ignore-regexps</span></span><span class="doc">' which `</span><span class="doc"><span class="constant">treemacs-ignore-filter</span></span><span class="doc">' will ensure are ignored"</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">treemacs-file-ignore-regexps</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">()</span>
    <span class="doc">"RegExps to be tested to ignore files, generated from `</span><span class="doc"><span class="constant">treeemacs-file-ignore-globs</span></span><span class="doc">'"</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">treemacs-file-ignore-generate-regexps</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="doc">"Generate `</span><span class="doc"><span class="constant">treemacs-file-ignore-regexps</span></span><span class="doc">' from `</span><span class="doc"><span class="constant">treemacs-file-ignore-globs</span></span><span class="doc">'"</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> treemacs-file-ignore-regexps <span class="rainbow-delimiters-depth-1">(</span><span class="constant">mapcar</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">dired-glob-regexp</span> treemacs-file-ignore-globs<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">equal</span> treemacs-file-ignore-globs <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-1">()</span><span class="rainbow-delimiters-depth-3">)</span> nil <span class="rainbow-delimiters-depth-3">(</span>treemacs-file-ignore-generate-regexps<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">treemacs-ignore-filter</span> <span class="rainbow-delimiters-depth-3">(</span>file full-path<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Ignore files specified by `</span><span class="doc"><span class="constant">treemacs-file-ignore-extensions</span></span><span class="doc">', and `</span><span class="doc"><span class="constant">treemacs-file-ignore-regexps</span></span><span class="doc">'"</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">member</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">file-name-extension</span> file<span class="rainbow-delimiters-depth-2">)</span> treemacs-file-ignore-extensions<span class="rainbow-delimiters-depth-1">)</span>
        <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>ignore-file nil<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">dolist</span> <span class="rainbow-delimiters-depth-3">(</span>regexp treemacs-file-ignore-regexps ignore-file<span class="rainbow-delimiters-depth-3">)</span>
            <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> ignore-file <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> ignore-file <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">string-match-p</span> regexp full-path<span class="rainbow-delimiters-depth-3">)</span> t nil<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-to-list</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">treemacs-ignored-file-predicates</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">treemacs-ignore-filter</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Treemacs:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Treemacs][Treemacs:2]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> treemacs-file-ignore-extensions
      <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span><span class="comment-delimiter">;; </span><span class="comment">LaTeX
</span>        <span class="string">"aux"</span>
        <span class="string">"ptc"</span>
        <span class="string">"fdb_latexmk"</span>
        <span class="string">"fls"</span>
        <span class="string">"synctex.gz"</span>
        <span class="string">"toc"</span>
        <span class="comment-delimiter">;; </span><span class="comment">LaTeX - glossary
</span>        <span class="string">"glg"</span>
        <span class="string">"glo"</span>
        <span class="string">"gls"</span>
        <span class="string">"glsdefs"</span>
        <span class="string">"ist"</span>
        <span class="string">"acn"</span>
        <span class="string">"acr"</span>
        <span class="string">"alg"</span>
        <span class="comment-delimiter">;; </span><span class="comment">LaTeX - pgfplots
</span>        <span class="string">"mw"</span>
        <span class="comment-delimiter">;; </span><span class="comment">LaTeX - pdfx
</span>        <span class="string">"pdfa.xmpi"</span>
        <span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> treemacs-file-ignore-globs
      <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span><span class="comment-delimiter">;; </span><span class="comment">LaTeX
</span>        <span class="string">"*/_minted-*"</span>
        <span class="comment-delimiter">;; </span><span class="comment">AucTeX
</span>        <span class="string">"*/.auctex-auto"</span>
        <span class="string">"*/_region_.log"</span>
        <span class="string">"*/_region_.tex"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Treemacs:2 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Which-key][Which-key:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> which-key-idle-delay <span class="highlight-numbers-number">0.5</span><span class="rainbow-delimiters-depth-1">)</span> <span class="comment-delimiter">;; </span><span class="comment">I need the help, I really do
</span><span class="comment-delimiter">;; </span><span class="comment">Which-key:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Which-key][Which-key:2]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> which-key-allow-multiple-replacements t<span class="rainbow-delimiters-depth-1">)</span>
<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> which-key
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">pushnew!</span>
   which-key-replacement-alist
   <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span><span class="string">""</span> . <span class="string">"\\`+?evil[-:]?</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(?:</span></span><span class="string">a-</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">?</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">.*</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">"</span><span class="rainbow-delimiters-depth-1">)</span> . <span class="rainbow-delimiters-depth-1">(</span>nil . <span class="string">"&#226;&#151;&#130;\\1"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
   <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span><span class="string">"\\`g s"</span> . <span class="string">"\\`evilem--?motion-</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">.*</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">"</span><span class="rainbow-delimiters-depth-1">)</span> . <span class="rainbow-delimiters-depth-1">(</span>nil . <span class="string">"&#226;&#151;&#131;\\1"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
   <span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Which-key:2 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Writeroom][Writeroom:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> <span class="variable-name">+zen-text-scale</span> <span class="highlight-numbers-number">0.6</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Writeroom:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Writeroom][Writeroom:2]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> writeroom-mode
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">writeroom-mode-hook</span>
            <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">+zen-cleaner-org</span> <span class="rainbow-delimiters-depth-1">()</span>
              <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">eq</span> <span class="variable-name">major-mode</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-mode</span><span class="rainbow-delimiters-depth-3">)</span> writeroom-mode<span class="rainbow-delimiters-depth-2">)</span>
                <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq-local</span> -display-line-numbers <span class="variable-name">display-line-numbers</span>
                            <span class="variable-name">display-line-numbers</span> nil<span class="rainbow-delimiters-depth-2">)</span>
                <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq-local</span> -org-indent-mode org-indent-mode<span class="rainbow-delimiters-depth-2">)</span>
                <span class="rainbow-delimiters-depth-2">(</span>org-indent-mode <span class="highlight-numbers-number">-1</span><span class="rainbow-delimiters-depth-2">)</span>
                <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">featurep</span> <span class="highlight-quoted-quote">'</span><span class="constant">org-superstar</span><span class="rainbow-delimiters-depth-3">)</span>
                  <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq-local</span> -org-superstar-headline-bullets-list org-superstar-headline-bullets-list
                              <span class="comment-delimiter">;; </span><span class="comment">org-superstar-headline-bullets-list '("&#240;&#159;&#153;&#144;" "&#240;&#159;&#153;&#145;" "&#240;&#159;&#153;&#146;" "&#240;&#159;&#153;&#147;" "&#240;&#159;&#153;&#148;" "&#240;&#159;&#153;&#149;" "&#240;&#159;&#153;&#150;" "&#240;&#159;&#153;&#151;")
</span>                              org-superstar-headline-bullets-list <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-1">(</span><span class="string">"&#240;&#159;&#153;&#152;"</span> <span class="string">"&#240;&#159;&#153;&#153;"</span> <span class="string">"&#240;&#159;&#153;&#154;"</span> <span class="string">"&#240;&#159;&#153;&#155;"</span><span class="rainbow-delimiters-depth-1">)</span>
                              -org-superstar-remove-leading-stars org-superstar-remove-leading-stars
                              org-superstar-remove-leading-stars t<span class="rainbow-delimiters-depth-3">)</span>
                  <span class="rainbow-delimiters-depth-3">(</span>org-superstar-restart<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">writeroom-mode-disable-hook</span>
            <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">+zen-dirty-org</span> <span class="rainbow-delimiters-depth-1">()</span>
              <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">eq</span> <span class="variable-name">major-mode</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-mode</span><span class="rainbow-delimiters-depth-2">)</span>
                <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq-local</span> <span class="variable-name">display-line-numbers</span> -display-line-numbers<span class="rainbow-delimiters-depth-2">)</span>
                <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">when</span> -org-indent-mode
                  <span class="rainbow-delimiters-depth-3">(</span>org-indent-mode <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">featurep</span> <span class="highlight-quoted-quote">'</span><span class="constant">org-superstar</span><span class="rainbow-delimiters-depth-3">)</span>
                  <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq-local</span> org-superstar-headline-bullets-list -org-superstar-headline-bullets-list
                              org-superstar-remove-leading-stars -org-superstar-remove-leading-stars<span class="rainbow-delimiters-depth-3">)</span>
                  <span class="rainbow-delimiters-depth-3">(</span>org-superstar-restart<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Writeroom:2 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*xkcd][xkcd:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">use-package!</span> xkcd
  <span class="builtin">:commands</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">xkcd-get-json</span>
             xkcd-download xkcd-get
             <span class="comment-delimiter">;; </span><span class="comment">now for funcs from my extension of this pkg
</span>             +xkcd-find-and-copy +xkcd-find-and-view
             +xkcd-fetch-info +xkcd-select<span class="rainbow-delimiters-depth-2">)</span>
  <span class="builtin">:config</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> xkcd-cache-dir <span class="rainbow-delimiters-depth-3">(</span><span class="constant">expand-file-name</span> <span class="string">"xkcd/"</span> <span class="variable-name">doom-cache-dir</span><span class="rainbow-delimiters-depth-3">)</span>
        xkcd-cache-latest <span class="rainbow-delimiters-depth-3">(</span><span class="constant">concat</span> xkcd-cache-dir <span class="string">"latest"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">unless</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">file-exists-p</span> xkcd-cache-dir<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">make-directory</span> xkcd-cache-dir<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">after!</span> evil-snipe
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">add-to-list</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">evil-snipe-disabled-modes</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">xkcd-mode</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="builtin">:general</span> <span class="rainbow-delimiters-depth-2">(</span><span class="builtin">:states</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">normal</span>
            <span class="builtin">:keymaps</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">xkcd-mode-map</span>
            <span class="string">"&lt;right&gt;"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">xkcd-next</span>
            <span class="string">"n"</span>       <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">xkcd-next</span> <span class="comment-delimiter">; </span><span class="comment">evil-ish
</span>            <span class="string">"&lt;left&gt;"</span>  <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">xkcd-prev</span>
            <span class="string">"N"</span>       <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">xkcd-prev</span> <span class="comment-delimiter">; </span><span class="comment">evil-ish
</span>            <span class="string">"r"</span>       <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">xkcd-rand</span>
            <span class="string">"a"</span>       <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">xkcd-rand</span> <span class="comment-delimiter">; </span><span class="comment">because image-rotate can interfere
</span>            <span class="string">"t"</span>       <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">xkcd-alt-text</span>
            <span class="string">"q"</span>       <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">xkcd-kill-buffer</span>
            <span class="string">"o"</span>       <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">xkcd-open-browser</span>
            <span class="string">"e"</span>       <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">xkcd-open-explanation-browser</span>
            <span class="comment-delimiter">;; </span><span class="comment">extras
</span>            <span class="string">"s"</span>       <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">+xkcd-find-and-view</span>
            <span class="string">"/"</span>       <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">+xkcd-find-and-view</span>
            <span class="string">"y"</span>       <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">+xkcd-copy</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">xkcd:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*xkcd][xkcd:2]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> xkcd
  <span class="rainbow-delimiters-depth-2">(</span><span class="constant">require</span> <span class="highlight-quoted-quote">'</span><span class="constant">emacsql-sqlite</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+xkcd-select</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="doc">"Prompt the user for an xkcd using `</span><span class="doc"><span class="constant">ivy-read</span></span><span class="doc">' and `</span><span class="doc"><span class="constant">+xkcd-select-format</span></span><span class="doc">'. Return the xkcd number or nil"</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-1">(</span>prompt-lines
           <span class="rainbow-delimiters-depth-2">(</span>-dummy <span class="rainbow-delimiters-depth-3">(</span><span class="constant">maphash</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-2">(</span>key xkcd-info<span class="rainbow-delimiters-depth-2">)</span>
                              <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">push</span> <span class="rainbow-delimiters-depth-3">(</span>+xkcd-select-format xkcd-info<span class="rainbow-delimiters-depth-3">)</span> prompt-lines<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                            +xkcd-stored-info<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>num <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">ivy-read</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">format</span> <span class="string">"xkcd (%s): "</span> xkcd-latest<span class="rainbow-delimiters-depth-1">)</span> prompt-lines<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">equal</span> <span class="string">""</span> num<span class="rainbow-delimiters-depth-2">)</span> xkcd-latest
        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">string-to-number</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">replace-regexp-in-string</span> <span class="string">"</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">[0-9]+</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">.*"</span> <span class="string">"\\1"</span> num<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+xkcd-select-format</span> <span class="rainbow-delimiters-depth-3">(</span>xkcd-info<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Creates each ivy-read line from an xkcd info plist. Must start with the xkcd number"</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"%-4s  %-30s %s"</span>
            <span class="rainbow-delimiters-depth-1">(</span><span class="constant">propertize</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">number-to-string</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> xkcd-info <span class="builtin">:num</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                        <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">counsel-key-binding</span><span class="rainbow-delimiters-depth-1">)</span>
            <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> xkcd-info <span class="builtin">:title</span><span class="rainbow-delimiters-depth-1">)</span>
            <span class="rainbow-delimiters-depth-1">(</span><span class="constant">propertize</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> xkcd-info <span class="builtin">:alt</span><span class="rainbow-delimiters-depth-2">)</span>
                        <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span>variable-pitch <span class="variable-name">font-lock-comment-face</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+xkcd-fetch-info</span> <span class="rainbow-delimiters-depth-3">(</span><span class="type">&amp;optional</span> num<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Fetch the parsed json info for comic NUM. Fetches latest when omitted or 0"</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">require</span> <span class="highlight-quoted-quote">'</span><span class="constant">xkcd</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">not</span> num<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">=</span> num <span class="highlight-numbers-number">0</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span>+xkcd-check-latest<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> num xkcd-latest<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>res <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">gethash</span> num +xkcd-stored-info<span class="rainbow-delimiters-depth-1">)</span>
                   <span class="rainbow-delimiters-depth-1">(</span><span class="constant">puthash</span> num <span class="rainbow-delimiters-depth-2">(</span>+xkcd-db-read num<span class="rainbow-delimiters-depth-2">)</span> +xkcd-stored-info<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">unless</span> res
        <span class="rainbow-delimiters-depth-2">(</span>+xkcd-db-write
         <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>url <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"https://xkcd.com/%d/info.0.json"</span> num<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                <span class="rainbow-delimiters-depth-2">(</span>json-assoc
                 <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">gethash</span> num +xkcd-stored-info<span class="rainbow-delimiters-depth-1">)</span>
                     <span class="rainbow-delimiters-depth-1">(</span><span class="constant">gethash</span> num +xkcd-stored-info<span class="rainbow-delimiters-depth-1">)</span>
                   <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">json-read-from-string</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">xkcd-get-json</span> url num<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
           json-assoc<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> res <span class="rainbow-delimiters-depth-3">(</span>+xkcd-db-read num<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      res<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="comment-delimiter">;; </span><span class="comment">since we've done this, we may as well go one little step further
</span>  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+xkcd-find-and-copy</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="doc">"Prompt for an xkcd using `</span><span class="doc"><span class="constant">+xkcd-select</span></span><span class="doc">' and copy url to clipboard"</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">interactive</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">+xkcd-copy</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">+xkcd-select</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+xkcd-copy</span> <span class="rainbow-delimiters-depth-3">(</span><span class="type">&amp;optional</span> num<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Copy a url to xkcd NUM to the clipboard"</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">interactive</span> <span class="string">"i"</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>num <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">or</span> num xkcd-cur<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">gui-select-text</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">format</span> <span class="string">"https://xkcd.com/%d"</span> num<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">message</span> <span class="string">"xkcd.com/%d copied to clipboard"</span> num<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+xkcd-find-and-view</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="doc">"Prompt for an xkcd using `</span><span class="doc"><span class="constant">+xkcd-select</span></span><span class="doc">' and view it"</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">interactive</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">xkcd-get</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">+xkcd-select</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">switch-to-buffer</span> <span class="string">"*xkcd*"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">+xkcd-latest-max-age</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">*</span> <span class="highlight-numbers-number">60</span> <span class="highlight-numbers-number">60</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">1 hour
</span>    <span class="doc">"Time after which xkcd-latest should be refreshed, in seconds"</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="comment-delimiter">;; </span><span class="comment">initialise `</span><span class="comment"><span class="constant">xkcd-latest</span></span><span class="comment">' and `</span><span class="comment"><span class="constant">+xkcd-stored-info</span></span><span class="comment">' with latest xkcd
</span>  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">add-transient-hook!</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">+xkcd-select</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">require</span> <span class="highlight-quoted-quote">'</span><span class="constant">xkcd</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">+xkcd-fetch-info</span> xkcd-latest<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> +xkcd-stored-info <span class="rainbow-delimiters-depth-1">(</span>+xkcd-db-read-all<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">add-transient-hook!</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">+xkcd-fetch-info</span>
    <span class="rainbow-delimiters-depth-3">(</span>xkcd-update-latest<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+xkcd-check-latest</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="doc">"Use value in `</span><span class="doc"><span class="constant">xkcd-cache-latest</span></span><span class="doc">' as long as it isn't older thabn `</span><span class="doc"><span class="constant">+xkcd-latest-max-age</span></span><span class="doc">'"</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">unless</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">file-exists-p</span> xkcd-cache-latest<span class="rainbow-delimiters-depth-2">)</span>
                 <span class="rainbow-delimiters-depth-2">(</span><span class="constant">&lt;</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">-</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">time-to-seconds</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">current-time</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                       <span class="rainbow-delimiters-depth-1">(</span><span class="constant">time-to-seconds</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">file-attribute-modification-time</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">file-attributes</span> xkcd-cache-latest<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                    +xkcd-latest-max-age<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>out <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">xkcd-get-json</span> <span class="string">"http://xkcd.com/info.0.json"</span> <span class="highlight-numbers-number">0</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>json-assoc <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">json-read-from-string</span> out<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>latest <span class="rainbow-delimiters-depth-1">(</span><span class="constant">cdr</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">assoc</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">num</span> json-assoc<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">/=</span> xkcd-latest latest<span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span>+xkcd-db-write json-assoc<span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">with-current-buffer</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">find-file</span> xkcd-cache-latest<span class="rainbow-delimiters-depth-1">)</span>
            <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> xkcd-latest latest<span class="rainbow-delimiters-depth-1">)</span>
            <span class="rainbow-delimiters-depth-1">(</span><span class="constant">erase-buffer</span><span class="rainbow-delimiters-depth-1">)</span>
            <span class="rainbow-delimiters-depth-1">(</span><span class="constant">insert</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">number-to-string</span> latest<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
            <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">save-buffer</span><span class="rainbow-delimiters-depth-1">)</span>
            <span class="rainbow-delimiters-depth-1">(</span><span class="constant">kill-buffer</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">current-buffer</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">shell-command</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">format</span> <span class="string">"touch %s"</span> xkcd-cache-latest<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">+xkcd-stored-info</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">make-hash-table</span> <span class="builtin">:test</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">eql</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Basic info on downloaded xkcds, in the form of a hashtable"</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defadvice!</span> xkcd-get-json--and-cache <span class="rainbow-delimiters-depth-3">(</span>url <span class="type">&amp;optional</span> num<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Fetch the Json coming from URL.
If the file NUM.json exists, use it instead.
If NUM is 0, always download from URL.
The return value is a string."</span>
    <span class="builtin">:override</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">xkcd-get-json</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>file <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"%s%d.json"</span> xkcd-cache-dir num<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>cached <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">file-exists-p</span> file<span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">not</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">eq</span> num <span class="highlight-numbers-number">0</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>out <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">with-current-buffer</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> cached
                                         <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">find-file</span> file<span class="rainbow-delimiters-depth-2">)</span>
                                       <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">url-retrieve-synchronously</span> url<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                  <span class="rainbow-delimiters-depth-1">(</span><span class="constant">goto-char</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">point-min</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                  <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">unless</span> cached <span class="rainbow-delimiters-depth-2">(</span><span class="constant">re-search-forward</span> <span class="string">"^$"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                  <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">prog1</span>
                      <span class="rainbow-delimiters-depth-2">(</span><span class="constant">buffer-substring-no-properties</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">point</span><span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">point-max</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                    <span class="rainbow-delimiters-depth-2">(</span><span class="constant">kill-buffer</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">current-buffer</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">unless</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> cached <span class="rainbow-delimiters-depth-3">(</span><span class="constant">eq</span> num <span class="highlight-numbers-number">0</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span>xkcd-cache-json num out<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      out<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defadvice!</span> +xkcd-get <span class="rainbow-delimiters-depth-3">(</span>num<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Get the xkcd number NUM."</span>
    <span class="builtin">:override</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">xkcd-get</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">interactive</span> <span class="string">"nEnter comic number: "</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span>xkcd-update-latest<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">get-buffer-create</span> <span class="string">"*xkcd*"</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">switch-to-buffer</span> <span class="string">"*xkcd*"</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">xkcd-mode</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="variable-name">buffer-read-only</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">erase-buffer</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> xkcd-cur num<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>xkcd-data <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">+xkcd-fetch-info</span> num<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>num <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> xkcd-data <span class="builtin">:num</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>img <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> xkcd-data <span class="builtin">:img</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>safe-title <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> xkcd-data <span class="builtin">:safe-title</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>alt <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> xkcd-data <span class="builtin">:alt</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             title file<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">message</span> <span class="string">"Getting comic..."</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> file <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">xkcd-download</span> img num<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> title <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"%d: %s"</span> num safe-title<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">insert</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">propertize</span> title
                            <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">outline-1</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">center-line</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">insert</span> <span class="string">"\n"</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span>xkcd-insert-image file num<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">eq</span> xkcd-cur <span class="highlight-numbers-number">0</span><span class="rainbow-delimiters-depth-3">)</span>
            <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> xkcd-cur num<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> xkcd-alt alt<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">message</span> <span class="string">"%s"</span> title<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defconst</span> <span class="variable-name">+xkcd-db--sqlite-available-p</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">with-demoted-errors</span> <span class="string">"+org-xkcd initialization: %S"</span>
      <span class="rainbow-delimiters-depth-1">(</span>emacsql-sqlite-ensure-binary<span class="rainbow-delimiters-depth-1">)</span>
      t<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">+xkcd-db--connection</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">make-hash-table</span> <span class="builtin">:test</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">equal</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Database connection to +org-xkcd database."</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+xkcd-db--get</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="doc">"Return the sqlite db file."</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">expand-file-name</span> <span class="string">"xkcd.db"</span> xkcd-cache-dir<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+xkcd-db--get-connection</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="doc">"Return the database connection, if any."</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">gethash</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">file-truename</span> xkcd-cache-dir<span class="rainbow-delimiters-depth-1">)</span>
             +xkcd-db--connection<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defconst</span> <span class="variable-name">+xkcd-db--table-schema</span>
    <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>xkcds
       <span class="rainbow-delimiters-depth-2">[</span><span class="rainbow-delimiters-depth-3">(</span>num integer <span class="builtin">:unique</span> <span class="builtin">:primary-key</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span>year        <span class="builtin">:not-null</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span>month       <span class="builtin">:not-null</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span>link        <span class="builtin">:not-null</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span>news        <span class="builtin">:not-null</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span>safe_title  <span class="builtin">:not-null</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span>title       <span class="builtin">:not-null</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span>transcript  <span class="builtin">:not-null</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span>alt         <span class="builtin">:not-null</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span>img         <span class="builtin">:not-null</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">]</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+xkcd-db--init</span> <span class="rainbow-delimiters-depth-3">(</span>db<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Initialize database DB with the correct schema and user version."</span>
    <span class="rainbow-delimiters-depth-3">(</span>emacsql-with-transaction db
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">pcase-dolist</span> <span class="rainbow-delimiters-depth-2">(</span><span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-3">(</span>,table . ,schema<span class="rainbow-delimiters-depth-3">)</span> +xkcd-db--table-schema<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span>emacsql db <span class="rainbow-delimiters-depth-3">[</span><span class="builtin">:create-table</span> $i1 $S2<span class="rainbow-delimiters-depth-3">]</span> table schema<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+xkcd-db</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="doc">"Entrypoint to the +org-xkcd sqlite database.
Initializes and stores the database, and the database connection.
Performs a database upgrade when required."</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">unless</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-2">(</span>+xkcd-db--get-connection<span class="rainbow-delimiters-depth-2">)</span>
                 <span class="rainbow-delimiters-depth-2">(</span>emacsql-live-p <span class="rainbow-delimiters-depth-3">(</span>+xkcd-db--get-connection<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>db-file <span class="rainbow-delimiters-depth-1">(</span>+xkcd-db--get<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>init-db <span class="rainbow-delimiters-depth-1">(</span><span class="constant">not</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">file-exists-p</span> db-file<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">make-directory</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">file-name-directory</span> db-file<span class="rainbow-delimiters-depth-3">)</span> t<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>conn <span class="rainbow-delimiters-depth-2">(</span>emacsql-sqlite db-file<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="constant">set-process-query-on-exit-flag</span> <span class="rainbow-delimiters-depth-1">(</span>emacsql-process conn<span class="rainbow-delimiters-depth-1">)</span> nil<span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="constant">puthash</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">file-truename</span> xkcd-cache-dir<span class="rainbow-delimiters-depth-1">)</span>
                   conn
                   +xkcd-db--connection<span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> init-db
            <span class="rainbow-delimiters-depth-1">(</span>+xkcd-db--init conn<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span>+xkcd-db--get-connection<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+xkcd-db-query</span> <span class="rainbow-delimiters-depth-3">(</span>sql <span class="type">&amp;rest</span> args<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Run SQL query on +org-xkcd database with ARGS.
SQL can be either the emacsql vector representation, or a string."</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span>  <span class="rainbow-delimiters-depth-1">(</span><span class="constant">stringp</span> sql<span class="rainbow-delimiters-depth-1">)</span>
        <span class="rainbow-delimiters-depth-1">(</span>emacsql <span class="rainbow-delimiters-depth-2">(</span>+xkcd-db<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">apply</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">format</span> sql args<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">apply</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">emacsql</span> <span class="rainbow-delimiters-depth-2">(</span>+xkcd-db<span class="rainbow-delimiters-depth-2">)</span> sql args<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+xkcd-db-read</span> <span class="rainbow-delimiters-depth-3">(</span>num<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when-let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>res
                <span class="rainbow-delimiters-depth-3">(</span><span class="constant">car</span> <span class="rainbow-delimiters-depth-1">(</span>+xkcd-db-query <span class="rainbow-delimiters-depth-2">[</span><span class="builtin">:select</span> * <span class="builtin">:from</span> xkcds
                                      <span class="builtin">:where</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">=</span> num $s1<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">]</span>
                                     num
                                     <span class="builtin">:limit</span> <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span>+xkcd-db-list-to-plist res<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+xkcd-db-read-all</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>xkcd-table <span class="rainbow-delimiters-depth-3">(</span><span class="constant">make-hash-table</span> <span class="builtin">:test</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">eql</span> <span class="builtin">:size</span> <span class="highlight-numbers-number">4000</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">mapcar</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-3">(</span>xkcd-info-list<span class="rainbow-delimiters-depth-3">)</span>
                <span class="rainbow-delimiters-depth-3">(</span><span class="constant">puthash</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">car</span> xkcd-info-list<span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span>+xkcd-db-list-to-plist xkcd-info-list<span class="rainbow-delimiters-depth-1">)</span> xkcd-table<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span>+xkcd-db-query <span class="rainbow-delimiters-depth-3">[</span><span class="builtin">:select</span> * <span class="builtin">:from</span> xkcds<span class="rainbow-delimiters-depth-3">]</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      xkcd-table<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+xkcd-db-list-to-plist</span> <span class="rainbow-delimiters-depth-3">(</span>xkcd-datalist<span class="rainbow-delimiters-depth-3">)</span>
    <span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-3">(</span><span class="builtin">:num</span> ,<span class="rainbow-delimiters-depth-1">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">0</span> xkcd-datalist<span class="rainbow-delimiters-depth-1">)</span>
      <span class="builtin">:year</span> ,<span class="rainbow-delimiters-depth-1">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">1</span> xkcd-datalist<span class="rainbow-delimiters-depth-1">)</span>
      <span class="builtin">:month</span> ,<span class="rainbow-delimiters-depth-1">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">2</span> xkcd-datalist<span class="rainbow-delimiters-depth-1">)</span>
      <span class="builtin">:link</span> ,<span class="rainbow-delimiters-depth-1">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">3</span> xkcd-datalist<span class="rainbow-delimiters-depth-1">)</span>
      <span class="builtin">:news</span> ,<span class="rainbow-delimiters-depth-1">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">4</span> xkcd-datalist<span class="rainbow-delimiters-depth-1">)</span>
      <span class="builtin">:safe-title</span> ,<span class="rainbow-delimiters-depth-1">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">5</span> xkcd-datalist<span class="rainbow-delimiters-depth-1">)</span>
      <span class="builtin">:title</span> ,<span class="rainbow-delimiters-depth-1">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">6</span> xkcd-datalist<span class="rainbow-delimiters-depth-1">)</span>
      <span class="builtin">:transcript</span> ,<span class="rainbow-delimiters-depth-1">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">7</span> xkcd-datalist<span class="rainbow-delimiters-depth-1">)</span>
      <span class="builtin">:alt</span> ,<span class="rainbow-delimiters-depth-1">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">8</span> xkcd-datalist<span class="rainbow-delimiters-depth-1">)</span>
      <span class="builtin">:img</span> ,<span class="rainbow-delimiters-depth-1">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">9</span> xkcd-datalist<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+xkcd-db-write</span> <span class="rainbow-delimiters-depth-3">(</span>data<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span>+xkcd-db-query <span class="rainbow-delimiters-depth-1">[</span><span class="builtin">:insert-into</span> xkcds
                     <span class="builtin">:values</span> $v1<span class="rainbow-delimiters-depth-1">]</span>
                    <span class="rainbow-delimiters-depth-1">(</span><span class="constant">list</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">vector</span>
                           <span class="rainbow-delimiters-depth-3">(</span><span class="constant">cdr</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">assoc</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">num</span>        data<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                           <span class="rainbow-delimiters-depth-3">(</span><span class="constant">cdr</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">assoc</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">year</span>       data<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                           <span class="rainbow-delimiters-depth-3">(</span><span class="constant">cdr</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">assoc</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">month</span>      data<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                           <span class="rainbow-delimiters-depth-3">(</span><span class="constant">cdr</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">assoc</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">link</span>       data<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                           <span class="rainbow-delimiters-depth-3">(</span><span class="constant">cdr</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">assoc</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">news</span>       data<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                           <span class="rainbow-delimiters-depth-3">(</span><span class="constant">cdr</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">assoc</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">safe_title</span> data<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                           <span class="rainbow-delimiters-depth-3">(</span><span class="constant">cdr</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">assoc</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">title</span>      data<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                           <span class="rainbow-delimiters-depth-3">(</span><span class="constant">cdr</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">assoc</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">transcript</span> data<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                           <span class="rainbow-delimiters-depth-3">(</span><span class="constant">cdr</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">assoc</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">alt</span>        data<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                           <span class="rainbow-delimiters-depth-3">(</span><span class="constant">cdr</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">assoc</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">img</span>        data<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                           <span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">xkcd:2 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*YASnippet][YASnippet:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> <span class="variable-name">yas-triggers-in-field</span> t<span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">YASnippet:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Ebooks][Ebooks:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">use-package!</span> calibredb
  <span class="builtin">:commands</span> calibredb
  <span class="builtin">:config</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> calibredb-root-dir <span class="string">"~/Desktop/TEC/Other/Ebooks"</span>
        calibredb-db-dir <span class="rainbow-delimiters-depth-3">(</span><span class="constant">expand-file-name</span> <span class="string">"metadata.db"</span> calibredb-root-dir<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">map!</span> <span class="builtin">:map</span> calibredb-show-mode-map
        <span class="builtin">:ne</span> <span class="string">"?"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-entry-dispatch</span>
        <span class="builtin">:ne</span> <span class="string">"o"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-find-file</span>
        <span class="builtin">:ne</span> <span class="string">"O"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-find-file-other-frame</span>
        <span class="builtin">:ne</span> <span class="string">"V"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-open-file-with-default-tool</span>
        <span class="builtin">:ne</span> <span class="string">"s"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-set-metadata-dispatch</span>
        <span class="builtin">:ne</span> <span class="string">"e"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-export-dispatch</span>
        <span class="builtin">:ne</span> <span class="string">"q"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-entry-quit</span>
        <span class="builtin">:ne</span> <span class="string">"."</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-open-dired</span>
        <span class="builtin">:ne</span> <span class="rainbow-delimiters-depth-3">[</span>tab<span class="rainbow-delimiters-depth-3">]</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-toggle-view-at-point</span>
        <span class="builtin">:ne</span> <span class="string">"M-t"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-set-metadata--tags</span>
        <span class="builtin">:ne</span> <span class="string">"M-a"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-set-metadata--author_sort</span>
        <span class="builtin">:ne</span> <span class="string">"M-A"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-set-metadata--authors</span>
        <span class="builtin">:ne</span> <span class="string">"M-T"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-set-metadata--title</span>
        <span class="builtin">:ne</span> <span class="string">"M-c"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-set-metadata--comments</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">map!</span> <span class="builtin">:map</span> calibredb-search-mode-map
        <span class="builtin">:ne</span> <span class="rainbow-delimiters-depth-3">[</span>mouse-3<span class="rainbow-delimiters-depth-3">]</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-search-mouse</span>
        <span class="builtin">:ne</span> <span class="string">"RET"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-find-file</span>
        <span class="builtin">:ne</span> <span class="string">"?"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-dispatch</span>
        <span class="builtin">:ne</span> <span class="string">"a"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-add</span>
        <span class="builtin">:ne</span> <span class="string">"A"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-add-dir</span>
        <span class="builtin">:ne</span> <span class="string">"c"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-clone</span>
        <span class="builtin">:ne</span> <span class="string">"d"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-remove</span>
        <span class="builtin">:ne</span> <span class="string">"D"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-remove-marked-items</span>
        <span class="builtin">:ne</span> <span class="string">"j"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-next-entry</span>
        <span class="builtin">:ne</span> <span class="string">"k"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-previous-entry</span>
        <span class="builtin">:ne</span> <span class="string">"l"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-virtual-library-list</span>
        <span class="builtin">:ne</span> <span class="string">"L"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-library-list</span>
        <span class="builtin">:ne</span> <span class="string">"n"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-virtual-library-next</span>
        <span class="builtin">:ne</span> <span class="string">"N"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-library-next</span>
        <span class="builtin">:ne</span> <span class="string">"p"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-virtual-library-previous</span>
        <span class="builtin">:ne</span> <span class="string">"P"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-library-previous</span>
        <span class="builtin">:ne</span> <span class="string">"s"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-set-metadata-dispatch</span>
        <span class="builtin">:ne</span> <span class="string">"S"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-switch-library</span>
        <span class="builtin">:ne</span> <span class="string">"o"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-find-file</span>
        <span class="builtin">:ne</span> <span class="string">"O"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-find-file-other-frame</span>
        <span class="builtin">:ne</span> <span class="string">"v"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-view</span>
        <span class="builtin">:ne</span> <span class="string">"V"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-open-file-with-default-tool</span>
        <span class="builtin">:ne</span> <span class="string">"."</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-open-dired</span>
        <span class="builtin">:ne</span> <span class="string">"b"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-catalog-bib-dispatch</span>
        <span class="builtin">:ne</span> <span class="string">"e"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-export-dispatch</span>
        <span class="builtin">:ne</span> <span class="string">"r"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-search-refresh-and-clear-filter</span>
        <span class="builtin">:ne</span> <span class="string">"R"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-search-clear-filter</span>
        <span class="builtin">:ne</span> <span class="string">"q"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-search-quit</span>
        <span class="builtin">:ne</span> <span class="string">"m"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-mark-and-forward</span>
        <span class="builtin">:ne</span> <span class="string">"f"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-toggle-favorite-at-point</span>
        <span class="builtin">:ne</span> <span class="string">"x"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-toggle-archive-at-point</span>
        <span class="builtin">:ne</span> <span class="string">"h"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-toggle-highlight-at-point</span>
        <span class="builtin">:ne</span> <span class="string">"u"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-unmark-and-forward</span>
        <span class="builtin">:ne</span> <span class="string">"i"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-edit-annotation</span>
        <span class="builtin">:ne</span> <span class="string">"DEL"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-unmark-and-backward</span>
        <span class="builtin">:ne</span> <span class="rainbow-delimiters-depth-3">[</span>backtab<span class="rainbow-delimiters-depth-3">]</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-toggle-view</span>
        <span class="builtin">:ne</span> <span class="rainbow-delimiters-depth-3">[</span>tab<span class="rainbow-delimiters-depth-3">]</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-toggle-view-at-point</span>
        <span class="builtin">:ne</span> <span class="string">"M-n"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-show-next-entry</span>
        <span class="builtin">:ne</span> <span class="string">"M-p"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-show-previous-entry</span>
        <span class="builtin">:ne</span> <span class="string">"/"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-search-live-filter</span>
        <span class="builtin">:ne</span> <span class="string">"M-t"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-set-metadata--tags</span>
        <span class="builtin">:ne</span> <span class="string">"M-a"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-set-metadata--author_sort</span>
        <span class="builtin">:ne</span> <span class="string">"M-A"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-set-metadata--authors</span>
        <span class="builtin">:ne</span> <span class="string">"M-T"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-set-metadata--title</span>
        <span class="builtin">:ne</span> <span class="string">"M-c"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">calibredb-set-metadata--comments</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Ebooks:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Ebooks][Ebooks:2]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">use-package!</span> nov
  <span class="builtin">:mode</span> <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\.epub\\'"</span> . nov-mode<span class="rainbow-delimiters-depth-2">)</span>
  <span class="builtin">:config</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">map!</span> <span class="builtin">:map</span> nov-mode-map
        <span class="builtin">:n</span> <span class="string">"RET"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">nov-scroll-up</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">doom-modeline-segment--nov-info</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">concat</span>
     <span class="string">" "</span>
     <span class="rainbow-delimiters-depth-1">(</span><span class="constant">propertize</span>
      <span class="rainbow-delimiters-depth-2">(</span><span class="constant">cdr</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">assoc</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">creator</span> nov-metadata<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
      <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">doom-modeline-project-parent-dir</span><span class="rainbow-delimiters-depth-1">)</span>
     <span class="string">" "</span>
     <span class="rainbow-delimiters-depth-1">(</span><span class="constant">cdr</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">assoc</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">title</span> nov-metadata<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
     <span class="string">" "</span>
     <span class="rainbow-delimiters-depth-1">(</span><span class="constant">propertize</span>
      <span class="rainbow-delimiters-depth-2">(</span><span class="constant">format</span> <span class="string">"%d/%d"</span>
              <span class="rainbow-delimiters-depth-3">(</span><span class="constant">1+</span> nov-documents-index<span class="rainbow-delimiters-depth-3">)</span>
              <span class="rainbow-delimiters-depth-3">(</span><span class="constant">length</span> nov-documents<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
      <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">doom-modeline-info</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">advice-add</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">nov-render-title</span> <span class="builtin">:override</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">ignore</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+nov-mode-setup</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">face-remap-add-relative</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">variable-pitch</span>
                             <span class="builtin">:family</span> <span class="string">"Merriweather"</span>
                             <span class="builtin">:height</span> <span class="highlight-numbers-number">1.4</span>
                             <span class="builtin">:width</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">semi-expanded</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">face-remap-add-relative</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">default</span> <span class="builtin">:height</span> <span class="highlight-numbers-number">1.3</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq-local</span> <span class="variable-name">line-spacing</span> <span class="highlight-numbers-number">0.2</span>
                <span class="variable-name">next-screen-context-lines</span> <span class="highlight-numbers-number">4</span>
                shr-use-colors nil<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">require</span> <span class="highlight-quoted-quote">'</span><span class="constant">visual-fill-column</span> nil t<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq-local</span> visual-fill-column-center-text t
                visual-fill-column-width <span class="highlight-numbers-number">80</span>
                nov-text-width <span class="highlight-numbers-number">80</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">visual-fill-column-mode</span> <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">hl-line-mode</span> <span class="highlight-numbers-number">-1</span><span class="rainbow-delimiters-depth-3">)</span>

    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">add-to-list</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">+lookup-definition-functions</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">+lookup/dictionary-definition</span><span class="rainbow-delimiters-depth-3">)</span>

    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq-local</span> <span class="variable-name">mode-line-format</span>
                <span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span><span class="builtin">:eval</span>
                   <span class="rainbow-delimiters-depth-3">(</span>doom-modeline-segment--workspace-name<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                  <span class="rainbow-delimiters-depth-2">(</span><span class="builtin">:eval</span>
                   <span class="rainbow-delimiters-depth-3">(</span>doom-modeline-segment--window-number<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                  <span class="rainbow-delimiters-depth-2">(</span><span class="builtin">:eval</span>
                   <span class="rainbow-delimiters-depth-3">(</span>doom-modeline-segment--nov-info<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                  ,<span class="rainbow-delimiters-depth-2">(</span><span class="constant">propertize</span>
                    <span class="string">" %P "</span>
                    <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">doom-modeline-buffer-minor-mode</span><span class="rainbow-delimiters-depth-2">)</span>
                  ,<span class="rainbow-delimiters-depth-2">(</span><span class="constant">propertize</span>
                    <span class="string">" "</span>
                    <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-1">(</span>doom-modeline--active<span class="rainbow-delimiters-depth-1">)</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">mode-line</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">mode-line-inactive</span><span class="rainbow-delimiters-depth-3">)</span>
                    <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">display</span> <span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>space
                                <span class="builtin">:align-to</span>
                                <span class="rainbow-delimiters-depth-2">(</span><span class="constant">-</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">+</span> right right-fringe right-margin<span class="rainbow-delimiters-depth-3">)</span>
                                   ,<span class="rainbow-delimiters-depth-3">(</span><span class="constant">*</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>width <span class="rainbow-delimiters-depth-1">(</span>doom-modeline--font-width<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                                         <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">=</span> width <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-1">)</span> <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-3">)</span>
                                             <span class="rainbow-delimiters-depth-3">(</span><span class="constant">/</span> width <span class="rainbow-delimiters-depth-1">(</span><span class="constant">frame-char-width</span><span class="rainbow-delimiters-depth-1">)</span> <span class="highlight-numbers-number">1.0</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                                       <span class="rainbow-delimiters-depth-1">(</span><span class="constant">string-width</span>
                                        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">format-mode-line</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">cons</span> <span class="string">""</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:eval</span> <span class="rainbow-delimiters-depth-2">(</span>doom-modeline-segment--major-mode<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                  <span class="rainbow-delimiters-depth-2">(</span><span class="builtin">:eval</span> <span class="rainbow-delimiters-depth-3">(</span>doom-modeline-segment--major-mode<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">nov-mode-hook</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">+nov-mode-setup</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Ebooks:2 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*IRC][IRC:3]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> circe
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq-default</span> circe-use-tls t<span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> circe-notifications-alert-icon <span class="string">"/usr/share/icons/breeze/actions/24/network-connect.svg"</span>
        lui-logging-directory <span class="string">"~/.emacs.d/.local/etc/irc"</span>
        lui-logging-file-format <span class="string">"{buffer}/%Y/%m-%d.txt"</span>
        circe-format-self-say <span class="string">"{nick:+13s} &#226;&#148;&#131; {body}"</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">custom-set-faces!</span>
    <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span>circe-my-message-face <span class="builtin">:weight</span> unspecified<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span>enable-lui-logging-globally<span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">enable-circe-display-images</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">lui-org-to-irc</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="doc">"Examine a buffer with simple org-mode formatting, and converts the empasis:
  *bold*, /italic/, and _underline_ to IRC semi-standard escape codes.
  =code= is converted to inverse (highlighted) text."</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">goto-char</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">point-min</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">while</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">re-search-forward</span> <span class="string">"\\_&lt;</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(?1:</span></span><span class="string">[*/_=]</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(?2:</span></span><span class="string">[</span><span class="string"><span class="negation-char">^</span></span><span class="string">[:space:]]</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(?:</span></span><span class="string">.*?[</span><span class="string"><span class="negation-char">^</span></span><span class="string">[:space:]]</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">?</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">\\1\\_&gt;"</span> nil t<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">replace-match</span>
       <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">pcase</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">match-string</span> <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-1">)</span>
                 <span class="rainbow-delimiters-depth-1">(</span><span class="string">"*"</span> <span class="string">"&#2;"</span><span class="rainbow-delimiters-depth-1">)</span>
                 <span class="rainbow-delimiters-depth-1">(</span><span class="string">"/"</span> <span class="string">"&#29;"</span><span class="rainbow-delimiters-depth-1">)</span>
                 <span class="rainbow-delimiters-depth-1">(</span><span class="string">"_"</span> <span class="string">"&#31;"</span><span class="rainbow-delimiters-depth-1">)</span>
                 <span class="rainbow-delimiters-depth-1">(</span><span class="string">"="</span> <span class="string">"&#22;"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
               <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">match-string</span> <span class="highlight-numbers-number">2</span><span class="rainbow-delimiters-depth-3">)</span>
               <span class="string">"&#15;"</span><span class="rainbow-delimiters-depth-2">)</span> <span class="warning-1">nil nil</span><span class="warning-1"><span class="rainbow-delimiters-depth-1">)</span></span><span class="warning-1"><span class="rainbow-delimiters-depth-3">)</span></span><span class="warning-1"><span class="rainbow-delimiters-depth-2">)</span></span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">lui-pre-input-hook</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">lui-org-to-irc</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">lui-ascii-to-emoji</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">goto-char</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">point-min</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">while</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">re-search-forward</span> <span class="string">"</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string"> </span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">?::?</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">[</span><span class="string"><span class="negation-char">^</span></span><span class="string">[:space:]:]+</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">:</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string"> </span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">?"</span> nil t<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">replace-match</span>
       <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">match-string</span> <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">cdr</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">assoc</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">match-string</span> <span class="highlight-numbers-number">2</span><span class="rainbow-delimiters-depth-3">)</span> lui-emojis-alist<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
            <span class="rainbow-delimiters-depth-1">(</span><span class="constant">concat</span> <span class="string">":"</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">match-string</span> <span class="highlight-numbers-number">2</span><span class="rainbow-delimiters-depth-2">)</span> <span class="string">":"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">match-string</span> <span class="highlight-numbers-number">3</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
       nil nil<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">lui-emoticon-to-emoji</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">dolist</span> <span class="rainbow-delimiters-depth-1">(</span>emoticon lui-emoticons-alist<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">goto-char</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">point-min</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">while</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">re-search-forward</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">concat</span> <span class="string">" "</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">car</span> emoticon<span class="rainbow-delimiters-depth-1">)</span> <span class="string">"</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string"> </span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">?"</span><span class="rainbow-delimiters-depth-3">)</span> nil t<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">replace-match</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">concat</span> <span class="string">" "</span>
                               <span class="rainbow-delimiters-depth-1">(</span><span class="constant">cdr</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">assoc</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">cdr</span> emoticon<span class="rainbow-delimiters-depth-3">)</span> lui-emojis-alist<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                               <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">match-string</span> <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">define-minor-mode</span> <span class="function-name">lui-emojify</span>
    <span class="doc">"Replace :emojis: and ;) emoticons with unicode emoji chars."</span>
    <span class="builtin">:global</span> t
    <span class="builtin">:init-value</span> t
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> lui-emojify
        <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">add-hook!</span> lui-pre-input <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">lui-ascii-to-emoji</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">lui-emoticon-to-emoji</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">remove-hook!</span> lui-pre-input <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">lui-ascii-to-emoji</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">lui-emoticon-to-emoji</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">lui-emojis-alist</span>
    <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span><span class="string">"grinning"</span>                      . <span class="string">"&#240;&#159;&#152;&#128;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"smiley"</span>                        . <span class="string">"&#240;&#159;&#152;&#131;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"smile"</span>                         . <span class="string">"&#240;&#159;&#152;&#132;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"grin"</span>                          . <span class="string">"&#240;&#159;&#152;&#129;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"laughing"</span>                      . <span class="string">"&#240;&#159;&#152;&#134;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"sweat_smile"</span>                   . <span class="string">"&#240;&#159;&#152;&#133;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"joy"</span>                           . <span class="string">"&#240;&#159;&#152;&#130;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"rofl"</span>                          . <span class="string">"&#240;&#159;&#164;&#163;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"relaxed"</span>                       . <span class="string">"&#226;&#152;&#186;&#239;&#184;&#143;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"blush"</span>                         . <span class="string">"&#240;&#159;&#152;&#138;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"innocent"</span>                      . <span class="string">"&#240;&#159;&#152;&#135;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"slight_smile"</span>                  . <span class="string">"&#240;&#159;&#153;&#130;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"upside_down"</span>                   . <span class="string">"&#240;&#159;&#153;&#131;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"wink"</span>                          . <span class="string">"&#240;&#159;&#152;&#137;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"relieved"</span>                      . <span class="string">"&#240;&#159;&#152;&#140;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"heart_eyes"</span>                    . <span class="string">"&#240;&#159;&#152;&#141;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"yum"</span>                           . <span class="string">"&#240;&#159;&#152;&#139;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"stuck_out_tongue"</span>              . <span class="string">"&#240;&#159;&#152;&#155;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"stuck_out_tongue_closed_eyes"</span>  . <span class="string">"&#240;&#159;&#152;&#157;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"stuck_out_tongue_wink"</span>         . <span class="string">"&#240;&#159;&#152;&#156;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"zanzy"</span>                         . <span class="string">"&#240;&#159;&#164;&#170;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"raised_eyebrow"</span>                . <span class="string">"&#240;&#159;&#164;&#168;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"monocle"</span>                       . <span class="string">"&#240;&#159;&#167;&#144;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"nerd"</span>                          . <span class="string">"&#240;&#159;&#164;&#147;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"cool"</span>                          . <span class="string">"&#240;&#159;&#152;&#142;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"star_struck"</span>                   . <span class="string">"&#240;&#159;&#164;&#169;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"party"</span>                         . <span class="string">"&#240;&#159;&#165;&#179;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"smirk"</span>                         . <span class="string">"&#240;&#159;&#152;&#143;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"unamused"</span>                      . <span class="string">"&#240;&#159;&#152;&#146;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"disapointed"</span>                   . <span class="string">"&#240;&#159;&#152;&#158;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"pensive"</span>                       . <span class="string">"&#240;&#159;&#152;&#148;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"worried"</span>                       . <span class="string">"&#240;&#159;&#152;&#159;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"confused"</span>                      . <span class="string">"&#240;&#159;&#152;&#149;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"slight_frown"</span>                  . <span class="string">"&#240;&#159;&#153;&#129;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"frown"</span>                         . <span class="string">"&#226;&#152;&#185;&#239;&#184;&#143;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"persevere"</span>                     . <span class="string">"&#240;&#159;&#152;&#163;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"confounded"</span>                    . <span class="string">"&#240;&#159;&#152;&#150;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"tired"</span>                         . <span class="string">"&#240;&#159;&#152;&#171;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"weary"</span>                         . <span class="string">"&#240;&#159;&#152;&#169;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"pleading"</span>                      . <span class="string">"&#240;&#159;&#165;&#186;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"tear"</span>                          . <span class="string">"&#240;&#159;&#152;&#162;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"cry"</span>                           . <span class="string">"&#240;&#159;&#152;&#162;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"sob"</span>                           . <span class="string">"&#240;&#159;&#152;&#173;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"triumph"</span>                       . <span class="string">"&#240;&#159;&#152;&#164;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"angry"</span>                         . <span class="string">"&#240;&#159;&#152;&#160;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"rage"</span>                          . <span class="string">"&#240;&#159;&#152;&#161;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"exploding_head"</span>                . <span class="string">"&#240;&#159;&#164;&#175;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"flushed"</span>                       . <span class="string">"&#240;&#159;&#152;&#179;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"hot"</span>                           . <span class="string">"&#240;&#159;&#165;&#181;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"cold"</span>                          . <span class="string">"&#240;&#159;&#165;&#182;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"scream"</span>                        . <span class="string">"&#240;&#159;&#152;&#177;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"fearful"</span>                       . <span class="string">"&#240;&#159;&#152;&#168;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"disapointed"</span>                   . <span class="string">"&#240;&#159;&#152;&#176;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"relieved"</span>                      . <span class="string">"&#240;&#159;&#152;&#165;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"sweat"</span>                         . <span class="string">"&#240;&#159;&#152;&#147;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"thinking"</span>                      . <span class="string">"&#240;&#159;&#164;&#148;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"shush"</span>                         . <span class="string">"&#240;&#159;&#164;&#171;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"liar"</span>                          . <span class="string">"&#240;&#159;&#164;&#165;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"blank_face"</span>                    . <span class="string">"&#240;&#159;&#152;&#182;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"neutral"</span>                       . <span class="string">"&#240;&#159;&#152;&#144;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"expressionless"</span>                . <span class="string">"&#240;&#159;&#152;&#145;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"grimace"</span>                       . <span class="string">"&#240;&#159;&#152;&#172;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"rolling_eyes"</span>                  . <span class="string">"&#240;&#159;&#153;&#132;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"hushed"</span>                        . <span class="string">"&#240;&#159;&#152;&#175;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"frowning"</span>                      . <span class="string">"&#240;&#159;&#152;&#166;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"anguished"</span>                     . <span class="string">"&#240;&#159;&#152;&#167;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"wow"</span>                           . <span class="string">"&#240;&#159;&#152;&#174;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"astonished"</span>                    . <span class="string">"&#240;&#159;&#152;&#178;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"sleeping"</span>                      . <span class="string">"&#240;&#159;&#152;&#180;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"drooling"</span>                      . <span class="string">"&#240;&#159;&#164;&#164;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"sleepy"</span>                        . <span class="string">"&#240;&#159;&#152;&#170;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"dizzy"</span>                         . <span class="string">"&#240;&#159;&#152;&#181;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"zipper_mouth"</span>                  . <span class="string">"&#240;&#159;&#164;&#144;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"woozy"</span>                         . <span class="string">"&#240;&#159;&#165;&#180;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"sick"</span>                          . <span class="string">"&#240;&#159;&#164;&#162;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"vomiting"</span>                      . <span class="string">"&#240;&#159;&#164;&#174;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"sneeze"</span>                        . <span class="string">"&#240;&#159;&#164;&#167;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"mask"</span>                          . <span class="string">"&#240;&#159;&#152;&#183;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"bandaged_head"</span>                 . <span class="string">"&#240;&#159;&#164;&#149;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"money_face"</span>                    . <span class="string">"&#240;&#159;&#164;&#145;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"cowboy"</span>                        . <span class="string">"&#240;&#159;&#164;&#160;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"imp"</span>                           . <span class="string">"&#240;&#159;&#152;&#136;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"ghost"</span>                         . <span class="string">"&#240;&#159;&#145;&#187;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"alien"</span>                         . <span class="string">"&#240;&#159;&#145;&#189;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"robot"</span>                         . <span class="string">"&#240;&#159;&#164;&#150;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"clap"</span>                          . <span class="string">"&#240;&#159;&#145;&#143;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"thumpup"</span>                       . <span class="string">"&#240;&#159;&#145;&#141;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"+1"</span>                            . <span class="string">"&#240;&#159;&#145;&#141;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"thumbdown"</span>                     . <span class="string">"&#240;&#159;&#145;&#142;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"-1"</span>                            . <span class="string">"&#240;&#159;&#145;&#142;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"ok"</span>                            . <span class="string">"&#240;&#159;&#145;&#140;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"pinch"</span>                         . <span class="string">"&#240;&#159;&#164;&#143;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"left"</span>                          . <span class="string">"&#240;&#159;&#145;&#136;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"right"</span>                         . <span class="string">"&#240;&#159;&#145;&#137;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"down"</span>                          . <span class="string">"&#240;&#159;&#145;&#135;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"wave"</span>                          . <span class="string">"&#240;&#159;&#145;&#139;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"pray"</span>                          . <span class="string">"&#240;&#159;&#153;&#143;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"eyes"</span>                          . <span class="string">"&#240;&#159;&#145;&#128;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"brain"</span>                         . <span class="string">"&#240;&#159;&#167;&#160;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"facepalm"</span>                      . <span class="string">"&#240;&#159;&#164;&#166;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"tada"</span>                          . <span class="string">"&#240;&#159;&#142;&#137;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"fire"</span>                          . <span class="string">"&#240;&#159;&#148;&#165;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"flying_money"</span>                  . <span class="string">"&#240;&#159;&#146;&#184;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"lighbulb"</span>                      . <span class="string">"&#240;&#159;&#146;&#161;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"heart"</span>                         . <span class="string">"&#226;&#157;&#164;&#239;&#184;&#143;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"sparkling_heart"</span>               . <span class="string">"&#240;&#159;&#146;&#150;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"heartbreak"</span>                    . <span class="string">"&#240;&#159;&#146;&#148;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"100"</span>                           . <span class="string">"&#240;&#159;&#146;&#175;"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">lui-emoticons-alist</span>
    <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span><span class="string">":)"</span>   . <span class="string">"slight_smile"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">";)"</span>   . <span class="string">"wink"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">":D"</span>   . <span class="string">"smile"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"=D"</span>   . <span class="string">"grin"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"xD"</span>   . <span class="string">"laughing"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">";("</span>   . <span class="string">"joy"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">":P"</span>   . <span class="string">"stuck_out_tongue"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">";D"</span>   . <span class="string">"stuck_out_tongue_wink"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"xP"</span>   . <span class="string">"stuck_out_tongue_closed_eyes"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">":("</span>   . <span class="string">"slight_frown"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">";("</span>   . <span class="string">"cry"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">";'("</span>  . <span class="string">"sob"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"&gt;:("</span>  . <span class="string">"angry"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"&gt;&gt;:("</span> . <span class="string">"rage"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">":o"</span>   . <span class="string">"wow"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">":O"</span>   . <span class="string">"astonished"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">":/"</span>   . <span class="string">"confused"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">":-/"</span>  . <span class="string">"thinking"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">":|"</span>   . <span class="string">"neutral"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">":-|"</span>  . <span class="string">"expressionless"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">named-circe-prompt</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="rainbow-delimiters-depth-3">(</span>lui-set-prompt
     <span class="rainbow-delimiters-depth-1">(</span><span class="constant">concat</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">propertize</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"%13s &gt; "</span> <span class="rainbow-delimiters-depth-1">(</span>circe-nick<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                         <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">circe-prompt-face</span><span class="rainbow-delimiters-depth-2">)</span>
             <span class="string">""</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">circe-chat-mode-hook</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">named-circe-prompt</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">appendq!</span> all-the-icons-mode-icon-alist
            <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>circe-channel-mode all-the-icons-material <span class="string">"message"</span> <span class="builtin">:face</span> all-the-icons-lblue<span class="rainbow-delimiters-depth-1">)</span>
              <span class="rainbow-delimiters-depth-1">(</span>circe-server-mode all-the-icons-material <span class="string">"chat_bubble_outline"</span> <span class="builtin">:face</span> all-the-icons-purple<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defun</span> <span class="function-name">auth-server-pass</span> <span class="rainbow-delimiters-depth-2">(</span>server<span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">if-let</span> <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>secret <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">car</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">auth-source-search</span> <span class="builtin">:host</span> server<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span> <span class="builtin">:secret</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
      <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">functionp</span> secret<span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="constant">funcall</span> secret<span class="rainbow-delimiters-depth-1">)</span> secret<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">error</span> <span class="string">"Could not fetch password for host %s"</span> server<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defun</span> <span class="function-name">register-irc-auths</span> <span class="rainbow-delimiters-depth-2">()</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="constant">require</span> <span class="highlight-quoted-quote">'</span><span class="constant">circe</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="constant">require</span> <span class="highlight-quoted-quote">'</span><span class="constant">dash</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>accounts <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">-filter</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-1">(</span>a<span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">string=</span> <span class="string">"irc"</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> a <span class="builtin">:for</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                           <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">auth-source-search</span> <span class="builtin">:require</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:for</span><span class="rainbow-delimiters-depth-1">)</span> <span class="builtin">:max</span> <span class="highlight-numbers-number">10</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">appendq!</span> circe-network-options
              <span class="rainbow-delimiters-depth-1">(</span><span class="constant">mapcar</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-3">(</span>entry<span class="rainbow-delimiters-depth-3">)</span>
                        <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>host <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> entry <span class="builtin">:host</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                               <span class="rainbow-delimiters-depth-2">(</span>label <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> entry <span class="builtin">:label</span><span class="rainbow-delimiters-depth-1">)</span> host<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                               <span class="rainbow-delimiters-depth-2">(</span>_ports <span class="rainbow-delimiters-depth-3">(</span><span class="constant">mapcar</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">string-to-number</span>
                                               <span class="rainbow-delimiters-depth-1">(</span>s-split <span class="string">","</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> entry <span class="builtin">:port</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                               <span class="rainbow-delimiters-depth-2">(</span>port <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">=</span> <span class="highlight-numbers-number">1</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">length</span> _ports<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">car</span> _ports<span class="rainbow-delimiters-depth-1">)</span> _ports<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                               <span class="rainbow-delimiters-depth-2">(</span>user <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> entry <span class="builtin">:user</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                               <span class="rainbow-delimiters-depth-2">(</span>nick <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> entry <span class="builtin">:nick</span><span class="rainbow-delimiters-depth-1">)</span> user<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                               <span class="rainbow-delimiters-depth-2">(</span>channels <span class="rainbow-delimiters-depth-3">(</span><span class="constant">mapcar</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-2">(</span>c<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span> <span class="string">"#"</span> c<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                                                 <span class="rainbow-delimiters-depth-1">(</span>s-split <span class="string">","</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> entry <span class="builtin">:channels</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                          <span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-1">(</span>,label
                            <span class="builtin">:host</span> ,host <span class="builtin">:port</span> ,port <span class="builtin">:nick</span> ,nick
                            <span class="builtin">:sasl-username</span> ,user <span class="builtin">:sasl-password</span> auth-server-pass
                            <span class="builtin">:channels</span> ,channels<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                      accounts<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">add-transient-hook!</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">=irc</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">register-irc-auths</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">IRC:3 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::org-emph-to-irc][org-emph-to-irc]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defun</span> <span class="function-name">lui-org-to-irc</span> <span class="rainbow-delimiters-depth-2">()</span>
  <span class="doc">"Examine a buffer with simple org-mode formatting, and converts the empasis:
*bold*, /italic/, and _underline_ to IRC semi-standard escape codes.
=code= is converted to inverse (highlighted) text."</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="constant">goto-char</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">point-min</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">while</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">re-search-forward</span> <span class="string">"\\_&lt;</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(?1:</span></span><span class="string">[*/_=]</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(?2:</span></span><span class="string">[</span><span class="string"><span class="negation-char">^</span></span><span class="string">[:space:]]</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(?:</span></span><span class="string">.*?[</span><span class="string"><span class="negation-char">^</span></span><span class="string">[:space:]]</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">?</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">\\1\\_&gt;"</span> nil t<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">replace-match</span>
     <span class="rainbow-delimiters-depth-1">(</span><span class="constant">concat</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">pcase</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">match-string</span> <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-3">)</span>
               <span class="rainbow-delimiters-depth-3">(</span><span class="string">"*"</span> <span class="string">"&#2;"</span><span class="rainbow-delimiters-depth-3">)</span>
               <span class="rainbow-delimiters-depth-3">(</span><span class="string">"/"</span> <span class="string">"&#29;"</span><span class="rainbow-delimiters-depth-3">)</span>
               <span class="rainbow-delimiters-depth-3">(</span><span class="string">"_"</span> <span class="string">"&#31;"</span><span class="rainbow-delimiters-depth-3">)</span>
               <span class="rainbow-delimiters-depth-3">(</span><span class="string">"="</span> <span class="string">"&#22;"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
             <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">match-string</span> <span class="highlight-numbers-number">2</span><span class="rainbow-delimiters-depth-2">)</span>
             <span class="string">"&#15;"</span><span class="rainbow-delimiters-depth-1">)</span> <span class="warning-1">nil nil</span><span class="warning-1"><span class="rainbow-delimiters-depth-3">)</span></span><span class="warning-1"><span class="rainbow-delimiters-depth-2">)</span></span><span class="warning-1"><span class="rainbow-delimiters-depth-1">)</span></span>

<span class="rainbow-delimiters-depth-1">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">lui-pre-input-hook</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">lui-org-to-irc</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">org-emph-to-irc ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Keybindings][Keybindings:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">map!</span> <span class="builtin">:map</span> elfeed-search-mode-map
      <span class="builtin">:after</span> elfeed-search
      <span class="rainbow-delimiters-depth-2">[</span>remap kill-this-buffer<span class="rainbow-delimiters-depth-2">]</span> <span class="string">"q"</span>
      <span class="rainbow-delimiters-depth-2">[</span>remap kill-buffer<span class="rainbow-delimiters-depth-2">]</span> <span class="string">"q"</span>
      <span class="builtin">:n</span> <span class="variable-name">doom-leader-key</span> nil
      <span class="builtin">:n</span> <span class="string">"q"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">+rss/quit</span>
      <span class="builtin">:n</span> <span class="string">"e"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">elfeed-update</span>
      <span class="builtin">:n</span> <span class="string">"r"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">elfeed-search-untag-all-unread</span>
      <span class="builtin">:n</span> <span class="string">"u"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">elfeed-search-tag-all-unread</span>
      <span class="builtin">:n</span> <span class="string">"s"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">elfeed-search-live-filter</span>
      <span class="builtin">:n</span> <span class="string">"RET"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">elfeed-search-show-entry</span>
      <span class="builtin">:n</span> <span class="string">"p"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">elfeed-show-pdf</span>
      <span class="builtin">:n</span> <span class="string">"+"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">elfeed-search-tag-all</span>
      <span class="builtin">:n</span> <span class="string">"-"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">elfeed-search-untag-all</span>
      <span class="builtin">:n</span> <span class="string">"S"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">elfeed-search-set-filter</span>
      <span class="builtin">:n</span> <span class="string">"b"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">elfeed-search-browse-url</span>
      <span class="builtin">:n</span> <span class="string">"y"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">elfeed-search-yank</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">map!</span> <span class="builtin">:map</span> elfeed-show-mode-map
      <span class="builtin">:after</span> elfeed-show
      <span class="rainbow-delimiters-depth-2">[</span>remap kill-this-buffer<span class="rainbow-delimiters-depth-2">]</span> <span class="string">"q"</span>
      <span class="rainbow-delimiters-depth-2">[</span>remap kill-buffer<span class="rainbow-delimiters-depth-2">]</span> <span class="string">"q"</span>
      <span class="builtin">:n</span> <span class="variable-name">doom-leader-key</span> nil
      <span class="builtin">:nm</span> <span class="string">"q"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">+rss/delete-pane</span>
      <span class="builtin">:nm</span> <span class="string">"o"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">ace-link-elfeed</span>
      <span class="builtin">:nm</span> <span class="string">"RET"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-ref-elfeed-add</span>
      <span class="builtin">:nm</span> <span class="string">"n"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">elfeed-show-next</span>
      <span class="builtin">:nm</span> <span class="string">"N"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">elfeed-show-prev</span>
      <span class="builtin">:nm</span> <span class="string">"p"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">elfeed-show-pdf</span>
      <span class="builtin">:nm</span> <span class="string">"+"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">elfeed-show-tag</span>
      <span class="builtin">:nm</span> <span class="string">"-"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">elfeed-show-untag</span>
      <span class="builtin">:nm</span> <span class="string">"s"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">elfeed-show-new-live-search</span>
      <span class="builtin">:nm</span> <span class="string">"y"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">elfeed-show-yank</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Keybindings:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Usability enhancements][Usability enhancements:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> elfeed-search
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">set-evil-initial-state!</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">elfeed-search-mode</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">normal</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> elfeed-show-mode
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">set-evil-initial-state!</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">elfeed-show-mode</span>   <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">normal</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> evil-snipe
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">push</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">elfeed-show-mode</span>   evil-snipe-disabled-modes<span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">push</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">elfeed-search-mode</span> evil-snipe-disabled-modes<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Usability enhancements:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Visual enhancements][Visual enhancements:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> elfeed

  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">elfeed-org</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">use-package!</span> elfeed-link<span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> elfeed-search-filter <span class="string">"@1-week-ago +unread"</span>
        elfeed-search-print-entry-function <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">+rss/elfeed-search-print-entry</span>
        elfeed-search-title-min-width <span class="highlight-numbers-number">80</span>
        elfeed-show-entry-switch <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">pop-to-buffer</span>
        elfeed-show-entry-delete <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">+rss/delete-pane</span>
        elfeed-show-refresh-function <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">+rss/elfeed-show-refresh--better-style</span>
        shr-max-image-proportion <span class="highlight-numbers-number">0.6</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">add-hook!</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">elfeed-show-mode-hook</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">hide-mode-line-mode</span> <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">add-hook!</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">elfeed-search-update-hook</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">hide-mode-line-mode</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defface</span> <span class="variable-name">elfeed-show-title-face</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>t <span class="rainbow-delimiters-depth-2">(</span><span class="builtin">:weight</span> ultrabold <span class="builtin">:slant</span> italic <span class="builtin">:height</span> <span class="highlight-numbers-number">1.5</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"title face in elfeed show buffer"</span>
    <span class="builtin">:group</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">elfeed</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defface</span> <span class="variable-name">elfeed-show-author-face</span> <span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>t <span class="rainbow-delimiters-depth-2">(</span><span class="builtin">:weight</span> light<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"title face in elfeed show buffer"</span>
    <span class="builtin">:group</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">elfeed</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">set-face-attribute</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">elfeed-search-title-face</span> nil
                      <span class="builtin">:foreground</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">nil</span>
                      <span class="builtin">:weight</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">light</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defadvice!</span> +rss-elfeed-wrap-h-nicer <span class="rainbow-delimiters-depth-3">()</span>
    <span class="doc">"Enhances an elfeed entry's readability by wrapping it to a width of
`</span><span class="doc"><span class="constant">fill-column</span></span><span class="doc">' and centering it with `</span><span class="doc"><span class="constant">visual-fill-column-mode</span></span><span class="doc">'."</span>
    <span class="builtin">:override</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">+rss-elfeed-wrap-h</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span><span class="variable-name">inhibit-read-only</span> t<span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span><span class="variable-name">inhibit-modification-hooks</span> t<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq-local</span> <span class="variable-name">truncate-lines</span> nil<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq-local</span> shr-width <span class="highlight-numbers-number">120</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq-local</span> <span class="variable-name">line-spacing</span> <span class="highlight-numbers-number">0.2</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq-local</span> visual-fill-column-center-text t<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">visual-fill-column-mode</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="comment-delimiter">;; </span><span class="comment">(setq-local shr-current-font '(:family "Merriweather" :height 1.2))
</span>      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">set-buffer-modified-p</span> nil<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+rss/elfeed-search-print-entry</span> <span class="rainbow-delimiters-depth-3">(</span>entry<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Print ENTRY to the buffer."</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>elfeed-goodies/tag-column-width <span class="highlight-numbers-number">40</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>elfeed-goodies/feed-source-column-width <span class="highlight-numbers-number">30</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>title <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-1">(</span>elfeed-meta entry <span class="builtin">:title</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span>elfeed-entry-title entry<span class="rainbow-delimiters-depth-1">)</span> <span class="string">""</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>title-faces <span class="rainbow-delimiters-depth-3">(</span>elfeed-search--faces <span class="rainbow-delimiters-depth-1">(</span>elfeed-entry-tags entry<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>feed <span class="rainbow-delimiters-depth-3">(</span>elfeed-entry-feed entry<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>feed-title
            <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> feed
              <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-2">(</span>elfeed-meta feed <span class="builtin">:title</span><span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span>elfeed-feed-title feed<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>tags <span class="rainbow-delimiters-depth-3">(</span><span class="constant">mapcar</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">symbol-name</span> <span class="rainbow-delimiters-depth-1">(</span>elfeed-entry-tags entry<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>tags-str <span class="rainbow-delimiters-depth-3">(</span><span class="constant">concat</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">mapconcat</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">identity</span> tags <span class="string">","</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>title-width <span class="rainbow-delimiters-depth-3">(</span><span class="constant">-</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">window-width</span><span class="rainbow-delimiters-depth-1">)</span> elfeed-goodies/feed-source-column-width
                           elfeed-goodies/tag-column-width <span class="highlight-numbers-number">4</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

           <span class="rainbow-delimiters-depth-2">(</span>tag-column <span class="rainbow-delimiters-depth-3">(</span>elfeed-format-column
                        tags-str <span class="rainbow-delimiters-depth-1">(</span>elfeed-clamp <span class="rainbow-delimiters-depth-2">(</span><span class="constant">length</span> tags-str<span class="rainbow-delimiters-depth-2">)</span>
                                               elfeed-goodies/tag-column-width
                                               elfeed-goodies/tag-column-width<span class="rainbow-delimiters-depth-1">)</span>
                        <span class="builtin">:left</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>feed-column <span class="rainbow-delimiters-depth-3">(</span>elfeed-format-column
                         feed-title <span class="rainbow-delimiters-depth-1">(</span>elfeed-clamp elfeed-goodies/feed-source-column-width
                                                  elfeed-goodies/feed-source-column-width
                                                  elfeed-goodies/feed-source-column-width<span class="rainbow-delimiters-depth-1">)</span>
                         <span class="builtin">:left</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">insert</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">propertize</span> feed-column <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">elfeed-search-feed-face</span><span class="rainbow-delimiters-depth-2">)</span> <span class="string">" "</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">insert</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">propertize</span> tag-column <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">elfeed-search-tag-face</span><span class="rainbow-delimiters-depth-2">)</span> <span class="string">" "</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">insert</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">propertize</span> title <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> title-faces <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">kbd-help</span> title<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq-local</span> <span class="variable-name">line-spacing</span> <span class="highlight-numbers-number">0.2</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+rss/elfeed-show-refresh--better-style</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="doc">"Update the buffer to match the selected entry, using a mail-style."</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">interactive</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span><span class="variable-name">inhibit-read-only</span> t<span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>title <span class="rainbow-delimiters-depth-3">(</span>elfeed-entry-title elfeed-show-entry<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>date <span class="rainbow-delimiters-depth-3">(</span><span class="constant">seconds-to-time</span> <span class="rainbow-delimiters-depth-1">(</span>elfeed-entry-date elfeed-show-entry<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>author <span class="rainbow-delimiters-depth-3">(</span>elfeed-meta elfeed-show-entry <span class="builtin">:author</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>link <span class="rainbow-delimiters-depth-3">(</span>elfeed-entry-link elfeed-show-entry<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>tags <span class="rainbow-delimiters-depth-3">(</span>elfeed-entry-tags elfeed-show-entry<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>tagsstr <span class="rainbow-delimiters-depth-3">(</span><span class="constant">mapconcat</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">symbol-name</span> tags <span class="string">", "</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>nicedate <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format-time-string</span> <span class="string">"%a, %e %b %Y %T %Z"</span> date<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>content <span class="rainbow-delimiters-depth-3">(</span>elfeed-deref <span class="rainbow-delimiters-depth-1">(</span>elfeed-entry-content elfeed-show-entry<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>type <span class="rainbow-delimiters-depth-3">(</span>elfeed-entry-content-type elfeed-show-entry<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>feed <span class="rainbow-delimiters-depth-3">(</span>elfeed-entry-feed elfeed-show-entry<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>feed-title <span class="rainbow-delimiters-depth-3">(</span>elfeed-feed-title feed<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>base <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">and</span> feed <span class="rainbow-delimiters-depth-1">(</span>elfeed-compute-base <span class="rainbow-delimiters-depth-2">(</span>elfeed-feed-url feed<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">erase-buffer</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">insert</span> <span class="string">"\n"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">insert</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">format</span> <span class="string">"%s\n\n"</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">propertize</span> title <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">elfeed-show-title-face</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">insert</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">format</span> <span class="string">"%s\t"</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">propertize</span> feed-title <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">elfeed-search-feed-face</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">and</span> author elfeed-show-entry-author<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">insert</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"%s\n"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">propertize</span> author <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">elfeed-show-author-face</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">insert</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">format</span> <span class="string">"%s\n\n"</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">propertize</span> nicedate <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">elfeed-log-date-face</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> tags
        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">insert</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"%s\n"</span>
                        <span class="rainbow-delimiters-depth-1">(</span><span class="constant">propertize</span> tagsstr <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">elfeed-search-tag-face</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="comment-delimiter">;; </span><span class="comment">(insert (propertize "Link: " 'face 'message-header-name))
</span>      <span class="comment-delimiter">;; </span><span class="comment">(elfeed-insert-link link link)
</span>      <span class="comment-delimiter">;; </span><span class="comment">(insert "\n")
</span>      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">cl-loop</span> for enclosure in <span class="rainbow-delimiters-depth-2">(</span>elfeed-entry-enclosures elfeed-show-entry<span class="rainbow-delimiters-depth-2">)</span>
               do <span class="rainbow-delimiters-depth-2">(</span><span class="constant">insert</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">propertize</span> <span class="string">"Enclosure: "</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">message-header-name</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
               do <span class="rainbow-delimiters-depth-2">(</span>elfeed-insert-link <span class="rainbow-delimiters-depth-3">(</span><span class="constant">car</span> enclosure<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
               do <span class="rainbow-delimiters-depth-2">(</span><span class="constant">insert</span> <span class="string">"\n"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">insert</span> <span class="string">"\n"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> content
          <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">eq</span> type <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">html</span><span class="rainbow-delimiters-depth-3">)</span>
              <span class="rainbow-delimiters-depth-3">(</span>elfeed-insert-html content base<span class="rainbow-delimiters-depth-3">)</span>
            <span class="rainbow-delimiters-depth-3">(</span><span class="constant">insert</span> content<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">insert</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">propertize</span> <span class="string">"(empty)\n"</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">italic</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">goto-char</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">point-min</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Visual enhancements:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Functionality enhancements][Functionality enhancements:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> elfeed-show
  <span class="rainbow-delimiters-depth-2">(</span><span class="constant">require</span> <span class="highlight-quoted-quote">'</span><span class="constant">url</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">elfeed-pdf-dir</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">expand-file-name</span> <span class="string">"pdfs/"</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">file-name-directory</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">directory-file-name</span> elfeed-enclosure-default-dir<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">elfeed-link-pdfs</span>
    <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span><span class="string">"https://www.jstatsoft.org/index.php/jss/article/view/v0</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">[</span><span class="string"><span class="negation-char">^</span></span><span class="string">/]+</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">"</span> . <span class="string">"https://www.jstatsoft.org/index.php/jss/article/view/v0\\1/v\\1.pdf"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"http://arxiv.org/abs/</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">[</span><span class="string"><span class="negation-char">^</span></span><span class="string">/]+</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">"</span> . <span class="string">"https://arxiv.org/pdf/\\1.pdf"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"List of alists of the form (REGEX-FOR-LINK . FORM-FOR-PDF)"</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">elfeed-show-pdf</span> <span class="rainbow-delimiters-depth-3">(</span>entry<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">interactive</span>
     <span class="rainbow-delimiters-depth-1">(</span><span class="constant">list</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> elfeed-show-entry <span class="rainbow-delimiters-depth-3">(</span>elfeed-search-selected <span class="builtin">:ignore-region</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>link <span class="rainbow-delimiters-depth-3">(</span>elfeed-entry-link entry<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span>feed-name <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> <span class="rainbow-delimiters-depth-1">(</span>elfeed-feed-meta <span class="rainbow-delimiters-depth-2">(</span>elfeed-entry-feed entry<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span> <span class="builtin">:title</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span>title <span class="rainbow-delimiters-depth-3">(</span>elfeed-entry-title entry<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span>file-view-function
           <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-1">(</span>f<span class="rainbow-delimiters-depth-1">)</span>
             <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> elfeed-show-entry
               <span class="rainbow-delimiters-depth-2">(</span>elfeed-kill-buffer<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
             <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">pop-to-buffer</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">find-file-noselect</span> f<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
          pdf<span class="rainbow-delimiters-depth-1">)</span>

      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>file <span class="rainbow-delimiters-depth-1">(</span><span class="constant">expand-file-name</span>
                   <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">subst-char-in-string</span> ?/ ?, title<span class="rainbow-delimiters-depth-3">)</span> <span class="string">".pdf"</span><span class="rainbow-delimiters-depth-2">)</span>
                   <span class="rainbow-delimiters-depth-2">(</span><span class="constant">expand-file-name</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">subst-char-in-string</span> ?/ ?, feed-name<span class="rainbow-delimiters-depth-3">)</span>
                                     elfeed-pdf-dir<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">file-exists-p</span> file<span class="rainbow-delimiters-depth-3">)</span>
            <span class="rainbow-delimiters-depth-3">(</span><span class="constant">funcall</span> file-view-function file<span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">dolist</span> <span class="rainbow-delimiters-depth-1">(</span>link-pdf elfeed-link-pdfs<span class="rainbow-delimiters-depth-1">)</span>
            <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">string-match-p</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">car</span> link-pdf<span class="rainbow-delimiters-depth-1">)</span> link<span class="rainbow-delimiters-depth-3">)</span>
                       <span class="rainbow-delimiters-depth-3">(</span><span class="constant">not</span> pdf<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> pdf <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">replace-regexp-in-string</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">car</span> link-pdf<span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">cdr</span> link-pdf<span class="rainbow-delimiters-depth-1">)</span> link<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">not</span> pdf<span class="rainbow-delimiters-depth-1">)</span>
              <span class="rainbow-delimiters-depth-1">(</span><span class="constant">message</span> <span class="string">"No associated PDF for entry"</span><span class="rainbow-delimiters-depth-1">)</span>
            <span class="rainbow-delimiters-depth-1">(</span><span class="constant">message</span> <span class="string">"Fetching %s"</span> pdf<span class="rainbow-delimiters-depth-1">)</span>
            <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">unless</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">file-exists-p</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">file-name-directory</span> file<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">make-directory</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">file-name-directory</span> file<span class="rainbow-delimiters-depth-3">)</span> t<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
            <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">url-copy-file</span> pdf file<span class="rainbow-delimiters-depth-1">)</span>
            <span class="rainbow-delimiters-depth-1">(</span><span class="constant">funcall</span> file-view-function file<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Functionality enhancements:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Dictionary][Dictionary:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">use-package!</span> lexic
  <span class="builtin">:commands</span> lexic-search lexic-list-dictionary
  <span class="builtin">:config</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">map!</span> <span class="builtin">:map</span> lexic-mode-map
        <span class="builtin">:n</span> <span class="string">"q"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">lexic-return-from-lexic</span>
        <span class="builtin">:nv</span> <span class="string">"RET"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">lexic-search-word-at-point</span>
        <span class="builtin">:n</span> <span class="string">"a"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">outline-show-all</span>
        <span class="builtin">:n</span> <span class="string">"h"</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">cmd!</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">outline-hide-sublevels</span> <span class="highlight-numbers-number">3</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="builtin">:n</span> <span class="string">"o"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">lexic-toggle-entry</span>
        <span class="builtin">:n</span> <span class="string">"n"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">lexic-next-entry</span>
        <span class="builtin">:n</span> <span class="string">"N"</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">cmd!</span> <span class="rainbow-delimiters-depth-1">(</span>lexic-next-entry t<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="builtin">:n</span> <span class="string">"p"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">lexic-previous-entry</span>
        <span class="builtin">:n</span> <span class="string">"P"</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">cmd!</span> <span class="rainbow-delimiters-depth-1">(</span>lexic-previous-entry t<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="builtin">:n</span> <span class="string">"E"</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">cmd!</span> <span class="rainbow-delimiters-depth-1">(</span>lexic-return-from-lexic<span class="rainbow-delimiters-depth-1">)</span> <span class="comment-delimiter">; </span><span class="comment">expand
</span>                     <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">switch-to-buffer</span> <span class="rainbow-delimiters-depth-2">(</span>lexic-get-buffer<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="builtin">:n</span> <span class="string">"M"</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">cmd!</span> <span class="rainbow-delimiters-depth-1">(</span>lexic-return-from-lexic<span class="rainbow-delimiters-depth-1">)</span> <span class="comment-delimiter">; </span><span class="comment">minimise
</span>                     <span class="rainbow-delimiters-depth-1">(</span>lexic-goto-lexic<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="builtin">:n</span> <span class="string">"C-p"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">lexic-search-history-backwards</span>
        <span class="builtin">:n</span> <span class="string">"C-n"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">lexic-search-history-forwards</span>
        <span class="builtin">:n</span> <span class="string">"/"</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">cmd!</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">call-interactively</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">lexic-search</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Dictionary:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Dictionary][Dictionary:2]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defadvice!</span> +lookup/dictionary-definition-lexic <span class="rainbow-delimiters-depth-2">(</span>identifier <span class="type">&amp;optional</span> arg<span class="rainbow-delimiters-depth-2">)</span>
  <span class="doc">"Look up the definition of the word at point (or selection) using `</span><span class="doc"><span class="constant">lexic-search</span></span><span class="doc">'."</span>
  <span class="builtin">:override</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">+lookup/dictionary-definition</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">interactive</span>
   <span class="rainbow-delimiters-depth-3">(</span><span class="constant">list</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">doom-thing-at-point-or-region</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">word</span><span class="rainbow-delimiters-depth-2">)</span>
             <span class="rainbow-delimiters-depth-2">(</span><span class="constant">read-string</span> <span class="string">"Look up in dictionary: "</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
         <span class="variable-name">current-prefix-arg</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">lexic-search</span> identifier nil nil t<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Dictionary:2 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Rebuild mail index while using mu4e][Rebuild mail index while using mu4e:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> mu4e
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">mu4e-reindex-request-file</span> <span class="string">"/tmp/mu_reindex_now"</span>
    <span class="doc">"Location of the reindex request, signaled by existance"</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">mu4e-reindex-request-min-seperation</span> <span class="highlight-numbers-number">5.0</span>
    <span class="doc">"Don't refresh again until this many second have elapsed.
Prevents a series of redisplays from being called (when set to an appropriate value)"</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">mu4e-reindex-request--file-watcher</span> nil<span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">mu4e-reindex-request--file-just-deleted</span> nil<span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">mu4e-reindex-request--last-time</span> <span class="highlight-numbers-number">0</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">mu4e-reindex-request--add-watcher</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> mu4e-reindex-request--file-just-deleted nil<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> mu4e-reindex-request--file-watcher
          <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">file-notify-add-watch</span> mu4e-reindex-request-file
                                 <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span>change<span class="rainbow-delimiters-depth-2">)</span>
                                 <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">mu4e-file-reindex-request</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defadvice!</span> mu4e-stop-watching-for-reindex-request <span class="rainbow-delimiters-depth-3">()</span>
    <span class="builtin">:after</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">mu4e~proc-kill</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> mu4e-reindex-request--file-watcher
        <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">file-notify-rm-watch</span> mu4e-reindex-request--file-watcher<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defadvice!</span> mu4e-watch-for-reindex-request <span class="rainbow-delimiters-depth-3">()</span>
    <span class="builtin">:after</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">mu4e~proc-start</span>
    <span class="rainbow-delimiters-depth-3">(</span>mu4e-stop-watching-for-reindex-request<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">file-exists-p</span> mu4e-reindex-request-file<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">delete-file</span> mu4e-reindex-request-file<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span>mu4e-reindex-request--add-watcher<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">mu4e-file-reindex-request</span> <span class="rainbow-delimiters-depth-3">(</span>event<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Act based on the existance of `</span><span class="doc"><span class="constant">mu4e-reindex-request-file</span></span><span class="doc">'"</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> mu4e-reindex-request--file-just-deleted
        <span class="rainbow-delimiters-depth-1">(</span>mu4e-reindex-request--add-watcher<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">equal</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">1</span> event<span class="rainbow-delimiters-depth-3">)</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">created</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">delete-file</span> mu4e-reindex-request-file<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> mu4e-reindex-request--file-just-deleted t<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span>mu4e-reindex-maybe t<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">mu4e-reindex-maybe</span> <span class="rainbow-delimiters-depth-3">(</span><span class="type">&amp;optional</span> new-request<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Run `</span><span class="doc"><span class="constant">mu4e~proc-index</span></span><span class="doc">' if it's been more than
`</span><span class="doc"><span class="constant">mu4e-reindex-request-min-seperation</span></span><span class="doc">'seconds since the last request,"</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>time-since-last-request <span class="rainbow-delimiters-depth-3">(</span><span class="constant">-</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">float-time</span><span class="rainbow-delimiters-depth-1">)</span>
                                      mu4e-reindex-request--last-time<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> new-request
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> mu4e-reindex-request--last-time <span class="rainbow-delimiters-depth-3">(</span><span class="constant">float-time</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">&gt;</span> time-since-last-request mu4e-reindex-request-min-seperation<span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span>mu4e~proc-index nil t<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">when</span> new-request
          <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">run-at-time</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">*</span> <span class="highlight-numbers-number">1.1</span> mu4e-reindex-request-min-seperation<span class="rainbow-delimiters-depth-1">)</span> nil
                       <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">mu4e-reindex-maybe</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Rebuild mail index while using mu4e:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Viewing Mail][Viewing Mail:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> mu4e
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> mu4e-headers-fields
        <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:flags</span> . <span class="highlight-numbers-number">6</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:account-stripe</span> . <span class="highlight-numbers-number">2</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:from-or-to</span> . <span class="highlight-numbers-number">25</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:folder</span> . <span class="highlight-numbers-number">10</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:recipnum</span> . <span class="highlight-numbers-number">2</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:subject</span> . <span class="highlight-numbers-number">80</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:human-date</span> . <span class="highlight-numbers-number">8</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        +mu4e-min-header-frame-width <span class="highlight-numbers-number">142</span>
        mu4e-headers-date-format <span class="string">"%d/%m/%y"</span>
        mu4e-headers-time-format <span class="string">"&#226;&#167;&#150; %H:%M"</span>
        mu4e-headers-results-limit <span class="highlight-numbers-number">1000</span>
        mu4e-index-cleanup t<span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-to-list</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">mu4e-bookmarks</span>
               <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="builtin">:name</span> <span class="string">"Yesterday's messages"</span> <span class="builtin">:query</span> <span class="string">"date:2d..1d"</span> <span class="builtin">:key</span> ?y<span class="rainbow-delimiters-depth-3">)</span> t<span class="rainbow-delimiters-depth-2">)</span>

  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">+mu4e-header--folder-colors</span> nil<span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">appendq!</span> mu4e-header-info-custom
            <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:folder</span> .
               <span class="rainbow-delimiters-depth-2">(</span><span class="builtin">:name</span> <span class="string">"Folder"</span> <span class="builtin">:shortname</span> <span class="string">"Folder"</span> <span class="builtin">:help</span> <span class="string">"Lowest level folder"</span> <span class="builtin">:function</span>
                <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-1">(</span>msg<span class="rainbow-delimiters-depth-1">)</span>
                  <span class="rainbow-delimiters-depth-1">(</span>+mu4e-colorize-str
                   <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">replace-regexp-in-string</span> <span class="string">"\\`.*/"</span> <span class="string">""</span> <span class="rainbow-delimiters-depth-3">(</span>mu4e-message-field msg <span class="builtin">:maildir</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                   <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">+mu4e-header--folder-colors</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Viewing Mail:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Viewing Mail][Viewing Mail:2]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> mu4e-alert-icon <span class="string">"/usr/share/icons/Papirus/64x64/apps/evolution.svg"</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Viewing Mail:2 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Sending Mail][Sending Mail:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> mu4e
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> sendmail-program <span class="string">"/usr/bin/msmtp"</span>
        <span class="variable-name">send-mail-function</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">smtpmail-send-it</span>
        message-sendmail-f-is-evil t
        message-sendmail-extra-arguments <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"--read-envelope-from"</span><span class="rainbow-delimiters-depth-3">)</span><span class="comment-delimiter">; </span><span class="comment">, "--read-recipients")
</span>        message-send-mail-function <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">message-send-mail-with-sendmail</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Sending Mail:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Sending Mail][Sending Mail:4]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defun</span> <span class="function-name">mu4e-compose-from-mailto</span> <span class="rainbow-delimiters-depth-2">(</span>mailto-string<span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="constant">require</span> <span class="highlight-quoted-quote">'</span><span class="constant">mu4e</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">unless</span> mu4e~server-props <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">mu4e</span> t<span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">sleep-for</span> <span class="highlight-numbers-number">0.1</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>mailto <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">rfc2368-parse-mailto-url</span> mailto-string<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
         <span class="rainbow-delimiters-depth-1">(</span>to <span class="rainbow-delimiters-depth-2">(</span><span class="constant">cdr</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">assoc</span> <span class="string">"To"</span> mailto<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
         <span class="rainbow-delimiters-depth-1">(</span>subject <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">cdr</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">assoc</span> <span class="string">"Subject"</span> mailto<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span> <span class="string">""</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
         <span class="rainbow-delimiters-depth-1">(</span>body <span class="rainbow-delimiters-depth-2">(</span><span class="constant">cdr</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">assoc</span> <span class="string">"Body"</span> mailto<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
         <span class="rainbow-delimiters-depth-1">(</span>org-msg-greeting-fmt <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">assoc</span> <span class="string">"Body"</span> mailto<span class="rainbow-delimiters-depth-3">)</span>
                                   <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">replace-regexp-in-string</span> <span class="string">"%"</span> <span class="string">"%%"</span>
                                                             <span class="rainbow-delimiters-depth-1">(</span><span class="constant">cdr</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">assoc</span> <span class="string">"Body"</span> mailto<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                                 org-msg-greeting-fmt<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
         <span class="rainbow-delimiters-depth-1">(</span>headers <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">-filter</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-1">(</span>spec<span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">not</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">-contains-p</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"To"</span> <span class="string">"Subject"</span> <span class="string">"Body"</span><span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">car</span> spec<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span> mailto<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span>mu4e~compose-mail to subject headers<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Sending Mail:4 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Org Msg][Org Msg:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> +org-msg-accent-color <span class="string">"#1a5fb4"</span>
      org-msg-greeting-fmt <span class="string">"\nHi %s,\n\n"</span>
      org-msg-signature <span class="string">"\n\n#+begin_signature\nAll the best,\\\\\n*Timothy*\n#+end_signature"</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">map!</span> <span class="builtin">:map</span> org-msg-edit-mode-map
      <span class="builtin">:after</span> org-msg
      <span class="builtin">:n</span> <span class="string">"G"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-msg-goto-body</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Org Msg:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*File Templates][File Templates:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="function-name">set-file-template!</span> <span class="string">"\\.tex$"</span> <span class="builtin">:trigger</span> <span class="string">"__"</span> <span class="builtin">:mode</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">latex-mode</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="rainbow-delimiters-depth-1">(</span><span class="function-name">set-file-template!</span> <span class="string">"\\.org$"</span> <span class="builtin">:trigger</span> <span class="string">"__"</span> <span class="builtin">:mode</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-mode</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="rainbow-delimiters-depth-1">(</span><span class="function-name">set-file-template!</span> <span class="string">"/LICEN[CS]E$"</span> <span class="builtin">:trigger</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">+file-templates/insert-license</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">File Templates:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Plaintext][Plaintext:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> text-mode
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">add-hook!</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">text-mode-hook</span>
             <span class="comment-delimiter">;; </span><span class="comment">Apply ANSI color codes
</span>             <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">with-silent-modifications</span>
               <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">ansi-color-apply-on-region</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">point-min</span><span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">point-max</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Plaintext:1 ends here
</span>
<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> org
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">org-ml-target-dir</span> <span class="string">"~/.emacs.d/.local/straight/repos/org-mode/"</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">org-ml-max-age</span> <span class="highlight-numbers-number">600</span>
    <span class="doc">"Maximum permissible age in seconds."</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">org-ml--cache-timestamp</span> <span class="highlight-numbers-number">0</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">org-ml--cache</span> nil<span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">org-ml-current-patches</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="doc">"Get the currently open patches, as a list of alists.
  Entries of the form (subject . id)."</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">delq</span> nil
          <span class="rainbow-delimiters-depth-1">(</span><span class="constant">mapcar</span>
           <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-3">(</span>entry<span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">unless</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> entry <span class="builtin">:fixed</span><span class="rainbow-delimiters-depth-1">)</span>
               <span class="rainbow-delimiters-depth-1">(</span><span class="constant">cons</span>
                <span class="rainbow-delimiters-depth-2">(</span><span class="constant">format</span> <span class="string">"%-8s  %s"</span>
                        <span class="rainbow-delimiters-depth-3">(</span><span class="constant">propertize</span>
                         <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">replace-regexp-in-string</span> <span class="string">"T.*"</span> <span class="string">""</span>
                                                   <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> entry <span class="builtin">:date</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                         <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">font-lock-doc-face</span><span class="rainbow-delimiters-depth-3">)</span>
                        <span class="rainbow-delimiters-depth-3">(</span><span class="constant">propertize</span>
                         <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">replace-regexp-in-string</span> <span class="string">"\\[</span><span class="string"><span class="constant">PATCH\\</span></span><span class="string">] ?"</span> <span class="string">""</span>
                                                   <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> entry <span class="builtin">:summary</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                         <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">font-lock-keyword-face</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> entry <span class="builtin">:id</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">with-current-buffer</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">url-retrieve-synchronously</span> <span class="string">"https://updates.orgmode.org/data/patches"</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span><span class="constant">json-parse-buffer</span> <span class="builtin">:object-type</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">plist</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">org-ml-select-patch-thread</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="doc">"Find and apply a proposed Org patch."</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">interactive</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>current-workspace <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">+workspace-current</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span>patches <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">progn</span>
                     <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">not</span> org-ml--cache<span class="rainbow-delimiters-depth-3">)</span>
                               <span class="rainbow-delimiters-depth-3">(</span><span class="constant">&gt;</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">-</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">float-time</span><span class="rainbow-delimiters-depth-2">)</span> org-ml--cache-timestamp<span class="rainbow-delimiters-depth-1">)</span>
                                  org-ml-max-age<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                       <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> org-ml--cache <span class="rainbow-delimiters-depth-3">(</span>org-ml-current-patches<span class="rainbow-delimiters-depth-3">)</span>
                             org-ml--cache-timestamp <span class="rainbow-delimiters-depth-3">(</span><span class="constant">float-time</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                     org-ml--cache<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
          msg-id<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">ivy-read</span> <span class="string">"Thread: "</span>
                patches
                <span class="builtin">:action</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-3">(</span>m<span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> msg-id <span class="rainbow-delimiters-depth-1">(</span><span class="constant">cdr</span> m<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">+workspace-switch</span> +mu4e-workspace-name<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span>mu4e-view-message-with-message-id msg-id<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">add-to-list</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">mu4e-view-actions</span>
                   <span class="rainbow-delimiters-depth-2">(</span><span class="constant">cons</span> <span class="string">"apply patch to org"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-ml-transient-mu4e-action</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">org-ml-transient-mu4e-action</span> <span class="rainbow-delimiters-depth-3">(</span>msg<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> mu4e-view-actions
          <span class="rainbow-delimiters-depth-1">(</span><span class="constant">delete</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">cons</span> <span class="string">"apply patch to org"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-ml-transient-mu4e-action</span><span class="rainbow-delimiters-depth-2">)</span>
                  mu4e-view-actions<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">+workspace/other</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">magit-status</span> org-ml-target-dir<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">with-current-buffer</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">get-buffer-create</span> <span class="string">"*Shell: Org apply patches*"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">erase-buffer</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="variable-name">default-directory</span> org-ml-target-dir<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">shell-command</span>
         <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"git am %s"</span>
                 <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">shell-quote-argument</span> <span class="rainbow-delimiters-depth-2">(</span>mu4e-message-field msg <span class="builtin">:path</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
         <span class="rainbow-delimiters-depth-3">(</span><span class="constant">current-buffer</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span>magit-refresh<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">string-match-p</span> <span class="string">"Error</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">|</span></span><span class="string">failed"</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">buffer-string</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">+popup/buffer</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> <span class="variable-name">org-directory</span> <span class="string">"~/.org"</span>                      <span class="comment-delimiter">; </span><span class="comment">let's put files here
</span>        org-use-property-inheritance t              <span class="comment-delimiter">; </span><span class="comment">it's convenient to have properties inherited
</span>        org-log-done <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">time</span>                          <span class="comment-delimiter">; </span><span class="comment">having the time a item is done sounds convininet
</span>        org-list-allow-alphabetical t               <span class="comment-delimiter">; </span><span class="comment">have a. A. a) A) list bullets
</span>        org-export-in-background t                  <span class="comment-delimiter">; </span><span class="comment">run export processes in external emacs process
</span>        org-catch-invisible-edits <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">smart</span>            <span class="comment-delimiter">; </span><span class="comment">try not to accidently do weird stuff in invisible regions
</span>        org-re-reveal-root <span class="string">"https://cdn.jsdelivr.net/npm/reveal.js"</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> org-babel-default-header-args
        <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:session</span> . <span class="string">"none"</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:results</span> . <span class="string">"replace"</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:exports</span> . <span class="string">"code"</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:cache</span> . <span class="string">"no"</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:noweb</span> . <span class="string">"no"</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:hlines</span> . <span class="string">"no"</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:tangle</span> . <span class="string">"no"</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:comments</span> . <span class="string">"link"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">remove-hook</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">text-mode-hook</span> <span class="highlight-quoted-quote">#'</span><span class="variable-name">visual-line-mode</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">text-mode-hook</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">auto-fill-mode</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">map!</span> <span class="builtin">:map</span> evil-org-mode-map
        <span class="builtin">:after</span> evil-org
        <span class="builtin">:n</span> <span class="string">"g &lt;up&gt;"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-backward-heading-same-level</span>
        <span class="builtin">:n</span> <span class="string">"g &lt;down&gt;"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-forward-heading-same-level</span>
        <span class="builtin">:n</span> <span class="string">"g &lt;left&gt;"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-up-element</span>
        <span class="builtin">:n</span> <span class="string">"g &lt;right&gt;"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-down-element</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">evil-define-command</span> <span class="function-name">evil-buffer-org-new</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">count</span> file<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Creates a new ORG buffer replacing the current window, optionally
     editing a certain FILE"</span>
    <span class="builtin">:repeat</span> nil
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">interactive</span> <span class="string">"P&lt;f&gt;"</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> file
        <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">evil-edit</span> file<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>buffer <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">generate-new-buffer</span> <span class="string">"*new org*"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">set-window-buffer</span> nil buffer<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">with-current-buffer</span> buffer
          <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">org-mode</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">map!</span> <span class="builtin">:leader</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="builtin">:prefix</span> <span class="string">"b"</span>
         <span class="builtin">:desc</span> <span class="string">"New empty ORG buffer"</span> <span class="string">"o"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">evil-buffer-org-new</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> org-list-demote-modify-bullet <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span><span class="string">"+"</span> . <span class="string">"-"</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"-"</span> . <span class="string">"+"</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"*"</span> . <span class="string">"+"</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"1."</span> . <span class="string">"a."</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">use-package!</span> org-ref
    <span class="builtin">:after</span> org
    <span class="builtin">:config</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> org-ref-completion-library <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-ref-ivy-cite</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-mode-hook</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">turn-on-org-cdlatex</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defadvice!</span> org-edit-latex-emv-after-insert <span class="rainbow-delimiters-depth-3">()</span>
    <span class="builtin">:after</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-cdlatex-environment-indent</span>
    <span class="rainbow-delimiters-depth-3">(</span>org-edit-latex-environment<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-mode-hook</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">turn-on-flyspell</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">cl-defmacro</span> <span class="function-name">lsp-org-babel-enable</span> <span class="rainbow-delimiters-depth-3">(</span>lang<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Support LANG in org source code block."</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> centaur-lsp <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">lsp-mode</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="warning-1">cl-check-type</span> lang stringp<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>edit-pre <span class="rainbow-delimiters-depth-3">(</span><span class="constant">intern</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">format</span> <span class="string">"org-babel-edit-prep:%s"</span> lang<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>intern-pre <span class="rainbow-delimiters-depth-3">(</span><span class="constant">intern</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">format</span> <span class="string">"lsp--%s"</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">symbol-name</span> edit-pre<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">progn</span>
         <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> ,intern-pre <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">info</span><span class="rainbow-delimiters-depth-3">)</span>
           <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>file-name <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">-&gt;&gt;</span> info caddr <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">alist-get</span> <span class="builtin">:file</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
             <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">unless</span> file-name
               <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> file-name <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">make-temp-file</span> <span class="string">"babel-lsp-"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
             <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> <span class="variable-name">buffer-file-name</span> file-name<span class="rainbow-delimiters-depth-1">)</span>
             <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">lsp-deferred</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
         <span class="rainbow-delimiters-depth-2">(</span><span class="constant">put</span> <span class="highlight-quoted-quote">'</span>,intern-pre <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">function-documentation</span>
              <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"Enable lsp-mode in the buffer of org source block (%s)."</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">upcase</span> ,lang<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
         <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">fboundp</span> <span class="highlight-quoted-quote">'</span>,edit-pre<span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">advice-add</span> <span class="highlight-quoted-quote">'</span>,edit-pre <span class="builtin">:after</span> <span class="highlight-quoted-quote">'</span>,intern-pre<span class="rainbow-delimiters-depth-3">)</span>
           <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">progn</span>
             <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defun</span> ,edit-pre <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">info</span><span class="rainbow-delimiters-depth-2">)</span>
               <span class="rainbow-delimiters-depth-2">(</span>,intern-pre info<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
             <span class="rainbow-delimiters-depth-1">(</span><span class="constant">put</span> <span class="highlight-quoted-quote">'</span>,edit-pre <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">function-documentation</span>
                  <span class="rainbow-delimiters-depth-2">(</span><span class="constant">format</span> <span class="string">"Prepare local buffer environment for org source block (%s)."</span>
                          <span class="rainbow-delimiters-depth-3">(</span><span class="constant">upcase</span> ,lang<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">org-babel-lang-list</span>
    <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"go"</span> <span class="string">"python"</span> <span class="string">"ipython"</span> <span class="string">"bash"</span> <span class="string">"sh"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">dolist</span> <span class="rainbow-delimiters-depth-3">(</span>lang org-babel-lang-list<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">eval</span> <span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-1">(</span>lsp-org-babel-enable ,lang<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">map!</span> <span class="builtin">:map</span> org-mode-map
        <span class="builtin">:localleader</span>
        <span class="builtin">:desc</span> <span class="string">"View exported file"</span> <span class="string">"v"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-view-output-file</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">org-view-output-file</span> <span class="rainbow-delimiters-depth-3">(</span><span class="type">&amp;optional</span> org-file-path<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Visit buffer open on the first output file (if any) found, using `</span><span class="doc"><span class="constant">org-view-output-file-extensions</span></span><span class="doc">'"</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">interactive</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>org-file-path <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">or</span> org-file-path <span class="rainbow-delimiters-depth-1">(</span><span class="variable-name">buffer-file-name</span><span class="rainbow-delimiters-depth-1">)</span> <span class="string">""</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>dir <span class="rainbow-delimiters-depth-3">(</span><span class="constant">file-name-directory</span> org-file-path<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>basename <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">file-name-base</span> org-file-path<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>output-file nil<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">dolist</span> <span class="rainbow-delimiters-depth-2">(</span>ext org-view-output-file-extensions<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">unless</span> output-file
          <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">file-exists-p</span>
                 <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span> dir basename <span class="string">"."</span> ext<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
            <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> output-file <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span> dir basename <span class="string">"."</span> ext<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> output-file
          <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">member</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">file-name-extension</span> output-file<span class="rainbow-delimiters-depth-1">)</span> org-view-external-file-extensions<span class="rainbow-delimiters-depth-3">)</span>
              <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">browse-url-xdg-open</span> output-file<span class="rainbow-delimiters-depth-3">)</span>
            <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">pop-to-buffer</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">find-buffer-visiting</span> output-file<span class="rainbow-delimiters-depth-2">)</span>
                               <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">find-file-noselect</span> output-file<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">message</span> <span class="string">"No exported file found"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">org-view-output-file-extensions</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"pdf"</span> <span class="string">"md"</span> <span class="string">"rst"</span> <span class="string">"txt"</span> <span class="string">"tex"</span> <span class="string">"html"</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Search for output files with these extensions, in order, viewing the first that matches"</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">org-view-external-file-extensions</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"html"</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"File formats that should be opened externally."</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">use-package!</span> org-super-agenda
    <span class="builtin">:commands</span> <span class="rainbow-delimiters-depth-3">(</span><span class="variable-name">org-super-agenda-mode</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">after!</span> org-agenda
    <span class="rainbow-delimiters-depth-3">(</span><span class="variable-name">org-super-agenda-mode</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> org-agenda-skip-scheduled-if-done t
        org-agenda-skip-deadline-if-done t
        org-agenda-include-deadlines t
        org-agenda-block-separator nil
        org-agenda-tags-column <span class="highlight-numbers-number">100</span> <span class="comment-delimiter">;; </span><span class="comment">from testing this seems to be a good value
</span>        org-agenda-compact-blocks t<span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> org-agenda-custom-commands
        <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span><span class="string">"o"</span> <span class="string">"Overview"</span>
           <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>agenda <span class="string">""</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>org-agenda-span <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">day</span><span class="rainbow-delimiters-depth-2">)</span>
                        <span class="rainbow-delimiters-depth-2">(</span>org-super-agenda-groups
                         <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:name</span> <span class="string">"Today"</span>
                            <span class="builtin">:time-grid</span> t
                            <span class="builtin">:date</span> today
                            <span class="builtin">:todo</span> <span class="string">"TODAY"</span>
                            <span class="builtin">:scheduled</span> today
                            <span class="builtin">:order</span> <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
            <span class="rainbow-delimiters-depth-3">(</span>alltodo <span class="string">""</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>org-agenda-overriding-header <span class="string">""</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span>org-super-agenda-groups
                          <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:name</span> <span class="string">"Next to do"</span>
                             <span class="builtin">:todo</span> <span class="string">"NEXT"</span>
                             <span class="builtin">:order</span> <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-1">)</span>
                            <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:name</span> <span class="string">"Important"</span>
                             <span class="builtin">:tag</span> <span class="string">"Important"</span>
                             <span class="builtin">:priority</span> <span class="string">"A"</span>
                             <span class="builtin">:order</span> <span class="highlight-numbers-number">6</span><span class="rainbow-delimiters-depth-1">)</span>
                            <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:name</span> <span class="string">"Due Today"</span>
                             <span class="builtin">:deadline</span> today
                             <span class="builtin">:order</span> <span class="highlight-numbers-number">2</span><span class="rainbow-delimiters-depth-1">)</span>
                            <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:name</span> <span class="string">"Due Soon"</span>
                             <span class="builtin">:deadline</span> future
                             <span class="builtin">:order</span> <span class="highlight-numbers-number">8</span><span class="rainbow-delimiters-depth-1">)</span>
                            <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:name</span> <span class="string">"Overdue"</span>
                             <span class="builtin">:deadline</span> past
                             <span class="builtin">:face</span> error
                             <span class="builtin">:order</span> <span class="highlight-numbers-number">7</span><span class="rainbow-delimiters-depth-1">)</span>
                            <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:name</span> <span class="string">"Assignments"</span>
                             <span class="builtin">:tag</span> <span class="string">"Assignment"</span>
                             <span class="builtin">:order</span> <span class="highlight-numbers-number">10</span><span class="rainbow-delimiters-depth-1">)</span>
                            <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:name</span> <span class="string">"Issues"</span>
                             <span class="builtin">:tag</span> <span class="string">"Issue"</span>
                             <span class="builtin">:order</span> <span class="highlight-numbers-number">12</span><span class="rainbow-delimiters-depth-1">)</span>
                            <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:name</span> <span class="string">"Emacs"</span>
                             <span class="builtin">:tag</span> <span class="string">"Emacs"</span>
                             <span class="builtin">:order</span> <span class="highlight-numbers-number">13</span><span class="rainbow-delimiters-depth-1">)</span>
                            <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:name</span> <span class="string">"Projects"</span>
                             <span class="builtin">:tag</span> <span class="string">"Project"</span>
                             <span class="builtin">:order</span> <span class="highlight-numbers-number">14</span><span class="rainbow-delimiters-depth-1">)</span>
                            <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:name</span> <span class="string">"Research"</span>
                             <span class="builtin">:tag</span> <span class="string">"Research"</span>
                             <span class="builtin">:order</span> <span class="highlight-numbers-number">15</span><span class="rainbow-delimiters-depth-1">)</span>
                            <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:name</span> <span class="string">"To read"</span>
                             <span class="builtin">:tag</span> <span class="string">"Read"</span>
                             <span class="builtin">:order</span> <span class="highlight-numbers-number">30</span><span class="rainbow-delimiters-depth-1">)</span>
                            <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:name</span> <span class="string">"Waiting"</span>
                             <span class="builtin">:todo</span> <span class="string">"WAITING"</span>
                             <span class="builtin">:order</span> <span class="highlight-numbers-number">20</span><span class="rainbow-delimiters-depth-1">)</span>
                            <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:name</span> <span class="string">"University"</span>
                             <span class="builtin">:tag</span> <span class="string">"uni"</span>
                             <span class="builtin">:order</span> <span class="highlight-numbers-number">32</span><span class="rainbow-delimiters-depth-1">)</span>
                            <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:name</span> <span class="string">"Trivial"</span>
                             <span class="builtin">:priority&lt;=</span> <span class="string">"E"</span>
                             <span class="builtin">:tag</span> <span class="rainbow-delimiters-depth-2">(</span><span class="string">"Trivial"</span> <span class="string">"Unimportant"</span><span class="rainbow-delimiters-depth-2">)</span>
                             <span class="builtin">:todo</span> <span class="rainbow-delimiters-depth-2">(</span><span class="string">"SOMEDAY"</span> <span class="rainbow-delimiters-depth-2">)</span>
                             <span class="builtin">:order</span> <span class="highlight-numbers-number">90</span><span class="rainbow-delimiters-depth-1">)</span>
                            <span class="rainbow-delimiters-depth-1">(</span><span class="builtin">:discard</span> <span class="rainbow-delimiters-depth-2">(</span><span class="builtin">:tag</span> <span class="rainbow-delimiters-depth-3">(</span><span class="string">"Chore"</span> <span class="string">"Routine"</span> <span class="string">"Daily"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">use-package!</span> doct
    <span class="builtin">:commands</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">doct</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">after!</span> org-capture
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-capture-select-template-prettier</span> <span class="rainbow-delimiters-depth-1">(</span><span class="type">&amp;optional</span> keys<span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"Select a capture template, in a prettier way than default
    Lisp programs can force the template by setting KEYS to a string."</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>org-capture-templates
             <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-2">(</span>org-contextualize-keys
                  <span class="rainbow-delimiters-depth-3">(</span>org-capture-upgrade-templates org-capture-templates<span class="rainbow-delimiters-depth-3">)</span>
                  org-capture-templates-contexts<span class="rainbow-delimiters-depth-2">)</span>
                 <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"t"</span> <span class="string">"Task"</span> entry <span class="rainbow-delimiters-depth-1">(</span>file+headline <span class="string">""</span> <span class="string">"Tasks"</span><span class="rainbow-delimiters-depth-1">)</span>
                    <span class="string">"* </span><span class="bold"><span class="warning">TODO</span></span><span class="string"> %?\n  %u\n  %a"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">if</span> keys
            <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">assoc</span> keys org-capture-templates<span class="rainbow-delimiters-depth-1">)</span>
                <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">error</span> <span class="string">"No capture template referred to by \"%s\" keys"</span> keys<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span>org-mks org-capture-templates
                   <span class="string">"Select a capture template\n&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;"</span>
                   <span class="string">"Template key: "</span>
                   <span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span><span class="string">"q"</span> ,<span class="rainbow-delimiters-depth-3">(</span><span class="constant">concat</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">all-the-icons-octicon</span> <span class="string">"stop"</span> <span class="builtin">:face</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">all-the-icons-red</span> <span class="builtin">:v-adjust</span> <span class="highlight-numbers-number">0.01</span><span class="rainbow-delimiters-depth-1">)</span> <span class="string">"\tAbort"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">advice-add</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-capture-select-template</span> <span class="builtin">:override</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-capture-select-template-prettier</span><span class="rainbow-delimiters-depth-3">)</span>
    
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-mks-pretty</span> <span class="rainbow-delimiters-depth-1">(</span>table title <span class="type">&amp;optional</span> prompt specials<span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"Select a member of an alist with multiple keys. Prettified.
    
    TABLE is the alist which should contain entries where the car is a string.
    There should be two types of entries.
    
    1. prefix descriptions like (\"a\" \"Description\")
       This indicates that `a' is a prefix key for multi-letter selection, and
       that there are entries following with keys like \"ab\", \"ax\"&#226;&#128;&#166;
    
    2. Select-able members must have more than two elements, with the first
       being the string of keys that lead to selecting it, and the second a
       short description string of the item.
    
    The command will then make a temporary buffer listing all entries
    that can be selected with a single key, and all the single key
    prefixes.  When you press the key for a single-letter entry, it is selected.
    When you press a prefix key, the commands (and maybe further prefixes)
    under this key will be shown and offered for selection.
    
    TITLE will be placed over the selection in the temporary buffer,
    PROMPT will be used when prompting for a key.  SPECIALS is an
    alist with (\"key\" \"description\") entries.  When one of these
    is selected, only the bare key is returned."</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">save-window-excursion</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span><span class="variable-name">inhibit-quit</span> t<span class="rainbow-delimiters-depth-1">)</span>
              <span class="rainbow-delimiters-depth-1">(</span>buffer <span class="rainbow-delimiters-depth-2">(</span>org-switch-to-buffer-other-window <span class="string">"*Org Select*"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
              <span class="rainbow-delimiters-depth-1">(</span>prompt <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> prompt <span class="string">"Select: "</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
              <span class="variable-name">case-fold-search</span>
              current<span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">unwind-protect</span>
              <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">catch</span> <span class="highlight-quoted-quote">'</span><span class="constant">exit</span>
                <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">while</span> t
                  <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq-local</span> <span class="variable-name">evil-normal-state-cursor</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">list</span> nil<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                  <span class="rainbow-delimiters-depth-3">(</span><span class="constant">erase-buffer</span><span class="rainbow-delimiters-depth-3">)</span>
                  <span class="rainbow-delimiters-depth-3">(</span><span class="constant">insert</span> title <span class="string">"\n\n"</span><span class="rainbow-delimiters-depth-3">)</span>
                  <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>des-keys nil<span class="rainbow-delimiters-depth-2">)</span>
                        <span class="rainbow-delimiters-depth-2">(</span>allowed-keys <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"\C-g"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                        <span class="rainbow-delimiters-depth-2">(</span>tab-alternatives <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"\s"</span> <span class="string">"\t"</span> <span class="string">"\r"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                        <span class="rainbow-delimiters-depth-2">(</span><span class="variable-name">cursor-type</span> nil<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                    <span class="comment-delimiter">;; </span><span class="comment">Populate allowed keys and descriptions keys
</span>                    <span class="comment-delimiter">;; </span><span class="comment">available with CURRENT selector.
</span>                    <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>re <span class="rainbow-delimiters-depth-1">(</span><span class="constant">format</span> <span class="string">"\\`%s</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">.</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">\\'"</span>
                                      <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">if</span> current <span class="rainbow-delimiters-depth-3">(</span><span class="constant">regexp-quote</span> current<span class="rainbow-delimiters-depth-3">)</span> <span class="string">""</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                          <span class="rainbow-delimiters-depth-3">(</span>prefix <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> current <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span> current <span class="string">" "</span><span class="rainbow-delimiters-depth-2">)</span> <span class="string">""</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                      <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">dolist</span> <span class="rainbow-delimiters-depth-3">(</span>entry table<span class="rainbow-delimiters-depth-3">)</span>
                        <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">pcase</span> entry
                          <span class="comment-delimiter">;; </span><span class="comment">Description.
</span>                          <span class="rainbow-delimiters-depth-1">(</span><span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-2">(</span>,<span class="rainbow-delimiters-depth-3">(</span><span class="keyword">and</span> key <span class="rainbow-delimiters-depth-1">(</span>pred <span class="rainbow-delimiters-depth-2">(</span><span class="constant">string-match</span> re<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span> ,desc<span class="rainbow-delimiters-depth-2">)</span>
                           <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>k <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">match-string</span> <span class="highlight-numbers-number">1</span> key<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                             <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">push</span> k des-keys<span class="rainbow-delimiters-depth-3">)</span>
                             <span class="comment-delimiter">;; </span><span class="comment">Keys ending in tab, space or RET are equivalent.
</span>                             <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">member</span> k tab-alternatives<span class="rainbow-delimiters-depth-1">)</span>
                                 <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">push</span> <span class="string">"\t"</span> allowed-keys<span class="rainbow-delimiters-depth-1">)</span>
                               <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">push</span> k allowed-keys<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                             <span class="rainbow-delimiters-depth-3">(</span><span class="constant">insert</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">propertize</span> prefix <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">font-lock-comment-face</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">propertize</span> k <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">bold</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">propertize</span> <span class="string">"&#226;&#128;&#186;"</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">font-lock-comment-face</span><span class="rainbow-delimiters-depth-1">)</span> <span class="string">"  "</span> desc <span class="string">"&#226;&#128;&#166;"</span> <span class="string">"\n"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                          <span class="comment-delimiter">;; </span><span class="comment">Usable entry.
</span>                          <span class="rainbow-delimiters-depth-1">(</span><span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-2">(</span>,<span class="rainbow-delimiters-depth-3">(</span><span class="keyword">and</span> key <span class="rainbow-delimiters-depth-1">(</span>pred <span class="rainbow-delimiters-depth-2">(</span><span class="constant">string-match</span> re<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span> ,desc . ,_<span class="rainbow-delimiters-depth-2">)</span>
                           <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>k <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">match-string</span> <span class="highlight-numbers-number">1</span> key<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                             <span class="rainbow-delimiters-depth-3">(</span><span class="constant">insert</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">propertize</span> prefix <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">font-lock-comment-face</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">propertize</span> k <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">bold</span><span class="rainbow-delimiters-depth-1">)</span> <span class="string">"   "</span> desc <span class="string">"\n"</span><span class="rainbow-delimiters-depth-3">)</span>
                             <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">push</span> k allowed-keys<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                          <span class="rainbow-delimiters-depth-1">(</span>_ nil<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                    <span class="comment-delimiter">;; </span><span class="comment">Insert special entries, if any.
</span>                    <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> specials
                      <span class="rainbow-delimiters-depth-2">(</span><span class="constant">insert</span> <span class="string">"&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;\n"</span><span class="rainbow-delimiters-depth-2">)</span>
                      <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">pcase-dolist</span> <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-1">(</span>,key ,description<span class="rainbow-delimiters-depth-1">)</span> specials<span class="rainbow-delimiters-depth-3">)</span>
                        <span class="rainbow-delimiters-depth-3">(</span><span class="constant">insert</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">format</span> <span class="string">"%s   %s\n"</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">propertize</span> key <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span>bold all-the-icons-red<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span> description<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                        <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">push</span> key allowed-keys<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                    <span class="comment-delimiter">;; </span><span class="comment">Display UI and let user select an entry or
</span>                    <span class="comment-delimiter">;; </span><span class="comment">a sub-level prefix.
</span>                    <span class="rainbow-delimiters-depth-1">(</span><span class="constant">goto-char</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">point-min</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                    <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">unless</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">pos-visible-in-window-p</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">point-max</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                      <span class="rainbow-delimiters-depth-2">(</span>org-fit-window-to-buffer<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                    <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>pressed <span class="rainbow-delimiters-depth-1">(</span>org--mks-read-key allowed-keys prompt<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                      <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> current <span class="rainbow-delimiters-depth-3">(</span><span class="constant">concat</span> current pressed<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                      <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">cond</span>
                       <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span><span class="constant">equal</span> pressed <span class="string">"\C-g"</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">user-error</span> <span class="string">"Abort"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                       <span class="comment-delimiter">;; </span><span class="comment">Selection is a prefix: open a new menu.
</span>                       <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span><span class="constant">member</span> pressed des-keys<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                       <span class="comment-delimiter">;; </span><span class="comment">Selection matches an association: return it.
</span>                       <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>entry <span class="rainbow-delimiters-depth-1">(</span><span class="constant">assoc</span> current table<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                          <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">and</span> entry <span class="rainbow-delimiters-depth-3">(</span><span class="constant">throw</span> <span class="highlight-quoted-quote">'</span><span class="constant">exit</span> entry<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                       <span class="comment-delimiter">;; </span><span class="comment">Selection matches a special entry: return the
</span>                       <span class="comment-delimiter">;; </span><span class="comment">selection prefix.
</span>                       <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span><span class="constant">assoc</span> current specials<span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">throw</span> <span class="highlight-quoted-quote">'</span><span class="constant">exit</span> current<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                       <span class="rainbow-delimiters-depth-3">(</span>t <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">error</span> <span class="string">"No entry available"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
            <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> buffer <span class="rainbow-delimiters-depth-2">(</span><span class="constant">kill-buffer</span> buffer<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">advice-add</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-mks</span> <span class="builtin">:override</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-mks-pretty</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> +org-capture-uni-units <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">condition-case</span> nil
                                     <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">split-string</span> <span class="rainbow-delimiters-depth-3">(</span>f-read-text <span class="string">"~/.org/.uni-units"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                                   <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">error</span> nil<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
          +org-capture-recipies  <span class="string">"~/Desktop/TEC/Organisation/recipies.org"</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">+doct-icon-declaration-to-icon</span> <span class="rainbow-delimiters-depth-1">(</span>declaration<span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"Convert :icon declaration to icon"</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>name <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">pop</span> declaration<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
            <span class="rainbow-delimiters-depth-3">(</span><span class="constant">set</span>  <span class="rainbow-delimiters-depth-1">(</span><span class="constant">intern</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span> <span class="string">"all-the-icons-"</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> declaration <span class="builtin">:set</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
            <span class="rainbow-delimiters-depth-3">(</span>face <span class="rainbow-delimiters-depth-1">(</span><span class="constant">intern</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span> <span class="string">"all-the-icons-"</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> declaration <span class="builtin">:color</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
            <span class="rainbow-delimiters-depth-3">(</span>v-adjust <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> declaration <span class="builtin">:v-adjust</span><span class="rainbow-delimiters-depth-2">)</span> <span class="highlight-numbers-number">0.01</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">apply</span> set <span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-3">(</span>,name <span class="builtin">:face</span> ,face <span class="builtin">:v-adjust</span> ,v-adjust<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">+doct-iconify-capture-templates</span> <span class="rainbow-delimiters-depth-1">(</span>groups<span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"Add declaration's :icon to each template group in GROUPS."</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>templates <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">doct-flatten-lists-in</span> groups<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> doct-templates <span class="rainbow-delimiters-depth-3">(</span><span class="constant">mapcar</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-2">(</span>template<span class="rainbow-delimiters-depth-2">)</span>
                                       <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">when-let*</span> <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>props <span class="rainbow-delimiters-depth-2">(</span><span class="constant">nthcdr</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">=</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">length</span> template<span class="rainbow-delimiters-depth-2">)</span> <span class="highlight-numbers-number">4</span><span class="rainbow-delimiters-depth-1">)</span> <span class="highlight-numbers-number">2</span> <span class="highlight-numbers-number">5</span><span class="rainbow-delimiters-depth-3">)</span> template<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                                                   <span class="rainbow-delimiters-depth-1">(</span>spec <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> props <span class="builtin">:doct</span><span class="rainbow-delimiters-depth-3">)</span> <span class="builtin">:icon</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                                         <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setf</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">1</span> template<span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">concat</span> <span class="rainbow-delimiters-depth-2">(</span>+doct-icon-declaration-to-icon spec<span class="rainbow-delimiters-depth-2">)</span>
                                                                        <span class="string">"\t"</span>
                                                                        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">1</span> template<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                                       template<span class="rainbow-delimiters-depth-1">)</span>
                                     templates<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> doct-after-conversion-functions <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-1">(</span>+doct-iconify-capture-templates<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">set-org-capture-templates</span> <span class="rainbow-delimiters-depth-1">()</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> org-capture-templates
            <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">doct</span> <span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span><span class="string">"Personal todo"</span> <span class="builtin">:keys</span> <span class="string">"t"</span>
                     <span class="builtin">:icon</span> <span class="rainbow-delimiters-depth-2">(</span><span class="string">"checklist"</span> <span class="builtin">:set</span> <span class="string">"octicon"</span> <span class="builtin">:color</span> <span class="string">"green"</span><span class="rainbow-delimiters-depth-2">)</span>
                     <span class="builtin">:file</span> <span class="variable-name">+org-capture-todo-file</span>
                     <span class="builtin">:prepend</span> t
                     <span class="builtin">:headline</span> <span class="string">"Inbox"</span>
                     <span class="builtin">:type</span> entry
                     <span class="builtin">:template</span> <span class="rainbow-delimiters-depth-2">(</span><span class="string">"* </span><span class="bold"><span class="warning">TODO</span></span><span class="string"> %?"</span>
                                <span class="string">"%i %a"</span><span class="rainbow-delimiters-depth-2">)</span>
                     <span class="rainbow-delimiters-depth-1">)</span>
                    <span class="rainbow-delimiters-depth-1">(</span><span class="string">"Personal note"</span> <span class="builtin">:keys</span> <span class="string">"n"</span>
                     <span class="builtin">:icon</span> <span class="rainbow-delimiters-depth-2">(</span><span class="string">"sticky-note-o"</span> <span class="builtin">:set</span> <span class="string">"faicon"</span> <span class="builtin">:color</span> <span class="string">"green"</span><span class="rainbow-delimiters-depth-2">)</span>
                     <span class="builtin">:file</span> <span class="variable-name">+org-capture-todo-file</span>
                     <span class="builtin">:prepend</span> t
                     <span class="builtin">:headline</span> <span class="string">"Inbox"</span>
                     <span class="builtin">:type</span> entry
                     <span class="builtin">:template</span> <span class="rainbow-delimiters-depth-2">(</span><span class="string">"* %?"</span>
                                <span class="string">"%i %a"</span><span class="rainbow-delimiters-depth-2">)</span>
                     <span class="rainbow-delimiters-depth-1">)</span>
                    <span class="rainbow-delimiters-depth-1">(</span><span class="string">"University"</span> <span class="builtin">:keys</span> <span class="string">"u"</span>
                     <span class="builtin">:icon</span> <span class="rainbow-delimiters-depth-2">(</span><span class="string">"graduation-cap"</span> <span class="builtin">:set</span> <span class="string">"faicon"</span> <span class="builtin">:color</span> <span class="string">"purple"</span><span class="rainbow-delimiters-depth-2">)</span>
                     <span class="builtin">:file</span> <span class="variable-name">+org-capture-todo-file</span>
                     <span class="builtin">:headline</span> <span class="string">"University"</span>
                     <span class="builtin">:unit-prompt</span> ,<span class="rainbow-delimiters-depth-2">(</span><span class="constant">format</span> <span class="string">"%%^{Unit|%s}"</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">string-join</span> +org-capture-uni-units <span class="string">"|"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                     <span class="builtin">:prepend</span> t
                     <span class="builtin">:type</span> entry
                     <span class="builtin">:children</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"Test"</span> <span class="builtin">:keys</span> <span class="string">"t"</span>
                                 <span class="builtin">:icon</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"timer"</span> <span class="builtin">:set</span> <span class="string">"material"</span> <span class="builtin">:color</span> <span class="string">"red"</span><span class="rainbow-delimiters-depth-1">)</span>
                                 <span class="builtin">:template</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"* </span><span class="bold"><span class="warning">TODO</span></span><span class="string"> [#C] %{unit-prompt} %? :uni:tests:"</span>
                                            <span class="string">"SCHEDULED: %^{Test date:}T"</span>
                                            <span class="string">"%i %a"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                                <span class="rainbow-delimiters-depth-3">(</span><span class="string">"Assignment"</span> <span class="builtin">:keys</span> <span class="string">"a"</span>
                                 <span class="builtin">:icon</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"library_books"</span> <span class="builtin">:set</span> <span class="string">"material"</span> <span class="builtin">:color</span> <span class="string">"orange"</span><span class="rainbow-delimiters-depth-1">)</span>
                                 <span class="builtin">:template</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"* </span><span class="bold"><span class="warning">TODO</span></span><span class="string"> [#B] %{unit-prompt} %? :uni:assignments:"</span>
                                            <span class="string">"DEADLINE: %^{Due date:}T"</span>
                                            <span class="string">"%i %a"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                                <span class="rainbow-delimiters-depth-3">(</span><span class="string">"Lecture"</span> <span class="builtin">:keys</span> <span class="string">"l"</span>
                                 <span class="builtin">:icon</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"keynote"</span> <span class="builtin">:set</span> <span class="string">"fileicon"</span> <span class="builtin">:color</span> <span class="string">"orange"</span><span class="rainbow-delimiters-depth-1">)</span>
                                 <span class="builtin">:template</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"* </span><span class="bold"><span class="warning">TODO</span></span><span class="string"> [#C] %{unit-prompt} %? :uni:lecture:"</span>
                                            <span class="string">"%i %a"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                                <span class="rainbow-delimiters-depth-3">(</span><span class="string">"Miscellaneous task"</span> <span class="builtin">:keys</span> <span class="string">"u"</span>
                                 <span class="builtin">:icon</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"list"</span> <span class="builtin">:set</span> <span class="string">"faicon"</span> <span class="builtin">:color</span> <span class="string">"yellow"</span><span class="rainbow-delimiters-depth-1">)</span>
                                 <span class="builtin">:template</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"* </span><span class="bold"><span class="warning">TODO</span></span><span class="string"> [#D] %{unit-prompt} %? :uni:"</span>
                                            <span class="string">"%i %a"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                    <span class="rainbow-delimiters-depth-1">(</span><span class="string">"Email"</span> <span class="builtin">:keys</span> <span class="string">"e"</span>
                     <span class="builtin">:icon</span> <span class="rainbow-delimiters-depth-2">(</span><span class="string">"envelope"</span> <span class="builtin">:set</span> <span class="string">"faicon"</span> <span class="builtin">:color</span> <span class="string">"blue"</span><span class="rainbow-delimiters-depth-2">)</span>
                     <span class="builtin">:file</span> <span class="variable-name">+org-capture-todo-file</span>
                     <span class="builtin">:prepend</span> t
                     <span class="builtin">:headline</span> <span class="string">"Inbox"</span>
                     <span class="builtin">:type</span> entry
                     <span class="builtin">:template</span> <span class="rainbow-delimiters-depth-2">(</span><span class="string">"* </span><span class="bold"><span class="warning">TODO</span></span><span class="string"> %^{type|reply to|contact} %\\3 %? :email:"</span>
                                <span class="string">"Send an email %^{urgancy|soon|ASAP|anon|at some point|eventually} to %^{recipiant}"</span>
                                <span class="string">"about %^{topic}"</span>
                                <span class="string">"%U %i %a"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                    <span class="rainbow-delimiters-depth-1">(</span><span class="string">"Interesting"</span> <span class="builtin">:keys</span> <span class="string">"i"</span>
                     <span class="builtin">:icon</span> <span class="rainbow-delimiters-depth-2">(</span><span class="string">"eye"</span> <span class="builtin">:set</span> <span class="string">"faicon"</span> <span class="builtin">:color</span> <span class="string">"lcyan"</span><span class="rainbow-delimiters-depth-2">)</span>
                     <span class="builtin">:file</span> <span class="variable-name">+org-capture-todo-file</span>
                     <span class="builtin">:prepend</span> t
                     <span class="builtin">:headline</span> <span class="string">"Interesting"</span>
                     <span class="builtin">:type</span> entry
                     <span class="builtin">:template</span> <span class="rainbow-delimiters-depth-2">(</span><span class="string">"* [ ] %{desc}%? :%{i-type}:"</span>
                                <span class="string">"%i %a"</span><span class="rainbow-delimiters-depth-2">)</span>
                     <span class="builtin">:children</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"Webpage"</span> <span class="builtin">:keys</span> <span class="string">"w"</span>
                                 <span class="builtin">:icon</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"globe"</span> <span class="builtin">:set</span> <span class="string">"faicon"</span> <span class="builtin">:color</span> <span class="string">"green"</span><span class="rainbow-delimiters-depth-1">)</span>
                                 <span class="builtin">:desc</span> <span class="string">"%(org-cliplink-capture) "</span>
                                 <span class="builtin">:i-type</span> <span class="string">"read:web"</span>
                                 <span class="rainbow-delimiters-depth-3">)</span>
                                <span class="rainbow-delimiters-depth-3">(</span><span class="string">"Article"</span> <span class="builtin">:keys</span> <span class="string">"a"</span>
                                 <span class="builtin">:icon</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"file-text"</span> <span class="builtin">:set</span> <span class="string">"octicon"</span> <span class="builtin">:color</span> <span class="string">"yellow"</span><span class="rainbow-delimiters-depth-1">)</span>
                                 <span class="builtin">:desc</span> <span class="string">""</span>
                                 <span class="builtin">:i-type</span> <span class="string">"read:reaserch"</span>
                                 <span class="rainbow-delimiters-depth-3">)</span>
                                <span class="rainbow-delimiters-depth-3">(</span><span class="string">"\tRecipie"</span> <span class="builtin">:keys</span> <span class="string">"r"</span>
                                 <span class="builtin">:icon</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"spoon"</span> <span class="builtin">:set</span> <span class="string">"faicon"</span> <span class="builtin">:color</span> <span class="string">"dorange"</span><span class="rainbow-delimiters-depth-1">)</span>
                                 <span class="builtin">:file</span> +org-capture-recipies
                                 <span class="builtin">:headline</span> <span class="string">"Unsorted"</span>
                                 <span class="builtin">:template</span> <span class="string">"%(org-chef-get-recipe-from-url)"</span>
                                 <span class="rainbow-delimiters-depth-3">)</span>
                                <span class="rainbow-delimiters-depth-3">(</span><span class="string">"Information"</span> <span class="builtin">:keys</span> <span class="string">"i"</span>
                                 <span class="builtin">:icon</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"info-circle"</span> <span class="builtin">:set</span> <span class="string">"faicon"</span> <span class="builtin">:color</span> <span class="string">"blue"</span><span class="rainbow-delimiters-depth-1">)</span>
                                 <span class="builtin">:desc</span> <span class="string">""</span>
                                 <span class="builtin">:i-type</span> <span class="string">"read:info"</span>
                                 <span class="rainbow-delimiters-depth-3">)</span>
                                <span class="rainbow-delimiters-depth-3">(</span><span class="string">"Idea"</span> <span class="builtin">:keys</span> <span class="string">"I"</span>
                                 <span class="builtin">:icon</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"bubble_chart"</span> <span class="builtin">:set</span> <span class="string">"material"</span> <span class="builtin">:color</span> <span class="string">"silver"</span><span class="rainbow-delimiters-depth-1">)</span>
                                 <span class="builtin">:desc</span> <span class="string">""</span>
                                 <span class="builtin">:i-type</span> <span class="string">"idea"</span>
                                 <span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                    <span class="rainbow-delimiters-depth-1">(</span><span class="string">"Tasks"</span> <span class="builtin">:keys</span> <span class="string">"k"</span>
                     <span class="builtin">:icon</span> <span class="rainbow-delimiters-depth-2">(</span><span class="string">"inbox"</span> <span class="builtin">:set</span> <span class="string">"octicon"</span> <span class="builtin">:color</span> <span class="string">"yellow"</span><span class="rainbow-delimiters-depth-2">)</span>
                     <span class="builtin">:file</span> <span class="variable-name">+org-capture-todo-file</span>
                     <span class="builtin">:prepend</span> t
                     <span class="builtin">:headline</span> <span class="string">"Tasks"</span>
                     <span class="builtin">:type</span> entry
                     <span class="builtin">:template</span> <span class="rainbow-delimiters-depth-2">(</span><span class="string">"* </span><span class="bold"><span class="warning">TODO</span></span><span class="string"> %? %^G%{extra}"</span>
                                <span class="string">"%i %a"</span><span class="rainbow-delimiters-depth-2">)</span>
                     <span class="builtin">:children</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"General Task"</span> <span class="builtin">:keys</span> <span class="string">"k"</span>
                                 <span class="builtin">:icon</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"inbox"</span> <span class="builtin">:set</span> <span class="string">"octicon"</span> <span class="builtin">:color</span> <span class="string">"yellow"</span><span class="rainbow-delimiters-depth-1">)</span>
                                 <span class="builtin">:extra</span> <span class="string">""</span>
                                 <span class="rainbow-delimiters-depth-3">)</span>
                                <span class="rainbow-delimiters-depth-3">(</span><span class="string">"Task with deadline"</span> <span class="builtin">:keys</span> <span class="string">"d"</span>
                                 <span class="builtin">:icon</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"timer"</span> <span class="builtin">:set</span> <span class="string">"material"</span> <span class="builtin">:color</span> <span class="string">"orange"</span> <span class="builtin">:v-adjust</span> <span class="highlight-numbers-number">-0.1</span><span class="rainbow-delimiters-depth-1">)</span>
                                 <span class="builtin">:extra</span> <span class="string">"\nDEADLINE: %^{Deadline:}t"</span>
                                 <span class="rainbow-delimiters-depth-3">)</span>
                                <span class="rainbow-delimiters-depth-3">(</span><span class="string">"Scheduled Task"</span> <span class="builtin">:keys</span> <span class="string">"s"</span>
                                 <span class="builtin">:icon</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"calendar"</span> <span class="builtin">:set</span> <span class="string">"octicon"</span> <span class="builtin">:color</span> <span class="string">"orange"</span><span class="rainbow-delimiters-depth-1">)</span>
                                 <span class="builtin">:extra</span> <span class="string">"\nSCHEDULED: %^{Start time:}t"</span>
                                 <span class="rainbow-delimiters-depth-3">)</span>
                                <span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                    <span class="rainbow-delimiters-depth-1">(</span><span class="string">"Project"</span> <span class="builtin">:keys</span> <span class="string">"p"</span>
                     <span class="builtin">:icon</span> <span class="rainbow-delimiters-depth-2">(</span><span class="string">"repo"</span> <span class="builtin">:set</span> <span class="string">"octicon"</span> <span class="builtin">:color</span> <span class="string">"silver"</span><span class="rainbow-delimiters-depth-2">)</span>
                     <span class="builtin">:prepend</span> t
                     <span class="builtin">:type</span> entry
                     <span class="builtin">:headline</span> <span class="string">"Inbox"</span>
                     <span class="builtin">:template</span> <span class="rainbow-delimiters-depth-2">(</span><span class="string">"* %{time-or-todo} %?"</span>
                                <span class="string">"%i"</span>
                                <span class="string">"%a"</span><span class="rainbow-delimiters-depth-2">)</span>
                     <span class="builtin">:file</span> <span class="string">""</span>
                     <span class="builtin">:custom</span> <span class="rainbow-delimiters-depth-2">(</span><span class="builtin">:time-or-todo</span> <span class="string">""</span><span class="rainbow-delimiters-depth-2">)</span>
                     <span class="builtin">:children</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"Project-local todo"</span> <span class="builtin">:keys</span> <span class="string">"t"</span>
                                 <span class="builtin">:icon</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"checklist"</span> <span class="builtin">:set</span> <span class="string">"octicon"</span> <span class="builtin">:color</span> <span class="string">"green"</span><span class="rainbow-delimiters-depth-1">)</span>
                                 <span class="builtin">:time-or-todo</span> <span class="string">"</span><span class="bold"><span class="warning">TODO</span></span><span class="string">"</span>
                                 <span class="builtin">:file</span> +org-capture-project-todo-file<span class="rainbow-delimiters-depth-3">)</span>
                                <span class="rainbow-delimiters-depth-3">(</span><span class="string">"Project-local note"</span> <span class="builtin">:keys</span> <span class="string">"n"</span>
                                 <span class="builtin">:icon</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"sticky-note"</span> <span class="builtin">:set</span> <span class="string">"faicon"</span> <span class="builtin">:color</span> <span class="string">"yellow"</span><span class="rainbow-delimiters-depth-1">)</span>
                                 <span class="builtin">:time-or-todo</span> <span class="string">"%U"</span>
                                 <span class="builtin">:file</span> +org-capture-project-notes-file<span class="rainbow-delimiters-depth-3">)</span>
                                <span class="rainbow-delimiters-depth-3">(</span><span class="string">"Project-local changelog"</span> <span class="builtin">:keys</span> <span class="string">"c"</span>
                                 <span class="builtin">:icon</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"list"</span> <span class="builtin">:set</span> <span class="string">"faicon"</span> <span class="builtin">:color</span> <span class="string">"blue"</span><span class="rainbow-delimiters-depth-1">)</span>
                                 <span class="builtin">:time-or-todo</span> <span class="string">"%U"</span>
                                 <span class="builtin">:heading</span> <span class="string">"Unreleased"</span>
                                 <span class="builtin">:file</span> +org-capture-project-changelog-file<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                     <span class="rainbow-delimiters-depth-1">)</span>
                    <span class="rainbow-delimiters-depth-1">(</span><span class="string">"\tCentralised project templates"</span>
                     <span class="builtin">:keys</span> <span class="string">"o"</span>
                     <span class="builtin">:type</span> entry
                     <span class="builtin">:prepend</span> t
                     <span class="builtin">:template</span> <span class="rainbow-delimiters-depth-2">(</span><span class="string">"* %{time-or-todo} %?"</span>
                                <span class="string">"%i"</span>
                                <span class="string">"%a"</span><span class="rainbow-delimiters-depth-2">)</span>
                     <span class="builtin">:children</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"Project todo"</span>
                                 <span class="builtin">:keys</span> <span class="string">"t"</span>
                                 <span class="builtin">:prepend</span> nil
                                 <span class="builtin">:time-or-todo</span> <span class="string">"</span><span class="bold"><span class="warning">TODO</span></span><span class="string">"</span>
                                 <span class="builtin">:heading</span> <span class="string">"Tasks"</span>
                                 <span class="builtin">:file</span> +org-capture-central-project-todo-file<span class="rainbow-delimiters-depth-3">)</span>
                                <span class="rainbow-delimiters-depth-3">(</span><span class="string">"Project note"</span>
                                 <span class="builtin">:keys</span> <span class="string">"n"</span>
                                 <span class="builtin">:time-or-todo</span> <span class="string">"%U"</span>
                                 <span class="builtin">:heading</span> <span class="string">"Notes"</span>
                                 <span class="builtin">:file</span> +org-capture-central-project-notes-file<span class="rainbow-delimiters-depth-3">)</span>
                                <span class="rainbow-delimiters-depth-3">(</span><span class="string">"Project changelog"</span>
                                 <span class="builtin">:keys</span> <span class="string">"c"</span>
                                 <span class="builtin">:time-or-todo</span> <span class="string">"%U"</span>
                                 <span class="builtin">:heading</span> <span class="string">"Unreleased"</span>
                                 <span class="builtin">:file</span> +org-capture-central-project-changelog-file<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                     <span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span>set-org-capture-templates<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">unless</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">display-graphic-p</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">server-after-make-frame-hook</span>
                <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">org-capture-reinitialise-hook</span> <span class="rainbow-delimiters-depth-3">()</span>
                  <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">display-graphic-p</span><span class="rainbow-delimiters-depth-1">)</span>
                    <span class="rainbow-delimiters-depth-1">(</span>set-org-capture-templates<span class="rainbow-delimiters-depth-1">)</span>
                    <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">remove-hook</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">server-after-make-frame-hook</span>
                                 <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-capture-reinitialise-hook</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">org-capture-select-template-prettier</span> <span class="rainbow-delimiters-depth-3">(</span><span class="type">&amp;optional</span> keys<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Select a capture template, in a prettier way than default
  Lisp programs can force the template by setting KEYS to a string."</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>org-capture-templates
           <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-1">(</span>org-contextualize-keys
                <span class="rainbow-delimiters-depth-2">(</span>org-capture-upgrade-templates org-capture-templates<span class="rainbow-delimiters-depth-2">)</span>
                org-capture-templates-contexts<span class="rainbow-delimiters-depth-1">)</span>
               <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span><span class="string">"t"</span> <span class="string">"Task"</span> entry <span class="rainbow-delimiters-depth-3">(</span>file+headline <span class="string">""</span> <span class="string">"Tasks"</span><span class="rainbow-delimiters-depth-3">)</span>
                  <span class="string">"* </span><span class="bold"><span class="warning">TODO</span></span><span class="string"> %?\n  %u\n  %a"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> keys
          <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">assoc</span> keys org-capture-templates<span class="rainbow-delimiters-depth-3">)</span>
              <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">error</span> <span class="string">"No capture template referred to by \"%s\" keys"</span> keys<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span>org-mks org-capture-templates
                 <span class="string">"Select a capture template\n&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;&#226;&#148;&#129;"</span>
                 <span class="string">"Template key: "</span>
                 <span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span><span class="string">"q"</span> ,<span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">all-the-icons-octicon</span> <span class="string">"stop"</span> <span class="builtin">:face</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">all-the-icons-red</span> <span class="builtin">:v-adjust</span> <span class="highlight-numbers-number">0.01</span><span class="rainbow-delimiters-depth-3">)</span> <span class="string">"\tAbort"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">advice-add</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-capture-select-template</span> <span class="builtin">:override</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-capture-select-template-prettier</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">org-mks-pretty</span> <span class="rainbow-delimiters-depth-3">(</span>table title <span class="type">&amp;optional</span> prompt specials<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Select a member of an alist with multiple keys. Prettified.
  
  TABLE is the alist which should contain entries where the car is a string.
  There should be two types of entries.
  
  1. prefix descriptions like (\"a\" \"Description\")
     This indicates that `a' is a prefix key for multi-letter selection, and
     that there are entries following with keys like \"ab\", \"ax\"&#226;&#128;&#166;
  
  2. Select-able members must have more than two elements, with the first
     being the string of keys that lead to selecting it, and the second a
     short description string of the item.
  
  The command will then make a temporary buffer listing all entries
  that can be selected with a single key, and all the single key
  prefixes.  When you press the key for a single-letter entry, it is selected.
  When you press a prefix key, the commands (and maybe further prefixes)
  under this key will be shown and offered for selection.
  
  TITLE will be placed over the selection in the temporary buffer,
  PROMPT will be used when prompting for a key.  SPECIALS is an
  alist with (\"key\" \"description\") entries.  When one of these
  is selected, only the bare key is returned."</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">save-window-excursion</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="variable-name">inhibit-quit</span> t<span class="rainbow-delimiters-depth-3">)</span>
            <span class="rainbow-delimiters-depth-3">(</span>buffer <span class="rainbow-delimiters-depth-1">(</span>org-switch-to-buffer-other-window <span class="string">"*Org Select*"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
            <span class="rainbow-delimiters-depth-3">(</span>prompt <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> prompt <span class="string">"Select: "</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
            <span class="variable-name">case-fold-search</span>
            current<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">unwind-protect</span>
            <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">catch</span> <span class="highlight-quoted-quote">'</span><span class="constant">exit</span>
              <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">while</span> t
                <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq-local</span> <span class="variable-name">evil-normal-state-cursor</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">list</span> nil<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                <span class="rainbow-delimiters-depth-2">(</span><span class="constant">erase-buffer</span><span class="rainbow-delimiters-depth-2">)</span>
                <span class="rainbow-delimiters-depth-2">(</span><span class="constant">insert</span> title <span class="string">"\n\n"</span><span class="rainbow-delimiters-depth-2">)</span>
                <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>des-keys nil<span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span>allowed-keys <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span><span class="string">"\C-g"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span>tab-alternatives <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span><span class="string">"\s"</span> <span class="string">"\t"</span> <span class="string">"\r"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="variable-name">cursor-type</span> nil<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                  <span class="comment-delimiter">;; </span><span class="comment">Populate allowed keys and descriptions keys
</span>                  <span class="comment-delimiter">;; </span><span class="comment">available with CURRENT selector.
</span>                  <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>re <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"\\`%s</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">.</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">\\'"</span>
                                    <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> current <span class="rainbow-delimiters-depth-2">(</span><span class="constant">regexp-quote</span> current<span class="rainbow-delimiters-depth-2">)</span> <span class="string">""</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                        <span class="rainbow-delimiters-depth-2">(</span>prefix <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> current <span class="rainbow-delimiters-depth-1">(</span><span class="constant">concat</span> current <span class="string">" "</span><span class="rainbow-delimiters-depth-1">)</span> <span class="string">""</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                    <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">dolist</span> <span class="rainbow-delimiters-depth-2">(</span>entry table<span class="rainbow-delimiters-depth-2">)</span>
                      <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">pcase</span> entry
                        <span class="comment-delimiter">;; </span><span class="comment">Description.
</span>                        <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-1">(</span>,<span class="rainbow-delimiters-depth-2">(</span><span class="keyword">and</span> key <span class="rainbow-delimiters-depth-3">(</span>pred <span class="rainbow-delimiters-depth-1">(</span><span class="constant">string-match</span> re<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span> ,desc<span class="rainbow-delimiters-depth-1">)</span>
                         <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>k <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">match-string</span> <span class="highlight-numbers-number">1</span> key<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                           <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">push</span> k des-keys<span class="rainbow-delimiters-depth-2">)</span>
                           <span class="comment-delimiter">;; </span><span class="comment">Keys ending in tab, space or RET are equivalent.
</span>                           <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">member</span> k tab-alternatives<span class="rainbow-delimiters-depth-3">)</span>
                               <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">push</span> <span class="string">"\t"</span> allowed-keys<span class="rainbow-delimiters-depth-3">)</span>
                             <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">push</span> k allowed-keys<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                           <span class="rainbow-delimiters-depth-2">(</span><span class="constant">insert</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">propertize</span> prefix <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">font-lock-comment-face</span><span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">propertize</span> k <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">bold</span><span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">propertize</span> <span class="string">"&#226;&#128;&#186;"</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">font-lock-comment-face</span><span class="rainbow-delimiters-depth-3">)</span> <span class="string">"  "</span> desc <span class="string">"&#226;&#128;&#166;"</span> <span class="string">"\n"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                        <span class="comment-delimiter">;; </span><span class="comment">Usable entry.
</span>                        <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-1">(</span>,<span class="rainbow-delimiters-depth-2">(</span><span class="keyword">and</span> key <span class="rainbow-delimiters-depth-3">(</span>pred <span class="rainbow-delimiters-depth-1">(</span><span class="constant">string-match</span> re<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span> ,desc . ,_<span class="rainbow-delimiters-depth-1">)</span>
                         <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>k <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">match-string</span> <span class="highlight-numbers-number">1</span> key<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                           <span class="rainbow-delimiters-depth-2">(</span><span class="constant">insert</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">propertize</span> prefix <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">font-lock-comment-face</span><span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">propertize</span> k <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">bold</span><span class="rainbow-delimiters-depth-3">)</span> <span class="string">"   "</span> desc <span class="string">"\n"</span><span class="rainbow-delimiters-depth-2">)</span>
                           <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">push</span> k allowed-keys<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                        <span class="rainbow-delimiters-depth-3">(</span>_ nil<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                  <span class="comment-delimiter">;; </span><span class="comment">Insert special entries, if any.
</span>                  <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> specials
                    <span class="rainbow-delimiters-depth-1">(</span><span class="constant">insert</span> <span class="string">"&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;&#226;&#148;&#128;\n"</span><span class="rainbow-delimiters-depth-1">)</span>
                    <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">pcase-dolist</span> <span class="rainbow-delimiters-depth-2">(</span><span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-3">(</span>,key ,description<span class="rainbow-delimiters-depth-3">)</span> specials<span class="rainbow-delimiters-depth-2">)</span>
                      <span class="rainbow-delimiters-depth-2">(</span><span class="constant">insert</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"%s   %s\n"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">propertize</span> key <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span>bold all-the-icons-red<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span> description<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                      <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">push</span> key allowed-keys<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                  <span class="comment-delimiter">;; </span><span class="comment">Display UI and let user select an entry or
</span>                  <span class="comment-delimiter">;; </span><span class="comment">a sub-level prefix.
</span>                  <span class="rainbow-delimiters-depth-3">(</span><span class="constant">goto-char</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">point-min</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                  <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">unless</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">pos-visible-in-window-p</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">point-max</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                    <span class="rainbow-delimiters-depth-1">(</span>org-fit-window-to-buffer<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                  <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>pressed <span class="rainbow-delimiters-depth-3">(</span>org--mks-read-key allowed-keys prompt<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                    <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> current <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span> current pressed<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                    <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">cond</span>
                     <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="constant">equal</span> pressed <span class="string">"\C-g"</span><span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">user-error</span> <span class="string">"Abort"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                     <span class="comment-delimiter">;; </span><span class="comment">Selection is a prefix: open a new menu.
</span>                     <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="constant">member</span> pressed des-keys<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                     <span class="comment-delimiter">;; </span><span class="comment">Selection matches an association: return it.
</span>                     <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>entry <span class="rainbow-delimiters-depth-3">(</span><span class="constant">assoc</span> current table<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                        <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">and</span> entry <span class="rainbow-delimiters-depth-2">(</span><span class="constant">throw</span> <span class="highlight-quoted-quote">'</span><span class="constant">exit</span> entry<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                     <span class="comment-delimiter">;; </span><span class="comment">Selection matches a special entry: return the
</span>                     <span class="comment-delimiter">;; </span><span class="comment">selection prefix.
</span>                     <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="constant">assoc</span> current specials<span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">throw</span> <span class="highlight-quoted-quote">'</span><span class="constant">exit</span> current<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                     <span class="rainbow-delimiters-depth-2">(</span>t <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">error</span> <span class="string">"No entry available"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> buffer <span class="rainbow-delimiters-depth-1">(</span><span class="constant">kill-buffer</span> buffer<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">advice-add</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-mks</span> <span class="builtin">:override</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-mks-pretty</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setf</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">alist-get</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">height</span> <span class="variable-name">+org-capture-frame-parameters</span><span class="rainbow-delimiters-depth-3">)</span> <span class="highlight-numbers-number">15</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="comment-delimiter">;; </span><span class="comment">(alist-get 'name +org-capture-frame-parameters) "&#226;&#157;&#150; Capture") ;; ATM hardcoded in other places, so changing breaks stuff
</span>  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> +org-capture-fn
        <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-1">()</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">interactive</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="constant">set-window-parameter</span> nil <span class="highlight-quoted-quote">'</span><span class="variable-name">mode-line-format</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">none</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">org-capture</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">after!</span> org-roam
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> org-roam-graph-node-extra-config
          <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span><span class="string">"shape"</span>      . <span class="string">"underline"</span><span class="rainbow-delimiters-depth-2">)</span>
            <span class="rainbow-delimiters-depth-2">(</span><span class="string">"style"</span>      . <span class="string">"rounded,filled"</span><span class="rainbow-delimiters-depth-2">)</span>
            <span class="rainbow-delimiters-depth-2">(</span><span class="string">"fillcolor"</span>  . <span class="string">"#EEEEEE"</span><span class="rainbow-delimiters-depth-2">)</span>
            <span class="rainbow-delimiters-depth-2">(</span><span class="string">"color"</span>      . <span class="string">"#C9C9C9"</span><span class="rainbow-delimiters-depth-2">)</span>
            <span class="rainbow-delimiters-depth-2">(</span><span class="string">"fontcolor"</span>  . <span class="string">"#111111"</span><span class="rainbow-delimiters-depth-2">)</span>
            <span class="rainbow-delimiters-depth-2">(</span><span class="string">"fontname"</span>   . <span class="string">"Overpass"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> +org-roam-graph--html-template
          <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">replace-regexp-in-string</span> <span class="string">"%</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">[</span><span class="string"><span class="negation-char">^</span></span><span class="string">s]</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">"</span> <span class="string">"%%\\1"</span>
                                    <span class="rainbow-delimiters-depth-2">(</span>f-read-text <span class="rainbow-delimiters-depth-3">(</span><span class="constant">concat</span> <span class="variable-name">doom-private-dir</span> <span class="string">"misc/org-roam-template.html"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defadvice!</span> +org-roam-graph--build-html <span class="rainbow-delimiters-depth-1">(</span><span class="type">&amp;optional</span> node-query callback<span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"Generate a graph showing the relations between nodes in NODE-QUERY. HTML style."</span>
      <span class="builtin">:override</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-roam-graph--build</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">unless</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">stringp</span> org-roam-graph-executable<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">user-error</span> <span class="string">"`</span><span class="string"><span class="constant">org-roam-graph-executable</span></span><span class="string">' is not a string"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">unless</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">executable-find</span> org-roam-graph-executable<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">user-error</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">concat</span> <span class="string">"Cannot find executable %s to generate the graph.  "</span>
                            <span class="string">"Please adjust `</span><span class="string"><span class="constant">org-roam-graph-executable</span></span><span class="string">'"</span><span class="rainbow-delimiters-depth-3">)</span>
                    org-roam-graph-executable<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>node-query <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> node-query
                             <span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-2">[</span><span class="builtin">:select</span> <span class="rainbow-delimiters-depth-3">[</span>file titles<span class="rainbow-delimiters-depth-3">]</span> <span class="builtin">:from</span> titles
                               ,@<span class="rainbow-delimiters-depth-3">(</span>org-roam-graph--expand-matcher <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">file</span> t<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">]</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>graph      <span class="rainbow-delimiters-depth-1">(</span>org-roam-graph--dot node-query<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>temp-dot   <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">make-temp-file</span> <span class="string">"graph."</span> nil <span class="string">".dot"</span> graph<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>temp-graph <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">make-temp-file</span> <span class="string">"graph."</span> nil <span class="string">".svg"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>temp-html  <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">make-temp-file</span> <span class="string">"graph."</span> nil <span class="string">".html"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span>org-roam-message <span class="string">"building graph"</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">make-process</span>
         <span class="builtin">:name</span> <span class="string">"*org-roam-graph--build-process*"</span>
         <span class="builtin">:buffer</span> <span class="string">"*org-roam-graph--build-process*"</span>
         <span class="builtin">:command</span> <span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-3">(</span>,org-roam-graph-executable ,temp-dot <span class="string">"-Tsvg"</span> <span class="string">"-o"</span> ,temp-graph<span class="rainbow-delimiters-depth-3">)</span>
         <span class="builtin">:sentinel</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">progn</span>
                     <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-2">(</span>process _event<span class="rainbow-delimiters-depth-2">)</span>
                       <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">=</span> <span class="highlight-numbers-number">0</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">process-exit-status</span> process<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                         <span class="rainbow-delimiters-depth-3">(</span><span class="constant">write-region</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">format</span> +org-roam-graph--html-template <span class="rainbow-delimiters-depth-2">(</span>f-read-text temp-graph<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span> nil temp-html<span class="rainbow-delimiters-depth-3">)</span>
                         <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> callback
                           <span class="rainbow-delimiters-depth-1">(</span><span class="constant">funcall</span> callback temp-html<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defadvice!</span> doom-modeline--buffer-file-name-roam-aware-a <span class="rainbow-delimiters-depth-3">(</span>orig-fun<span class="rainbow-delimiters-depth-3">)</span>
    <span class="builtin">:around</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">doom-modeline-buffer-file-name</span> <span class="comment-delimiter">; </span><span class="comment">takes no args
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-1">(</span>s-contains-p org-roam-directory <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> <span class="variable-name">buffer-file-name</span> <span class="string">""</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
        <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">replace-regexp-in-string</span>
         <span class="string">"</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(?:</span></span><span class="string">^</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">|</span></span><span class="string">.*/</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">[0-9]\\{4\\}</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">[0-9]\\{2\\}</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">[0-9]\\{2\\}</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">[0-9]*-"</span>
         <span class="string">"&#240;&#159;&#162;&#148;(\\1-\\2-\\3) "</span>
         <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">subst-char-in-string</span> ?_ ?  <span class="variable-name">buffer-file-name</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">funcall</span> orig-fun<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">org-reference-contraction-max-words</span> <span class="highlight-numbers-number">3</span>
    <span class="doc">"Maximum number of words in a reference reference."</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">org-reference-contraction-max-length</span> <span class="highlight-numbers-number">35</span>
    <span class="doc">"Maximum length of resulting reference reference, including joining characters."</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">org-reference-contraction-stripped-words</span>
    <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"the"</span> <span class="string">"on"</span> <span class="string">"in"</span> <span class="string">"off"</span> <span class="string">"a"</span> <span class="string">"for"</span> <span class="string">"by"</span> <span class="string">"of"</span> <span class="string">"and"</span> <span class="string">"is"</span> <span class="string">"to"</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Superfluous words to be removed from a reference."</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">org-reference-contraction-joining-char</span> <span class="string">"-"</span>
    <span class="doc">"Character used to join words in the reference reference."</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">org-reference-contraction-truncate-words</span> <span class="rainbow-delimiters-depth-3">(</span>words<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Using `</span><span class="doc"><span class="constant">org-reference-contraction-max-length</span></span><span class="doc">' as the total character 'budget' for the WORDS
  and truncate individual words to conform to this budget.
  
  To arrive at a budget that accounts for words undershooting their requisite average length,
  the number of charachters in the budget freed by short words is distributed among the words
  exceeding the average length.  This adjusts the per-word budget to be the maximum feasable for
  this particular situation, rather than the universal maximum average.
  
  This budget-adjusted per-word maximum length is given by the mathematical expression below:
  
  max length = \\floor{ \\frac{total length - chars for seperators - \\sum_{word \\leq average length} length(word) }{num(words) &gt; average length} }"</span>
    <span class="comment-delimiter">;; </span><span class="comment">trucate each word to a max word length determined by
</span>    <span class="comment-delimiter">;;</span><span class="comment">
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>total-length-budget <span class="rainbow-delimiters-depth-3">(</span><span class="constant">-</span> org-reference-contraction-max-length  <span class="comment-delimiter">; </span><span class="comment">how many non-separator chars we can use
</span>                                   <span class="rainbow-delimiters-depth-1">(</span><span class="constant">1-</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">length</span> words<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>word-length-budget <span class="rainbow-delimiters-depth-3">(</span><span class="constant">/</span> total-length-budget                      <span class="comment-delimiter">; </span><span class="comment">max length of each word to keep within budget
</span>                                  org-reference-contraction-max-words<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>num-overlong <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">-count</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-2">(</span>word<span class="rainbow-delimiters-depth-2">)</span>                            <span class="comment-delimiter">; </span><span class="comment">how many words exceed that budget
</span>                                   <span class="rainbow-delimiters-depth-2">(</span><span class="constant">&gt;</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">length</span> word<span class="rainbow-delimiters-depth-3">)</span> word-length-budget<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                                 words<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>total-short-length <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">-sum</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">mapcar</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-3">(</span>word<span class="rainbow-delimiters-depth-3">)</span>                <span class="comment-delimiter">; </span><span class="comment">total length of words under that budget
</span>                                               <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">&lt;=</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">length</span> word<span class="rainbow-delimiters-depth-2">)</span> word-length-budget<span class="rainbow-delimiters-depth-1">)</span>
                                                   <span class="rainbow-delimiters-depth-1">(</span><span class="constant">length</span> word<span class="rainbow-delimiters-depth-1">)</span> <span class="highlight-numbers-number">0</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                                             words<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>max-length <span class="rainbow-delimiters-depth-3">(</span><span class="constant">/</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">-</span> total-length-budget total-short-length<span class="rainbow-delimiters-depth-1">)</span>       <span class="comment-delimiter">; </span><span class="comment">max(max-length) that we can have to fit within the budget
</span>                          num-overlong<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">mapcar</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-3">(</span>word<span class="rainbow-delimiters-depth-3">)</span>
                <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">&lt;=</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">length</span> word<span class="rainbow-delimiters-depth-2">)</span> max-length<span class="rainbow-delimiters-depth-1">)</span>
                    word
                  <span class="rainbow-delimiters-depth-1">(</span><span class="constant">substring</span> word <span class="highlight-numbers-number">0</span> max-length<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
              words<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">org-reference-contraction</span> <span class="rainbow-delimiters-depth-3">(</span>reference-string<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Give a contracted form of REFERENCE-STRING that is only contains alphanumeric characters.
  Strips 'joining' words present in `</span><span class="doc"><span class="constant">org-reference-contraction-stripped-words</span></span><span class="doc">',
  and then limits the result to the first `</span><span class="doc"><span class="constant">org-reference-contraction-max-words</span></span><span class="doc">' words.
  If the total length is &gt; `</span><span class="doc"><span class="constant">org-reference-contraction-max-length</span></span><span class="doc">' then individual words are
  truncated to fit within the limit using `</span><span class="doc"><span class="constant">org-reference-contraction-truncate-words</span></span><span class="doc">'."</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>reference-words
           <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">-filter</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-2">(</span>word<span class="rainbow-delimiters-depth-2">)</span>
                      <span class="rainbow-delimiters-depth-2">(</span><span class="constant">not</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">member</span> word org-reference-contraction-stripped-words<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                    <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">split-string</span>
                     <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">-&gt;&gt;</span> reference-string
                          downcase
                          <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">replace-regexp-in-string</span> <span class="string">"\\[\\[[</span><span class="string"><span class="negation-char">^</span></span><span class="string">]]+\\]\\[</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">[</span><span class="string"><span class="negation-char">^</span></span><span class="string">]]+</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">\\]\\]"</span> <span class="string">"\\1"</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">get description from org-link
</span>                          <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">replace-regexp-in-string</span> <span class="string">"[-/ ]+"</span> <span class="string">" "</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">replace seperator-type chars with space
</span>                          <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">replace-regexp-in-string</span> <span class="string">"[</span><span class="string"><span class="negation-char">^</span></span><span class="string">a-z0-9 ]"</span> <span class="string">""</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">strip chars which need %-encoding in a uri
</span>                          <span class="rainbow-delimiters-depth-2">)</span> <span class="string">" "</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">&gt;</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">length</span> reference-words<span class="rainbow-delimiters-depth-3">)</span>
               org-reference-contraction-max-words<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> reference-words
              <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">cl-subseq</span> reference-words <span class="highlight-numbers-number">0</span> org-reference-contraction-max-words<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
  
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">&gt;</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">apply</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">+</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">1-</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">length</span> reference-words<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">mapcar</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">length</span> reference-words<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
               org-reference-contraction-max-length<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> reference-words <span class="rainbow-delimiters-depth-3">(</span>org-reference-contraction-truncate-words reference-words<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
  
      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">string-join</span> reference-words org-reference-contraction-joining-char<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">define-minor-mode</span> <span class="function-name">unpackaged/org-export-html-with-useful-ids-mode</span>
    <span class="doc">"Attempt to export Org as HTML with useful link IDs.
  Instead of random IDs like \"#orga1b2c3\", use heading titles,
  made unique when necessary."</span>
    <span class="builtin">:global</span> t
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> unpackaged/org-export-html-with-useful-ids-mode
        <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">advice-add</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-export-get-reference</span> <span class="builtin">:override</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">unpackaged/org-export-get-reference</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">advice-remove</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-export-get-reference</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">unpackaged/org-export-get-reference</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span>unpackaged/org-export-html-with-useful-ids-mode <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-2">)</span> <span class="comment-delimiter">; </span><span class="comment">ensure enabled, and advice run
</span>  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">unpackaged/org-export-get-reference</span> <span class="rainbow-delimiters-depth-3">(</span>datum info<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Like `</span><span class="doc"><span class="constant">org-export-get-reference</span></span><span class="doc">', except uses heading titles instead of random numbers."</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>cache <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> info <span class="builtin">:internal-references</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">car</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">rassq</span> datum cache<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>crossrefs <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> info <span class="builtin">:crossrefs</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                 <span class="rainbow-delimiters-depth-1">(</span>cells <span class="rainbow-delimiters-depth-2">(</span>org-export-search-cells datum<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                 <span class="comment-delimiter">;; </span><span class="comment">Preserve any pre-existing association between
</span>                 <span class="comment-delimiter">;; </span><span class="comment">a search cell and a reference, i.e., when some
</span>                 <span class="comment-delimiter">;; </span><span class="comment">previously published document referenced a location
</span>                 <span class="comment-delimiter">;; </span><span class="comment">within current file (see
</span>                 <span class="comment-delimiter">;; </span><span class="comment">`</span><span class="comment"><span class="constant">org-publish-resolve-external-link</span></span><span class="comment">').
</span>                 <span class="comment-delimiter">;;</span><span class="comment">
</span>                 <span class="comment-delimiter">;; </span><span class="comment">However, there is no guarantee that search cells are
</span>                 <span class="comment-delimiter">;; </span><span class="comment">unique, e.g., there might be duplicate custom ID or
</span>                 <span class="comment-delimiter">;; </span><span class="comment">two headings with the same title in the file.
</span>                 <span class="comment-delimiter">;;</span><span class="comment">
</span>                 <span class="comment-delimiter">;; </span><span class="comment">As a consequence, before re-using any reference to
</span>                 <span class="comment-delimiter">;; </span><span class="comment">an element or object, we check that it doesn't refer
</span>                 <span class="comment-delimiter">;; </span><span class="comment">to a previous element or object.
</span>                 <span class="rainbow-delimiters-depth-1">(</span>new <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">cl-some</span>
                           <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-2">(</span>cell<span class="rainbow-delimiters-depth-2">)</span>
                             <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>stored <span class="rainbow-delimiters-depth-2">(</span><span class="constant">cdr</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">assoc</span> cell crossrefs<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                               <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> stored
                                 <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>old <span class="rainbow-delimiters-depth-1">(</span>org-export-format-reference stored<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                                   <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">not</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">assoc</span> old cache<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span> stored<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                           cells<span class="rainbow-delimiters-depth-3">)</span>
                          <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-1">(</span>org-element-property <span class="builtin">:raw-value</span> datum<span class="rainbow-delimiters-depth-1">)</span>
                            <span class="comment-delimiter">;; </span><span class="comment">Heading with a title
</span>                            <span class="rainbow-delimiters-depth-1">(</span>unpackaged/org-export-new-named-reference datum cache<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                          <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">member</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">car</span> datum<span class="rainbow-delimiters-depth-2">)</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span>src-block table example fixed-width property-drawer<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                            <span class="comment-delimiter">;; </span><span class="comment">Nameable elements
</span>                            <span class="rainbow-delimiters-depth-1">(</span>unpackaged/org-export-new-named-reference datum cache<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                          <span class="comment-delimiter">;; </span><span class="bold"><span class="success">NOTE:</span></span><span class="comment"> This probably breaks some Org Export
</span>                          <span class="comment-delimiter">;; </span><span class="comment">feature, but if it does what I need, fine.
</span>                          <span class="rainbow-delimiters-depth-3">(</span>org-export-format-reference
                           <span class="rainbow-delimiters-depth-1">(</span>org-export-new-reference cache<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                 <span class="rainbow-delimiters-depth-1">(</span>reference-string new<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
            <span class="comment-delimiter">;; </span><span class="comment">Cache contains both data already associated to
</span>            <span class="comment-delimiter">;; </span><span class="comment">a reference and in-use internal references, so as to make
</span>            <span class="comment-delimiter">;; </span><span class="comment">unique references.
</span>            <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">dolist</span> <span class="rainbow-delimiters-depth-1">(</span>cell cells<span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">push</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">cons</span> cell new<span class="rainbow-delimiters-depth-2">)</span> cache<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
            <span class="comment-delimiter">;; </span><span class="comment">Retain a direct association between reference string and
</span>            <span class="comment-delimiter">;; </span><span class="comment">DATUM since (1) not every object or element can be given
</span>            <span class="comment-delimiter">;; </span><span class="comment">a search cell (2) it permits quick lookup.
</span>            <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">push</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">cons</span> reference-string datum<span class="rainbow-delimiters-depth-1">)</span> cache<span class="rainbow-delimiters-depth-3">)</span>
            <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-put</span> info <span class="builtin">:internal-references</span> cache<span class="rainbow-delimiters-depth-3">)</span>
            reference-string<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">unpackaged/org-export-new-named-reference</span> <span class="rainbow-delimiters-depth-3">(</span>datum cache<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Return new reference for DATUM that is unique in CACHE."</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">cl-macrolet</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>inc-suffixf <span class="rainbow-delimiters-depth-3">(</span>place<span class="rainbow-delimiters-depth-3">)</span>
                               <span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-3">(</span><span class="keyword">progn</span>
                                  <span class="rainbow-delimiters-depth-1">(</span><span class="constant">string-match</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">rx</span> bos
                                                    <span class="rainbow-delimiters-depth-3">(</span>minimal-match <span class="rainbow-delimiters-depth-1">(</span>group <span class="rainbow-delimiters-depth-2">(</span><span class="constant">1+</span> anything<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                                                    <span class="rainbow-delimiters-depth-3">(</span>optional <span class="string">"--"</span> <span class="rainbow-delimiters-depth-1">(</span>group <span class="rainbow-delimiters-depth-2">(</span><span class="constant">1+</span> digit<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                                                    eos<span class="rainbow-delimiters-depth-2">)</span>
                                                ,place<span class="rainbow-delimiters-depth-1">)</span>
                                  <span class="comment-delimiter">;; </span><span class="bold"><span class="constant">HACK:</span></span><span class="comment"> `</span><span class="comment"><span class="constant">s1</span></span><span class="comment">' instead of a gensym.
</span>                                  <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">-let*</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>s1 suffix<span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">list</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">match-string</span> <span class="highlight-numbers-number">1</span> ,place<span class="rainbow-delimiters-depth-2">)</span>
                                                             <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">match-string</span> <span class="highlight-numbers-number">2</span> ,place<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                                          <span class="rainbow-delimiters-depth-3">(</span>suffix <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> suffix
                                                      <span class="rainbow-delimiters-depth-2">(</span><span class="constant">string-to-number</span> suffix<span class="rainbow-delimiters-depth-2">)</span>
                                                    <span class="highlight-numbers-number">0</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                                    <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setf</span> ,place <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"%s--%s"</span> s1 <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">cl-incf</span> suffix<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>headline-p <span class="rainbow-delimiters-depth-1">(</span><span class="constant">eq</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">car</span> datum<span class="rainbow-delimiters-depth-2">)</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">headline</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>title <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> headline-p
                        <span class="rainbow-delimiters-depth-2">(</span>org-element-property <span class="builtin">:raw-value</span> datum<span class="rainbow-delimiters-depth-2">)</span>
                      <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-3">(</span>org-element-property <span class="builtin">:name</span> datum<span class="rainbow-delimiters-depth-3">)</span>
                          <span class="rainbow-delimiters-depth-3">(</span><span class="constant">concat</span> <span class="rainbow-delimiters-depth-1">(</span>org-element-property <span class="builtin">:raw-value</span>
                                                        <span class="rainbow-delimiters-depth-2">(</span>org-element-property <span class="builtin">:parent</span>
                                                                              <span class="rainbow-delimiters-depth-3">(</span>org-element-property <span class="builtin">:parent</span> datum<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="comment-delimiter">;; </span><span class="comment">get ascii-only form of title without needing percent-encoding
</span>             <span class="rainbow-delimiters-depth-3">(</span>ref <span class="rainbow-delimiters-depth-1">(</span><span class="constant">concat</span> <span class="rainbow-delimiters-depth-2">(</span>org-reference-contraction <span class="rainbow-delimiters-depth-3">(</span><span class="constant">substring-no-properties</span> title<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                          <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">unless</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">or</span> headline-p <span class="rainbow-delimiters-depth-1">(</span>org-element-property <span class="builtin">:name</span> datum<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                            <span class="rainbow-delimiters-depth-3">(</span><span class="constant">concat</span> <span class="string">","</span>
                                    <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">pcase</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">car</span> datum<span class="rainbow-delimiters-depth-2">)</span>
                                      <span class="rainbow-delimiters-depth-2">(</span><span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">src-block</span> <span class="string">"code"</span><span class="rainbow-delimiters-depth-2">)</span>
                                      <span class="rainbow-delimiters-depth-2">(</span><span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">example</span> <span class="string">"example"</span><span class="rainbow-delimiters-depth-2">)</span>
                                      <span class="rainbow-delimiters-depth-2">(</span><span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">fixed-width</span> <span class="string">"mono"</span><span class="rainbow-delimiters-depth-2">)</span>
                                      <span class="rainbow-delimiters-depth-2">(</span><span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">property-drawer</span> <span class="string">"properties"</span><span class="rainbow-delimiters-depth-2">)</span>
                                      <span class="rainbow-delimiters-depth-2">(</span>_ <span class="rainbow-delimiters-depth-3">(</span><span class="constant">symbol-name</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">car</span> datum<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                                    <span class="string">"--1"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>parent <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> headline-p <span class="rainbow-delimiters-depth-2">(</span>org-element-property <span class="builtin">:parent</span> datum<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">while</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">--any</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">equal</span> ref <span class="rainbow-delimiters-depth-2">(</span><span class="constant">car</span> it<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                      cache<span class="rainbow-delimiters-depth-3">)</span>
          <span class="comment-delimiter">;; </span><span class="comment">Title not unique: make it so.
</span>          <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> parent
              <span class="comment-delimiter">;; </span><span class="comment">Append ancestor title.
</span>              <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setf</span> title <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span> <span class="rainbow-delimiters-depth-3">(</span>org-element-property <span class="builtin">:raw-value</span> parent<span class="rainbow-delimiters-depth-3">)</span>
                                  <span class="string">"--"</span> title<span class="rainbow-delimiters-depth-2">)</span>
                    <span class="comment-delimiter">;; </span><span class="comment">get ascii-only form of title without needing percent-encoding
</span>                    ref <span class="rainbow-delimiters-depth-2">(</span>org-reference-contraction <span class="rainbow-delimiters-depth-3">(</span><span class="constant">substring-no-properties</span> title<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                    parent <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">when</span> headline-p <span class="rainbow-delimiters-depth-3">(</span>org-element-property <span class="builtin">:parent</span> parent<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
            <span class="comment-delimiter">;; </span><span class="comment">No more ancestors: add and increment a number.
</span>            <span class="rainbow-delimiters-depth-1">(</span>inc-suffixf ref<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        ref<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-load-hook</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">unpackaged/org-export-html-with-useful-ids-mode</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">unpackaged/org-element-descendant-of</span> <span class="rainbow-delimiters-depth-3">(</span>type element<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Return non-nil if ELEMENT is a descendant of TYPE.
  TYPE should be an element type, like `</span><span class="doc"><span class="constant">item</span></span><span class="doc">' or `</span><span class="doc"><span class="constant">paragraph</span></span><span class="doc">'.
  ELEMENT should be a list like that returned by `</span><span class="doc"><span class="constant">org-element-context</span></span><span class="doc">'."</span>
    <span class="comment-delimiter">;; </span><span class="comment">MAYBE: Use `</span><span class="comment"><span class="constant">org-element-lineage</span></span><span class="comment">'.
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when-let*</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>parent <span class="rainbow-delimiters-depth-3">(</span>org-element-property <span class="builtin">:parent</span> element<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">eq</span> type <span class="rainbow-delimiters-depth-3">(</span><span class="constant">car</span> parent<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span>unpackaged/org-element-descendant-of type parent<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="comment-delimiter">;;;</span><span class="comment">###autoload
</span>  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">unpackaged/org-return-dwim</span> <span class="rainbow-delimiters-depth-3">(</span><span class="type">&amp;optional</span> default<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"A helpful replacement for `</span><span class="doc"><span class="constant">org-return-indent</span></span><span class="doc">'.  With prefix, call `</span><span class="doc"><span class="constant">org-return-indent</span></span><span class="doc">'.
  
  On headings, move point to position after entry content.  In
  lists, insert a new item or end the list, with checkbox if
  appropriate.  In tables, insert a new row or end the table."</span>
    <span class="comment-delimiter">;; </span><span class="comment">Inspired by John Kitchin: http://kitchingroup.cheme.cmu.edu/blog/2017/04/09/A-better-return-in-org-mode/
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">interactive</span> <span class="string">"P"</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> default
        <span class="rainbow-delimiters-depth-1">(</span>org-return t<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">cond</span>
       <span class="comment-delimiter">;; </span><span class="comment">Act depending on context around point.
</span>  
       <span class="comment-delimiter">;; </span><span class="bold"><span class="success">NOTE:</span></span><span class="comment"> I prefer RET to not follow links, but by uncommenting this block, links will be
</span>       <span class="comment-delimiter">;; </span><span class="comment">followed.
</span>  
       <span class="comment-delimiter">;; </span><span class="comment">((eq 'link (car (org-element-context)))
</span>       <span class="comment-delimiter">;;  </span><span class="comment">;; Link: Open it.
</span>       <span class="comment-delimiter">;;  </span><span class="comment">(org-open-at-point-global))
</span>  
       <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>org-at-heading-p<span class="rainbow-delimiters-depth-3">)</span>
        <span class="comment-delimiter">;; </span><span class="comment">Heading: Move to position after entry content.
</span>        <span class="comment-delimiter">;; </span><span class="bold"><span class="success">NOTE:</span></span><span class="comment"> This is probably the most interesting feature of this function.
</span>        <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>heading-start <span class="rainbow-delimiters-depth-3">(</span>org-entry-beginning-position<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="constant">goto-char</span> <span class="rainbow-delimiters-depth-2">(</span>org-entry-end-position<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">cond</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-1">(</span>org-at-heading-p<span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">=</span> heading-start <span class="rainbow-delimiters-depth-2">(</span>org-entry-beginning-position<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                 <span class="comment-delimiter">;; </span><span class="comment">Entry ends on its heading; add newline after
</span>                 <span class="rainbow-delimiters-depth-3">(</span><span class="constant">end-of-line</span><span class="rainbow-delimiters-depth-3">)</span>
                 <span class="rainbow-delimiters-depth-3">(</span><span class="constant">insert</span> <span class="string">"\n\n"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                <span class="rainbow-delimiters-depth-2">(</span>t
                 <span class="comment-delimiter">;; </span><span class="comment">Entry ends after its heading; back up
</span>                 <span class="rainbow-delimiters-depth-3">(</span><span class="constant">forward-line</span> <span class="highlight-numbers-number">-1</span><span class="rainbow-delimiters-depth-3">)</span>
                 <span class="rainbow-delimiters-depth-3">(</span><span class="constant">end-of-line</span><span class="rainbow-delimiters-depth-3">)</span>
                 <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-1">(</span>org-at-heading-p<span class="rainbow-delimiters-depth-1">)</span>
                   <span class="comment-delimiter">;; </span><span class="comment">At the same heading
</span>                   <span class="rainbow-delimiters-depth-1">(</span><span class="constant">forward-line</span><span class="rainbow-delimiters-depth-1">)</span>
                   <span class="rainbow-delimiters-depth-1">(</span><span class="constant">insert</span> <span class="string">"\n"</span><span class="rainbow-delimiters-depth-1">)</span>
                   <span class="rainbow-delimiters-depth-1">(</span><span class="constant">forward-line</span> <span class="highlight-numbers-number">-1</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                 <span class="comment-delimiter">;; </span><span class="bold"><span class="error">FIXME:</span></span><span class="comment"> looking-back is supposed to be called with more arguments.
</span>                 <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">while</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">not</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">looking-back</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">rx</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">repeat</span> <span class="highlight-numbers-number">3</span> <span class="rainbow-delimiters-depth-2">(</span>seq <span class="rainbow-delimiters-depth-3">(</span>optional blank<span class="rainbow-delimiters-depth-3">)</span> <span class="string">"\n"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                   <span class="rainbow-delimiters-depth-1">(</span><span class="constant">insert</span> <span class="string">"\n"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                 <span class="rainbow-delimiters-depth-3">(</span><span class="constant">forward-line</span> <span class="highlight-numbers-number">-1</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
       <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>org-at-item-checkbox-p<span class="rainbow-delimiters-depth-3">)</span>
        <span class="comment-delimiter">;; </span><span class="comment">Checkbox: Insert new item with checkbox.
</span>        <span class="rainbow-delimiters-depth-3">(</span>org-insert-todo-heading nil<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
       <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>org-in-item-p<span class="rainbow-delimiters-depth-3">)</span>
        <span class="comment-delimiter">;; </span><span class="comment">Plain list.  Yes, this gets a little complicated...
</span>        <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>context <span class="rainbow-delimiters-depth-3">(</span>org-element-context<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">eq</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">plain-list</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">car</span> context<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>  <span class="comment-delimiter">; </span><span class="comment">First item in list
</span>                  <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">eq</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">item</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">car</span> context<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                       <span class="rainbow-delimiters-depth-1">(</span><span class="constant">not</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">eq</span> <span class="rainbow-delimiters-depth-3">(</span>org-element-property <span class="builtin">:contents-begin</span> context<span class="rainbow-delimiters-depth-3">)</span>
                                <span class="rainbow-delimiters-depth-3">(</span>org-element-property <span class="builtin">:contents-end</span> context<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                  <span class="rainbow-delimiters-depth-3">(</span>unpackaged/org-element-descendant-of <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">item</span> context<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>  <span class="comment-delimiter">; </span><span class="comment">Element in list item, e.g. a link
</span>              <span class="comment-delimiter">;; </span><span class="comment">Non-empty item: Add new item.
</span>              <span class="rainbow-delimiters-depth-2">(</span>org-insert-item<span class="rainbow-delimiters-depth-2">)</span>
            <span class="comment-delimiter">;; </span><span class="comment">Empty item: Close the list.
</span>            <span class="comment-delimiter">;; </span><span class="bold"><span class="warning">TODO:</span></span><span class="comment"> Do this with org functions rather than operating on the text. Can't seem to find the right function.
</span>            <span class="rainbow-delimiters-depth-2">(</span><span class="constant">delete-region</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">line-beginning-position</span><span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">line-end-position</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
            <span class="rainbow-delimiters-depth-2">(</span><span class="constant">insert</span> <span class="string">"\n"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
       <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">fboundp</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-inlinetask-in-task-p</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span>org-inlinetask-in-task-p<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="comment-delimiter">;; </span><span class="comment">Inline task: Don't insert a new heading.
</span>        <span class="rainbow-delimiters-depth-3">(</span>org-return t<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
       <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>org-at-table-p<span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">cond</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span><span class="keyword">save-excursion</span>
                 <span class="rainbow-delimiters-depth-3">(</span><span class="constant">beginning-of-line</span><span class="rainbow-delimiters-depth-3">)</span>
                 <span class="comment-delimiter">;; </span><span class="comment">See `</span><span class="comment"><span class="constant">org-table-next-field</span></span><span class="comment">'.
</span>                 <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">cl-loop</span> with end = <span class="rainbow-delimiters-depth-1">(</span><span class="constant">line-end-position</span><span class="rainbow-delimiters-depth-1">)</span>
                          for cell = <span class="rainbow-delimiters-depth-1">(</span>org-element-table-cell-parser<span class="rainbow-delimiters-depth-1">)</span>
                          always <span class="rainbow-delimiters-depth-1">(</span><span class="constant">equal</span> <span class="rainbow-delimiters-depth-2">(</span>org-element-property <span class="builtin">:contents-begin</span> cell<span class="rainbow-delimiters-depth-2">)</span>
                                        <span class="rainbow-delimiters-depth-2">(</span>org-element-property <span class="builtin">:contents-end</span> cell<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                          while <span class="rainbow-delimiters-depth-1">(</span><span class="constant">re-search-forward</span> <span class="string">"|"</span> end t<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
               <span class="comment-delimiter">;; </span><span class="comment">Empty row: end the table.
</span>               <span class="rainbow-delimiters-depth-2">(</span><span class="constant">delete-region</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">line-beginning-position</span><span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">line-end-position</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
               <span class="rainbow-delimiters-depth-2">(</span>org-return t<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
              <span class="rainbow-delimiters-depth-1">(</span>t
               <span class="comment-delimiter">;; </span><span class="comment">Non-empty row: call `</span><span class="comment"><span class="constant">org-return-indent</span></span><span class="comment">'.
</span>               <span class="rainbow-delimiters-depth-2">(</span>org-return t<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
       <span class="rainbow-delimiters-depth-2">(</span>t
        <span class="comment-delimiter">;; </span><span class="comment">All other cases: call `</span><span class="comment"><span class="constant">org-return-indent</span></span><span class="comment">'.
</span>        <span class="rainbow-delimiters-depth-3">(</span>org-return t<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">map!</span>
   <span class="builtin">:after</span> evil-org
   <span class="builtin">:map</span> evil-org-mode-map
   <span class="builtin">:i</span> <span class="rainbow-delimiters-depth-3">[</span>return<span class="rainbow-delimiters-depth-3">]</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">unpackaged/org-return-dwim</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+yas/org-src-lang</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="doc">"Try to find the current language of the src/header at point.
  Return nil otherwise."</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">save-excursion</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">pcase</span>
          <span class="rainbow-delimiters-depth-2">(</span><span class="constant">downcase</span>
           <span class="rainbow-delimiters-depth-3">(</span><span class="constant">buffer-substring-no-properties</span>
            <span class="rainbow-delimiters-depth-1">(</span><span class="constant">goto-char</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">line-beginning-position</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
            <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">ignore-errors</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">1-</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">search-forward</span> <span class="string">" "</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">line-end-position</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                <span class="rainbow-delimiters-depth-2">(</span><span class="constant">1+</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">point</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="string">"#+property:"</span>
         <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">re-search-forward</span> <span class="string">"header-args:"</span><span class="rainbow-delimiters-depth-1">)</span>
           <span class="rainbow-delimiters-depth-1">(</span><span class="constant">buffer-substring-no-properties</span>
            <span class="rainbow-delimiters-depth-2">(</span><span class="constant">point</span><span class="rainbow-delimiters-depth-2">)</span>
            <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">forward-symbol</span> <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">point</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                <span class="rainbow-delimiters-depth-3">(</span><span class="constant">1+</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">point</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="string">"#+begin_src"</span>
         <span class="rainbow-delimiters-depth-3">(</span><span class="constant">buffer-substring-no-properties</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="constant">point</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">forward-symbol</span> <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">point</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="constant">1+</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">point</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="string">"#+header:"</span>
         <span class="rainbow-delimiters-depth-3">(</span><span class="constant">search-forward</span> <span class="string">"#+begin_src"</span><span class="rainbow-delimiters-depth-3">)</span>
         <span class="rainbow-delimiters-depth-3">(</span>+yas/org-src-lang<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span>_ nil<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+yas/org-src-header-p</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">or</span>
     <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">looking-back</span> <span class="string">"^#\\+property:[ \t]+header-args:.*"</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">line-beginning-position</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
     <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">looking-back</span> <span class="string">"^#\\+header:.*"</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">line-beginning-position</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+yas/org-last-src-lang</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">save-excursion</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">beginning-of-line</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">search-backward</span> <span class="string">"#+begin_src"</span> nil t<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span>+yas/org-src-lang<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+yas/org-most-common-no-property-lang</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="doc">"Find the lang with the most source blocks that has no global header-args, else nil."</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span>src-langs header-langs<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">save-excursion</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">goto-char</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">point-min</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">while</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">search-forward</span> <span class="string">"#+begin_src"</span> nil t<span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">push</span> <span class="rainbow-delimiters-depth-1">(</span>+yas/org-src-lang<span class="rainbow-delimiters-depth-1">)</span> src-langs<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">goto-char</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">point-min</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">while</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">re-search-forward</span> <span class="string">"#\\+property: +header-args"</span> nil t<span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">push</span> <span class="rainbow-delimiters-depth-1">(</span>+yas/org-src-lang<span class="rainbow-delimiters-depth-1">)</span> header-langs<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
  
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> src-langs
            <span class="rainbow-delimiters-depth-2">(</span><span class="constant">mapcar</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">car</span>
                    <span class="comment-delimiter">;; </span><span class="comment">sort alist by frequency (desc.)
</span>                    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">sort</span>
                     <span class="comment-delimiter">;; </span><span class="comment">generate alist with form (value . frequency)
</span>                     <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">cl-loop</span> for <span class="rainbow-delimiters-depth-2">(</span>n . m<span class="rainbow-delimiters-depth-2">)</span> in <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">seq-group-by</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">identity</span> src-langs<span class="rainbow-delimiters-depth-2">)</span>
                              collect <span class="rainbow-delimiters-depth-2">(</span><span class="constant">cons</span> n <span class="rainbow-delimiters-depth-3">(</span><span class="constant">length</span> m<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                     <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-2">(</span>a b<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">&gt;</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">cdr</span> a<span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">cdr</span> b<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
  
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">car</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">cl-set-difference</span> src-langs header-langs <span class="builtin">:test</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">string=</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">org-syntax-convert-case-to-lower</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="doc">"Convert all #+KEYWORDS to #+keywords."</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">interactive</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">save-excursion</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">goto-char</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">point-min</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="function-name">count</span> <span class="highlight-numbers-number">0</span><span class="rainbow-delimiters-depth-3">)</span>
            <span class="rainbow-delimiters-depth-3">(</span><span class="variable-name">case-fold-search</span> nil<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">while</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">re-search-forward</span> <span class="string">"#\\+[A-Z_]+"</span> nil t<span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="constant">replace-match</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">downcase</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">match-string</span> <span class="highlight-numbers-number">0</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span> t<span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> count <span class="rainbow-delimiters-depth-1">(</span><span class="constant">1+</span> count<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">message</span> <span class="string">"Replaced %d occurances"</span> count<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span>org-link-set-parameters <span class="string">"xkcd"</span>
                           <span class="builtin">:image-data-fun</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">+org-xkcd-image-fn</span>
                           <span class="builtin">:follow</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">+org-xkcd-open-fn</span>
                           <span class="builtin">:export</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">+org-xkcd-export</span>
                           <span class="builtin">:complete</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">+org-xkcd-complete</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+org-xkcd-open-fn</span> <span class="rainbow-delimiters-depth-3">(</span>link<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span>+org-xkcd-image-fn nil link nil<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+org-xkcd-image-fn</span> <span class="rainbow-delimiters-depth-3">(</span>protocol link description<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Get image data for xkcd num LINK"</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>xkcd-info <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">+xkcd-fetch-info</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">string-to-number</span> link<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>img <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> xkcd-info <span class="builtin">:img</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>alt <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> xkcd-info <span class="builtin">:alt</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">message</span> alt<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">+org-image-file-data-fn</span> protocol <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">xkcd-download</span> img <span class="rainbow-delimiters-depth-3">(</span><span class="constant">string-to-number</span> link<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span> description<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+org-xkcd-export</span> <span class="rainbow-delimiters-depth-3">(</span>num desc backend _com<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Convert xkcd to html/LaTeX form"</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>xkcd-info <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">+xkcd-fetch-info</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">string-to-number</span> num<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>img <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> xkcd-info <span class="builtin">:img</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>alt <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> xkcd-info <span class="builtin">:alt</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>title <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> xkcd-info <span class="builtin">:title</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>file <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">xkcd-download</span> img <span class="rainbow-delimiters-depth-1">(</span><span class="constant">string-to-number</span> num<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">cond</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>org-export-derived-backend-p backend <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">html</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"&lt;img class='invertible' src='%s' title=\"%s\" alt='%s'&gt;"</span> img <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">subst-char-in-string</span> ?\" ?&#226;&#128;&#156; alt<span class="rainbow-delimiters-depth-1">)</span> title<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
            <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>org-export-derived-backend-p backend <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">latex</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"\\begin{figure}[!htb]
    \\centering
    \\includegraphics[scale=0.4]{%s}%s
  \\end{figure}"</span> file <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">equal</span> desc <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"xkcd:%s"</span> num<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span> <span class="string">""</span>
                        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">format</span> <span class="string">"\n  \\caption*{\\label{xkcd:%s} %s}"</span>
                                num
                                <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">or</span> desc
                                    <span class="rainbow-delimiters-depth-1">(</span><span class="constant">format</span> <span class="string">"\\textbf{%s} %s"</span> title alt<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
            <span class="rainbow-delimiters-depth-2">(</span>t <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"https://xkcd.com/%s"</span> num<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+org-xkcd-complete</span> <span class="rainbow-delimiters-depth-3">(</span><span class="type">&amp;optional</span> arg<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Complete xkcd using `</span><span class="doc"><span class="constant">+xkcd-stored-info</span></span><span class="doc">'"</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"xkcd:%d"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">+xkcd-select</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">after!</span> org
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defvar</span> <span class="variable-name">org-music-player</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">mpris</span>
      <span class="doc">"Music player type. Curretly only supports mpris."</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defvar</span> <span class="variable-name">org-music-mpris-player</span> <span class="string">"Lollypop"</span>
      <span class="doc">"Name of the mpris player, used in the form org.gnome.MPRIS."</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defvar</span> <span class="variable-name">org-music-track-search-method</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">beets</span>
      <span class="doc">"Method to find the track file from the link."</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defvar</span> <span class="variable-name">org-music-beets-db</span> <span class="string">"~/Music/library.db"</span>
      <span class="doc">"Location of the beets DB, for when using beets as the `</span><span class="doc"><span class="constant">org-music-track-search-method</span></span><span class="doc">'"</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defvar</span> <span class="variable-name">org-music-folder</span> <span class="string">"~/Music/"</span>
      <span class="doc">"Location of your music folder, for when using file as the `</span><span class="doc"><span class="constant">org-music-track-search-method</span></span><span class="doc">'"</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defvar</span> <span class="variable-name">org-music-recognised-extensions</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-1">(</span><span class="string">"flac"</span> <span class="string">"mp4"</span> <span class="string">"m4a"</span> <span class="string">"aiff"</span> <span class="string">"wav"</span> <span class="string">"ogg"</span> <span class="string">"aiff"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"When searching for files in `</span><span class="doc"><span class="constant">org-music-track-search-method</span></span><span class="doc">', recognise these extensions as audio files."</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-music-get-link</span> <span class="rainbow-delimiters-depth-1">(</span>full <span class="type">&amp;optional</span> include-time<span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"Generate link string for currently playing track, optionally including a time-stamp"</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">pcase</span> org-music-player <span class="comment-delimiter">;; </span><span class="bold"><span class="success">NOTE</span></span><span class="comment"> this could do with better generalisation
</span>        <span class="rainbow-delimiters-depth-2">(</span><span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">mpris</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>track-metadata
                        <span class="rainbow-delimiters-depth-3">(</span>org-music-mpris-get-property <span class="string">"Metadata"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                       <span class="rainbow-delimiters-depth-2">(</span>album-artist <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">caar</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">cadr</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">assoc</span> <span class="string">"xesam:albumArtist"</span> track-metadata<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                       <span class="rainbow-delimiters-depth-2">(</span>artist <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">equal</span> album-artist <span class="string">""</span><span class="rainbow-delimiters-depth-2">)</span>
                                       <span class="rainbow-delimiters-depth-2">(</span>s-contains-p <span class="string">"various"</span> album-artist t<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                                   <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">caar</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">cadr</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">assoc</span> <span class="string">"xesam:artist"</span> track-metadata<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                                 album-artist<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                       <span class="rainbow-delimiters-depth-2">(</span>track <span class="rainbow-delimiters-depth-3">(</span><span class="constant">car</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">cadr</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">assoc</span> <span class="string">"xesam:title"</span> track-metadata<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                       <span class="rainbow-delimiters-depth-2">(</span>start-time <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> include-time
                                     <span class="rainbow-delimiters-depth-1">(</span><span class="constant">/</span> <span class="rainbow-delimiters-depth-2">(</span>org-music-mpris-get-property <span class="string">"Position"</span><span class="rainbow-delimiters-depth-2">)</span> <span class="highlight-numbers-number">1000000</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                  <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> full
                      <span class="rainbow-delimiters-depth-2">(</span><span class="constant">format</span> <span class="string">"[[music:%s][%s by %s]]"</span> <span class="rainbow-delimiters-depth-3">(</span>org-music-format-link artist track start-time<span class="rainbow-delimiters-depth-3">)</span> track artist<span class="rainbow-delimiters-depth-2">)</span>
                    <span class="rainbow-delimiters-depth-2">(</span>org-music-format-link artist track start-time<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span>_ <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">user-error!</span> <span class="string">"The specified music player: %s is not supported"</span> org-music-player<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-music-format-link</span> <span class="rainbow-delimiters-depth-1">(</span>artist track <span class="type">&amp;optional</span> start-time end-time<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>artist <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">replace-regexp-in-string</span> <span class="string">":"</span> <span class="string">"\\:"</span> artist<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
            <span class="rainbow-delimiters-depth-3">(</span>track <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">replace-regexp-in-string</span> <span class="string">":"</span> <span class="string">"\\:"</span> track<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span> artist <span class="string">":"</span> track
                <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">cond</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span><span class="keyword">and</span> start-time end-time<span class="rainbow-delimiters-depth-2">)</span>
                       <span class="rainbow-delimiters-depth-2">(</span><span class="constant">format</span> <span class="string">"::%s-%s"</span>
                               <span class="rainbow-delimiters-depth-3">(</span>org-music-seconds-to-time start-time<span class="rainbow-delimiters-depth-3">)</span>
                               <span class="rainbow-delimiters-depth-3">(</span>org-music-seconds-to-time end-time<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span>start-time
                       <span class="rainbow-delimiters-depth-2">(</span><span class="constant">format</span> <span class="string">"::%s"</span>
                               <span class="rainbow-delimiters-depth-3">(</span>org-music-seconds-to-time start-time<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-music-parse-link</span> <span class="rainbow-delimiters-depth-1">(</span>link<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>link-dc <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">-&gt;&gt;</span> link
                           <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">replace-regexp-in-string</span> <span class="string">"</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">[</span><span class="string"><span class="negation-char">^</span></span><span class="string">\\\\]</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">\\\\:"</span> <span class="string">"\\1#COLON#"</span><span class="rainbow-delimiters-depth-2">)</span>
                           <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">replace-regexp-in-string</span> <span class="string">"</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">::[a-z0-9]*[0-9]</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">\\'"</span> <span class="string">"\\1s"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>link-components <span class="rainbow-delimiters-depth-1">(</span><span class="constant">mapcar</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-3">(</span>lc<span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">replace-regexp-in-string</span> <span class="string">"#COLON#"</span> <span class="string">":"</span> lc<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                                      <span class="rainbow-delimiters-depth-2">(</span>s-split <span class="string">":"</span> link-dc<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>artist <span class="rainbow-delimiters-depth-1">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">0</span> link-components<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>track <span class="rainbow-delimiters-depth-1">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">1</span> link-components<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>durations <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">&gt;</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">length</span> link-components<span class="rainbow-delimiters-depth-1">)</span> <span class="highlight-numbers-number">3</span><span class="rainbow-delimiters-depth-3">)</span>
                                   <span class="rainbow-delimiters-depth-3">(</span><span class="constant">equal</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">2</span> link-components<span class="rainbow-delimiters-depth-1">)</span> <span class="string">""</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                          <span class="rainbow-delimiters-depth-2">(</span>s-split <span class="string">"-"</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">3</span> link-components<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>start-time <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> durations
                           <span class="rainbow-delimiters-depth-2">(</span>org-music-time-to-seconds <span class="rainbow-delimiters-depth-3">(</span><span class="constant">car</span> durations<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>end-time <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">cdr</span> durations<span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span>org-music-time-to-seconds <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">cadr</span> durations<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">list</span> artist track start-time end-time<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-music-seconds-to-time</span> <span class="rainbow-delimiters-depth-1">(</span>seconds<span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"Convert a number of seconds to a nice human duration, e.g. 5m21s.
  This action is reversed by `</span><span class="doc"><span class="constant">org-music-time-to-seconds</span></span><span class="doc">'."</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">&lt;</span> seconds <span class="highlight-numbers-number">60</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span><span class="constant">format</span> <span class="string">"%ss"</span> seconds<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">&lt;</span> seconds <span class="highlight-numbers-number">3600</span><span class="rainbow-delimiters-depth-3">)</span>
            <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"%sm%ss"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">/</span> seconds <span class="highlight-numbers-number">60</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="variable-name">%</span> seconds <span class="highlight-numbers-number">60</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"%sh%sm%ss"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">/</span> seconds <span class="highlight-numbers-number">3600</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">/</span> <span class="rainbow-delimiters-depth-2">(</span><span class="variable-name">%</span> seconds <span class="highlight-numbers-number">3600</span><span class="rainbow-delimiters-depth-2">)</span> <span class="highlight-numbers-number">60</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="variable-name">%</span> seconds <span class="highlight-numbers-number">60</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-music-time-to-seconds</span> <span class="rainbow-delimiters-depth-1">(</span>time-str<span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"Get the number of seconds in a string produced by `</span><span class="doc"><span class="constant">org-music-seconds-to-time</span></span><span class="doc">'."</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>time-components <span class="rainbow-delimiters-depth-1">(</span><span class="constant">reverse</span> <span class="rainbow-delimiters-depth-2">(</span>s-split <span class="string">"[a-z]"</span> time-str<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>seconds <span class="rainbow-delimiters-depth-1">(</span><span class="constant">string-to-number</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">1</span> time-components<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>minutes <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">&gt;</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">length</span> time-components<span class="rainbow-delimiters-depth-3">)</span> <span class="highlight-numbers-number">2</span><span class="rainbow-delimiters-depth-2">)</span>
                        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">string-to-number</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">2</span> time-components<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>hours <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">&gt;</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">length</span> time-components<span class="rainbow-delimiters-depth-3">)</span> <span class="highlight-numbers-number">3</span><span class="rainbow-delimiters-depth-2">)</span>
                      <span class="rainbow-delimiters-depth-2">(</span><span class="constant">string-to-number</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">3</span> time-components<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">+</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">*</span> <span class="highlight-numbers-number">3600</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> hours <span class="highlight-numbers-number">0</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">*</span> <span class="highlight-numbers-number">60</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> minutes <span class="highlight-numbers-number">0</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span> seconds<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-music-play-track</span> <span class="rainbow-delimiters-depth-1">(</span>artist title <span class="type">&amp;optional</span> start-time end-time<span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"Play the track specified by ARTIST and TITLE, optionally skipping to START-TIME in, stopping at END-TIME."</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if-let</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>file <span class="rainbow-delimiters-depth-1">(</span>org-music-find-track-file artist title<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">pcase</span> org-music-player
            <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">mpris</span> <span class="rainbow-delimiters-depth-1">(</span>org-music-mpris-play file start-time end-time<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
            <span class="rainbow-delimiters-depth-3">(</span>_ <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">user-error!</span> <span class="string">"The specified music player: %s is not supported"</span> org-music-player<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">user-error!</span> <span class="string">"Could not find the track '%s' by '%s'"</span> title artist<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">add-transient-hook!</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-music-play-track</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">require</span> <span class="highlight-quoted-quote">'</span><span class="constant">dbus</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-music-mpris-play</span> <span class="rainbow-delimiters-depth-1">(</span>file <span class="type">&amp;optional</span> start-time end-time<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>uri <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">url-encode-url</span> <span class="rainbow-delimiters-depth-2">(</span>rng-file-name-uri file<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span>org-music-mpris-call-method <span class="string">"OpenUri"</span> uri<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>track-id <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">caadr</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">assoc</span> <span class="string">"mpris:trackid"</span>
                                      <span class="rainbow-delimiters-depth-1">(</span>org-music-mpris-get-property <span class="string">"Metadata"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> start-time
            <span class="rainbow-delimiters-depth-1">(</span>org-music-mpris-call-method <span class="string">"SetPosition"</span> <span class="builtin">:object-path</span> track-id
                                         <span class="builtin">:int64</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">round</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">*</span> start-time <span class="highlight-numbers-number">1000000</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> end-time
            <span class="rainbow-delimiters-depth-1">(</span>org-music-mpris-stop-at-time uri end-time<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">orgb3-music-mpris-stop-at-time</span> <span class="rainbow-delimiters-depth-1">(</span>url end-time<span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"Check that url is playing, and if it is stop it at END-TIME."</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">equal</span> url <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">caadr</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">assoc</span> <span class="string">"xesam:url"</span> <span class="rainbow-delimiters-depth-2">(</span>org-music-mpris-get-property <span class="string">"Metadata"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>time-current <span class="rainbow-delimiters-depth-2">(</span><span class="constant">/</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">/</span> <span class="rainbow-delimiters-depth-1">(</span>org-music-mpris-get-property <span class="string">"Position"</span><span class="rainbow-delimiters-depth-1">)</span> <span class="highlight-numbers-number">10000</span><span class="rainbow-delimiters-depth-3">)</span> <span class="highlight-numbers-number">100.0</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
               <span class="rainbow-delimiters-depth-1">(</span>time-delta <span class="rainbow-delimiters-depth-2">(</span><span class="constant">-</span> end-time time-current<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="constant">message</span> <span class="string">"%s"</span> time-delta<span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">&lt;</span> time-delta <span class="highlight-numbers-number">0</span><span class="rainbow-delimiters-depth-1">)</span>
              <span class="rainbow-delimiters-depth-1">(</span>org-music-mpris-call-method <span class="string">"Pause"</span><span class="rainbow-delimiters-depth-1">)</span>
            <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">&lt;</span> time-delta <span class="highlight-numbers-number">6</span><span class="rainbow-delimiters-depth-2">)</span>
                <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">run-at-time</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">max</span> <span class="highlight-numbers-number">0.001</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">*</span> <span class="highlight-numbers-number">0.9</span> time-delta<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span> nil <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-music-mpris-stop-at-time</span> url end-time<span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">run-at-time</span> <span class="highlight-numbers-number">5</span> nil <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-music-mpris-stop-at-time</span> url end-time<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-music-mpris-get-property</span> <span class="rainbow-delimiters-depth-1">(</span>property<span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"Return the value of org.mpris.MediaPlayer2.Player.PROPERTY."</span>
      <span class="rainbow-delimiters-depth-1">(</span>dbus-get-property <span class="builtin">:session</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span> <span class="string">"org.gnome."</span> org-music-mpris-player<span class="rainbow-delimiters-depth-2">)</span>
                         <span class="string">"/org/mpris/MediaPlayer2"</span> <span class="string">"org.mpris.MediaPlayer2.Player"</span>
                         property<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-music-mpris-call-method</span> <span class="rainbow-delimiters-depth-1">(</span>property <span class="type">&amp;rest</span> args<span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"Call org.mpris.MediaPlayer2.Player.PROPERTY with ARGS, returning the result."</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">apply</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">dbus-call-method</span> <span class="builtin">:session</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span> <span class="string">"org.gnome."</span> org-music-mpris-player<span class="rainbow-delimiters-depth-2">)</span>
             <span class="string">"/org/mpris/MediaPlayer2"</span> <span class="string">"org.mpris.MediaPlayer2.Player"</span>
             property args<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-music-guess-mpris-player</span> <span class="rainbow-delimiters-depth-1">()</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when-let</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>players
                  <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">-filter</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-3">(</span>interface<span class="rainbow-delimiters-depth-3">)</span>
                             <span class="rainbow-delimiters-depth-3">(</span>s-contains-p <span class="string">"org.mpris.MediaPlayer2"</span> interface<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                           <span class="rainbow-delimiters-depth-2">(</span>dbus-call-method <span class="builtin">:session</span>
                                             dbus-service-dbus
                                             dbus-path-dbus
                                             dbus-interface-dbus
                                             <span class="string">"ListNames"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">replace-regexp-in-string</span> <span class="string">"org\\.mpris\\.MediaPlayer2\\."</span> <span class="string">""</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">car</span> players<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">eq</span> org-music-player <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">mpris</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">unless</span> org-music-mpris-player
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> org-music-mpris-player <span class="rainbow-delimiters-depth-3">(</span>org-music-guess-mpris-player<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-music-find-track-file</span> <span class="rainbow-delimiters-depth-1">(</span>artist title<span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"Try to find the file for TRACK by ARTIST, using `</span><span class="doc"><span class="constant">org-music-track-search-method</span></span><span class="doc">', returning nil if nothing could be found."</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">pcase</span> org-music-track-search-method
        <span class="rainbow-delimiters-depth-2">(</span><span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">file</span> <span class="rainbow-delimiters-depth-3">(</span>org-music-find-file artist title<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">beets</span> <span class="rainbow-delimiters-depth-3">(</span>org-music-beets-find-file artist title<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span>_ <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">user-error!</span> <span class="string">"The specified music search method: %s is not supported"</span> org-music-track-search-method<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-music-beets-find-file</span> <span class="rainbow-delimiters-depth-1">(</span>artist title<span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"Find the file correspanding to a given artist and title."</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>artist-escaped <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">replace-regexp-in-string</span> <span class="string">"\""</span> <span class="string">"\\\""</span> artist<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>title-escaped <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">replace-regexp-in-string</span> <span class="string">"\""</span> <span class="string">"\\\""</span> title<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>file
              <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span>
               <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">shell-command-to-string</span>
                <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span>
                 <span class="string">"sqlite3 '%s' \"SELECT path FROM items WHERE albumartist IS '%s' AND title IS '%s' LIMIT 1 COLLATE NOCASE\""</span>
                 <span class="rainbow-delimiters-depth-1">(</span><span class="constant">expand-file-name</span> org-music-beets-db<span class="rainbow-delimiters-depth-1">)</span> artist-escaped title-escaped<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
               <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">shell-command-to-string</span>
                <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span>
                 <span class="string">"sqlite3 '%s' \"SELECT path FROM items WHERE artist IS '%s' AND title IS '%s' LIMIT 1 COLLATE NOCASE\""</span>
                 <span class="rainbow-delimiters-depth-1">(</span><span class="constant">expand-file-name</span> org-music-beets-db<span class="rainbow-delimiters-depth-1">)</span> artist-escaped title-escaped<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">&gt;</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">length</span> file<span class="rainbow-delimiters-depth-1">)</span> <span class="highlight-numbers-number">0</span><span class="rainbow-delimiters-depth-3">)</span>
            <span class="rainbow-delimiters-depth-3">(</span><span class="constant">substring</span> file <span class="highlight-numbers-number">0</span> <span class="highlight-numbers-number">-1</span><span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-music-find-file</span> <span class="rainbow-delimiters-depth-1">(</span>artist title<span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"Try to find a file in `</span><span class="doc"><span class="constant">org-music-folder</span></span><span class="doc">' which contains TITLE, looking first in ./ARTIST if possible."</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when-let*</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>music-folder <span class="rainbow-delimiters-depth-1">(</span><span class="constant">expand-file-name</span> org-music-folder<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                  <span class="rainbow-delimiters-depth-3">(</span>search-folders <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span>
                                   <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">-filter</span> <span class="comment-delimiter">; </span><span class="comment">look for folders which contain ARTIST
</span>                                    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-1">(</span>file-or-folder<span class="rainbow-delimiters-depth-1">)</span>
                                      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">and</span>
                                       <span class="rainbow-delimiters-depth-2">(</span>s-contains-p artist <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">file-name-base</span> file-or-folder<span class="rainbow-delimiters-depth-3">)</span> t<span class="rainbow-delimiters-depth-2">)</span>
                                       <span class="rainbow-delimiters-depth-2">(</span><span class="constant">file-directory-p</span> file-or-folder<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                                    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">directory-files</span> music-folder t<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                                   <span class="rainbow-delimiters-depth-2">(</span><span class="constant">list</span> music-folder<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                  <span class="rainbow-delimiters-depth-3">(</span>extension-regex <span class="rainbow-delimiters-depth-1">(</span><span class="constant">format</span> <span class="string">"\\.</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(?:</span></span><span class="string">%s</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">\\'"</span> <span class="rainbow-delimiters-depth-2">(</span>s-join <span class="string">"</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">|</span></span><span class="string">"</span> org-music-recognised-extensions<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                  <span class="rainbow-delimiters-depth-3">(</span>tracks <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">-filter</span>
                           <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-3">(</span>file<span class="rainbow-delimiters-depth-3">)</span>
                             <span class="rainbow-delimiters-depth-3">(</span>s-contains-p title <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">file-name-base</span> file<span class="rainbow-delimiters-depth-1">)</span> t<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                           <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">-flatten</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">mapcar</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-2">(</span>dir<span class="rainbow-delimiters-depth-2">)</span>
                                               <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">directory-files-recursively</span> dir extension-regex<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                                             search-folders<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">&gt;</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">length</span> tracks<span class="rainbow-delimiters-depth-1">)</span> <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="constant">message</span> <span class="string">"Warning: multiple matches for %s by %s found"</span> title artist<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">car</span> tracks<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">after!</span> org
    <span class="rainbow-delimiters-depth-3">(</span>org-link-set-parameters <span class="string">"music"</span>
                             <span class="builtin">:follow</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-music-open-fn</span>
                             <span class="builtin">:export</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-music-export-text</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span>org-link-set-parameters <span class="string">"Music"</span> <span class="comment-delimiter">;; </span><span class="comment">like music, but visually fancier
</span>                             <span class="comment-delimiter">;; </span><span class="bold"><span class="error">FIXME</span></span><span class="comment"> this should work as far as I can tell
</span>                             <span class="comment-delimiter">;; </span><span class="comment">:image-data-fun #'org-music-image-fn
</span>                             <span class="builtin">:follow</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-music-open-fn</span>
                             <span class="builtin">:export</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-music-fancy-export</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-music-open-fn</span> <span class="rainbow-delimiters-depth-1">(</span>link<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">apply</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-music-play-track</span> <span class="rainbow-delimiters-depth-2">(</span>org-music-parse-link link<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-music-insert-current-track</span> <span class="rainbow-delimiters-depth-1">(</span><span class="type">&amp;optional</span> include-time<span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"Insert link to currest track, including a timestamp when the universal argument is supplied."</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">interactive</span> <span class="string">"P"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">pp</span> include-time<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">insert</span> <span class="rainbow-delimiters-depth-2">(</span>org-music-get-link t include-time<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-music-export-text</span> <span class="rainbow-delimiters-depth-1">(</span>path desc backend _com <span class="type">&amp;optional</span> newline<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>track-info <span class="rainbow-delimiters-depth-1">(</span>org-music-parse-link path<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>artist <span class="rainbow-delimiters-depth-1">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">0</span> track-info<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>track <span class="rainbow-delimiters-depth-1">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">1</span> track-info<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>start-time <span class="rainbow-delimiters-depth-1">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">2</span> track-info<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>end-time <span class="rainbow-delimiters-depth-1">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">3</span> track-info<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>emphasise <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">cond</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>org-export-derived-backend-p backend <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">html</span><span class="rainbow-delimiters-depth-3">)</span>
                               <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-1">(</span>s<span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">format</span> <span class="string">"&lt;span style=\"font-style: italic\"&gt;%s&lt;/span&gt;"</span> s<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                              <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>org-export-derived-backend-p backend <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">latex</span><span class="rainbow-delimiters-depth-3">)</span>
                               <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-1">(</span>s<span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">format</span> <span class="string">"\\emph{%s}"</span> s<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                              <span class="rainbow-delimiters-depth-2">(</span>t <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-1">(</span>s<span class="rainbow-delimiters-depth-1">)</span> s<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> desc
            <span class="rainbow-delimiters-depth-3">(</span><span class="constant">concat</span>
             <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">cond</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="keyword">and</span> start-time end-time<span class="rainbow-delimiters-depth-3">)</span>
                    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"%s to %s seconds of%s"</span> start-time end-time <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> newline <span class="string">" "</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                   <span class="rainbow-delimiters-depth-2">(</span>start-time
                    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"%s seconds into%s"</span> start-time <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> newline <span class="string">" "</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
             <span class="rainbow-delimiters-depth-1">(</span><span class="constant">funcall</span> emphasise track<span class="rainbow-delimiters-depth-1">)</span>
             <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> newline <span class="string">" "</span><span class="rainbow-delimiters-depth-1">)</span>
             <span class="string">"by "</span>
             artist<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-music-cover-image</span> <span class="rainbow-delimiters-depth-1">(</span>track-file<span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"Try to find a cover image for the track in the given location"</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">car</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">-filter</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-1">(</span>file<span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">-contains-p</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span><span class="string">"png"</span> <span class="string">"jpg"</span> <span class="string">"jpeg"</span><span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">file-name-extension</span> file<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">directory-files</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">file-name-directory</span> track-file<span class="rainbow-delimiters-depth-1">)</span> t <span class="string">"cover"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-music-image-fn</span> <span class="rainbow-delimiters-depth-1">(</span>_protocol link _description<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when-let*</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>track-data <span class="rainbow-delimiters-depth-1">(</span>org-music-parse-link link<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                  <span class="rainbow-delimiters-depth-3">(</span>cover-file <span class="rainbow-delimiters-depth-1">(</span>org-music-cover-image
                               <span class="rainbow-delimiters-depth-2">(</span>org-music-find-track-file
                                <span class="rainbow-delimiters-depth-3">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">0</span> track-data<span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">1</span> track-data<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">with-temp-buffer</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="constant">set-buffer-multibyte</span> nil<span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> <span class="variable-name">buffer-file-coding-system</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">binary</span><span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">insert-file-contents-literally</span> cover-file<span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="constant">buffer-substring-no-properties</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">point-min</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">point-max</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-music-fancy-export</span> <span class="rainbow-delimiters-depth-1">(</span>path desc backend _com<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>track-data <span class="rainbow-delimiters-depth-1">(</span>org-music-parse-link path<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>file <span class="rainbow-delimiters-depth-1">(</span>org-music-find-track-file
                    <span class="rainbow-delimiters-depth-2">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">0</span> track-data<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">1</span> track-data<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>cover-img <span class="rainbow-delimiters-depth-1">(</span>org-music-cover-image file<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>newline-str <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">cond</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>org-export-derived-backend-p backend <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">html</span><span class="rainbow-delimiters-depth-3">)</span> <span class="string">"&lt;br&gt;"</span><span class="rainbow-delimiters-depth-2">)</span>
                                <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>org-export-derived-backend-p backend <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">latex</span><span class="rainbow-delimiters-depth-3">)</span> <span class="string">"\\newline "</span><span class="rainbow-delimiters-depth-2">)</span>
                                <span class="rainbow-delimiters-depth-2">(</span>t <span class="string">" "</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
             <span class="rainbow-delimiters-depth-3">(</span>text <span class="rainbow-delimiters-depth-1">(</span>org-music-export-text path nil backend nil newline-str<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">cond</span> <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>org-export-derived-backend-p backend <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">html</span><span class="rainbow-delimiters-depth-1">)</span>
               <span class="rainbow-delimiters-depth-1">(</span><span class="constant">format</span> <span class="string">"&lt;div class='music-track'&gt;
      &lt;img src='%s'&gt; &lt;span&gt;%s&lt;/span&gt;
  &lt;/div&gt;"</span> cover-img text<span class="rainbow-delimiters-depth-1">)</span>
               <span class="rainbow-delimiters-depth-3">)</span>
              <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>org-export-derived-backend-p backend <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">latex</span><span class="rainbow-delimiters-depth-1">)</span>
               <span class="rainbow-delimiters-depth-1">(</span><span class="constant">format</span> <span class="string">"\\begin{tabular}{@{\\hspace{0.3\\columnwidth}}r@{\\hspace{0.1\\columnwidth}}p{0.4\\columnwidth}}
    \\includegraphics[height=6em]{%s} &amp; \\vspace{-0.12\\columnwidth}%s
  \\end{tabular}"</span> cover-img text<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
              <span class="rainbow-delimiters-depth-3">(</span>t text<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span>org-link-set-parameters <span class="string">"yt"</span> <span class="builtin">:export</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">+org-export-yt</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+org-export-yt</span> <span class="rainbow-delimiters-depth-3">(</span>path desc backend _com<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">cond</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>org-export-derived-backend-p backend <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">html</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span><span class="constant">format</span> <span class="string">"&lt;iframe width='440' \
  height='335' \
  src='https://www.youtube.com/embed/%s' \
  frameborder='0' \
  allowfullscreen&gt;%s&lt;/iframe&gt;"</span> path <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">or</span> <span class="string">""</span> desc<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>org-export-derived-backend-p backend <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">latex</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span><span class="constant">format</span> <span class="string">"\\href{https://youtu.be/%s}{%s}"</span> path <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">or</span> desc <span class="string">"youtube"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span>t <span class="rainbow-delimiters-depth-2">(</span><span class="constant">format</span> <span class="string">"https://youtu.be/%s"</span> path<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">add-hook!</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-mode-hook</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">+org-pretty-mode</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">mixed-pitch-mode</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> <span class="variable-name">global-org-pretty-table-mode</span> t<span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">custom-set-faces!</span>
    <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span>outline-1 <span class="builtin">:weight</span> extra-bold <span class="builtin">:height</span> <span class="highlight-numbers-number">1.25</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span>outline-2 <span class="builtin">:weight</span> bold <span class="builtin">:height</span> <span class="highlight-numbers-number">1.15</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span>outline-3 <span class="builtin">:weight</span> bold <span class="builtin">:height</span> <span class="highlight-numbers-number">1.12</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span>outline-4 <span class="builtin">:weight</span> semi-bold <span class="builtin">:height</span> <span class="highlight-numbers-number">1.09</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span>outline-5 <span class="builtin">:weight</span> semi-bold <span class="builtin">:height</span> <span class="highlight-numbers-number">1.06</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span>outline-6 <span class="builtin">:weight</span> semi-bold <span class="builtin">:height</span> <span class="highlight-numbers-number">1.03</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span>outline-8 <span class="builtin">:weight</span> semi-bold<span class="rainbow-delimiters-depth-3">)</span>
    <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span>outline-9 <span class="builtin">:weight</span> semi-bold<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">custom-set-faces!</span>
    <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span>org-document-title <span class="builtin">:height</span> <span class="highlight-numbers-number">1.2</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> org-agenda-deadline-faces
        <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span><span class="highlight-numbers-number">1.001</span> . error<span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="highlight-numbers-number">1.0</span> . org-warning<span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="highlight-numbers-number">0.5</span> . org-upcoming-deadline<span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span><span class="highlight-numbers-number">0.0</span> . org-upcoming-distant-deadline<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> org-fontify-quote-and-verse-blocks t<span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">use-package!</span> org-appear
    <span class="builtin">:hook</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">org-mode</span> . org-appear-mode<span class="rainbow-delimiters-depth-3">)</span>
    <span class="builtin">:config</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> org-appear-autoemphasis t
          org-appear-autosubmarkers t
          org-appear-autolinks nil<span class="rainbow-delimiters-depth-3">)</span>
    <span class="comment-delimiter">;; </span><span class="comment">for proper first-time setup, `</span><span class="comment"><span class="constant">org-appear--set-fragments</span></span><span class="comment">'
</span>    <span class="comment-delimiter">;; </span><span class="comment">needs to be run after other hooks have acted.
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">run-at-time</span> nil nil <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-appear--set-fragments</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="comment-delimiter">;; </span><span class="comment">(use-package org-pretty-tags
</span>  <span class="comment-delimiter">;; </span><span class="comment">:config
</span>  <span class="comment-delimiter">;;  </span><span class="comment">(setq org-pretty-tags-surrogate-strings
</span>  <span class="comment-delimiter">;;        </span><span class="comment">`(("uni"        . ,(all-the-icons-faicon   "graduation-cap" :face 'all-the-icons-purple  :v-adjust 0.01))
</span>  <span class="comment-delimiter">;;          </span><span class="comment">("ucc"        . ,(all-the-icons-material "computer"       :face 'all-the-icons-silver  :v-adjust 0.01))
</span>  <span class="comment-delimiter">;;          </span><span class="comment">("assignment" . ,(all-the-icons-material "library_books"  :face 'all-the-icons-orange  :v-adjust 0.01))
</span>  <span class="comment-delimiter">;;          </span><span class="comment">("test"       . ,(all-the-icons-material "timer"          :face 'all-the-icons-red     :v-adjust 0.01))
</span>  <span class="comment-delimiter">;;          </span><span class="comment">("lecture"    . ,(all-the-icons-fileicon "keynote"        :face 'all-the-icons-orange  :v-adjust 0.01))
</span>  <span class="comment-delimiter">;;          </span><span class="comment">("email"      . ,(all-the-icons-faicon   "envelope"       :face 'all-the-icons-blue    :v-adjust 0.01))
</span>  <span class="comment-delimiter">;;          </span><span class="comment">("read"       . ,(all-the-icons-octicon  "book"           :face 'all-the-icons-lblue   :v-adjust 0.01))
</span>  <span class="comment-delimiter">;;          </span><span class="comment">("article"    . ,(all-the-icons-octicon  "file-text"      :face 'all-the-icons-yellow  :v-adjust 0.01))
</span>  <span class="comment-delimiter">;;          </span><span class="comment">("web"        . ,(all-the-icons-faicon   "globe"          :face 'all-the-icons-green   :v-adjust 0.01))
</span>  <span class="comment-delimiter">;;          </span><span class="comment">("info"       . ,(all-the-icons-faicon   "info-circle"    :face 'all-the-icons-blue    :v-adjust 0.01))
</span>  <span class="comment-delimiter">;;          </span><span class="comment">("issue"      . ,(all-the-icons-faicon   "bug"            :face 'all-the-icons-red     :v-adjust 0.01))
</span>  <span class="comment-delimiter">;;          </span><span class="comment">("someday"    . ,(all-the-icons-faicon   "calendar-o"     :face 'all-the-icons-cyan    :v-adjust 0.01))
</span>  <span class="comment-delimiter">;;          </span><span class="comment">("idea"       . ,(all-the-icons-octicon  "light-bulb"     :face 'all-the-icons-yellow  :v-adjust 0.01))
</span>  <span class="comment-delimiter">;;          </span><span class="comment">("emacs"      . ,(all-the-icons-fileicon "emacs"          :face 'all-the-icons-lpurple :v-adjust 0.01))))
</span>  <span class="comment-delimiter">;;  </span><span class="comment">(org-pretty-tags-global-mode))
</span>  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">after!</span> org-superstar
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> org-superstar-headline-bullets-list <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-1">(</span><span class="string">"&#226;&#151;&#137;"</span> <span class="string">"&#226;&#151;&#139;"</span> <span class="string">"&#226;&#156;&#184;"</span> <span class="string">"&#226;&#156;&#191;"</span> <span class="string">"&#226;&#156;&#164;"</span> <span class="string">"&#226;&#156;&#156;"</span> <span class="string">"&#226;&#151;&#134;"</span> <span class="string">"&#226;&#150;&#182;"</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="comment-delimiter">;; </span><span class="comment">org-superstar-headline-bullets-list '("&#226;&#133;&#160;" "&#226;&#133;&#161;" "&#226;&#133;&#162;" "&#226;&#133;&#163;" "&#226;&#133;&#164;" "&#226;&#133;&#165;" "&#226;&#133;&#166;" "&#226;&#133;&#167;" "&#226;&#133;&#168;" "&#226;&#133;&#169;")
</span>          org-superstar-prettify-item-bullets t <span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> org-ellipsis <span class="string">" &#226;&#150;&#190; "</span>
        org-hide-leading-stars t
        org-priority-highest ?A
        org-priority-lowest ?E
        org-priority-faces
        <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>?A . <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">all-the-icons-red</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span>?B . <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">all-the-icons-orange</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span>?C . <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">all-the-icons-yellow</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span>?D . <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">all-the-icons-green</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span>?E . <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">all-the-icons-blue</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">appendq!</span> <span class="variable-name">+ligatures-extra-symbols</span>
            <span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-3">(</span><span class="builtin">:checkbox</span>      <span class="string">"&#226;&#152;&#144;"</span>
              <span class="builtin">:pending</span>       <span class="string">"&#226;&#151;&#188;"</span>
              <span class="builtin">:checkedbox</span>    <span class="string">"&#226;&#152;&#145;"</span>
              <span class="builtin">:list_property</span> <span class="string">"&#226;&#136;&#183;"</span>
              <span class="builtin">:em_dash</span>       <span class="string">"&#226;&#128;&#148;"</span>
              <span class="builtin">:ellipses</span>      <span class="string">"&#226;&#128;&#166;"</span>
              <span class="builtin">:title</span>         <span class="string">"&#240;&#157;&#153;&#143;"</span>
              <span class="builtin">:subtitle</span>      <span class="string">"&#240;&#157;&#153;&#169;"</span>
              <span class="builtin">:author</span>        <span class="string">"&#240;&#157;&#152;&#188;"</span>
              <span class="builtin">:date</span>          <span class="string">"&#240;&#157;&#152;&#191;"</span>
              <span class="builtin">:property</span>      <span class="string">"&#226;&#152;&#184;"</span>
              <span class="builtin">:options</span>       <span class="string">"&#226;&#140;&#165;"</span>
              <span class="builtin">:latex_class</span>   <span class="string">"&#240;&#159;&#132;&#178;"</span>
              <span class="builtin">:latex_header</span>  <span class="string">"&#226;&#135;&#165;"</span>
              <span class="builtin">:beamer_header</span> <span class="string">"&#226;&#134;&#160;"</span>
              <span class="builtin">:attr_latex</span>    <span class="string">"&#240;&#159;&#132;&#155;"</span>
              <span class="builtin">:attr_html</span>     <span class="string">"&#240;&#159;&#132;&#151;"</span>
              <span class="builtin">:begin_quote</span>   <span class="string">"&#226;&#157;&#174;"</span>
              <span class="builtin">:end_quote</span>     <span class="string">"&#226;&#157;&#175;"</span>
              <span class="builtin">:caption</span>       <span class="string">"&#226;&#152;&#176;"</span>
              <span class="builtin">:header</span>        <span class="string">"&#226;&#128;&#186;"</span>
              <span class="builtin">:results</span>       <span class="string">"&#240;&#159;&#160;&#182;"</span>
              <span class="builtin">:begin_export</span>  <span class="string">"&#226;&#175;&#174;"</span>
              <span class="builtin">:end_export</span>    <span class="string">"&#226;&#175;&#172;"</span>
              <span class="builtin">:properties</span>    <span class="string">"&#226;&#154;&#153;"</span>
              <span class="builtin">:end</span>           <span class="string">"&#226;&#136;&#142;"</span>
              <span class="builtin">:priority_a</span>   ,<span class="rainbow-delimiters-depth-1">(</span><span class="constant">propertize</span> <span class="string">"&#226;&#154;&#145;"</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">all-the-icons-red</span><span class="rainbow-delimiters-depth-1">)</span>
              <span class="builtin">:priority_b</span>   ,<span class="rainbow-delimiters-depth-1">(</span><span class="constant">propertize</span> <span class="string">"&#226;&#172;&#134;"</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">all-the-icons-orange</span><span class="rainbow-delimiters-depth-1">)</span>
              <span class="builtin">:priority_c</span>   ,<span class="rainbow-delimiters-depth-1">(</span><span class="constant">propertize</span> <span class="string">"&#226;&#150;&#160;"</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">all-the-icons-yellow</span><span class="rainbow-delimiters-depth-1">)</span>
              <span class="builtin">:priority_d</span>   ,<span class="rainbow-delimiters-depth-1">(</span><span class="constant">propertize</span> <span class="string">"&#226;&#172;&#135;"</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">all-the-icons-green</span><span class="rainbow-delimiters-depth-1">)</span>
              <span class="builtin">:priority_e</span>   ,<span class="rainbow-delimiters-depth-1">(</span><span class="constant">propertize</span> <span class="string">"&#226;&#157;&#147;"</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">face</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">all-the-icons-blue</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">set-ligatures!</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-mode</span>
    <span class="builtin">:merge</span> t
    <span class="builtin">:checkbox</span>      <span class="string">"[ ]"</span>
    <span class="builtin">:pending</span>       <span class="string">"[-]"</span>
    <span class="builtin">:checkedbox</span>    <span class="string">"[X]"</span>
    <span class="builtin">:list_property</span> <span class="string">"::"</span>
    <span class="builtin">:em_dash</span>       <span class="string">"---"</span>
    <span class="builtin">:ellipsis</span>      <span class="string">"..."</span>
    <span class="builtin">:title</span>         <span class="string">"#+title:"</span>
    <span class="builtin">:subtitle</span>      <span class="string">"#+subtitle:"</span>
    <span class="builtin">:author</span>        <span class="string">"#+author:"</span>
    <span class="builtin">:date</span>          <span class="string">"#+date:"</span>
    <span class="builtin">:property</span>      <span class="string">"#+property:"</span>
    <span class="builtin">:options</span>       <span class="string">"#+options:"</span>
    <span class="builtin">:latex_class</span>   <span class="string">"#+latex_class:"</span>
    <span class="builtin">:latex_header</span>  <span class="string">"#+latex_header:"</span>
    <span class="builtin">:beamer_header</span> <span class="string">"#+beamer_header:"</span>
    <span class="builtin">:attr_latex</span>    <span class="string">"#+attr_latex:"</span>
    <span class="builtin">:attr_html</span>     <span class="string">"#+attr_latex:"</span>
    <span class="builtin">:begin_quote</span>   <span class="string">"#+begin_quote"</span>
    <span class="builtin">:end_quote</span>     <span class="string">"#+end_quote"</span>
    <span class="builtin">:caption</span>       <span class="string">"#+caption:"</span>
    <span class="builtin">:header</span>        <span class="string">"#+header:"</span>
    <span class="builtin">:begin_export</span>  <span class="string">"#+begin_export"</span>
    <span class="builtin">:end_export</span>    <span class="string">"#+end_export"</span>
    <span class="builtin">:results</span>       <span class="string">"#+RESULTS:"</span>
    <span class="builtin">:property</span>      <span class="string">":PROPERTIES:"</span>
    <span class="builtin">:end</span>           <span class="string">":END:"</span>
    <span class="builtin">:priority_a</span>    <span class="string">"[#A]"</span>
    <span class="builtin">:priority_b</span>    <span class="string">"[#B]"</span>
    <span class="builtin">:priority_c</span>    <span class="string">"[#C]"</span>
    <span class="builtin">:priority_d</span>    <span class="string">"[#D]"</span>
    <span class="builtin">:priority_e</span>    <span class="string">"[#E]"</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-put</span> <span class="variable-name">+ligatures-extra-symbols</span> <span class="builtin">:name</span> <span class="string">"&#226;&#129;&#141;"</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> org-highlight-latex-and-related <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span>native script entities<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">use-package!</span> org-fragtog
    <span class="builtin">:hook</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">org-mode</span> . org-fragtog-mode<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> org-format-latex-header <span class="string">"\\documentclass{article}
  \\usepackage[usenames]{color}
  
  \\usepackage[T1]{fontenc}
  
  \\usepackage{booktabs}
  
  \\pagestyle{empty}             % do not remove
  % The settings below are copied from fullpage.sty
  \\setlength{\\textwidth}{\\paperwidth}
  \\addtolength{\\textwidth}{-3cm}
  \\setlength{\\oddsidemargin}{1.5cm}
  \\addtolength{\\oddsidemargin}{-2.54cm}
  \\setlength{\\evensidemargin}{\\oddsidemargin}
  \\setlength{\\textheight}{\\paperheight}
  \\addtolength{\\textheight}{-\\headheight}
  \\addtolength{\\textheight}{-\\headsep}
  \\addtolength{\\textheight}{-\\footskip}
  \\addtolength{\\textheight}{-3cm}
  \\setlength{\\topmargin}{1.5cm}
  \\addtolength{\\topmargin}{-2.54cm}
  % my custom stuff
  \\usepackage[nofont,plaindd]{bmc-maths}
  \\usepackage{arev}
  "</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="comment-delimiter">;; </span><span class="comment">make background of fragments transparent
</span>  <span class="comment-delimiter">;; </span><span class="comment">(let ((dvipng--plist (alist-get 'dvipng org-preview-latex-process-alist)))
</span>  <span class="comment-delimiter">;;   </span><span class="comment">(plist-put dvipng--plist :use-xcolor t)
</span>  <span class="comment-delimiter">;;   </span><span class="comment">(plist-put dvipng--plist :image-converter '("dvipng -D %D -bg 'transparent' -T tight -o %O %f")))
</span>  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">add-hook!</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">doom-load-theme-hook</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">+org-refresh-latex-background</span> <span class="rainbow-delimiters-depth-1">()</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">plist-put!</span> org-format-latex-options
                  <span class="builtin">:background</span>
                  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">face-attribute</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">cadr</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">assq</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">default</span> <span class="variable-name">face-remapping-alist</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                                      <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">default</span><span class="rainbow-delimiters-depth-3">)</span>
                                  <span class="builtin">:background</span> nil t<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-to-list</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-latex-regexps</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"\\ce"</span> <span class="string">"^\\\\ce{</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(?:</span></span><span class="string">[</span><span class="string"><span class="negation-char">^</span></span><span class="string">\000{}]</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">|</span></span><span class="string">{[</span><span class="string"><span class="negation-char">^</span></span><span class="string">\000}]+?}</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">}"</span> <span class="highlight-numbers-number">0</span> nil<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">scimax-org-latex-fragment-justify</span> <span class="rainbow-delimiters-depth-3">(</span>justification<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Justify the latex fragment at point with JUSTIFICATION.
  JUSTIFICATION is a symbol for 'left, 'center or 'right."</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">interactive</span>
     <span class="rainbow-delimiters-depth-1">(</span><span class="constant">list</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">intern-soft</span>
            <span class="rainbow-delimiters-depth-3">(</span><span class="constant">completing-read</span> <span class="string">"Justification (left): "</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-1">(</span>left center right<span class="rainbow-delimiters-depth-1">)</span>
                             nil t nil nil <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">left</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>ov <span class="rainbow-delimiters-depth-3">(</span>ov-at<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>beg <span class="rainbow-delimiters-depth-3">(</span>ov-beg ov<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>end <span class="rainbow-delimiters-depth-3">(</span>ov-end ov<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>shift <span class="rainbow-delimiters-depth-3">(</span><span class="constant">-</span> beg <span class="rainbow-delimiters-depth-1">(</span><span class="constant">line-beginning-position</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>img <span class="rainbow-delimiters-depth-3">(</span><span class="constant">overlay-get</span> ov <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">display</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>img <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">and</span> img <span class="rainbow-delimiters-depth-2">(</span><span class="constant">consp</span> img<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">eq</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">car</span> img<span class="rainbow-delimiters-depth-3">)</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">image</span><span class="rainbow-delimiters-depth-2">)</span>
                          <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">image-type-available-p</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">cdr</span> img<span class="rainbow-delimiters-depth-1">)</span> <span class="builtin">:type</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                     img<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           space-left offset<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">and</span> img
                 <span class="comment-delimiter">;; </span><span class="comment">This means the equation is at the start of the line
</span>                 <span class="rainbow-delimiters-depth-3">(</span><span class="constant">=</span> beg <span class="rainbow-delimiters-depth-1">(</span><span class="constant">line-beginning-position</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                 <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">or</span>
                  <span class="rainbow-delimiters-depth-1">(</span><span class="constant">string=</span> <span class="string">""</span> <span class="rainbow-delimiters-depth-2">(</span>s-trim <span class="rainbow-delimiters-depth-3">(</span><span class="constant">buffer-substring</span> end <span class="rainbow-delimiters-depth-1">(</span><span class="constant">line-end-position</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                  <span class="rainbow-delimiters-depth-1">(</span><span class="constant">eq</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">latex-environment</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">car</span> <span class="rainbow-delimiters-depth-3">(</span>org-element-context<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> space-left <span class="rainbow-delimiters-depth-3">(</span><span class="constant">-</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">window-max-chars-per-line</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">car</span> <span class="rainbow-delimiters-depth-2">(</span>image-size img<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
              offset <span class="rainbow-delimiters-depth-3">(</span><span class="constant">floor</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">cond</span>
                             <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="constant">eq</span> justification <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">center</span><span class="rainbow-delimiters-depth-3">)</span>
                              <span class="rainbow-delimiters-depth-3">(</span><span class="constant">-</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">/</span> space-left <span class="highlight-numbers-number">2</span><span class="rainbow-delimiters-depth-1">)</span> shift<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                             <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="constant">eq</span> justification <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">right</span><span class="rainbow-delimiters-depth-3">)</span>
                              <span class="rainbow-delimiters-depth-3">(</span><span class="constant">-</span> space-left shift<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                             <span class="rainbow-delimiters-depth-2">(</span>t
                              <span class="highlight-numbers-number">0</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">&gt;=</span> offset <span class="highlight-numbers-number">0</span><span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="constant">overlay-put</span> ov <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">before-string</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">make-string</span> offset ?\ <span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">scimax-org-latex-fragment-justify-advice</span> <span class="rainbow-delimiters-depth-3">(</span>beg end image imagetype<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"After advice function to justify fragments."</span>
    <span class="rainbow-delimiters-depth-3">(</span>scimax-org-latex-fragment-justify <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> org-format-latex-options <span class="builtin">:justify</span><span class="rainbow-delimiters-depth-2">)</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">left</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">scimax-toggle-latex-fragment-justification</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="doc">"Toggle if LaTeX fragment justification options can be used."</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">interactive</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">not</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">get</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">scimax-org-latex-fragment-justify-advice</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">enabled</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
        <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">progn</span>
          <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">advice-add</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org--format-latex-make-overlay</span> <span class="builtin">:after</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">scimax-org-latex-fragment-justify-advice</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span><span class="constant">put</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">scimax-org-latex-fragment-justify-advice</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">enabled</span> t<span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span><span class="constant">message</span> <span class="string">"Latex fragment justification enabled"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">advice-remove</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org--format-latex-make-overlay</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">scimax-org-latex-fragment-justify-advice</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">put</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">scimax-org-latex-fragment-justify-advice</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">enabled</span> nil<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">message</span> <span class="string">"Latex fragment justification disabled"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="comment-delimiter">;; </span><span class="comment">Numbered equations all have (1) as the number for fragments with vanilla
</span>  <span class="comment-delimiter">;; </span><span class="comment">org-mode. This code injects the correct numbers into the previews so they
</span>  <span class="comment-delimiter">;; </span><span class="comment">look good.
</span>  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">scimax-org-renumber-environment</span> <span class="rainbow-delimiters-depth-3">(</span>orig-func <span class="type">&amp;rest</span> args<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"A function to inject numbers in LaTeX fragment previews."</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>results <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">()</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span>counter <span class="highlight-numbers-number">-1</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span><span class="constant">numberp</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> results <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">cl-loop</span> for <span class="rainbow-delimiters-depth-3">(</span>begin . env<span class="rainbow-delimiters-depth-3">)</span> in
                             <span class="rainbow-delimiters-depth-3">(</span>org-element-map <span class="rainbow-delimiters-depth-1">(</span>org-element-parse-buffer<span class="rainbow-delimiters-depth-1">)</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">latex-environment</span>
                               <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-2">(</span>env<span class="rainbow-delimiters-depth-2">)</span>
                                 <span class="rainbow-delimiters-depth-2">(</span><span class="constant">cons</span>
                                  <span class="rainbow-delimiters-depth-3">(</span>org-element-property <span class="builtin">:begin</span> env<span class="rainbow-delimiters-depth-3">)</span>
                                  <span class="rainbow-delimiters-depth-3">(</span>org-element-property <span class="builtin">:value</span> env<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                             collect
                             <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">cond</span>
                              <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">string-match</span> <span class="string">"\\\\begin{equation}"</span> env<span class="rainbow-delimiters-depth-3">)</span>
                                    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">not</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">string-match</span> <span class="string">"\\\\tag{"</span> env<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                               <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">incf</span> counter<span class="rainbow-delimiters-depth-2">)</span>
                               <span class="rainbow-delimiters-depth-2">(</span><span class="constant">cons</span> begin counter<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                              <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span><span class="constant">string-match</span> <span class="string">"\\\\begin{align}"</span> env<span class="rainbow-delimiters-depth-2">)</span>
                               <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">prog2</span>
                                   <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">incf</span> counter<span class="rainbow-delimiters-depth-3">)</span>
                                   <span class="rainbow-delimiters-depth-3">(</span><span class="constant">cons</span> begin counter<span class="rainbow-delimiters-depth-3">)</span>
                                 <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">with-temp-buffer</span>
                                   <span class="rainbow-delimiters-depth-1">(</span><span class="constant">insert</span> env<span class="rainbow-delimiters-depth-1">)</span>
                                   <span class="rainbow-delimiters-depth-1">(</span><span class="constant">goto-char</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">point-min</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                                   <span class="comment-delimiter">;; </span><span class="comment">\\ is used for a new line. Each one leads to a number
</span>                                   <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">incf</span> counter <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">count-matches</span> <span class="string">"\\\\$"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                                   <span class="comment-delimiter">;; </span><span class="comment">unless there are nonumbers.
</span>                                   <span class="rainbow-delimiters-depth-1">(</span><span class="constant">goto-char</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">point-min</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                                   <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">decf</span> counter <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">count-matches</span> <span class="string">"\\nonumber"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                              <span class="rainbow-delimiters-depth-1">(</span>t
                               <span class="rainbow-delimiters-depth-2">(</span><span class="constant">cons</span> begin nil<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
  
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> numberp <span class="rainbow-delimiters-depth-3">(</span><span class="constant">cdr</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">assoc</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">point</span><span class="rainbow-delimiters-depth-2">)</span> results<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setf</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">car</span> args<span class="rainbow-delimiters-depth-3">)</span>
              <span class="rainbow-delimiters-depth-3">(</span><span class="constant">concat</span>
               <span class="rainbow-delimiters-depth-1">(</span><span class="constant">format</span> <span class="string">"\\setcounter{equation}{%s}\n"</span> numberp<span class="rainbow-delimiters-depth-1">)</span>
               <span class="rainbow-delimiters-depth-1">(</span><span class="constant">car</span> args<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">apply</span> orig-func args<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">scimax-toggle-latex-equation-numbering</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="doc">"Toggle whether LaTeX fragments are numbered."</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">interactive</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">not</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">get</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">scimax-org-renumber-environment</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">enabled</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
        <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">progn</span>
          <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">advice-add</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-create-formula-image</span> <span class="builtin">:around</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">scimax-org-renumber-environment</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span><span class="constant">put</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">scimax-org-renumber-environment</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">enabled</span> t<span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span><span class="constant">message</span> <span class="string">"Latex numbering enabled"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">advice-remove</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-create-formula-image</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">scimax-org-renumber-environment</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">put</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">scimax-org-renumber-environment</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">enabled</span> nil<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">message</span> <span class="string">"Latex numbering disabled."</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">advice-add</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-create-formula-image</span> <span class="builtin">:around</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">scimax-org-renumber-environment</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="constant">put</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">scimax-org-renumber-environment</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">enabled</span> t<span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">after!</span> org-plot
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-plot/generate-theme</span> <span class="rainbow-delimiters-depth-1">(</span>_type<span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"Use the current Doom theme colours to generate a GnuPlot preamble."</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">format</span> <span class="string">"
  fgt = \"textcolor rgb '%s'\" # foreground text
  fgat = \"textcolor rgb '%s'\" # foreground alt text
  fgl = \"linecolor rgb '%s'\" # foreground line
  fgal = \"linecolor rgb '%s'\" # foreground alt line
  
  # foreground colors
  set border lc rgb '%s'
  # change text colors of  tics
  set xtics @fgt
  set ytics @fgt
  # change text colors of labels
  set title @fgt
  set xlabel @fgt
  set ylabel @fgt
  # change a text color of key
  set key @fgt
  
  # line styles
  set linetype 1 lw 2 lc rgb '%s' # red
  set linetype 2 lw 2 lc rgb '%s' # blue
  set linetype 3 lw 2 lc rgb '%s' # green
  set linetype 4 lw 2 lc rgb '%s' # magenta
  set linetype 5 lw 2 lc rgb '%s' # orange
  set linetype 6 lw 2 lc rgb '%s' # yellow
  set linetype 7 lw 2 lc rgb '%s' # teal
  set linetype 8 lw 2 lc rgb '%s' # violet
  
  # palette
  set palette maxcolors 8
  set palette defined ( 0 '%s',\
  1 '%s',\
  2 '%s',\
  3 '%s',\
  4 '%s',\
  5 '%s',\
  6 '%s',\
  7 '%s' )
  "</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">fg</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">fg-alt</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">fg</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">fg-alt</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">fg</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="comment-delimiter">;; </span><span class="comment">colours
</span>              <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">red</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">blue</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">green</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">magenta</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">orange</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">yellow</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">teal</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">violet</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="comment-delimiter">;; </span><span class="comment">duplicated
</span>              <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">red</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">blue</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">green</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">magenta</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">orange</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">yellow</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">teal</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">violet</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-plot/gnuplot-term-properties</span> <span class="rainbow-delimiters-depth-1">(</span>_type<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">format</span> <span class="string">"background rgb '%s' size 1050,650"</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">bg</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> org-plot/gnuplot-script-preamble <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-plot/generate-theme</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> org-plot/gnuplot-term-extra <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-plot/gnuplot-term-properties</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> org-export-headline-levels <span class="highlight-numbers-number">5</span><span class="rainbow-delimiters-depth-2">)</span> <span class="comment-delimiter">; </span><span class="comment">I like nesting
</span>  <span class="rainbow-delimiters-depth-2">(</span><span class="constant">require</span> <span class="highlight-quoted-quote">'</span><span class="constant">ox-extra</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span>ox-extras-activate <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span>ignore-headlines<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">after!</span> ox-html
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">define-minor-mode</span> <span class="function-name">org-fancy-html-export-mode</span>
      <span class="doc">"Toggle my fabulous org export tweaks. While this mode itself does a little bit,
    the vast majority of the change in behaviour comes from switch statements in:
     - `</span><span class="doc"><span class="constant">org-html-template-fancier</span></span><span class="doc">'
     - `</span><span class="doc"><span class="constant">org-html--build-meta-info-extended</span></span><span class="doc">'
     - `</span><span class="doc"><span class="constant">org-html-src-block-collapsable</span></span><span class="doc">'
     - `</span><span class="doc"><span class="constant">org-html-block-collapsable</span></span><span class="doc">'
     - `</span><span class="doc"><span class="constant">org-html-table-wrapped</span></span><span class="doc">'
     - `</span><span class="doc"><span class="constant">org-html--format-toc-headline-colapseable</span></span><span class="doc">'
     - `</span><span class="doc"><span class="constant">org-html--toc-text-stripped-leaves</span></span><span class="doc">'
     - `</span><span class="doc"><span class="constant">org-export-html-headline-anchor</span></span><span class="doc">'"</span>
      <span class="builtin">:global</span> t
      <span class="builtin">:init-value</span> t
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> org-fancy-html-export-mode
          <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> org-html-style-default org-html-style-fancy
                org-html-meta-tags <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-html-meta-tags-fancy</span>
                org-html-checkbox-type <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">html-span</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> org-html-style-default org-html-style-plain
              org-html-meta-tags <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-html-meta-tags-default</span>
              org-html-checkbox-type <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">html</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defadvice!</span> org-html-template-fancier <span class="rainbow-delimiters-depth-1">(</span>orig-fn contents info<span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"Return complete document string after HTML conversion.
    CONTENTS is the transcoded contents string.  INFO is a plist
    holding export options. Adds a few extra things to the body
    compared to the default implementation."</span>
      <span class="builtin">:around</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-html-template</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">not</span> org-fancy-html-export-mode<span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">bound-and-true-p</span> +org-msg-currently-exporting<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span><span class="constant">funcall</span> orig-fn contents info<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span>
         <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">not</span> <span class="rainbow-delimiters-depth-3">(</span>org-html-html5-p info<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span>org-html-xhtml-p info<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
           <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>xml-declaration <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> info <span class="builtin">:html-xml-declaration</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                  <span class="rainbow-delimiters-depth-3">(</span>decl <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">stringp</span> xml-declaration<span class="rainbow-delimiters-depth-3">)</span> xml-declaration<span class="rainbow-delimiters-depth-2">)</span>
                            <span class="rainbow-delimiters-depth-2">(</span><span class="constant">cdr</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">assoc</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> info <span class="builtin">:html-extension</span><span class="rainbow-delimiters-depth-1">)</span>
                                        xml-declaration<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                            <span class="rainbow-delimiters-depth-2">(</span><span class="constant">cdr</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">assoc</span> <span class="string">"html"</span> xml-declaration<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                            <span class="string">""</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
             <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">not</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">not</span> decl<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">string=</span> <span class="string">""</span> decl<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
               <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"%s\n"</span>
                       <span class="rainbow-delimiters-depth-1">(</span><span class="constant">format</span> decl
                               <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">and</span> org-html-coding-system
                                        <span class="rainbow-delimiters-depth-1">(</span><span class="constant">fboundp</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">coding-system-get</span><span class="rainbow-delimiters-depth-1">)</span>
                                        <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">coding-system-get</span> org-html-coding-system <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">mime-charset</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                                   <span class="string">"iso-8859-1"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
         <span class="rainbow-delimiters-depth-3">(</span>org-html-doctype info<span class="rainbow-delimiters-depth-3">)</span>
         <span class="string">"\n"</span>
         <span class="rainbow-delimiters-depth-3">(</span><span class="constant">concat</span> <span class="string">"&lt;html"</span>
                 <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">cond</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>org-html-xhtml-p info<span class="rainbow-delimiters-depth-3">)</span>
                        <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span>
                         <span class="string">" xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"%s\" xml:lang=\"%s\""</span>
                         <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> info <span class="builtin">:language</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> info <span class="builtin">:language</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                       <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>org-html-html5-p info<span class="rainbow-delimiters-depth-3">)</span>
                        <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">" lang=\"%s\""</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> info <span class="builtin">:language</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                 <span class="string">"&gt;\n"</span><span class="rainbow-delimiters-depth-3">)</span>
         <span class="string">"&lt;head&gt;\n"</span>
         <span class="rainbow-delimiters-depth-3">(</span>org-html--build-meta-info info<span class="rainbow-delimiters-depth-3">)</span>
         <span class="rainbow-delimiters-depth-3">(</span>org-html--build-head info<span class="rainbow-delimiters-depth-3">)</span>
         <span class="rainbow-delimiters-depth-3">(</span>org-html--build-mathjax-config info<span class="rainbow-delimiters-depth-3">)</span>
         <span class="string">"&lt;/head&gt;\n"</span>
         <span class="string">"&lt;body&gt;\n&lt;input type='checkbox' id='theme-switch'&gt;&lt;div id='page'&gt;&lt;label id='switch-label' for='theme-switch'&gt;&lt;/label&gt;"</span>
         <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>link-up <span class="rainbow-delimiters-depth-3">(</span>org-trim <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> info <span class="builtin">:html-link-up</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
               <span class="rainbow-delimiters-depth-2">(</span>link-home <span class="rainbow-delimiters-depth-3">(</span>org-trim <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> info <span class="builtin">:html-link-home</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
           <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">unless</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">string=</span> link-up <span class="string">""</span><span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">string=</span> link-home <span class="string">""</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
             <span class="rainbow-delimiters-depth-2">(</span><span class="constant">format</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> info <span class="builtin">:html-home/up-format</span><span class="rainbow-delimiters-depth-3">)</span>
                     <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">or</span> link-up link-home<span class="rainbow-delimiters-depth-3">)</span>
                     <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">or</span> link-home link-up<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
         <span class="comment-delimiter">;; </span><span class="comment">Preamble.
</span>         <span class="rainbow-delimiters-depth-3">(</span>org-html--build-pre/postamble <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">preamble</span> info<span class="rainbow-delimiters-depth-3">)</span>
         <span class="comment-delimiter">;; </span><span class="comment">Document contents.
</span>         <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>div <span class="rainbow-delimiters-depth-3">(</span><span class="constant">assq</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">content</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> info <span class="builtin">:html-divs</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
           <span class="rainbow-delimiters-depth-1">(</span><span class="constant">format</span> <span class="string">"&lt;%s id=\"%s\"&gt;\n"</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">1</span> div<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">2</span> div<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
         <span class="comment-delimiter">;; </span><span class="comment">Document title.
</span>         <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> info <span class="builtin">:with-title</span><span class="rainbow-delimiters-depth-1">)</span>
           <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>title <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> info <span class="builtin">:with-title</span><span class="rainbow-delimiters-depth-2">)</span>
                             <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> info <span class="builtin">:title</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                 <span class="rainbow-delimiters-depth-3">(</span>subtitle <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> info <span class="builtin">:subtitle</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                 <span class="rainbow-delimiters-depth-3">(</span>html5-fancy <span class="rainbow-delimiters-depth-1">(</span>org-html--html5-fancy-p info<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
             <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">when</span> title
               <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span>
                <span class="string">"&lt;div class='page-header'&gt;&lt;div class='page-meta'&gt;%s, %s&lt;/div&gt;&lt;h1 class=\"title\"&gt;%s%s&lt;/h1&gt;&lt;/div&gt;\n"</span>
                <span class="rainbow-delimiters-depth-1">(</span>org-export-data <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> info <span class="builtin">:date</span><span class="rainbow-delimiters-depth-2">)</span> info<span class="rainbow-delimiters-depth-1">)</span>
                <span class="rainbow-delimiters-depth-1">(</span>org-export-data <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> info <span class="builtin">:author</span><span class="rainbow-delimiters-depth-2">)</span> info<span class="rainbow-delimiters-depth-1">)</span>
                <span class="rainbow-delimiters-depth-1">(</span>org-export-data title info<span class="rainbow-delimiters-depth-1">)</span>
                <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> subtitle
                    <span class="rainbow-delimiters-depth-2">(</span><span class="constant">format</span>
                     <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> html5-fancy
                         <span class="string">"&lt;p class=\"subtitle\"&gt;%s&lt;/p&gt;\n"</span>
                       <span class="rainbow-delimiters-depth-1">(</span><span class="constant">concat</span> <span class="string">"\n"</span> <span class="rainbow-delimiters-depth-2">(</span>org-html-close-tag <span class="string">"br"</span> nil info<span class="rainbow-delimiters-depth-2">)</span> <span class="string">"\n"</span>
                               <span class="string">"&lt;span class=\"subtitle\"&gt;%s&lt;/span&gt;\n"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                     <span class="rainbow-delimiters-depth-3">(</span>org-export-data subtitle info<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                  <span class="string">""</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
         contents
         <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"&lt;/%s&gt;\n"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">nth</span> <span class="highlight-numbers-number">1</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">assq</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">content</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> info <span class="builtin">:html-divs</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
         <span class="comment-delimiter">;; </span><span class="comment">Postamble.
</span>         <span class="rainbow-delimiters-depth-3">(</span>org-html--build-pre/postamble <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">postamble</span> info<span class="rainbow-delimiters-depth-3">)</span>
         <span class="comment-delimiter">;; </span><span class="comment">Possibly use the Klipse library live code blocks.
</span>         <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> info <span class="builtin">:html-klipsify-src</span><span class="rainbow-delimiters-depth-1">)</span>
           <span class="rainbow-delimiters-depth-1">(</span><span class="constant">concat</span> <span class="string">"&lt;script&gt;"</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> info <span class="builtin">:html-klipse-selection-script</span><span class="rainbow-delimiters-depth-2">)</span>
                   <span class="string">"&lt;/script&gt;&lt;script src=\""</span>
                   org-html-klipse-js
                   <span class="string">"\"&gt;&lt;/script&gt;&lt;link rel=\"stylesheet\" type=\"text/css\" href=\""</span>
                   org-html-klipse-css <span class="string">"\"/&gt;"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
         <span class="comment-delimiter">;; </span><span class="comment">Closing document.
</span>         <span class="string">"&lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defadvice!</span> org-html-toc-linked <span class="rainbow-delimiters-depth-1">(</span>depth info <span class="type">&amp;optional</span> scope<span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"Build a table of contents.
    
    Just like `</span><span class="doc"><span class="constant">org-html-toc</span></span><span class="doc">', except the header is a link to \"#\".
    
    DEPTH is an integer specifying the depth of the table.  INFO is
    a plist used as a communication channel.  Optional argument SCOPE
    is an element defining the scope of the table.  Return the table
    of contents as a string, or nil if it is empty."</span>
      <span class="builtin">:override</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-html-toc</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>toc-entries
         <span class="rainbow-delimiters-depth-1">(</span><span class="constant">mapcar</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-3">(</span>headline<span class="rainbow-delimiters-depth-3">)</span>
               <span class="rainbow-delimiters-depth-3">(</span><span class="constant">cons</span> <span class="rainbow-delimiters-depth-1">(</span>org-html--format-toc-headline headline info<span class="rainbow-delimiters-depth-1">)</span>
                 <span class="rainbow-delimiters-depth-1">(</span>org-export-get-relative-level headline info<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
             <span class="rainbow-delimiters-depth-2">(</span>org-export-collect-headlines info depth scope<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">when</span> toc-entries
          <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>toc <span class="rainbow-delimiters-depth-3">(</span><span class="constant">concat</span> <span class="string">"&lt;div id=\"text-table-of-contents\"&gt;"</span>
                 <span class="rainbow-delimiters-depth-1">(</span>org-html--toc-text toc-entries<span class="rainbow-delimiters-depth-1">)</span>
                 <span class="string">"&lt;/div&gt;\n"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
        <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> scope toc
          <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>outer-tag <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-3">(</span>org-html--html5-fancy-p info<span class="rainbow-delimiters-depth-3">)</span>
                       <span class="string">"nav"</span>
                     <span class="string">"div"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
            <span class="rainbow-delimiters-depth-3">(</span><span class="constant">concat</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">format</span> <span class="string">"&lt;%s id=\"table-of-contents\"&gt;\n"</span> outer-tag<span class="rainbow-delimiters-depth-1">)</span>
                <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="constant">top-level</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> info <span class="builtin">:html-toplevel-hlevel</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                  <span class="rainbow-delimiters-depth-2">(</span><span class="constant">format</span> <span class="string">"&lt;h%d&gt;&lt;a href=\"#\" style=\"color:inherit; text-decoration: none;\"&gt;%s&lt;/a&gt;&lt;/h%d&gt;\n"</span>
                      top-level
                      <span class="rainbow-delimiters-depth-3">(</span>org-html--translate <span class="string">"Table of Contents"</span> info<span class="rainbow-delimiters-depth-3">)</span>
                      top-level<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                toc
                <span class="rainbow-delimiters-depth-1">(</span><span class="constant">format</span> <span class="string">"&lt;/%s&gt;\n"</span> outer-tag<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-html-meta-tags-fancy</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">info</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"Use the INFO plist to construct the meta tags, as described in `</span><span class="doc"><span class="constant">org-html-meta-tags</span></span><span class="doc">'."</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>title <span class="rainbow-delimiters-depth-1">(</span>org-html-plain-text
                    <span class="rainbow-delimiters-depth-2">(</span>org-element-interpret-data <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> info <span class="builtin">:title</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span> info<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
            <span class="rainbow-delimiters-depth-3">(</span>author <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> info <span class="builtin">:with-author</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>auth <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> info <span class="builtin">:author</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                           <span class="comment-delimiter">;; </span><span class="comment">Return raw Org syntax.
</span>                           <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">and</span> auth <span class="rainbow-delimiters-depth-1">(</span>org-html-plain-text
                                      <span class="rainbow-delimiters-depth-2">(</span>org-element-interpret-data auth<span class="rainbow-delimiters-depth-2">)</span> info<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">list</span>
         <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-1">(</span>org-string-nw-p author<span class="rainbow-delimiters-depth-1">)</span>
           <span class="rainbow-delimiters-depth-1">(</span><span class="constant">list</span> <span class="string">"name"</span> <span class="string">"author"</span> author<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
         <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-1">(</span>org-string-nw-p <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> info <span class="builtin">:description</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
           <span class="rainbow-delimiters-depth-1">(</span><span class="constant">list</span> <span class="string">"name"</span> <span class="string">"description"</span>
                 <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> info <span class="builtin">:description</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
         <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"name"</span> <span class="string">"generator"</span> <span class="string">"org mode"</span><span class="rainbow-delimiters-depth-3">)</span>
         <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"name"</span> <span class="string">"theme-color"</span> <span class="string">"#77aa99"</span><span class="rainbow-delimiters-depth-3">)</span>
         <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"property"</span> <span class="string">"og:type"</span> <span class="string">"article"</span><span class="rainbow-delimiters-depth-3">)</span>
         <span class="rainbow-delimiters-depth-3">(</span><span class="constant">list</span> <span class="string">"property"</span> <span class="string">"og:title"</span> title<span class="rainbow-delimiters-depth-3">)</span>
         <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>subtitle <span class="rainbow-delimiters-depth-3">(</span>org-export-data <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> info <span class="builtin">:subtitle</span><span class="rainbow-delimiters-depth-1">)</span> info<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
           <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-2">(</span>org-string-nw-p subtitle<span class="rainbow-delimiters-depth-2">)</span>
             <span class="rainbow-delimiters-depth-2">(</span><span class="constant">list</span> <span class="string">"property"</span> <span class="string">"og:description"</span> subtitle<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
         <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"property"</span> <span class="string">"og:image"</span> <span class="string">"https://tecosaur.com/resources/org/nib.png"</span><span class="rainbow-delimiters-depth-3">)</span>
         <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"property"</span> <span class="string">"og:image:type"</span> <span class="string">"image/png"</span><span class="rainbow-delimiters-depth-3">)</span>
         <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"property"</span> <span class="string">"og:image:width"</span> <span class="string">"200"</span><span class="rainbow-delimiters-depth-3">)</span>
         <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"property"</span> <span class="string">"og:image:height"</span> <span class="string">"200"</span><span class="rainbow-delimiters-depth-3">)</span>
         <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"property"</span> <span class="string">"og:image:alt"</span> <span class="string">"Green fountain pen nib"</span><span class="rainbow-delimiters-depth-3">)</span>
         <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-1">(</span>org-string-nw-p author<span class="rainbow-delimiters-depth-1">)</span>
           <span class="rainbow-delimiters-depth-1">(</span><span class="constant">list</span> <span class="string">"property"</span> <span class="string">"og:article:author:first_name"</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">car</span> <span class="rainbow-delimiters-depth-3">(</span>s-split-up-to <span class="string">" "</span> author <span class="highlight-numbers-number">2</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
         <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-2">(</span>org-string-nw-p author<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span>s-contains-p <span class="string">" "</span> author<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
           <span class="rainbow-delimiters-depth-1">(</span><span class="constant">list</span> <span class="string">"property"</span> <span class="string">"og:article:author:last_name"</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">cadr</span> <span class="rainbow-delimiters-depth-3">(</span>s-split-up-to <span class="string">" "</span> author <span class="highlight-numbers-number">2</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
         <span class="rainbow-delimiters-depth-3">(</span><span class="constant">list</span> <span class="string">"property"</span> <span class="string">"og:article:published_time"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">format-time-string</span> <span class="string">"%FT%T%z"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">unless</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">functionp</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-html-meta-tags-default</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">defalias</span> <span class="highlight-quoted-quote">'</span><span class="function-name">org-html-meta-tags-default</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">ignore</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> org-html-meta-tags <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-html-meta-tags-fancy</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> org-html-style-plain org-html-style-default
          org-html-htmlize-output-type <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">css</span>
          org-html-doctype <span class="string">"html5"</span>
          org-html-html5-fancy t<span class="rainbow-delimiters-depth-3">)</span>
    
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-html-reload-fancy-style</span> <span class="rainbow-delimiters-depth-1">()</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">interactive</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> org-html-style-fancy
            <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span> <span class="rainbow-delimiters-depth-3">(</span>f-read-text <span class="rainbow-delimiters-depth-1">(</span><span class="constant">expand-file-name</span> <span class="string">"misc/org-export-header.html"</span> <span class="variable-name">doom-private-dir</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                    <span class="string">"&lt;script&gt;\n"</span>
                    <span class="rainbow-delimiters-depth-3">(</span>f-read-text <span class="rainbow-delimiters-depth-1">(</span><span class="constant">expand-file-name</span> <span class="string">"misc/org-css/main.js"</span> <span class="variable-name">doom-private-dir</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                    <span class="string">"&lt;/script&gt;\n&lt;style&gt;\n"</span>
                    <span class="rainbow-delimiters-depth-3">(</span>f-read-text <span class="rainbow-delimiters-depth-1">(</span><span class="constant">expand-file-name</span> <span class="string">"misc/org-css/main.css"</span> <span class="variable-name">doom-private-dir</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                    <span class="string">"&lt;/style&gt;"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> org-fancy-html-export-mode
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> org-html-style-default org-html-style-fancy<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span>org-html-reload-fancy-style<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defvar</span> <span class="variable-name">org-html-export-collapsed</span> nil<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">eval</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-1">(</span>cl-pushnew <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span><span class="builtin">:collapsed</span> <span class="string">"COLLAPSED"</span> <span class="string">"collapsed"</span> org-html-export-collapsed t<span class="rainbow-delimiters-depth-2">)</span>
                       <span class="rainbow-delimiters-depth-2">(</span>org-export-backend-options <span class="rainbow-delimiters-depth-3">(</span>org-export-get-backend <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">html</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">add-to-list</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-default-properties</span> <span class="string">"EXPORT_COLLAPSED"</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defadvice!</span> org-html-src-block-collapsable <span class="rainbow-delimiters-depth-1">(</span>orig-fn src-block contents info<span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"Wrap the usual &lt;pre&gt; block in a &lt;details&gt;"</span>
      <span class="builtin">:around</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-html-src-block</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">not</span> org-fancy-html-export-mode<span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">bound-and-true-p</span> +org-msg-currently-exporting<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span><span class="constant">funcall</span> orig-fn src-block contents info<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>properties <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">cadr</span> src-block<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
               <span class="rainbow-delimiters-depth-1">(</span>lang <span class="rainbow-delimiters-depth-2">(</span>mode-name-to-lang-name
                      <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> properties <span class="builtin">:language</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
               <span class="rainbow-delimiters-depth-1">(</span>name <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> properties <span class="builtin">:name</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
               <span class="rainbow-delimiters-depth-1">(</span>ref <span class="rainbow-delimiters-depth-2">(</span>org-export-get-reference src-block info<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
               <span class="rainbow-delimiters-depth-1">(</span>collapsed-p <span class="rainbow-delimiters-depth-2">(</span><span class="constant">member</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-1">(</span>org-export-read-attribute <span class="builtin">:attr_html</span> src-block <span class="builtin">:collapsed</span><span class="rainbow-delimiters-depth-1">)</span>
                                        <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> info <span class="builtin">:collapsed</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                                    <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"y"</span> <span class="string">"yes"</span> <span class="string">"t"</span> t <span class="string">"true"</span> <span class="string">"all"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span>
           <span class="string">"&lt;details id='%s' class='code'%s&gt;&lt;summary%s&gt;%s&lt;/summary&gt;
    &lt;div class='gutter'&gt;
    &lt;a href='#%s'&gt;#&lt;/a&gt;
    &lt;button title='Copy to clipboard' onclick='copyPreToClipbord(this)'&gt;&#226;&#142;&#152;&lt;/button&gt;\
    &lt;/div&gt;
    %s
    &lt;/details&gt;"</span>
           ref
           <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> collapsed-p <span class="string">""</span> <span class="string">" open"</span><span class="rainbow-delimiters-depth-1">)</span>
           <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> name <span class="string">" class='named'"</span> <span class="string">""</span><span class="rainbow-delimiters-depth-1">)</span>
           <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">not</span> name<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span> <span class="string">"&lt;span class='lang'&gt;"</span> lang <span class="string">"&lt;/span&gt;"</span><span class="rainbow-delimiters-depth-2">)</span>
             <span class="rainbow-delimiters-depth-2">(</span><span class="constant">format</span> <span class="string">"&lt;span class='name'&gt;%s&lt;/span&gt;&lt;span class='lang'&gt;%s&lt;/span&gt;"</span> name lang<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
           ref
           <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> name
               <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">replace-regexp-in-string</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"&lt;pre</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string"> class=\"[</span><span class="string"><span class="negation-char">^</span></span><span class="string">\"]+\"</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">? id=\"%s\"&gt;"</span> ref<span class="rainbow-delimiters-depth-3">)</span> <span class="string">"&lt;pre\\1&gt;"</span>
                                         <span class="rainbow-delimiters-depth-3">(</span><span class="constant">funcall</span> orig-fn src-block contents info<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
             <span class="rainbow-delimiters-depth-2">(</span><span class="constant">funcall</span> orig-fn src-block contents info<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">mode-name-to-lang-name</span> <span class="rainbow-delimiters-depth-1">(</span>mode<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">cadr</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">assoc</span> mode
                       <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span><span class="string">"asymptote"</span> <span class="string">"Asymptote"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"awk"</span> <span class="string">"Awk"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"C"</span> <span class="string">"C"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"clojure"</span> <span class="string">"Clojure"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"css"</span> <span class="string">"CSS"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"D"</span> <span class="string">"D"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"ditaa"</span> <span class="string">"ditaa"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"dot"</span> <span class="string">"Graphviz"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"calc"</span> <span class="string">"Emacs Calc"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"emacs-lisp"</span> <span class="string">"Emacs Lisp"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"fortran"</span> <span class="string">"Fortran"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"gnuplot"</span> <span class="string">"gnuplot"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"haskell"</span> <span class="string">"Haskell"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"hledger"</span> <span class="string">"hledger"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"java"</span> <span class="string">"Java"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"js"</span> <span class="string">"Javascript"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"latex"</span> <span class="string">"LaTeX"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"ledger"</span> <span class="string">"Ledger"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"lisp"</span> <span class="string">"Lisp"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"lilypond"</span> <span class="string">"Lilypond"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"lua"</span> <span class="string">"Lua"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"matlab"</span> <span class="string">"MATLAB"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"mscgen"</span> <span class="string">"Mscgen"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"ocaml"</span> <span class="string">"Objective Caml"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"octave"</span> <span class="string">"Octave"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"org"</span> <span class="string">"Org mode"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"oz"</span> <span class="string">"OZ"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"plantuml"</span> <span class="string">"Plantuml"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"processing"</span> <span class="string">"Processing.js"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"python"</span> <span class="string">"Python"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"R"</span> <span class="string">"R"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"ruby"</span> <span class="string">"Ruby"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"sass"</span> <span class="string">"Sass"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"scheme"</span> <span class="string">"Scheme"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"screen"</span> <span class="string">"Gnu Screen"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"sed"</span> <span class="string">"Sed"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"sh"</span> <span class="string">"shell"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"sql"</span> <span class="string">"SQL"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"sqlite"</span> <span class="string">"SQLite"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"forth"</span> <span class="string">"Forth"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"io"</span> <span class="string">"IO"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"J"</span> <span class="string">"J"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"makefile"</span> <span class="string">"Makefile"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"maxima"</span> <span class="string">"Maxima"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"perl"</span> <span class="string">"Perl"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"picolisp"</span> <span class="string">"Pico Lisp"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"scala"</span> <span class="string">"Scala"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"shell"</span> <span class="string">"Shell Script"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"ebnf2ps"</span> <span class="string">"ebfn2ps"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"cpp"</span> <span class="string">"C++"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"abc"</span> <span class="string">"ABC"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"coq"</span> <span class="string">"Coq"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"groovy"</span> <span class="string">"Groovy"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"bash"</span> <span class="string">"bash"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"csh"</span> <span class="string">"csh"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"ash"</span> <span class="string">"ash"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"dash"</span> <span class="string">"dash"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"ksh"</span> <span class="string">"ksh"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"mksh"</span> <span class="string">"mksh"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"posh"</span> <span class="string">"posh"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"ada"</span> <span class="string">"Ada"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"asm"</span> <span class="string">"Assembler"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"caml"</span> <span class="string">"Caml"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"delphi"</span> <span class="string">"Delphi"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"html"</span> <span class="string">"HTML"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"idl"</span> <span class="string">"IDL"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"mercury"</span> <span class="string">"Mercury"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"metapost"</span> <span class="string">"MetaPost"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"modula-2"</span> <span class="string">"Modula-2"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"pascal"</span> <span class="string">"Pascal"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"ps"</span> <span class="string">"PostScript"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"prolog"</span> <span class="string">"Prolog"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"simula"</span> <span class="string">"Simula"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"tcl"</span> <span class="string">"tcl"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"tex"</span> <span class="string">"LaTeX"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"plain-tex"</span> <span class="string">"TeX"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"verilog"</span> <span class="string">"Verilog"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"vhdl"</span> <span class="string">"VHDL"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"xml"</span> <span class="string">"XML"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"nxml"</span> <span class="string">"XML"</span><span class="rainbow-delimiters-depth-2">)</span>
                         <span class="rainbow-delimiters-depth-2">(</span><span class="string">"conf"</span> <span class="string">"Configuration File"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
          mode<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-html-block-collapsable</span> <span class="rainbow-delimiters-depth-1">(</span>orig-fn block contents info<span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"Wrap the usual block in a &lt;details&gt;"</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">not</span> org-fancy-html-export-mode<span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">bound-and-true-p</span> +org-msg-currently-exporting<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span><span class="constant">funcall</span> orig-fn block contents info<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>ref <span class="rainbow-delimiters-depth-2">(</span>org-export-get-reference block info<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
              <span class="rainbow-delimiters-depth-1">(</span>type <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">pcase</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">car</span> block<span class="rainbow-delimiters-depth-3">)</span>
                      <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">property-drawer</span> <span class="string">"Properties"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
              <span class="rainbow-delimiters-depth-1">(</span>collapsed-default <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">pcase</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">car</span> block<span class="rainbow-delimiters-depth-3">)</span>
                                   <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">property-drawer</span> t<span class="rainbow-delimiters-depth-3">)</span>
                                   <span class="rainbow-delimiters-depth-3">(</span>_ nil<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
              <span class="rainbow-delimiters-depth-1">(</span>collapsed-value <span class="rainbow-delimiters-depth-2">(</span>org-export-read-attribute <span class="builtin">:attr_html</span> block <span class="builtin">:collapsed</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
              <span class="rainbow-delimiters-depth-1">(</span>collapsed-p <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">member</span> <span class="rainbow-delimiters-depth-1">(</span>org-export-read-attribute <span class="builtin">:attr_html</span> block <span class="builtin">:collapsed</span><span class="rainbow-delimiters-depth-1">)</span>
                                       <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-1">(</span><span class="string">"y"</span> <span class="string">"yes"</span> <span class="string">"t"</span> t <span class="string">"true"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                               <span class="rainbow-delimiters-depth-3">(</span><span class="constant">member</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> info <span class="builtin">:collapsed</span><span class="rainbow-delimiters-depth-1">)</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-1">(</span><span class="string">"all"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span>
           <span class="string">"&lt;details id='%s' class='code'%s&gt;
    &lt;summary%s&gt;%s&lt;/summary&gt;
    &lt;div class='gutter'&gt;\
    &lt;a href='#%s'&gt;#&lt;/a&gt;
    &lt;button title='Copy to clipboard' onclick='copyPreToClipbord(this)'&gt;&#226;&#142;&#152;&lt;/button&gt;\
    &lt;/div&gt;
    %s\n
    &lt;/details&gt;"</span>
           ref
           <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> collapsed-p collapsed-default<span class="rainbow-delimiters-depth-2">)</span> <span class="string">""</span> <span class="string">" open"</span><span class="rainbow-delimiters-depth-1">)</span>
           <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> type <span class="string">" class='named'"</span> <span class="string">""</span><span class="rainbow-delimiters-depth-1">)</span>
           <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> type <span class="rainbow-delimiters-depth-2">(</span><span class="constant">format</span> <span class="string">"&lt;span class='type'&gt;%s&lt;/span&gt;"</span> type<span class="rainbow-delimiters-depth-2">)</span> <span class="string">""</span><span class="rainbow-delimiters-depth-1">)</span>
           ref
           <span class="rainbow-delimiters-depth-1">(</span><span class="constant">funcall</span> orig-fn block contents info<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">advice-add</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-html-example-block</span>   <span class="builtin">:around</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-html-block-collapsable</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">advice-add</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-html-fixed-width</span>     <span class="builtin">:around</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-html-block-collapsable</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">advice-add</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-html-property-drawer</span> <span class="builtin">:around</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-html-block-collapsable</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">htmlize-before-hook</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">highlight-numbers--turn-on</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defadvice!</span> org-html-table-wrapped <span class="rainbow-delimiters-depth-1">(</span>orig-fn table contents info<span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"Wrap the usual &lt;table&gt; in a &lt;div&gt;"</span>
      <span class="builtin">:around</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-html-table</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">not</span> org-fancy-html-export-mode<span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">bound-and-true-p</span> +org-msg-currently-exporting<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span><span class="constant">funcall</span> orig-fn table contents info<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>name <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">cadr</span> table<span class="rainbow-delimiters-depth-3">)</span> <span class="builtin">:name</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
               <span class="rainbow-delimiters-depth-1">(</span>ref <span class="rainbow-delimiters-depth-2">(</span>org-export-get-reference table info<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"&lt;div id='%s' class='table'&gt;
    &lt;div class='gutter'&gt;&lt;a href='#%s'&gt;#&lt;/a&gt;&lt;/div&gt;
    &lt;div class='tabular'&gt;
    %s
    &lt;/div&gt;\
    &lt;/div&gt;"</span>
                  ref ref
                  <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> name
                      <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">replace-regexp-in-string</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"&lt;table id=\"%s\""</span> ref<span class="rainbow-delimiters-depth-3">)</span> <span class="string">"&lt;table"</span>
                                                <span class="rainbow-delimiters-depth-3">(</span><span class="constant">funcall</span> orig-fn table contents info<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                    <span class="rainbow-delimiters-depth-2">(</span><span class="constant">funcall</span> orig-fn table contents info<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defadvice!</span> org-html--format-toc-headline-colapseable <span class="rainbow-delimiters-depth-1">(</span>orig-fn headline info<span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"Add a label and checkbox to `</span><span class="doc"><span class="constant">org-html--format-toc-headline</span></span><span class="doc">'s usual output,
    to allow the TOC to be a collapseable tree."</span>
      <span class="builtin">:around</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-html--format-toc-headline</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">not</span> org-fancy-html-export-mode<span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">bound-and-true-p</span> +org-msg-currently-exporting<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span><span class="constant">funcall</span> orig-fn headline info<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>id <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-3">(</span>org-element-property <span class="builtin">:CUSTOM_ID</span> headline<span class="rainbow-delimiters-depth-3">)</span>
                      <span class="rainbow-delimiters-depth-3">(</span>org-export-get-reference headline info<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"&lt;input type='checkbox' id='toc--%s'/&gt;&lt;label for='toc--%s'&gt;%s&lt;/label&gt;"</span>
                  id id <span class="rainbow-delimiters-depth-1">(</span><span class="constant">funcall</span> orig-fn headline info<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defadvice!</span> org-html--toc-text-stripped-leaves <span class="rainbow-delimiters-depth-1">(</span>orig-fn toc-entries<span class="rainbow-delimiters-depth-1">)</span>
      <span class="doc">"Remove label"</span>
      <span class="builtin">:around</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-html--toc-text</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">not</span> org-fancy-html-export-mode<span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">bound-and-true-p</span> +org-msg-currently-exporting<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span><span class="constant">funcall</span> orig-fn toc-entries<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">replace-regexp-in-string</span> <span class="string">"&lt;input [</span><span class="string"><span class="negation-char">^</span></span><span class="string">&gt;]+&gt;&lt;label [</span><span class="string"><span class="negation-char">^</span></span><span class="string">&gt;]+&gt;</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">.+?</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">&lt;/label&gt;&lt;/li&gt;"</span> <span class="string">"\\1&lt;/li&gt;"</span>
                                  <span class="rainbow-delimiters-depth-3">(</span><span class="constant">funcall</span> orig-fn toc-entries<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> org-html-text-markup-alist
          <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>bold . <span class="string">"&lt;b&gt;%s&lt;/b&gt;"</span><span class="rainbow-delimiters-depth-2">)</span>
            <span class="rainbow-delimiters-depth-2">(</span>code . <span class="string">"&lt;code&gt;%s&lt;/code&gt;"</span><span class="rainbow-delimiters-depth-2">)</span>
            <span class="rainbow-delimiters-depth-2">(</span>italic . <span class="string">"&lt;i&gt;%s&lt;/i&gt;"</span><span class="rainbow-delimiters-depth-2">)</span>
            <span class="rainbow-delimiters-depth-2">(</span>strike-through . <span class="string">"&lt;del&gt;%s&lt;/del&gt;"</span><span class="rainbow-delimiters-depth-2">)</span>
            <span class="rainbow-delimiters-depth-2">(</span>underline . <span class="string">"&lt;span class=\"underline\"&gt;%s&lt;/span&gt;"</span><span class="rainbow-delimiters-depth-2">)</span>
            <span class="rainbow-delimiters-depth-2">(</span>verbatim . <span class="string">"&lt;kbd&gt;%s&lt;/kbd&gt;"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">appendq!</span> org-html-checkbox-types
              <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>html-span
                 <span class="rainbow-delimiters-depth-3">(</span>on . <span class="string">"&lt;span class='checkbox'&gt;&lt;/span&gt;"</span><span class="rainbow-delimiters-depth-3">)</span>
                 <span class="rainbow-delimiters-depth-3">(</span>off . <span class="string">"&lt;span class='checkbox'&gt;&lt;/span&gt;"</span><span class="rainbow-delimiters-depth-3">)</span>
                 <span class="rainbow-delimiters-depth-3">(</span>trans . <span class="string">"&lt;span class='checkbox'&gt;&lt;/span&gt;"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> org-html-checkbox-type <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">html-span</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">org-export-html-headline-anchor</span> <span class="rainbow-delimiters-depth-1">(</span>text backend info<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-3">(</span>org-export-derived-backend-p backend <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">html</span><span class="rainbow-delimiters-depth-3">)</span>
                 org-fancy-html-export-mode<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">unless</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">bound-and-true-p</span> +org-msg-currently-exporting<span class="rainbow-delimiters-depth-3">)</span>
          <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">replace-regexp-in-string</span>
           <span class="string">"&lt;h</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">[0-9]</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string"> id=\"</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">[a-z0-9-]+</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">\"&gt;</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">.*[</span><span class="string"><span class="negation-char">^</span></span><span class="string"> ]</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">&lt;\\/h[0-9]&gt;"</span> <span class="comment-delimiter">; </span><span class="comment">this is quite restrictive, but due to `</span><span class="comment"><span class="constant">org-reference-contraction</span></span><span class="comment">' I can do this
</span>           <span class="string">"&lt;h\\1 id=\"\\2\"&gt;\\3&lt;a aria-hidden=\"true\" href=\"#\\2\"&gt;#&lt;/a&gt; &lt;/h\\1&gt;"</span>
           text<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">add-to-list</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-export-filter-headline-functions</span>
                 <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-export-html-headline-anchor</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="comment-delimiter">;; </span><span class="comment">(setq-default org-html-with-latex `dvisvgm)
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> org-html-mathjax-options
          <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>path <span class="string">"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"</span> <span class="rainbow-delimiters-depth-2">)</span>
            <span class="rainbow-delimiters-depth-2">(</span>scale <span class="string">"1"</span><span class="rainbow-delimiters-depth-2">)</span>
            <span class="rainbow-delimiters-depth-2">(</span>autonumber <span class="string">"ams"</span><span class="rainbow-delimiters-depth-2">)</span>
            <span class="rainbow-delimiters-depth-2">(</span>multlinewidth <span class="string">"85%"</span><span class="rainbow-delimiters-depth-2">)</span>
            <span class="rainbow-delimiters-depth-2">(</span>tagindent <span class="string">".8em"</span><span class="rainbow-delimiters-depth-2">)</span>
            <span class="rainbow-delimiters-depth-2">(</span>tagside <span class="string">"right"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> org-html-mathjax-template
          <span class="string">"&lt;script&gt;
    MathJax = {
      chtml: {
        scale: %SCALE
      },
      svg: {
        scale: %SCALE,
        fontCache: \"global\"
      },
      tex: {
        tags: \"%AUTONUMBER\",
        multlineWidth: \"%MULTLINEWIDTH\",
        tagSide: \"%TAGSIDE\",
        tagIndent: \"%TAGINDENT\"
      }
    };
    &lt;/script&gt;
    &lt;script id=\"MathJax-script\" async
            src=\"%PATH\"&gt;&lt;/script&gt;"</span><span class="rainbow-delimiters-depth-3">)</span>
  <span class="rainbow-delimiters-depth-2">)</span>
  <span class="comment-delimiter">;; </span><span class="comment">org-latex-compilers = ("pdflatex" "xelatex" "lualatex"), which are the possible values for %latex
</span>  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> org-latex-pdf-process <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"latexmk -%latex -shell-escape -interaction=nonstopmode -f -pdf -output-directory=%o %f"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">tec/org-export-latex-filter-acronym</span> <span class="rainbow-delimiters-depth-3">(</span>text backend info<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>the-backend
           <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">cond</span>
            <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>org-export-derived-backend-p backend <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">latex</span><span class="rainbow-delimiters-depth-2">)</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">latex</span><span class="rainbow-delimiters-depth-1">)</span>
            <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>org-export-derived-backend-p backend <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">html</span><span class="rainbow-delimiters-depth-2">)</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">html</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span><span class="variable-name">case-fold-search</span> nil<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> the-backend
        <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">replace-regexp-in-string</span>
         <span class="string">"[;\\\\]?\\b[A-Z][A-Z]+s?"</span>
         <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-1">(</span>all-caps-str<span class="rainbow-delimiters-depth-1">)</span>
           <span class="comment-delimiter">;; </span><span class="comment">only format as acronym if str doesn't start with ";" or "\" (for LaTeX commands)
</span>           <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">cond</span> <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="constant">equal</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">aref</span> all-caps-str <span class="highlight-numbers-number">0</span><span class="rainbow-delimiters-depth-1">)</span> ?\;<span class="rainbow-delimiters-depth-3">)</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">substring</span> all-caps-str <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                 <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="constant">equal</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">aref</span> all-caps-str <span class="highlight-numbers-number">0</span><span class="rainbow-delimiters-depth-1">)</span> ?\\<span class="rainbow-delimiters-depth-3">)</span> all-caps-str<span class="rainbow-delimiters-depth-2">)</span>
                 <span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="constant">equal</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">aref</span> all-caps-str <span class="rainbow-delimiters-depth-2">(</span><span class="constant">-</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">length</span> all-caps-str<span class="rainbow-delimiters-depth-3">)</span> <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span> ?s<span class="rainbow-delimiters-depth-3">)</span>
                  <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">pcase</span> the-backend
                    <span class="rainbow-delimiters-depth-1">(</span><span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">latex</span>
                     <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span> <span class="string">"\\textls*[70]{\\textsc{"</span> <span class="rainbow-delimiters-depth-3">(</span>s-downcase <span class="rainbow-delimiters-depth-1">(</span><span class="constant">substring</span> all-caps-str <span class="highlight-numbers-number">0</span> <span class="highlight-numbers-number">-1</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                             <span class="string">"}\\protect\\scalebox{.91}[.84]{s}}"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                    <span class="rainbow-delimiters-depth-1">(</span><span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">html</span>
                     <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span> <span class="string">"&lt;span class='acr'&gt;"</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">substring</span> all-caps-str <span class="highlight-numbers-number">0</span> <span class="highlight-numbers-number">-1</span><span class="rainbow-delimiters-depth-3">)</span>
                             <span class="string">"&lt;/span&gt;&lt;small&gt;s&lt;/small&gt;"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                 <span class="rainbow-delimiters-depth-2">(</span>t <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">pcase</span> the-backend
                      <span class="rainbow-delimiters-depth-1">(</span><span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">latex</span>
                       <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span> <span class="string">"\\textls*[70]{\\textsc{"</span> <span class="rainbow-delimiters-depth-3">(</span>s-downcase all-caps-str<span class="rainbow-delimiters-depth-3">)</span> <span class="string">"}}"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">html</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span> <span class="string">"&lt;span class='acr'&gt;"</span> all-caps-str <span class="string">"&lt;/span&gt;"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
         text t t<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-to-list</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-export-filter-plain-text-functions</span>
               <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">tec/org-export-latex-filter-acronym</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="comment-delimiter">;; </span><span class="bold"><span class="error">FIXME</span></span><span class="comment"> I want to process headings, but this causes issues ATM,
</span>  <span class="comment-delimiter">;;       </span><span class="comment">specifically it passes (and formats) the entire section contents
</span>  <span class="comment-delimiter">;; </span><span class="comment">(add-to-list 'org-export-filter-headline-functions
</span>  <span class="comment-delimiter">;;              </span><span class="comment">'tec/org-export-latex-filter-acronym)
</span>  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+org-export-latex-fancy-item-checkboxes</span> <span class="rainbow-delimiters-depth-3">(</span>text backend info<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-1">(</span>org-export-derived-backend-p backend <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">latex</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">replace-regexp-in-string</span>
       <span class="string">"\\\\item\\[{$\\\\</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">\\w+</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">$}\\]"</span>
       <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-3">(</span>fullmatch<span class="rainbow-delimiters-depth-3">)</span>
         <span class="rainbow-delimiters-depth-3">(</span><span class="constant">concat</span> <span class="string">"\\\\item["</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">pcase</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">substring</span> fullmatch <span class="highlight-numbers-number">9</span> <span class="highlight-numbers-number">-3</span><span class="rainbow-delimiters-depth-2">)</span> <span class="comment-delimiter">; </span><span class="comment">content of capture group
</span>                               <span class="rainbow-delimiters-depth-2">(</span><span class="string">"square"</span>   <span class="string">"\\\\ifdefined\\\\checkboxUnchecked\\\\checkboxUnchecked\\\\else$\\\\square$\\\\fi"</span>    <span class="rainbow-delimiters-depth-2">)</span>
                               <span class="rainbow-delimiters-depth-2">(</span><span class="string">"boxminus"</span> <span class="string">"\\\\ifdefined\\\\checkboxTransitive\\\\checkboxTransitive\\\\else$\\\\boxminus$\\\\fi"</span><span class="rainbow-delimiters-depth-2">)</span>
                               <span class="rainbow-delimiters-depth-2">(</span><span class="string">"boxtimes"</span> <span class="string">"\\\\ifdefined\\\\checkboxChecked\\\\checkboxChecked\\\\else$\\\\boxtimes$\\\\fi"</span>      <span class="rainbow-delimiters-depth-2">)</span>
                               <span class="rainbow-delimiters-depth-2">(</span>_ <span class="rainbow-delimiters-depth-3">(</span><span class="constant">substring</span> fullmatch <span class="highlight-numbers-number">9</span> <span class="highlight-numbers-number">-3</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span> <span class="string">"]"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
       text<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-to-list</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-export-filter-item-functions</span>
               <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">+org-export-latex-fancy-item-checkboxes</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">after!</span> ox-latex
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">add-to-list</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-latex-classes</span>
                 <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-1">(</span><span class="string">"fancy-article"</span>
                   <span class="string">"\\documentclass{scrartcl}\n
  \\usepackage[T1]{fontenc}\n\
  \\usepackage[osf,largesc,helvratio=0.9]{newpxtext}\n\
  \\usepackage[scale=0.9]{sourcecodepro}\n\
  \\usepackage{bmc-maths}\n\
  
  \\usepackage[activate={true,nocompatibility},final,tracking=true,kerning=true,spacing=true,factor=2000]{microtype}\n\
  \\usepackage{xcolor}\n\
  \\usepackage{booktabs}
  
  \\usepackage{subcaption}
  \\usepackage[hypcap=true]{caption}
  \\setkomafont{caption}{\\sffamily\\small}
  \\setkomafont{captionlabel}{\\upshape\\bfseries}
  \\captionsetup{justification=raggedright,singlelinecheck=true}
  \\setcapindent{0pt}
  
  \\setlength{\\parskip}{\\baselineskip}\n\
  \\setlength{\\parindent}{0pt}\n\
  
  \\AtBeginEnvironment{quote}{\\itshape}
  
  \\usepackage{pifont}
  \\newcommand{\\checkboxUnchecked}{$\\square$}
  \\newcommand{\\checkboxTransitive}{\\rlap{\\raisebox{-0.1ex}{\\hspace{0.35ex}\\Large\\textbf -}}$\\square$}
  \\newcommand{\\checkboxChecked}{\\rlap{\\raisebox{0.2ex}{\\hspace{0.35ex}\\scriptsize \\ding{52}}}$\\square$}
  
  % args = #1 Name, #2 Colour, #3 Ding, #4 Label
  \\newcommand{\\defsimplebox}[4]{%
    \\definecolor{#1}{HTML}{#2}
    \\newenvironment{#1}
    {%
      \\par \\vspace{-0.7\\baselineskip}%
      \\textcolor{#1}{#3} \\textcolor{#1}{\\textbf{#4}}%
      \\vspace{-0.8\\baselineskip}
      \\begin{addmargin}[1em]{1em}
    }{%
      \\end{addmargin}
      \\vspace{-0.5\\baselineskip}
    }%
  }
  \\defsimplebox{warning}{e66100}{\\ding{68}}{Warning}
  \\defsimplebox{info}{3584e4}{\\ding{68}}{Information}
  \\defsimplebox{success}{26a269}{\\ding{68}}{\\vspace{-\\baselineskip}}
  \\defsimplebox{error}{c01c28}{\\ding{68}}{Important}
  "</span>
                   <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\section{%s}"</span> . <span class="string">"\\section*{%s}"</span><span class="rainbow-delimiters-depth-2">)</span>
                   <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\subsection{%s}"</span> . <span class="string">"\\subsection*{%s}"</span><span class="rainbow-delimiters-depth-2">)</span>
                   <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\subsubsection{%s}"</span> . <span class="string">"\\subsubsection*{%s}"</span><span class="rainbow-delimiters-depth-2">)</span>
                   <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\paragraph{%s}"</span> . <span class="string">"\\paragraph*{%s}"</span><span class="rainbow-delimiters-depth-2">)</span>
                   <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\subparagraph{%s}"</span> . <span class="string">"\\subparagraph*{%s}"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">add-to-list</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-latex-classes</span>
                 <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-1">(</span><span class="string">"blank"</span>
                   <span class="string">"[NO-DEFAULT-PACKAGES]
                 [NO-PACKAGES]
                 [EXTRA]"</span>
                   <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\section{%s}"</span> . <span class="string">"\\section*{%s}"</span><span class="rainbow-delimiters-depth-2">)</span>
                   <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\subsection{%s}"</span> . <span class="string">"\\subsection*{%s}"</span><span class="rainbow-delimiters-depth-2">)</span>
                   <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\subsubsection{%s}"</span> . <span class="string">"\\subsubsection*{%s}"</span><span class="rainbow-delimiters-depth-2">)</span>
                   <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\paragraph{%s}"</span> . <span class="string">"\\paragraph*{%s}"</span><span class="rainbow-delimiters-depth-2">)</span>
                   <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\subparagraph{%s}"</span> . <span class="string">"\\subparagraph*{%s}"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">add-to-list</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-latex-classes</span>
                 <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-1">(</span><span class="string">"bmc-article"</span>
                   <span class="string">"\\documentclass[article,code,maths]{bmc}
                 [NO-DEFAULT-PACKAGES]
                 [NO-PACKAGES]
                 [EXTRA]"</span>
                   <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\section{%s}"</span> . <span class="string">"\\section*{%s}"</span><span class="rainbow-delimiters-depth-2">)</span>
                   <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\subsection{%s}"</span> . <span class="string">"\\subsection*{%s}"</span><span class="rainbow-delimiters-depth-2">)</span>
                   <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\subsubsection{%s}"</span> . <span class="string">"\\subsubsection*{%s}"</span><span class="rainbow-delimiters-depth-2">)</span>
                   <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\paragraph{%s}"</span> . <span class="string">"\\paragraph*{%s}"</span><span class="rainbow-delimiters-depth-2">)</span>
                   <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\subparagraph{%s}"</span> . <span class="string">"\\subparagraph*{%s}"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">add-to-list</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-latex-classes</span>
                 <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-1">(</span><span class="string">"bmc"</span>
                   <span class="string">"\\documentclass[code,maths]{bmc}
                 [NO-DEFAULT-PACKAGES]
                 [NO-PACKAGES]
                 [EXTRA]"</span>
                   <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\chapter{%s}"</span> . <span class="string">"\\chapter*{%s}"</span><span class="rainbow-delimiters-depth-2">)</span>
                   <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\section{%s}"</span> . <span class="string">"\\section*{%s}"</span><span class="rainbow-delimiters-depth-2">)</span>
                   <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\subsection{%s}"</span> . <span class="string">"\\subsection*{%s}"</span><span class="rainbow-delimiters-depth-2">)</span>
                   <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\subsubsection{%s}"</span> . <span class="string">"\\subsubsection*{%s}"</span><span class="rainbow-delimiters-depth-2">)</span>
                   <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\paragraph{%s}"</span> . <span class="string">"\\paragraph*{%s}"</span><span class="rainbow-delimiters-depth-2">)</span>
                   <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\subparagraph{%s}"</span> . <span class="string">"\\subparagraph*{%s}"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> org-latex-default-class <span class="string">"fancy-article"</span>
        org-latex-tables-booktabs t
        org-latex-hyperref-template <span class="string">"
  \\colorlet{greenyblue}{blue!70!green}
  \\colorlet{blueygreen}{blue!40!green}
  \\providecolor{link}{named}{greenyblue}
  \\providecolor{cite}{named}{blueygreen}
  \\hypersetup{
    pdfauthor={%a},
    pdftitle={%t},
    pdfkeywords={%k},
    pdfsubject={%d},
    pdfcreator={%c},
    pdflang={%L},
    breaklinks=true,
    colorlinks=true,
    linkcolor=,
    urlcolor=link,
    citecolor=cite\n}
  \\urlstyle{same}
  "</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">org-latex-universal-preamble</span> <span class="string">"
  \\usepackage[main,include]{embedall}
  \\IfFileExists{./\\jobname.org}{\\embedfile[desc=The original file]{\\jobname.org}}{}
  "</span>
    <span class="doc">"Preamble to be included in every export."</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">org-latex-conditional-preambles</span>
    <span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>t . org-latex-universal-preamble<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="string">"\\[\\[</span><span class="string"><span class="constant">file:.*\\.svg\\</span></span><span class="string">]\\]"</span> . <span class="string">"\\usepackage{svg}"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Snippets which are conditionally included in the preamble of a LaTeX export.
  
  Alist where when the car results in a non-nil value, the cdr is inserted in
  the preamble.  The car may be a:
  - string, which is used as a regex search in the buffer
  - symbol, the value of which used
  - function, the result of the function is used
  
  The cdr may be a:
  - string, which is inserted without processing
  - symbol, the value of which is inserted
  - function, the result of which is inserted"</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defadvice!</span> org-latex-header-smart-preamble <span class="rainbow-delimiters-depth-3">(</span>orig-fn tpl def-pkg pkg snippets-p <span class="type">&amp;optional</span> extra<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Dynamically insert preamble content based on `</span><span class="doc"><span class="constant">org-latex-conditional-preambles</span></span><span class="doc">'."</span>
    <span class="builtin">:around</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-splice-latex-header</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>header <span class="rainbow-delimiters-depth-3">(</span><span class="constant">funcall</span> orig-fn tpl def-pkg pkg snippets-p extra<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> snippets-p header
        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span> header
                <span class="rainbow-delimiters-depth-3">(</span><span class="constant">mapconcat</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-2">(</span>term-preamble<span class="rainbow-delimiters-depth-2">)</span>
                             <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">pcase</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">car</span> term-preamble<span class="rainbow-delimiters-depth-1">)</span>
                                     <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>pred stringp<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">save-excursion</span>
                                                         <span class="rainbow-delimiters-depth-3">(</span><span class="constant">goto-char</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">point-min</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                                                         <span class="rainbow-delimiters-depth-3">(</span><span class="constant">search-forward-regexp</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">car</span> term-preamble<span class="rainbow-delimiters-depth-1">)</span> nil t<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                                     <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>pred functionp<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">funcall</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">car</span> term-preamble<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                                     <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>pred symbolp<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">symbol-value</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">car</span> term-preamble<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                                     <span class="rainbow-delimiters-depth-1">(</span>_ <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">user-error</span> <span class="string">"org-latex-conditional-preambles key %s unable to be used"</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">car</span> term-preamble<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                               <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">pcase</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">cdr</span> term-preamble<span class="rainbow-delimiters-depth-1">)</span>
                                 <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>pred stringp<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">cdr</span> term-preamble<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                                 <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>pred functionp<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">funcall</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">cdr</span> term-preamble<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                                 <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>pred symbolp<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">symbol-value</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">cdr</span> term-preamble<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                                 <span class="rainbow-delimiters-depth-1">(</span>_ <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">user-error</span> <span class="string">"org-latex-conditional-preambles value %s unable to be used"</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">cdr</span> term-preamble<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                           org-latex-conditional-preambles
                           <span class="string">"\n"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> org-latex-listings <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">engraved</span><span class="rainbow-delimiters-depth-2">)</span> <span class="comment-delimiter">; </span><span class="bold"><span class="success">NOTE</span></span><span class="comment"> non-standard value
</span>  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defadvice!</span> org-latex-src-block-engraved <span class="rainbow-delimiters-depth-3">(</span>orig-fn src-block contents info<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Like `</span><span class="doc"><span class="constant">org-latex-src-block</span></span><span class="doc">', but supporting an engraved backend"</span>
    <span class="builtin">:around</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-latex-src-block</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">eq</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">engraved</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> info <span class="builtin">:latex-listings</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
        <span class="rainbow-delimiters-depth-1">(</span>org-latex-scr-block--engraved src-block contents info<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">funcall</span> orig-fn src-block contents info<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defadvice!</span> org-latex-inline-src-block-engraved <span class="rainbow-delimiters-depth-3">(</span>orig-fn inline-src-block contents info<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Like `</span><span class="doc"><span class="constant">org-latex-inline-src-block</span></span><span class="doc">', but supporting an engraved backend"</span>
    <span class="builtin">:around</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-latex-inline-src-block</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">eq</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">engraved</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> info <span class="builtin">:latex-listings</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
        <span class="rainbow-delimiters-depth-1">(</span>org-latex-inline-scr-block--engraved inline-src-block contents info<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">funcall</span> orig-fn src-block contents info<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> org-latex-engraved-code-preamble <span class="string">"
  \\usepackage{fvextra}
  \\fvset{
    commandchars=\\\\\\{\\},
    highlightcolor=white!95!black!80!blue,
    breaklines=true,
    breaksymbol=\\color{white!60!black}\\tiny\\ensuremath{\\hookrightarrow}}
  \\renewcommand\\theFancyVerbLine{\\footnotesize\\color{black!40!white}\\arabic{FancyVerbLine}}
  
  % </span><span class="bold"><span class="warning">TODO</span></span><span class="string"> have code boxes keep line vertical alignment
  \\usepackage[breakable,xparse]{tcolorbox}
  \\DeclareTColorBox[]{Code}{o}%
  {colback=white!97!black, colframe=white!94!black,
    fontupper=\\color{EFD}\\footnotesize,
    IfNoValueTF={#1}%
    {boxsep=2pt, arc=2.5pt, outer arc=2.5pt,
      boxrule=0.5pt, left=2pt}%
    {boxsep=2.5pt, arc=0pt, outer arc=0pt,
      boxrule=0pt, leftrule=1.5pt, left=0.5pt},
    right=2pt, top=1pt, bottom=0.5pt,
    breakable}
  "</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-to-list</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-latex-conditional-preambles</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"#\\+BEGIN_SRC</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">|</span></span><span class="string">#\\+begin_src"</span> . org-latex-engraved-code-preamble<span class="rainbow-delimiters-depth-3">)</span> t<span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-to-list</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-latex-conditional-preambles</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"#\\+BEGIN_SRC</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">|</span></span><span class="string">#\\+begin_src"</span> . engrave-faces-latex-gen-preamble<span class="rainbow-delimiters-depth-3">)</span> t<span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">org-latex-scr-block--engraved</span> <span class="rainbow-delimiters-depth-3">(</span>src-block contents info<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>lang <span class="rainbow-delimiters-depth-3">(</span>org-element-property <span class="builtin">:language</span> src-block<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>attributes <span class="rainbow-delimiters-depth-3">(</span>org-export-read-attribute <span class="builtin">:attr_latex</span> src-block<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span><span class="constant">float</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> attributes <span class="builtin">:float</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>num-start <span class="rainbow-delimiters-depth-3">(</span>org-export-get-loc src-block info<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>retain-labels <span class="rainbow-delimiters-depth-3">(</span>org-element-property <span class="builtin">:retain-labels</span> src-block<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>caption <span class="rainbow-delimiters-depth-3">(</span>org-element-property <span class="builtin">:caption</span> src-block<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>caption-above-p <span class="rainbow-delimiters-depth-3">(</span>org-latex--caption-above-p src-block info<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>caption-str <span class="rainbow-delimiters-depth-3">(</span>org-latex--caption/label-string src-block info<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>placement <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-1">(</span>org-unbracket-string <span class="string">"["</span> <span class="string">"]"</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> attributes <span class="builtin">:placement</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                          <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> info <span class="builtin">:latex-default-figure-position</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>float-env
            <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">cond</span>
             <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span><span class="constant">string=</span> <span class="string">"multicolumn"</span> float<span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="constant">format</span> <span class="string">"\\begin{listing*}[%s]\n%s%%s\n%s\\end{listing*}"</span>
                      placement
                      <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> caption-above-p caption-str <span class="string">""</span><span class="rainbow-delimiters-depth-3">)</span>
                      <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> caption-above-p <span class="string">""</span> caption-str<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
             <span class="rainbow-delimiters-depth-1">(</span>caption
              <span class="rainbow-delimiters-depth-2">(</span><span class="constant">format</span> <span class="string">"\\begin{listing}[%s]\n%s%%s\n%s\\end{listing}"</span>
                      placement
                      <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> caption-above-p caption-str <span class="string">""</span><span class="rainbow-delimiters-depth-3">)</span>
                      <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> caption-above-p <span class="string">""</span> caption-str<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
             <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span><span class="constant">string=</span> <span class="string">"t"</span> float<span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"\\begin{listing}[%s]\n"</span>
                              placement<span class="rainbow-delimiters-depth-3">)</span>
                      <span class="string">"%s\n\\end{listing}"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
             <span class="rainbow-delimiters-depth-1">(</span>t <span class="string">"%s"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>options <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> info <span class="builtin">:latex-minted-options</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>content-buffer
            <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">with-temp-buffer</span>
              <span class="rainbow-delimiters-depth-1">(</span><span class="constant">insert</span>
               <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>code-info <span class="rainbow-delimiters-depth-2">(</span>org-export-unravel-code src-block<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span>max-width
                       <span class="rainbow-delimiters-depth-2">(</span><span class="constant">apply</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">max</span>
                              <span class="rainbow-delimiters-depth-3">(</span><span class="constant">mapcar</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">length</span>
                                      <span class="rainbow-delimiters-depth-1">(</span>org-split-string <span class="rainbow-delimiters-depth-2">(</span><span class="constant">car</span> code-info<span class="rainbow-delimiters-depth-2">)</span>
                                                        <span class="string">"\n"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                 <span class="rainbow-delimiters-depth-3">(</span>org-export-format-code
                  <span class="rainbow-delimiters-depth-1">(</span><span class="constant">car</span> code-info<span class="rainbow-delimiters-depth-1">)</span>
                  <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-2">(</span>loc _num ref<span class="rainbow-delimiters-depth-2">)</span>
                    <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span>
                     loc
                     <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> ref
                       <span class="comment-delimiter">;; </span><span class="comment">Ensure references are flushed to the right,
</span>                       <span class="comment-delimiter">;; </span><span class="comment">separated with 6 spaces from the widest line
</span>                       <span class="comment-delimiter">;; </span><span class="comment">of code.
</span>                       <span class="rainbow-delimiters-depth-1">(</span><span class="constant">concat</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">make-string</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">+</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">-</span> max-width <span class="rainbow-delimiters-depth-2">(</span><span class="constant">length</span> loc<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span> <span class="highlight-numbers-number">6</span><span class="rainbow-delimiters-depth-3">)</span>
                                            ?\s<span class="rainbow-delimiters-depth-2">)</span>
                               <span class="rainbow-delimiters-depth-2">(</span><span class="constant">format</span> <span class="string">"(%s)"</span> ref<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                  nil <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">and</span> retain-labels <span class="rainbow-delimiters-depth-2">(</span><span class="constant">cdr</span> code-info<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
              <span class="rainbow-delimiters-depth-1">(</span><span class="constant">funcall</span> <span class="rainbow-delimiters-depth-2">(</span>org-src-get-lang-mode lang<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
              <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">engrave-faces-latex-buffer</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>content
            <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">with-current-buffer</span> content-buffer
              <span class="rainbow-delimiters-depth-1">(</span><span class="constant">buffer-string</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>body
            <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span>
             <span class="string">"\\begin{Code}\n\\begin{Verbatim}[%s]\n%s\\end{Verbatim}\n\\end{Code}"</span>
             <span class="comment-delimiter">;; </span><span class="comment">Options.
</span>             <span class="rainbow-delimiters-depth-1">(</span><span class="constant">concat</span>
              <span class="rainbow-delimiters-depth-2">(</span>org-latex--make-option-string
               <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">not</span> num-start<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">assoc</span> <span class="string">"linenos"</span> options<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                   options
                 <span class="rainbow-delimiters-depth-1">(</span><span class="constant">append</span>
                  <span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"linenos"</span><span class="rainbow-delimiters-depth-3">)</span>
                    <span class="rainbow-delimiters-depth-3">(</span><span class="string">"firstnumber"</span> ,<span class="rainbow-delimiters-depth-1">(</span><span class="constant">number-to-string</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">1+</span> num-start<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
                  options<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>local-options <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-get</span> attributes <span class="builtin">:options</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">and</span> local-options <span class="rainbow-delimiters-depth-1">(</span><span class="constant">concat</span> <span class="string">","</span> local-options<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
             content<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">kill-buffer</span> content-buffer<span class="rainbow-delimiters-depth-1">)</span>
      <span class="comment-delimiter">;; </span><span class="comment">Return value.
</span>      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">format</span> float-env body<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">org-latex-inline-scr-block--engraved</span> <span class="rainbow-delimiters-depth-3">(</span>inline-src-block _contents info<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>options <span class="rainbow-delimiters-depth-3">(</span>org-latex--make-option-string
                    <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> info <span class="builtin">:latex-minted-options</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
          code-buffer code<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> code-buffer
            <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">with-temp-buffer</span>
              <span class="rainbow-delimiters-depth-3">(</span><span class="constant">insert</span> <span class="rainbow-delimiters-depth-1">(</span>org-element-property <span class="builtin">:value</span> inline-src-block<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
              <span class="rainbow-delimiters-depth-3">(</span><span class="constant">funcall</span> <span class="rainbow-delimiters-depth-1">(</span>org-src-get-lang-mode
                        <span class="rainbow-delimiters-depth-2">(</span>org-element-property <span class="builtin">:language</span> inline-src-block<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
              <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">engrave-faces-latex-buffer</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> code <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">with-current-buffer</span> code-buffer
                   <span class="rainbow-delimiters-depth-3">(</span><span class="constant">buffer-string</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">kill-buffer</span> code-buffer<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">format</span> <span class="string">"\\Verb%s{%s}"</span>
              <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">string=</span> options <span class="string">""</span><span class="rainbow-delimiters-depth-3">)</span> <span class="string">""</span>
                <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"[%s]"</span> options<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
              code<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defadvice!</span> org-latex-example-block-engraved <span class="rainbow-delimiters-depth-3">(</span>orig-fn example-block contents info<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Like `</span><span class="doc"><span class="constant">org-latex-example-block</span></span><span class="doc">', but supporting an engraved backend"</span>
    <span class="builtin">:around</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-latex-example-block</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>output-block <span class="rainbow-delimiters-depth-3">(</span><span class="constant">funcall</span> orig-fn example-block contents info<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">eq</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">engraved</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> info <span class="builtin">:latex-listings</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span><span class="constant">format</span> <span class="string">"\\begin{Code}[alt]\n%s\n\\end{Code}"</span> output-block<span class="rainbow-delimiters-depth-2">)</span>
        output-block<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">+org-latex-replace-non-ascii-chars</span> <span class="rainbow-delimiters-depth-3">(</span>text backend info<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Replace non-ascii chars with \\char\"XYZ forms."</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-2">(</span>org-export-derived-backend-p backend <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">latex</span><span class="rainbow-delimiters-depth-2">)</span>
               <span class="rainbow-delimiters-depth-2">(</span><span class="constant">string=</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> info <span class="builtin">:latex-compiler</span><span class="rainbow-delimiters-depth-3">)</span> <span class="string">"pdflatex"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">replace-regexp-in-string</span> <span class="string">"[</span><span class="string"><span class="negation-char">^</span></span><span class="string">[:ascii:]]"</span> <span class="string">"&#194;&#191;"</span> text<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-to-list</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-export-filter-final-output-functions</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">+org-latex-replace-non-ascii-chars</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defadvice!</span> +org-latex-link <span class="rainbow-delimiters-depth-3">(</span>orig-fn link desc info<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Acts as `</span><span class="doc"><span class="constant">org-latex-link</span></span><span class="doc">', but supports remote images."</span>
    <span class="builtin">:around</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-latex-link</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> o-link link
          o-desc desc
          o-info info<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">member</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">cadr</span> link<span class="rainbow-delimiters-depth-1">)</span> <span class="builtin">:type</span><span class="rainbow-delimiters-depth-3">)</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"http"</span> <span class="string">"https"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
             <span class="rainbow-delimiters-depth-2">(</span><span class="constant">member</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">file-name-extension</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">cadr</span> link<span class="rainbow-delimiters-depth-2">)</span> <span class="builtin">:path</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                     <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"png"</span> <span class="string">"jpg"</span> <span class="string">"jpeg"</span> <span class="string">"pdf"</span> <span class="string">"svg"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
        <span class="rainbow-delimiters-depth-1">(</span>org-latex-link--remote link desc info<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">funcall</span> orig-fn link desc info<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">org-latex-link--remote</span> <span class="rainbow-delimiters-depth-3">(</span>link _desc info<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let*</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>url <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-get</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">cadr</span> link<span class="rainbow-delimiters-depth-1">)</span> <span class="builtin">:raw-link</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>ext <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">file-name-extension</span> url<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
           <span class="rainbow-delimiters-depth-2">(</span>target <span class="rainbow-delimiters-depth-3">(</span><span class="constant">format</span> <span class="string">"%s%s.%s"</span>
                           <span class="rainbow-delimiters-depth-1">(</span><span class="variable-name">temporary-file-directory</span><span class="rainbow-delimiters-depth-1">)</span>
                           <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">replace-regexp-in-string</span> <span class="string">"[./]"</span> <span class="string">"-"</span>
                                                     <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">file-name-sans-extension</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">substring</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">cadr</span> link<span class="rainbow-delimiters-depth-2">)</span> <span class="builtin">:path</span><span class="rainbow-delimiters-depth-1">)</span> <span class="highlight-numbers-number">2</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                           ext<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">unless</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">file-exists-p</span> target<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">url-copy-file</span> url target<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">setcdr</span> link <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">--&gt;</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">cadr</span> link<span class="rainbow-delimiters-depth-3">)</span>
                     <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-put</span> it <span class="builtin">:type</span> <span class="string">"file"</span><span class="rainbow-delimiters-depth-3">)</span>
                     <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-put</span> it <span class="builtin">:path</span> target<span class="rainbow-delimiters-depth-3">)</span>
                     <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-put</span> it <span class="builtin">:raw-link</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">concat</span> <span class="string">"file:"</span> target<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                     <span class="rainbow-delimiters-depth-3">(</span><span class="constant">list</span> it<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">concat</span> <span class="string">"% fetched from "</span> url <span class="string">"\n"</span>
              <span class="rainbow-delimiters-depth-2">(</span>org-latex--inline-image link info<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">after!</span> ox
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defvar</span> <span class="variable-name">ox-chameleon-base-class</span> <span class="string">"fancy-article"</span>
      <span class="doc">"The base class that chameleon builds on"</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defvar</span> <span class="variable-name">ox-chameleon--p</span> nil
      <span class="doc">"Used to indicate whether the current export is trying to blend in. Set just before being accessed."</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="comment-delimiter">;; </span><span class="comment">(setf (alist-get :filter-latex-class
</span>    <span class="comment-delimiter">;;                  </span><span class="comment">(org-export-backend-filters
</span>    <span class="comment-delimiter">;;                   </span><span class="comment">(org-export-get-backend 'latex)))
</span>    <span class="comment-delimiter">;;       </span><span class="comment">'ox-chameleon-latex-class-detector-filter)
</span>  
    <span class="comment-delimiter">;; </span><span class="comment">(defun ox-chameleon-latex-class-detector-filter (info backend)
</span>    <span class="comment-delimiter">;;   </span><span class="comment">""
</span>    <span class="comment-delimiter">;;   </span><span class="comment">(setq ox-chameleon--p (when (equal (plist-get info :latex-class)
</span>    <span class="comment-delimiter">;;                                      </span><span class="comment">"chameleon")
</span>    <span class="comment-delimiter">;;                           </span><span class="comment">(plist-put info :latex-class ox-chameleon-base-class)
</span>    <span class="comment-delimiter">;;                           </span><span class="comment">t)))
</span>  
    <span class="comment-delimiter">;; </span><span class="bold"><span class="warning">TODO</span></span><span class="comment"> make this less hacky. One ideas was as follows
</span>    <span class="comment-delimiter">;; </span><span class="comment">(map-put (org-export-backend-filters (org-export-get-backend 'latex))
</span>    <span class="comment-delimiter">;;           </span><span class="comment">:filter-latex-class 'ox-chameleon-latex-class-detector-filter))
</span>    <span class="comment-delimiter">;; </span><span class="comment">Never seemed to execute though
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defadvice!</span> ox-chameleon-org-latex-detect <span class="rainbow-delimiters-depth-1">(</span>orig-fun info<span class="rainbow-delimiters-depth-1">)</span>
      <span class="builtin">:around</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-export-install-filters</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> ox-chameleon--p <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">equal</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">plist-get</span> info <span class="builtin">:latex-class</span><span class="rainbow-delimiters-depth-1">)</span>
                                         <span class="string">"chameleon"</span><span class="rainbow-delimiters-depth-3">)</span>
                              <span class="rainbow-delimiters-depth-3">(</span><span class="constant">plist-put</span> info <span class="builtin">:latex-class</span> ox-chameleon-base-class<span class="rainbow-delimiters-depth-3">)</span>
                              t<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">funcall</span> orig-fun info<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defadvice!</span> ox-chameleon-org-latex-export <span class="rainbow-delimiters-depth-1">(</span>orig-fn info <span class="type">&amp;optional</span> template snippet?<span class="rainbow-delimiters-depth-1">)</span>
      <span class="builtin">:around</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-latex-make-preamble</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">funcall</span> orig-fn info<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">not</span> ox-chameleon--p<span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span><span class="constant">funcall</span> orig-fn info template snippet?<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">funcall</span> orig-fn info template snippet?<span class="rainbow-delimiters-depth-3">)</span>
                <span class="rainbow-delimiters-depth-3">(</span>ox-chameleon-generate-colourings<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
  
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">defun</span> <span class="function-name">ox-chameleon-generate-colourings</span> <span class="rainbow-delimiters-depth-1">()</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">apply</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">format</span>
             <span class="string">"%% make document follow Emacs theme
  \\definecolor{bg}{HTML}{%s}
  \\definecolor{fg}{HTML}{%s}
  
  \\definecolor{red}{HTML}{%s}
  \\definecolor{orange}{HTML}{%s}
  \\definecolor{green}{HTML}{%s}
  \\definecolor{teal}{HTML}{%s}
  \\definecolor{yellow}{HTML}{%s}
  \\definecolor{blue}{HTML}{%s}
  \\definecolor{dark-blue}{HTML}{%s}
  \\definecolor{magenta}{HTML}{%s}
  \\definecolor{violet}{HTML}{%s}
  \\definecolor{cyan}{HTML}{%s}
  \\definecolor{dark-cyan}{HTML}{%s}
  
  \\definecolor{level1}{HTML}{%s}
  \\definecolor{level2}{HTML}{%s}
  \\definecolor{level3}{HTML}{%s}
  \\definecolor{level4}{HTML}{%s}
  \\definecolor{level5}{HTML}{%s}
  \\definecolor{level6}{HTML}{%s}
  \\definecolor{level7}{HTML}{%s}
  \\definecolor{level8}{HTML}{%s}
  
  \\definecolor{link}{HTML}{%s}
  \\definecolor{cite}{HTML}{%s}
  \\definecolor{itemlabel}{HTML}{%s}
  \\definecolor{code}{HTML}{%s}
  \\definecolor{verbatim}{HTML}{%s}
  
  \\pagecolor{bg}
  \\color{fg}
  
  \\addtokomafont{section}{\\color{level1}}
  \\newkomafont{sectionprefix}{\\color{level1}}
  \\addtokomafont{subsection}{\\color{level2}}
  \\newkomafont{subsectionprefix}{\\color{level2}}
  \\addtokomafont{subsubsection}{\\color{level3}}
  \\newkomafont{subsubsectionprefix}{\\color{level3}}
  \\addtokomafont{paragraph}{\\color{level4}}
  \\newkomafont{paragraphprefix}{\\color{level4}}
  \\addtokomafont{subparagraph}{\\color{level5}}
  \\newkomafont{subparagraphprefix}{\\color{level5}}
  
  \\renewcommand{\\labelitemi}{\\textcolor{itemlabel}{\\textbullet}}
  \\renewcommand{\\labelitemii}{\\textcolor{itemlabel}{\\normalfont\\bfseries \\textendash}}
  \\renewcommand{\\labelitemiii}{\\textcolor{itemlabel}{\\textasteriskcentered}}
  \\renewcommand{\\labelitemiv}{\\textcolor{itemlabel}{\\textperiodcentered}}
  
  \\renewcommand{\\labelenumi}{\\textcolor{itemlabel}{\\theenumi.}}
  \\renewcommand{\\labelenumii}{\\textcolor{itemlabel}{(\\theenumii)}}
  \\renewcommand{\\labelenumiii}{\\textcolor{itemlabel}{\\theenumiii.}}
  \\renewcommand{\\labelenumiv}{\\textcolor{itemlabel}{\\theenumiv.}}
  
  \\DeclareTextFontCommand{\\texttt}{\\color{code}\\ttfamily}
  \\makeatletter
  \\def\\verbatim@font{\\color{verbatim}\\normalfont\\ttfamily}
  \\makeatother
  %% end customisations
  "</span>
             <span class="rainbow-delimiters-depth-2">(</span><span class="constant">mapcar</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">doom-rpartial</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">substring</span> <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-3">)</span>
                     <span class="rainbow-delimiters-depth-3">(</span><span class="constant">list</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">face-attribute</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">solaire-default-face</span> <span class="builtin">:background</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">face-attribute</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">default</span> <span class="builtin">:foreground</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="comment-delimiter">;;</span><span class="comment">
</span>                      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">red</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">orange</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">green</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">teal</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">yellow</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">blue</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">dark-blue</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">magenta</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">violet</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">cyan</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">dark-cyan</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="comment-delimiter">;;</span><span class="comment">
</span>                      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">face-attribute</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">outline-1</span> <span class="builtin">:foreground</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">face-attribute</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">outline-2</span> <span class="builtin">:foreground</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">face-attribute</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">outline-3</span> <span class="builtin">:foreground</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">face-attribute</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">outline-4</span> <span class="builtin">:foreground</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">face-attribute</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">outline-5</span> <span class="builtin">:foreground</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">face-attribute</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">outline-6</span> <span class="builtin">:foreground</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">face-attribute</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">outline-7</span> <span class="builtin">:foreground</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">face-attribute</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">outline-8</span> <span class="builtin">:foreground</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="comment-delimiter">;;</span><span class="comment">
</span>                      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">face-attribute</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">link</span> <span class="builtin">:foreground</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">face-attribute</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-ref-cite-face</span> <span class="builtin">:foreground</span><span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">doom-color</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">yellow</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">face-attribute</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-list-dt</span> <span class="builtin">:foreground</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">face-attribute</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-code</span> <span class="builtin">:foreground</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">face-attribute</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-verbatim</span> <span class="builtin">:foreground</span><span class="rainbow-delimiters-depth-1">)</span>
                      <span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> org-latex-text-markup-alist
        <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>bold . <span class="string">"\\textbf{%s}"</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span>code . protectedtexttt<span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span>italic . <span class="string">"\\emph{%s}"</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span>strike-through . <span class="string">"\\sout{%s}"</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span>underline . <span class="string">"\\uline{%s}"</span><span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span>verbatim . verb<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> org-beamer-theme <span class="string">"[progressbar=foot]metropolis"</span><span class="rainbow-delimiters-depth-2">)</span>
  
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> org-beamer-frame-level <span class="highlight-numbers-number">2</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defadvice!</span> org-md-plain-text-unicode-a <span class="rainbow-delimiters-depth-3">(</span>orig-fn text info<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Locally rebind `</span><span class="doc"><span class="constant">org-html-special-string-regexps</span></span><span class="doc">'"</span>
    <span class="builtin">:around</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">org-md-plain-text</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span>org-html-special-string-regexps
           <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span><span class="string">"\\\\-"</span> . <span class="string">"-"</span><span class="rainbow-delimiters-depth-1">)</span>
             <span class="rainbow-delimiters-depth-1">(</span><span class="string">"---</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">[</span><span class="string"><span class="negation-char">^</span></span><span class="string">-]</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">"</span> . <span class="string">"&#226;&#128;&#148;\\1"</span><span class="rainbow-delimiters-depth-1">)</span>
             <span class="rainbow-delimiters-depth-1">(</span><span class="string">"--</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">[</span><span class="string"><span class="negation-char">^</span></span><span class="string">-]</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">)</span></span><span class="string">"</span> . <span class="string">"&#226;&#128;&#147;\\1"</span><span class="rainbow-delimiters-depth-1">)</span>
             <span class="rainbow-delimiters-depth-1">(</span><span class="string">"\\.\\.\\."</span> . <span class="string">"&#226;&#128;&#166;"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="constant">funcall</span> orig-fn text <span class="rainbow-delimiters-depth-2">(</span><span class="constant">plist-put</span> info <span class="builtin">:with-smart-quotes</span> nil<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> org-babel-python-command <span class="string">"python3"</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">tec-org-python</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">eq</span> <span class="variable-name">major-mode</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">python-mode</span><span class="rainbow-delimiters-depth-1">)</span>
        <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">progn</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">anaconda-mode</span> t<span class="rainbow-delimiters-depth-2">)</span>
               <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">company-mode</span> t<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">org-src-mode-hook</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">tec-org-python</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> ess-eval-visibly <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">nowait</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> ess-R-font-lock-keywords
        <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="rainbow-delimiters-depth-1">(</span>ess-R-fl-keyword:keywords . t<span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span>ess-R-fl-keyword:constants . t<span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span>ess-R-fl-keyword:modifiers . t<span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span>ess-R-fl-keyword:fun-defs . t<span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span>ess-R-fl-keyword:assign-ops . t<span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span>ess-R-fl-keyword:%op% . t<span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span>ess-fl-keyword:fun-calls . t<span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span>ess-fl-keyword:numbers . t<span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span>ess-fl-keyword:operators . t<span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span>ess-fl-keyword:delimiters . t<span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span>ess-fl-keyword:= . t<span class="rainbow-delimiters-depth-1">)</span>
          <span class="rainbow-delimiters-depth-1">(</span>ess-R-fl-keyword:F&amp;T . t<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
<span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> org-roam-directory <span class="string">"~/Desktop/TEC/Organisation/Roam/"</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Compilation][Compilation:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> TeX-save-query nil
      TeX-show-compilation t
      TeX-command-extra-options <span class="string">"-shell-escape"</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> latex
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-to-list</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">TeX-command-list</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"XeLaTeX"</span> <span class="string">"%`xelatex%(mode)%' %t"</span> TeX-run-TeX nil t<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Compilation:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Compilation][Compilation:2]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> <span class="variable-name">+latex-viewers</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span>pdf-tools evince zathura okular skim sumatrapdf<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Compilation:2 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Template][Template:2]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> tec/yas-latex-template-preamble <span class="string">"
\\usepackage[pdfa,unicode=true,hidelinks]{hyperref}

\\usepackage[dvipsnames,svgnames,table,hyperref]{xcolor}
\\renewcommand{\\UrlFont}{\\ttfamily\\small}

\\usepackage[a-2b]{pdfx} % why not be archival

\\usepackage[T1]{fontenc}
\\usepackage[osf,helvratio=0.9]{newpxtext} % pallatino
\\usepackage[scale=0.9]{sourcecodepro}

\\usepackage[varbb]{newpxmath}
\\usepackage{mathtools}
\\usepackage{amssymb}

\\usepackage[activate={true,nocompatibility},final,tracking=true,kerning=true,spacing=true,factor=2000]{microtype}
% microtype makes text look nicer

\\usepackage{graphicx} % include graphics
\\usepackage{grffile} % fix allowed graphicx filenames

\\usepackage{booktabs} % nice table rules
"</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defun</span> <span class="function-name">tec/yas-latex-get-class-choice</span> <span class="rainbow-delimiters-depth-2">()</span>
  <span class="doc">"Prompt user for LaTeX class choice"</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> tec/yas-latex-class-choice <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">ivy-read</span> <span class="string">"Select document class: "</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-1">(</span><span class="string">"article"</span> <span class="string">"scrartcl"</span> <span class="string">"bmc"</span><span class="rainbow-delimiters-depth-1">)</span> <span class="builtin">:def</span> <span class="string">"bmc"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defun</span> <span class="function-name">tec/yas-latex-preamble-if</span> <span class="rainbow-delimiters-depth-2">()</span>
  <span class="doc">"Based on class choice prompt for insertion of default preamble"</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">equal</span> tec/yas-latex-class-choice <span class="string">"bmc"</span><span class="rainbow-delimiters-depth-3">)</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">nil</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">eq</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">read-char-choice</span> <span class="string">"Include default preamble? [Type y/n]"</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span>?y ?n<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span> ?y<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Template:2 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Deliminators][Deliminators:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> tex
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">tec/tex-last-delim-char</span> nil
    <span class="doc">"Last open delim expanded in a tex document"</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defvar</span> <span class="variable-name">tec/tex-delim-dot-second</span> t
    <span class="doc">"When the `</span><span class="doc"><span class="constant">tec/tex-last-delim-char</span></span><span class="doc">' is . a second charachter (this) is prompted for"</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">tec/get-open-delim-char</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="doc">"Exclusivly read next char to tec/tex-last-delim-char"</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> tec/tex-delim-dot-second nil<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">setq</span> tec/tex-last-delim-char <span class="rainbow-delimiters-depth-1">(</span><span class="constant">read-char-exclusive</span> <span class="string">"Opening deliminator, recognises: 9 ( [ { &lt; | ."</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">when</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">eql</span> ?. tec/tex-last-delim-char<span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> tec/tex-delim-dot-second <span class="rainbow-delimiters-depth-2">(</span><span class="constant">read-char-exclusive</span> <span class="string">"Other deliminator, recognises: 0 9 (  ) [ ] { } &lt; &gt; |"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">tec/tex-open-delim-from-char</span> <span class="rainbow-delimiters-depth-3">(</span><span class="type">&amp;optional</span> open-char<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Find the associated opening delim as string"</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">unless</span> open-char <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> open-char <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">eql</span> ?. tec/tex-last-delim-char<span class="rainbow-delimiters-depth-3">)</span>
                                          tec/tex-delim-dot-second
                                        tec/tex-last-delim-char<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">pcase</span> open-char
      <span class="rainbow-delimiters-depth-1">(</span>?\( <span class="string">"("</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span>?9  <span class="string">"("</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span>?\[ <span class="string">"["</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span>?\{ <span class="string">"\\{"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span>?&lt;  <span class="string">"&lt;"</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span>?|  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">if</span> tec/tex-delim-dot-second <span class="string">"."</span> <span class="string">"|"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span>_   <span class="string">"."</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">tec/tex-close-delim-from-char</span> <span class="rainbow-delimiters-depth-3">(</span><span class="type">&amp;optional</span> open-char<span class="rainbow-delimiters-depth-3">)</span>
    <span class="doc">"Find the associated closing delim as string"</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">if</span> tec/tex-delim-dot-second
        <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">pcase</span> tec/tex-delim-dot-second
          <span class="rainbow-delimiters-depth-2">(</span>?\) <span class="string">")"</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span>?0  <span class="string">")"</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span>?\] <span class="string">"]"</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span>?\} <span class="string">"\\}"</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span>?\&gt; <span class="string">"&gt;"</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span>?|  <span class="string">"|"</span><span class="rainbow-delimiters-depth-2">)</span>
          <span class="rainbow-delimiters-depth-2">(</span>_   <span class="string">"."</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">pcase</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">or</span> open-char tec/tex-last-delim-char<span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span>?\( <span class="string">")"</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span>?9  <span class="string">")"</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span>?\[ <span class="string">"]"</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span>?\{ <span class="string">"\\}"</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span>?&lt;  <span class="string">"&gt;"</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span>?\) <span class="string">")"</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span>?0  <span class="string">")"</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span>?\] <span class="string">"]"</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span>?\} <span class="string">"\\}"</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span>?\&gt; <span class="string">"&gt;"</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span>?|  <span class="string">"|"</span><span class="rainbow-delimiters-depth-2">)</span>
        <span class="rainbow-delimiters-depth-2">(</span>_   <span class="string">"."</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">tec/tex-next-char-smart-close-delim</span> <span class="rainbow-delimiters-depth-3">(</span><span class="type">&amp;optional</span> open-char<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">bound-and-true-p</span> <span class="variable-name">smartparens-mode</span><span class="rainbow-delimiters-depth-1">)</span>
         <span class="rainbow-delimiters-depth-1">(</span><span class="constant">eql</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">char-after</span><span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">pcase</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">or</span> open-char tec/tex-last-delim-char<span class="rainbow-delimiters-depth-3">)</span>
                             <span class="rainbow-delimiters-depth-3">(</span>?\( ?\)<span class="rainbow-delimiters-depth-3">)</span>
                             <span class="rainbow-delimiters-depth-3">(</span>?\[ ?\]<span class="rainbow-delimiters-depth-3">)</span>
                             <span class="rainbow-delimiters-depth-3">(</span>?{ ?}<span class="rainbow-delimiters-depth-3">)</span>
                             <span class="rainbow-delimiters-depth-3">(</span>?&lt; ?&gt;<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">tec/tex-delim-yas-expand</span> <span class="rainbow-delimiters-depth-3">(</span><span class="type">&amp;optional</span> open-char<span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">yas-expand-snippet</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">yas-lookup-snippet</span> <span class="string">"_deliminators"</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">latex-mode</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">point</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">+</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">point</span><span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-3">(</span>tec/tex-next-char-smart-close-delim open-char<span class="rainbow-delimiters-depth-3">)</span> <span class="highlight-numbers-number">2</span> <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Deliminators:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Editor visuals][Editor visuals:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">LaTeX-mode-hook</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">mixed-pitch-mode</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Editor visuals:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Editor visuals][Editor visuals:2]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> latex
  <span class="rainbow-delimiters-depth-2">(</span><span class="constant">setcar</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">assoc</span> <span class="string">"&#226;&#139;&#134;"</span> LaTeX-fold-math-spec-list<span class="rainbow-delimiters-depth-3">)</span> <span class="string">"&#226;&#152;&#133;"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span> <span class="comment-delimiter">;; </span><span class="comment">make \star bigger
</span>
<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> TeX-fold-math-spec-list
      <span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-2">(</span><span class="comment-delimiter">;; </span><span class="comment">missing/better symbols
</span>        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#226;&#137;&#164;"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"le"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#226;&#137;&#165;"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"ge"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#226;&#137;&#160;"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"ne"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="comment-delimiter">;; </span><span class="comment">conviniance shorts -- these don't work nicely ATM
</span>        <span class="comment-delimiter">;; </span><span class="comment">("&#226;&#128;&#185;" ("left"))
</span>        <span class="comment-delimiter">;; </span><span class="comment">("&#226;&#128;&#186;" ("right"))
</span>        <span class="comment-delimiter">;; </span><span class="comment">private macros
</span>        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#226;&#132;&#157;"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"RR"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#226;&#132;&#149;"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"NN"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#226;&#132;&#164;"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"ZZ"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#226;&#132;&#154;"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"QQ"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#226;&#132;&#130;"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"CC"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#226;&#132;&#153;"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"PP"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#226;&#132;&#141;"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"HH"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#240;&#157;&#148;&#188;"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"EE"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#240;&#157;&#145;&#145;"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"dd"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="comment-delimiter">;; </span><span class="comment">known commands
</span>        <span class="rainbow-delimiters-depth-3">(</span><span class="string">""</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"phantom"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span>,<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-2">(</span>num den<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">TeX-string-single-token-p</span> num<span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">TeX-string-single-token-p</span> den<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
                                <span class="rainbow-delimiters-depth-3">(</span><span class="constant">concat</span> num <span class="string">"&#239;&#188;&#143;"</span> den<span class="rainbow-delimiters-depth-3">)</span>
                              <span class="rainbow-delimiters-depth-3">(</span><span class="constant">concat</span> <span class="string">"&#226;&#157;&#170;"</span> num <span class="string">"&#239;&#188;&#143;"</span> den <span class="string">"&#226;&#157;&#171;"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"frac"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span>,<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-2">(</span>arg<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span> <span class="string">"&#226;&#136;&#154;"</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">TeX-fold-parenthesize-as-neccesary</span> arg<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"sqrt"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span>,<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-2">(</span>arg<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">concat</span> <span class="string">"&#226;&#173;&#161;"</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">TeX-fold-parenthesize-as-neccesary</span> arg<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"vec"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#226;&#128;&#152;{1}&#226;&#128;&#153;"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"text"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="comment-delimiter">;; </span><span class="comment">private commands
</span>        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"|{1}|"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"abs"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#226;&#128;&#150;{1}&#226;&#128;&#150;"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"norm"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#226;&#140;&#138;{1}&#226;&#140;&#139;"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"floor"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#226;&#140;&#136;{1}&#226;&#140;&#137;"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"ceil"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#226;&#140;&#138;{1}&#226;&#140;&#137;"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"round"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#240;&#157;&#145;&#145;{1}/&#240;&#157;&#145;&#145;{2}"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"dv"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#226;&#136;&#130;{1}/&#226;&#136;&#130;{2}"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"pdv"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="comment-delimiter">;; </span><span class="comment">fancification
</span>        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"{1}"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"mathrm"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span>,<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-2">(</span>word<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">string-offset-roman-chars</span> <span class="highlight-numbers-number">119743</span> word<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"mathbf"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span>,<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-2">(</span>word<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">string-offset-roman-chars</span> <span class="highlight-numbers-number">119951</span> word<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"mathcal"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span>,<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-2">(</span>word<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">string-offset-roman-chars</span> <span class="highlight-numbers-number">120003</span> word<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"mathfrak"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span>,<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-2">(</span>word<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">string-offset-roman-chars</span> <span class="highlight-numbers-number">120055</span> word<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"mathbb"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span>,<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-2">(</span>word<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">string-offset-roman-chars</span> <span class="highlight-numbers-number">120159</span> word<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"mathsf"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span>,<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-2">(</span>word<span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">string-offset-roman-chars</span> <span class="highlight-numbers-number">120367</span> word<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"mathtt"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-2">)</span>
      TeX-fold-macro-spec-list
      <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span>
        <span class="comment-delimiter">;; </span><span class="comment">as the defaults
</span>        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"[f]"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"footnote"</span> <span class="string">"marginpar"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"[c]"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"cite"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"[l]"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"label"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"[r]"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"ref"</span> <span class="string">"pageref"</span> <span class="string">"eqref"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"[i]"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"index"</span> <span class="string">"glossary"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"..."</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"dots"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"{1}"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"emph"</span> <span class="string">"textit"</span> <span class="string">"textsl"</span> <span class="string">"textmd"</span> <span class="string">"textrm"</span> <span class="string">"textsf"</span> <span class="string">"texttt"</span>
                <span class="string">"textbf"</span> <span class="string">"textsc"</span> <span class="string">"textup"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="comment-delimiter">;; </span><span class="comment">tweaked defaults
</span>        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#194;&#169;"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"copyright"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#194;&#174;"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"textregistered"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#226;&#132;&#162;"</span>  <span class="rainbow-delimiters-depth-1">(</span><span class="string">"texttrademark"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"[1]:||&#226;&#150;&#186;"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"item"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#226;&#157;&#161;&#226;&#157;&#161;&#226;&#128;&#134;{1}"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"part"</span> <span class="string">"part*"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#226;&#157;&#161;&#226;&#128;&#134;{1}"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"chapter"</span> <span class="string">"chapter*"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#194;&#167;&#226;&#128;&#134;{1}"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"section"</span> <span class="string">"section*"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#194;&#167;&#194;&#167;&#226;&#128;&#134;{1}"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"subsection"</span> <span class="string">"subsection*"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#194;&#167;&#194;&#167;&#194;&#167;&#226;&#128;&#134;{1}"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"subsubsection"</span> <span class="string">"subsubsection*"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#194;&#182;&#226;&#128;&#134;{1}"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"paragraph"</span> <span class="string">"paragraph*"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#194;&#182;&#194;&#182;&#226;&#128;&#134;{1}"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"subparagraph"</span> <span class="string">"subparagraph*"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="comment-delimiter">;; </span><span class="comment">extra
</span>        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#226;&#172;&#150;&#226;&#128;&#134;{1}"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"begin"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-3">(</span><span class="string">"&#226;&#172;&#151;&#226;&#128;&#134;{1}"</span> <span class="rainbow-delimiters-depth-1">(</span><span class="string">"end"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
        <span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defun</span> <span class="function-name">string-offset-roman-chars</span> <span class="rainbow-delimiters-depth-2">(</span>offset word<span class="rainbow-delimiters-depth-2">)</span>
  <span class="doc">"Shift the codepoint of each charachter in WORD by OFFSET with an extra -6 shift if the letter is lowercase"</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="constant">apply</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">string</span>
         <span class="rainbow-delimiters-depth-3">(</span><span class="constant">mapcar</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">lambda</span> <span class="rainbow-delimiters-depth-2">(</span>c<span class="rainbow-delimiters-depth-2">)</span>
                   <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">string-offset-apply-roman-char-exceptions</span>
                    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">+</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">&gt;=</span> c <span class="highlight-numbers-number">97</span><span class="rainbow-delimiters-depth-2">)</span> <span class="rainbow-delimiters-depth-2">(</span><span class="constant">-</span> c <span class="highlight-numbers-number">6</span><span class="rainbow-delimiters-depth-2">)</span> c<span class="rainbow-delimiters-depth-1">)</span> offset<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
                 word<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defvar</span> <span class="variable-name">string-offset-roman-char-exceptions</span>
  <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span><span class="comment-delimiter">;; </span><span class="comment">lowercase serif
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-numbers-number">119892</span> .  <span class="highlight-numbers-number">8462</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">&#226;&#132;&#142;
</span>    <span class="comment-delimiter">;; </span><span class="comment">lowercase caligraphic
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-numbers-number">119994</span> . <span class="highlight-numbers-number">8495</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">&#226;&#132;&#175;
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-numbers-number">119996</span> . <span class="highlight-numbers-number">8458</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">&#226;&#132;&#138;
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-numbers-number">120004</span> . <span class="highlight-numbers-number">8500</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">&#226;&#132;&#180;
</span>    <span class="comment-delimiter">;; </span><span class="comment">caligraphic
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-numbers-number">119965</span> . <span class="highlight-numbers-number">8492</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">&#226;&#132;&#172;
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-numbers-number">119968</span> . <span class="highlight-numbers-number">8496</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">&#226;&#132;&#176;
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-numbers-number">119969</span> . <span class="highlight-numbers-number">8497</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">&#226;&#132;&#177;
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-numbers-number">119971</span> . <span class="highlight-numbers-number">8459</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">&#226;&#132;&#139;
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-numbers-number">119972</span> . <span class="highlight-numbers-number">8464</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">&#226;&#132;&#144;
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-numbers-number">119975</span> . <span class="highlight-numbers-number">8466</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">&#226;&#132;&#146;
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-numbers-number">119976</span> . <span class="highlight-numbers-number">8499</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">&#226;&#132;&#179;
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-numbers-number">119981</span> . <span class="highlight-numbers-number">8475</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">&#226;&#132;&#155;
</span>    <span class="comment-delimiter">;; </span><span class="comment">fraktur
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-numbers-number">120070</span> . <span class="highlight-numbers-number">8493</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">&#226;&#132;&#173;
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-numbers-number">120075</span> . <span class="highlight-numbers-number">8460</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">&#226;&#132;&#140;
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-numbers-number">120076</span> . <span class="highlight-numbers-number">8465</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">&#226;&#132;&#145;
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-numbers-number">120085</span> . <span class="highlight-numbers-number">8476</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">&#226;&#132;&#156;
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-numbers-number">120092</span> . <span class="highlight-numbers-number">8488</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">&#226;&#132;&#168;
</span>    <span class="comment-delimiter">;; </span><span class="comment">blackboard
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-numbers-number">120122</span> . <span class="highlight-numbers-number">8450</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">&#226;&#132;&#130;
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-numbers-number">120127</span> . <span class="highlight-numbers-number">8461</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">&#226;&#132;&#141;
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-numbers-number">120133</span> . <span class="highlight-numbers-number">8469</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">&#226;&#132;&#149;
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-numbers-number">120135</span> . <span class="highlight-numbers-number">8473</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">&#226;&#132;&#153;
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-numbers-number">120136</span> . <span class="highlight-numbers-number">8474</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">&#226;&#132;&#154;
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-numbers-number">120137</span> . <span class="highlight-numbers-number">8477</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">&#226;&#132;&#157;
</span>    <span class="rainbow-delimiters-depth-3">(</span><span class="highlight-numbers-number">120145</span> . <span class="highlight-numbers-number">8484</span><span class="rainbow-delimiters-depth-3">)</span> <span class="comment-delimiter">; </span><span class="comment">&#226;&#132;&#164;
</span>    <span class="rainbow-delimiters-depth-2">)</span>
  <span class="doc">"An alist of deceptive codepoints, and then where the glyph actually resides."</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defun</span> <span class="function-name">string-offset-apply-roman-char-exceptions</span> <span class="rainbow-delimiters-depth-2">(</span>char<span class="rainbow-delimiters-depth-2">)</span>
  <span class="doc">"Sometimes the codepoint doesn't contain the char you expect.
Such special cases should be remapped to another value, as given in `</span><span class="doc"><span class="constant">string-offset-roman-char-exceptions</span></span><span class="doc">'."</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-3">(</span><span class="constant">assoc</span> char <span class="variable-name">string-offset-roman-char-exceptions</span><span class="rainbow-delimiters-depth-3">)</span>
      <span class="rainbow-delimiters-depth-3">(</span><span class="constant">cdr</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">assoc</span> char <span class="variable-name">string-offset-roman-char-exceptions</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    char<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defun</span> <span class="function-name">TeX-fold-parenthesize-as-neccesary</span> <span class="rainbow-delimiters-depth-2">(</span>tokens <span class="type">&amp;optional</span> suppress-left suppress-right<span class="rainbow-delimiters-depth-2">)</span>
  <span class="doc">"Add &#226;&#157;&#170; &#226;&#157;&#171; parenthesis as if multiple LaTeX tokens appear to be present"</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">TeX-string-single-token-p</span> tokens<span class="rainbow-delimiters-depth-3">)</span> tokens
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">concat</span> <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> suppress-left <span class="string">""</span> <span class="string">"&#226;&#157;&#170;"</span><span class="rainbow-delimiters-depth-1">)</span>
            tokens
            <span class="rainbow-delimiters-depth-1">(</span><span class="keyword">if</span> suppress-right <span class="string">""</span> <span class="string">"&#226;&#157;&#171;"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defun</span> <span class="function-name">TeX-string-single-token-p</span> <span class="rainbow-delimiters-depth-2">(</span>teststring<span class="rainbow-delimiters-depth-2">)</span>
  <span class="doc">"Return t if TESTSTRING appears to be a single token, nil otherwise"</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">string-match-p</span> <span class="string">"^\\\\?\\w+$"</span> teststring<span class="rainbow-delimiters-depth-3">)</span> t nil<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Editor visuals:2 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Editor visuals][Editor visuals:3]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> tex
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">map!</span>
   <span class="builtin">:map</span> LaTeX-mode-map
   <span class="builtin">:ei</span> <span class="rainbow-delimiters-depth-3">[</span>C-return<span class="rainbow-delimiters-depth-3">]</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">LaTeX-insert-item</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> TeX-electric-math <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"</span><span class="string"><span class="regexp-grouping-backslash">\\</span></span><span class="string"><span class="regexp-grouping-construct">(</span></span><span class="string">"</span> . <span class="string">""</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Editor visuals:3 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Editor visuals][Editor visuals:4]]
</span><span class="comment-delimiter">;; </span><span class="comment">Making \( \) less visible
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">defface</span> <span class="variable-name">unimportant-latex-face</span>
  <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>t
     <span class="builtin">:inherit</span> <span class="variable-name">font-lock-comment-face</span> <span class="builtin">:family</span> <span class="string">"Overpass"</span> <span class="builtin">:weight</span> light<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="doc">"Face used to make \\(\\), \\[</span><span class="doc"><span class="constant">\\</span></span><span class="doc">] less visible."</span>
  <span class="builtin">:group</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">LaTeX-math</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="function-name">font-lock-add-keywords</span>
 <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">latex-mode</span>
 <span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>,<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">rx</span> <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">and</span> <span class="string">"\\"</span> <span class="rainbow-delimiters-depth-3">(</span>any <span class="string">"()[]"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span> <span class="highlight-numbers-number">0</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">unimportant-latex-face</span> prepend<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
 <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">end</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="function-name">font-lock-add-keywords</span>
 <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">latex-mode</span>
 <span class="highlight-quoted-quote">`</span><span class="rainbow-delimiters-depth-2">(</span><span class="rainbow-delimiters-depth-3">(</span>,<span class="string">"\\\\[[:word:]]+"</span> <span class="highlight-numbers-number">0</span> <span class="highlight-quoted-quote">'</span><span class="variable-name">font-lock-keyword-face</span> prepend<span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
 <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">end</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Editor visuals:4 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Editor visuals][Editor visuals:5]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">setq</span> preview-LaTeX-command <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span><span class="string">"%`%l \"\\nonstopmode\\nofiles\
\\PassOptionsToPackage{"</span> <span class="rainbow-delimiters-depth-3">(</span><span class="string">","</span> . preview-required-option-list<span class="rainbow-delimiters-depth-3">)</span> <span class="string">"}{preview}\
\\AtBeginDocument{\\ifx\\ifPreview\\undefined"</span>
preview-default-preamble <span class="string">"\\fi}\"%' \"\\detokenize{\" %t \"}\""</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Editor visuals:5 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*CDLaTeX][CDLaTeX:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> cdlatex
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> <span class="comment-delimiter">;; </span><span class="comment">cdlatex-math-symbol-prefix ?\; ;; doesn't work at the moment :(
</span>   cdlatex-math-symbol-alist
   <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span> <span class="comment-delimiter">;; </span><span class="comment">adding missing functions to 3rd level symbols
</span>     <span class="rainbow-delimiters-depth-1">(</span>?_    <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\downarrow"</span>  <span class="string">""</span>           <span class="string">"\\inf"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
     <span class="rainbow-delimiters-depth-1">(</span>?2    <span class="rainbow-delimiters-depth-2">(</span><span class="string">"^2"</span>           <span class="string">"\\sqrt{?}"</span>     <span class="string">""</span>     <span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
     <span class="rainbow-delimiters-depth-1">(</span>?3    <span class="rainbow-delimiters-depth-2">(</span><span class="string">"^3"</span>           <span class="string">"\\sqrt[3]{?}"</span>  <span class="string">""</span>     <span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
     <span class="rainbow-delimiters-depth-1">(</span>?^    <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\uparrow"</span>    <span class="string">""</span>           <span class="string">"\\sup"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
     <span class="rainbow-delimiters-depth-1">(</span>?k    <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\kappa"</span>      <span class="string">""</span>           <span class="string">"\\ker"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
     <span class="rainbow-delimiters-depth-1">(</span>?m    <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\mu"</span>         <span class="string">""</span>           <span class="string">"\\lim"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
     <span class="rainbow-delimiters-depth-1">(</span>?c    <span class="rainbow-delimiters-depth-2">(</span><span class="string">""</span>             <span class="string">"\\circ"</span>     <span class="string">"\\cos"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
     <span class="rainbow-delimiters-depth-1">(</span>?d    <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\delta"</span>      <span class="string">"\\partial"</span>  <span class="string">"\\dim"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
     <span class="rainbow-delimiters-depth-1">(</span>?D    <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\Delta"</span>      <span class="string">"\\nabla"</span>    <span class="string">"\\deg"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
     <span class="comment-delimiter">;; </span><span class="comment">no idea why \Phi isnt on 'F' in first place, \phi is on 'f'.
</span>     <span class="rainbow-delimiters-depth-1">(</span>?F    <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\Phi"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
     <span class="comment-delimiter">;; </span><span class="comment">now just conveniance
</span>     <span class="rainbow-delimiters-depth-1">(</span>?.    <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\cdot"</span> <span class="string">"\\dots"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
     <span class="rainbow-delimiters-depth-1">(</span>?:    <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\vdots"</span> <span class="string">"\\ddots"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
     <span class="rainbow-delimiters-depth-1">(</span>?*    <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\times"</span> <span class="string">"\\star"</span> <span class="string">"\\ast"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
   cdlatex-math-modify-alist
   <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span> <span class="comment-delimiter">;; </span><span class="comment">my own stuff
</span>     <span class="rainbow-delimiters-depth-1">(</span>?B    <span class="string">"\\mathbb"</span>        nil          t    nil  nil<span class="rainbow-delimiters-depth-1">)</span>
     <span class="rainbow-delimiters-depth-1">(</span>?a    <span class="string">"\\abs"</span>           nil          t    nil  nil<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">CDLaTeX:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*SyncTeX][SyncTeX:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> tex
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-to-list</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">TeX-view-program-list</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="string">"Evince"</span> <span class="string">"evince %o"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-to-list</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">TeX-view-program-selection</span> <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span>output-pdf <span class="string">"Evince"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">SyncTeX:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Fixes][Fixes:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">when</span> <span class="variable-name">EMACS28+</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">add-hook</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">latex-mode-hook</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">TeX-latex-mode</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Fixes:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Python][Python:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> lsp-python-ms
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">set-lsp-priority!</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">mspyls</span> <span class="highlight-numbers-number">1</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Python:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Editor Visuals][Editor Visuals:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">after!</span> ess-r-mode
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">appendq!</span> <span class="variable-name">+ligatures-extra-symbols</span>
            <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-3">(</span><span class="builtin">:assign</span> <span class="string">"&#226;&#159;&#181;"</span>
              <span class="builtin">:multiply</span> <span class="string">"&#195;&#151;"</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">set-ligatures!</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">ess-r-mode</span>
    <span class="comment-delimiter">;; </span><span class="comment">Functional
</span>    <span class="builtin">:def</span> <span class="string">"function"</span>
    <span class="comment-delimiter">;; </span><span class="comment">Types
</span>    <span class="builtin">:null</span> <span class="string">"NULL"</span>
    <span class="builtin">:true</span> <span class="string">"TRUE"</span>
    <span class="builtin">:false</span> <span class="string">"FALSE"</span>
    <span class="builtin">:int</span> <span class="string">"int"</span>
    <span class="builtin">:floar</span> <span class="string">"float"</span>
    <span class="builtin">:bool</span> <span class="string">"bool"</span>
    <span class="comment-delimiter">;; </span><span class="comment">Flow
</span>    <span class="builtin">:not</span> <span class="string">"!"</span>
    <span class="builtin">:and</span> <span class="string">"&amp;&amp;"</span> <span class="builtin">:or</span> <span class="string">"||"</span>
    <span class="builtin">:for</span> <span class="string">"for"</span>
    <span class="builtin">:in</span> <span class="string">"%in%"</span>
    <span class="builtin">:return</span> <span class="string">"return"</span>
    <span class="comment-delimiter">;; </span><span class="comment">Other
</span>    <span class="builtin">:assign</span> <span class="string">"&lt;-"</span>
    <span class="builtin">:multiply</span> <span class="string">"%*%"</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Editor Visuals:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Graphviz][Graphviz:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">use-package!</span> graphviz-dot-mode
  <span class="builtin">:commands</span> graphviz-dot-mode
  <span class="builtin">:mode</span> <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\.dot\\'"</span> <span class="string">"\\.gz\\'"</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="builtin">:init</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">after!</span> org
    <span class="rainbow-delimiters-depth-3">(</span><span class="constant">setcdr</span> <span class="rainbow-delimiters-depth-1">(</span><span class="constant">assoc</span> <span class="string">"dot"</span> org-src-lang-modes<span class="rainbow-delimiters-depth-1">)</span>
            <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">graphviz-dot</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>

<span class="rainbow-delimiters-depth-1">(</span><span class="keyword">use-package!</span> company-graphviz-dot
  <span class="builtin">:after</span> graphviz-dot-mode<span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Graphviz:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Markdown][Markdown:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">add-hook!</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">gfm-mode</span> markdown-mode<span class="rainbow-delimiters-depth-2">)</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">mixed-pitch-mode</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Markdown:1 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Markdown][Markdown:2]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">add-hook!</span> <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">gfm-mode</span> markdown-mode<span class="rainbow-delimiters-depth-2">)</span> <span class="highlight-quoted-quote">#'</span><span class="variable-name">visual-line-mode</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">turn-off-auto-fill</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Markdown:2 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Markdown][Markdown:3]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">custom-set-faces!</span>
  <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span>markdown-header-face-1 <span class="builtin">:height</span> <span class="highlight-numbers-number">1.25</span> <span class="builtin">:weight</span> extra-bold <span class="builtin">:inherit</span> markdown-header-face<span class="rainbow-delimiters-depth-2">)</span>
  <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span>markdown-header-face-2 <span class="builtin">:height</span> <span class="highlight-numbers-number">1.15</span> <span class="builtin">:weight</span> bold       <span class="builtin">:inherit</span> markdown-header-face<span class="rainbow-delimiters-depth-2">)</span>
  <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span>markdown-header-face-3 <span class="builtin">:height</span> <span class="highlight-numbers-number">1.08</span> <span class="builtin">:weight</span> bold       <span class="builtin">:inherit</span> markdown-header-face<span class="rainbow-delimiters-depth-2">)</span>
  <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span>markdown-header-face-4 <span class="builtin">:height</span> <span class="highlight-numbers-number">1.00</span> <span class="builtin">:weight</span> bold       <span class="builtin">:inherit</span> markdown-header-face<span class="rainbow-delimiters-depth-2">)</span>
  <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span>markdown-header-face-5 <span class="builtin">:height</span> <span class="highlight-numbers-number">0.90</span> <span class="builtin">:weight</span> bold       <span class="builtin">:inherit</span> markdown-header-face<span class="rainbow-delimiters-depth-2">)</span>
  <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-2">(</span>markdown-header-face-6 <span class="builtin">:height</span> <span class="highlight-numbers-number">0.75</span> <span class="builtin">:weight</span> extra-bold <span class="builtin">:inherit</span> markdown-header-face<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Markdown:3 ends here
</span>
<span class="comment-delimiter">;; </span><span class="comment">[[file:~/.config/doom/config.org::*Beancount][Beancount:1]]
</span><span class="rainbow-delimiters-depth-1">(</span><span class="keyword">use-package!</span> beancount
  <span class="builtin">:mode</span> <span class="rainbow-delimiters-depth-2">(</span><span class="string">"\\.beancount\\'"</span> . beancount-mode<span class="rainbow-delimiters-depth-2">)</span>
  <span class="builtin">:init</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">after!</span> all-the-icons
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">add-to-list</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">all-the-icons-icon-alist</span>
                 <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-1">(</span><span class="string">"\\.beancount\\'"</span> all-the-icons-material <span class="string">"attach_money"</span> <span class="builtin">:face</span> all-the-icons-lblue<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="function-name">add-to-list</span> <span class="highlight-quoted-quote">'</span><span class="highlight-quoted-symbol">all-the-icons-mode-icon-alist</span>
                 <span class="highlight-quoted-quote">'</span><span class="rainbow-delimiters-depth-1">(</span>beancount-mode all-the-icons-material <span class="string">"attach_money"</span> <span class="builtin">:face</span> all-the-icons-lblue<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="builtin">:config</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">setq</span> beancount-electric-currency t<span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">defun</span> <span class="function-name">beancount-bal</span> <span class="rainbow-delimiters-depth-3">()</span>
    <span class="doc">"Run bean-report bal."</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">interactive</span><span class="rainbow-delimiters-depth-3">)</span>
    <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-1">(</span><span class="rainbow-delimiters-depth-2">(</span><span class="variable-name">compilation-read-command</span> nil<span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
      <span class="rainbow-delimiters-depth-1">(</span>beancount--run <span class="string">"bean-report"</span>
                      <span class="rainbow-delimiters-depth-2">(</span><span class="function-name">file-relative-name</span> <span class="variable-name">buffer-file-name</span><span class="rainbow-delimiters-depth-2">)</span> <span class="string">"bal"</span><span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span>
  <span class="rainbow-delimiters-depth-2">(</span><span class="keyword">map!</span> <span class="builtin">:map</span> beancount-mode-map
        <span class="builtin">:n</span> <span class="string">"TAB"</span> <span class="highlight-quoted-quote">#'</span><span class="highlight-quoted-symbol">beancount-align-to-previous-number</span>
        <span class="builtin">:i</span> <span class="string">"RET"</span> <span class="rainbow-delimiters-depth-3">(</span><span class="keyword">cmd!</span> <span class="rainbow-delimiters-depth-1">(</span><span class="function-name">newline-and-indent</span><span class="rainbow-delimiters-depth-1">)</span> <span class="rainbow-delimiters-depth-1">(</span>beancount-align-to-previous-number<span class="rainbow-delimiters-depth-1">)</span><span class="rainbow-delimiters-depth-3">)</span><span class="rainbow-delimiters-depth-2">)</span><span class="rainbow-delimiters-depth-1">)</span>
<span class="comment-delimiter">;; </span><span class="comment">Beancount:1 ends here
</span></pre>
  </body>
</html>
